"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function He(t){if(!t)return t;if(typeof t.toJSON=="function"&&(t=t.toJSON()),Array.isArray(t))return t.map(He);if(typeof t=="object"){const e={};return Object.keys(t).forEach(n=>e[n]=He(t[n])),e}return t}const ss={};function O(t,e,n=ss){if(t===e)return!0;const s=typeof t,r=typeof t;if(s==="number"&&r==="number"&&isNaN(t)&&isNaN(e))return!0;if(!t||!e||s!=="object"||r!=="object"||t.constructor!==e.constructor)return!1;if(t.valueOf()!==t)return O(t.valueOf(),e.valueOf(),n);const i=n.shallow?rs:O;if(typeof t[Symbol.iterator]=="function"){const l=t[Symbol.iterator](),a=e[Symbol.iterator]();let h=l.next(),d=a.next();for(;!h.done&&!d.done;){if(!i(h.value,d.value,n))return!1;h=l.next(),d=a.next()}return h.done===d.done}let o=Object.keys(t),c=Object.keys(e);if(n.excludeProps){const l=is(n.excludeProps);o=o.filter(l),c=c.filter(l)}return(n.partial||o.length===c.length)&&c.every(l=>t.hasOwnProperty(l)&&i(e[l],t[l],n))}function rs(t,e){return t===e}function is(t){return e=>!t.has(e)}function ue(t){return t===Object(t)&&!Array.isArray(t)}function Kt(t){if(t==null)return!0;if(!ue(t))return!1;for(const e in t)if(!Kt(t[e]))return!1;return!0}var rt;(t=>{function e(i={},o={},c){typeof i!="object"&&(i={}),typeof o!="object"&&(o={});let l=He(o);for(const a in i)ue(i[a])&&ue(l[a])&&(l[a]=e(i[a],l[a],c));c||(l=Object.keys(l).reduce((a,h)=>(Kt(l[h])||(a[h]=l[h]),a),{}));for(const a in i)i[a]!==void 0&&o[a]===void 0&&(l[a]=i[a]);return Object.keys(l).length>0?l:void 0}t.compose=e;function n(i={},o={}){typeof i!="object"&&(i={}),typeof o!="object"&&(o={});const c=Object.keys(i).concat(Object.keys(o)).reduce((l,a)=>(O(i[a],o[a])||(o[a]===void 0?l[a]=null:ue(i[a])&&ue(o[a])?l[a]=n(i[a],o[a]):l[a]=o[a]),l),{});return Object.keys(c).length>0?c:void 0}t.diff=n;function s(i={},o={}){i=i||{};const c=Object.keys(o).reduce((l,a)=>(!O(o[a],i[a])&&i[a]!==void 0&&(ue(i[a])&&ue(o[a])?l[a]=s(i[a],o[a]):l[a]=o[a]),l),{});return Object.keys(i).reduce((l,a)=>(i[a]!==o[a]&&o[a]===void 0&&(l[a]=null),l),c)}t.invert=s;function r(i,o,c=!1){if(typeof i!="object")return o;if(typeof o!="object")return;if(!c)return o;const l=Object.keys(o).reduce((a,h)=>(i[h]===void 0?a[h]=o[h]:ue(i[h])&&ue(o[h])&&(a[h]=r(i[h],o[h],!0)),a),{});return Object.keys(l).length>0?l:void 0}t.transform=r})(rt||(rt={}));const te=rt;function os(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var et,Mt;function cs(){if(Mt)return et;Mt=1;var t=-1,e=1,n=0;function s(u,y,p,w,E){if(u===y)return u?[[n,u]]:[];if(p!=null){var v=re(u,y,p);if(v)return v}var L=c(u,y),N=u.substring(0,L);u=u.substring(L),y=y.substring(L),L=a(u,y);var T=u.substring(u.length-L);u=u.substring(0,u.length-L),y=y.substring(0,y.length-L);var F=r(u,y);return N&&F.unshift([n,N]),T&&F.push([n,T]),M(F,E),w&&d(F),F}function r(u,y){var p;if(!u)return[[e,y]];if(!y)return[[t,u]];var w=u.length>y.length?u:y,E=u.length>y.length?y:u,v=w.indexOf(E);if(v!==-1)return p=[[e,w.substring(0,v)],[n,E],[e,w.substring(v+E.length)]],u.length>y.length&&(p[0][0]=p[2][0]=t),p;if(E.length===1)return[[t,u],[e,y]];var L=h(u,y);if(L){var N=L[0],T=L[1],F=L[2],S=L[3],R=L[4],H=s(N,F),B=s(T,S);return H.concat([[n,R]],B)}return i(u,y)}function i(u,y){for(var p=u.length,w=y.length,E=Math.ceil((p+w)/2),v=E,L=2*E,N=new Array(L),T=new Array(L),F=0;F<L;F++)N[F]=-1,T[F]=-1;N[v+1]=0,T[v+1]=0;for(var S=p-w,R=S%2!==0,H=0,B=0,W=0,K=0,G=0;G<E;G++){for(var P=-G+H;P<=G-B;P+=2){var $=v+P,z;P===-G||P!==G&&N[$-1]<N[$+1]?z=N[$+1]:z=N[$-1]+1;for(var U=z-P;z<p&&U<w&&u.charAt(z)===y.charAt(U);)z++,U++;if(N[$]=z,z>p)B+=2;else if(U>w)H+=2;else if(R){var Y=v+S-P;if(Y>=0&&Y<L&&T[Y]!==-1){var Q=p-T[Y];if(z>=Q)return o(u,y,z,U)}}}for(var ne=-G+W;ne<=G-K;ne+=2){var Y=v+ne,Q;ne===-G||ne!==G&&T[Y-1]<T[Y+1]?Q=T[Y+1]:Q=T[Y-1]+1;for(var ce=Q-ne;Q<p&&ce<w&&u.charAt(p-Q-1)===y.charAt(w-ce-1);)Q++,ce++;if(T[Y]=Q,Q>p)K+=2;else if(ce>w)W+=2;else if(!R){var $=v+S-ne;if($>=0&&$<L&&N[$]!==-1){var z=N[$],U=v+z-$;if(Q=p-Q,z>=Q)return o(u,y,z,U)}}}}return[[t,u],[e,y]]}function o(u,y,p,w){var E=u.substring(0,p),v=y.substring(0,w),L=u.substring(p),N=y.substring(w),T=s(E,v),F=s(L,N);return T.concat(F)}function c(u,y){if(!u||!y||u.charAt(0)!==y.charAt(0))return 0;for(var p=0,w=Math.min(u.length,y.length),E=w,v=0;p<E;)u.substring(v,E)==y.substring(v,E)?(p=E,v=p):w=E,E=Math.floor((w-p)/2+p);return k(u.charCodeAt(E-1))&&E--,E}function l(u,y){var p=u.length,w=y.length;if(p==0||w==0)return 0;p>w?u=u.substring(p-w):p<w&&(y=y.substring(0,p));var E=Math.min(p,w);if(u==y)return E;for(var v=0,L=1;;){var N=u.substring(E-L),T=y.indexOf(N);if(T==-1)return v;L+=T,(T==0||u.substring(E-L)==y.substring(0,L))&&(v=L,L++)}}function a(u,y){if(!u||!y||u.slice(-1)!==y.slice(-1))return 0;for(var p=0,w=Math.min(u.length,y.length),E=w,v=0;p<E;)u.substring(u.length-E,u.length-v)==y.substring(y.length-E,y.length-v)?(p=E,v=p):w=E,E=Math.floor((w-p)/2+p);return Z(u.charCodeAt(u.length-E))&&E--,E}function h(u,y){var p=u.length>y.length?u:y,w=u.length>y.length?y:u;if(p.length<4||w.length*2<p.length)return null;function E(B,W,K){for(var G=B.substring(K,K+Math.floor(B.length/4)),P=-1,$="",z,U,Y,Q;(P=W.indexOf(G,P+1))!==-1;){var ne=c(B.substring(K),W.substring(P)),ce=a(B.substring(0,K),W.substring(0,P));$.length<ce+ne&&($=W.substring(P-ce,P)+W.substring(P,P+ne),z=B.substring(0,K-ce),U=B.substring(K+ne),Y=W.substring(0,P-ce),Q=W.substring(P+ne))}return $.length*2>=B.length?[z,U,Y,Q,$]:null}var v=E(p,w,Math.ceil(p.length/4)),L=E(p,w,Math.ceil(p.length/2)),N;if(!v&&!L)return null;L?v?N=v[4].length>L[4].length?v:L:N=L:N=v;var T,F,S,R;u.length>y.length?(T=N[0],F=N[1],S=N[2],R=N[3]):(S=N[0],R=N[1],T=N[2],F=N[3]);var H=N[4];return[T,F,S,R,H]}function d(u){for(var y=!1,p=[],w=0,E=null,v=0,L=0,N=0,T=0,F=0;v<u.length;)u[v][0]==n?(p[w++]=v,L=T,N=F,T=0,F=0,E=u[v][1]):(u[v][0]==e?T+=u[v][1].length:F+=u[v][1].length,E&&E.length<=Math.max(L,N)&&E.length<=Math.max(T,F)&&(u.splice(p[w-1],0,[t,E]),u[p[w-1]+1][0]=e,w--,w--,v=w>0?p[w-1]:-1,L=0,N=0,T=0,F=0,E=null,y=!0)),v++;for(y&&M(u),x(u),v=1;v<u.length;){if(u[v-1][0]==t&&u[v][0]==e){var S=u[v-1][1],R=u[v][1],H=l(S,R),B=l(R,S);H>=B?(H>=S.length/2||H>=R.length/2)&&(u.splice(v,0,[n,R.substring(0,H)]),u[v-1][1]=S.substring(0,S.length-H),u[v+1][1]=R.substring(H),v++):(B>=S.length/2||B>=R.length/2)&&(u.splice(v,0,[n,S.substring(0,B)]),u[v-1][0]=e,u[v-1][1]=R.substring(0,R.length-B),u[v+1][0]=t,u[v+1][1]=S.substring(B),v++),v++}v++}}var f=/[^a-zA-Z0-9]/,g=/\s/,m=/[\r\n]/,b=/\n\r?\n$/,A=/^\r?\n\r?\n/;function x(u){function y(B,W){if(!B||!W)return 6;var K=B.charAt(B.length-1),G=W.charAt(0),P=K.match(f),$=G.match(f),z=P&&K.match(g),U=$&&G.match(g),Y=z&&K.match(m),Q=U&&G.match(m),ne=Y&&B.match(b),ce=Q&&W.match(A);return ne||ce?5:Y||Q?4:P&&!z&&U?3:z||U?2:P||$?1:0}for(var p=1;p<u.length-1;){if(u[p-1][0]==n&&u[p+1][0]==n){var w=u[p-1][1],E=u[p][1],v=u[p+1][1],L=a(w,E);if(L){var N=E.substring(E.length-L);w=w.substring(0,w.length-L),E=N+E.substring(0,E.length-L),v=N+v}for(var T=w,F=E,S=v,R=y(w,E)+y(E,v);E.charAt(0)===v.charAt(0);){w+=E.charAt(0),E=E.substring(1)+v.charAt(0),v=v.substring(1);var H=y(w,E)+y(E,v);H>=R&&(R=H,T=w,F=E,S=v)}u[p-1][1]!=T&&(T?u[p-1][1]=T:(u.splice(p-1,1),p--),u[p][1]=F,S?u[p+1][1]=S:(u.splice(p+1,1),p--))}p++}}function M(u,y){u.push([n,""]);for(var p=0,w=0,E=0,v="",L="",N;p<u.length;){if(p<u.length-1&&!u[p][1]){u.splice(p,1);continue}switch(u[p][0]){case e:E++,L+=u[p][1],p++;break;case t:w++,v+=u[p][1],p++;break;case n:var T=p-E-w-1;if(y){if(T>=0&&_(u[T][1])){var F=u[T][1].slice(-1);if(u[T][1]=u[T][1].slice(0,-1),v=F+v,L=F+L,!u[T][1]){u.splice(T,1),p--;var S=T-1;u[S]&&u[S][0]===e&&(E++,L=u[S][1]+L,S--),u[S]&&u[S][0]===t&&(w++,v=u[S][1]+v,S--),T=S}}if(I(u[p][1])){var F=u[p][1].charAt(0);u[p][1]=u[p][1].slice(1),v+=F,L+=F}}if(p<u.length-1&&!u[p][1]){u.splice(p,1);break}if(v.length>0||L.length>0){v.length>0&&L.length>0&&(N=c(L,v),N!==0&&(T>=0?u[T][1]+=L.substring(0,N):(u.splice(0,0,[n,L.substring(0,N)]),p++),L=L.substring(N),v=v.substring(N)),N=a(L,v),N!==0&&(u[p][1]=L.substring(L.length-N)+u[p][1],L=L.substring(0,L.length-N),v=v.substring(0,v.length-N)));var R=E+w;v.length===0&&L.length===0?(u.splice(p-R,R),p=p-R):v.length===0?(u.splice(p-R,R,[e,L]),p=p-R+1):L.length===0?(u.splice(p-R,R,[t,v]),p=p-R+1):(u.splice(p-R,R,[t,v],[e,L]),p=p-R+2)}p!==0&&u[p-1][0]===n?(u[p-1][1]+=u[p][1],u.splice(p,1)):p++,E=0,w=0,v="",L="";break}}u[u.length-1][1]===""&&u.pop();var H=!1;for(p=1;p<u.length-1;)u[p-1][0]===n&&u[p+1][0]===n&&(u[p][1].substring(u[p][1].length-u[p-1][1].length)===u[p-1][1]?(u[p][1]=u[p-1][1]+u[p][1].substring(0,u[p][1].length-u[p-1][1].length),u[p+1][1]=u[p-1][1]+u[p+1][1],u.splice(p-1,1),H=!0):u[p][1].substring(0,u[p+1][1].length)==u[p+1][1]&&(u[p-1][1]+=u[p+1][1],u[p][1]=u[p][1].substring(u[p+1][1].length)+u[p+1][1],u.splice(p+1,1),H=!0)),p++;H&&M(u,y)}function k(u){return u>=55296&&u<=56319}function Z(u){return u>=56320&&u<=57343}function I(u){return Z(u.charCodeAt(0))}function _(u){return k(u.charCodeAt(u.length-1))}function C(u){for(var y=[],p=0;p<u.length;p++)u[p][1].length>0&&y.push(u[p]);return y}function J(u,y,p,w){return _(u)||I(w)?null:C([[n,u],[t,y],[e,p],[n,w]])}function re(u,y,p){var w=typeof p=="number"?{index:p,length:0}:p.oldRange,E=typeof p=="number"?null:p.newRange,v=u.length,L=y.length;if(w.length===0&&(E===null||E.length===0)){var N=w.index,T=u.slice(0,N),F=u.slice(N),S=E?E.index:null;e:{var R=N+L-v;if(S!==null&&S!==R||R<0||R>L)break e;var H=y.slice(0,R),B=y.slice(R);if(B!==F)break e;var W=Math.min(N,R),K=T.slice(0,W),G=H.slice(0,W);if(K!==G)break e;var P=T.slice(W),$=H.slice(W);return J(K,P,$,F)}e:{if(S!==null&&S!==N)break e;var z=N,H=y.slice(0,z),B=y.slice(z);if(H!==T)break e;var U=Math.min(v-z,L-z),Y=F.slice(F.length-U),Q=B.slice(B.length-U);if(Y!==Q)break e;var P=F.slice(0,F.length-U),$=B.slice(0,B.length-U);return J(T,P,$,Y)}}if(w.length>0&&E&&E.length===0)e:{var K=u.slice(0,w.index),Y=u.slice(w.index+w.length),W=K.length,U=Y.length;if(L<W+U)break e;var G=y.slice(0,W),Q=y.slice(L-U);if(K!==G||Y!==Q)break e;var P=u.slice(W,v-U),$=y.slice(W,L-U);return J(K,P,$,Y)}return null}function ee(u,y,p,w){return s(u,y,p,w,!0)}return ee.INSERT=e,ee.DELETE=t,ee.EQUAL=n,et=ee,et}var ls=cs();const he=os(ls);var xe;(t=>{function e(s){return new pt(s)}t.iterator=e;function n(s){return typeof s.delete=="number"?s.delete:typeof s.retain=="number"?s.retain:typeof s.insert=="string"?s.insert.length:1}t.length=n})(xe||(xe={}));const X=xe;class pt{ops;index;offset;constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return!!this.peek()}next(e){e||(e=1/0);const n=this.ops[this.index];if(n){const s=this.offset,r=xe.length(n);if(e>=r-s?(e=r-s,this.index+=1,this.offset=0):this.offset+=e,typeof n.delete=="number")return{delete:e};{if(r===e)return n;const i={};return n.attributes&&(i.attributes=n.attributes),typeof n.retain=="number"?i.retain=e:typeof n.insert=="string"?i.insert=n.insert.substr(s,e):i.insert=n.insert,i}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?xe.length(this.ops[this.index])-this.offset:1/0}peekType(){const e=this.ops[this.index];return e?typeof e.delete=="number"?"delete":typeof e.retain=="number"?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const e=this.offset,n=this.index,s=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=n,[s].concat(r)}}else return[]}}const as="\0";class D{static Op=X;static AttributeMap=te;ops;constructor(e){Array.isArray(e)?this.ops=e:e!=null&&Array.isArray(e.ops)?this.ops=e.ops:this.ops=[]}insert(e,n){const s={};return typeof e=="string"&&e.length===0?this:(s.insert=e,n!=null&&typeof n=="object"&&Object.keys(n).length>0&&(s.attributes=n),this.push(s))}delete(e){return e<=0?this:this.push({delete:e})}retain(e,n){if(e<=0)return this;const s={retain:e};return n!=null&&typeof n=="object"&&Object.keys(n).length>0&&(s.attributes=n),this.push(s)}push(e){let n=this.ops.length,s=this.ops[n-1];if(typeof s=="object"){if(typeof e.delete=="number"&&typeof s.delete=="number")return this.ops[n-1]={delete:s.delete+e.delete},this;if(typeof s.delete=="number"&&e.insert!=null&&(n-=1,s=this.ops[n-1],typeof s!="object"))return this.ops.unshift(e),this;if(O(e.attributes,s.attributes)){if(typeof e.insert=="string"&&typeof s.insert=="string")return this.ops[n-1]={insert:s.insert+e.insert},typeof e.attributes=="object"&&(this.ops[n-1].attributes=e.attributes),this;if(typeof e.retain=="number"&&typeof s.retain=="number")return this.ops[n-1]={retain:s.retain+e.retain},typeof e.attributes=="object"&&(this.ops[n-1].attributes=e.attributes),this}}return n===this.ops.length?this.ops.push(e):this.ops.splice(n,0,e),this}chop(){const e=this.ops[this.ops.length-1];return e&&e.retain&&!e.attributes&&this.ops.pop(),this}filter(e){return this.ops.filter(e)}forEach(e){this.ops.forEach(e)}map(e){return this.ops.map(e)}partition(e){const n=[],s=[];return this.forEach(r=>{(e(r)?n:s).push(r)}),[n,s]}reduce(e,n){return this.ops.reduce(e,n)}changeLength(){return this.reduce((e,n)=>n.insert?e+X.length(n):n.delete?e-n.delete:e,0)}length(){return this.reduce((e,n)=>e+X.length(n),0)}slice(e=0,n=1/0){const s=[],r=X.iterator(this.ops);let i=0;for(;i<n&&r.hasNext();){let o;i<e?o=r.next(e-i):(o=r.next(n-i),s.push(o)),i+=X.length(o)}return new D(s)}compose(e,n){const s=X.iterator(this.ops),r=X.iterator(e.ops),i=[],o=r.peek();if(o!=null&&typeof o.retain=="number"&&o.attributes==null){let l=o.retain;for(;s.peekType()==="insert"&&s.peekLength()<=l;)l-=s.peekLength(),i.push(s.next());o.retain-l>0&&r.next(o.retain-l)}const c=new D(i);for(;s.hasNext()||r.hasNext();)if(r.peekType()==="insert")c.push(r.next());else if(s.peekType()==="delete")c.push(s.next());else{const l=Math.min(s.peekLength(),r.peekLength()),a=s.next(l),h=r.next(l);if(typeof h.retain=="number"){let d;const f=h.attributes&&te.compose(a.attributes,h.attributes,!n&&typeof a.retain=="number");if(h.attributes&&!O(f,a.attributes)?(d={},typeof a.retain=="number"?d.retain=l:d.insert=a.insert,f&&(d.attributes=f)):a.retain===1/0?d=h:d=a,c.push(d),h.retain===1/0||!r.hasNext()&&O(c.ops[c.ops.length-1],d)){const g=new D(s.rest());return c.concat(g).chop()}}else typeof h.delete=="number"&&typeof a.retain=="number"&&c.push(h)}return c.chop()}concat(e){const n=new D(this.ops.slice());return e.ops.length>0&&(n.push(e.ops[0]),n.ops=n.ops.concat(e.ops.slice(1))),n}diff(e,n){if(this.ops===e.ops)return new D;const s=[this,e].map(l=>l.map(a=>{if(a.insert!=null)return typeof a.insert=="string"?a.insert:as;const h=l===e?"on":"with";throw new Error("diff() called "+h+" non-document")}).join("")),r=new D,i=he(s[0],s[1],n),o=X.iterator(this.ops),c=X.iterator(e.ops);return i.forEach(l=>{let a=l[1].length;for(;a>0;){let h=0;switch(l[0]){case he.INSERT:h=Math.min(c.peekLength(),a),r.push(c.next(h));break;case he.DELETE:h=Math.min(a,o.peekLength()),o.next(h),r.delete(h);break;case he.EQUAL:h=Math.min(o.peekLength(),c.peekLength(),a);const d=o.next(h),f=c.next(h);O(d.insert,f.insert)?r.retain(h,te.diff(d.attributes,f.attributes)):r.push(f).delete(h);break}a-=h}}),r.chop()}eachLine(e,n=`
`){const s=X.iterator(this.ops);let r=new D,i=0;for(;s.hasNext();){if(s.peekType()!=="insert")return;const o=s.peek(),c=X.length(o)-s.peekLength(),l=typeof o.insert=="string"?o.insert.indexOf(n,c)-c:-1;if(l<0)r.push(s.next());else if(l>0)r.push(s.next(l));else{if(e(r,s.next(1).attributes||{},i)===!1)return;i+=1,r=new D}}r.length()>0&&e(r,{},i)}invert(e){const n=new D;return this.reduce((s,r)=>{if(r.insert)n.delete(X.length(r));else{if(r.retain&&r.attributes==null)return n.retain(r.retain),s+r.retain;if(r.delete||r.retain){const i=r.delete||r.retain;return e.slice(s,s+i).forEach(c=>{r.delete?n.push(c):r.retain&&r.attributes&&n.retain(X.length(c),te.invert(r.attributes,c.attributes))}),s+i}}return s},0),n.chop()}transform(e,n=!1){if(n=!!n,typeof e=="number")return this.transformPosition(e,n);const s=e,r=X.iterator(this.ops),i=X.iterator(s.ops),o=new D;for(;r.hasNext()||i.hasNext();)if(r.peekType()==="insert"&&(n||i.peekType()!=="insert"))o.retain(X.length(r.next()));else if(i.peekType()==="insert")o.push(i.next());else{const c=Math.min(r.peekLength(),i.peekLength()),l=r.next(c),a=i.next(c);if(l.delete)continue;a.delete?o.push(a):o.retain(c,te.transform(l.attributes,a.attributes,n))}return o.chop()}transformPosition(e,n=!1){n=!!n;const s=X.iterator(this.ops);let r=0;for(;s.hasNext()&&r<=e;){const i=s.peekLength(),o=s.peekType();if(s.next(),o==="delete"){e-=Math.min(i,e-r);continue}else o==="insert"&&(r<e||!n)&&(e+=i);r+=i}return e}}function q(t){return t&&(t[0]>t[1]&&(t=[t[1],t[0]]),t)}function gt(t){return t.map(e=>typeof e.insert=="string"?e.insert:e.insert?" ":"").join("")}const us=new Map,hs={id:"",attributes:{},content:new D([{retain:1/0}]),length:1/0};var Fe;(t=>{function e(f,g){return new Gt(f,g)}t.iterator=e;function n(f){const g=new Map;return f.forEach(m=>g.set(m.id||t.createId(g),m)),g}t.linesToLineIds=n;function s(f){return f.length}t.length=s;function r(f){return console.warn("getId() is deprecated"),f.id}t.getId=r;function i(f,g){return O(f.attributes,g.attributes)&&O(f.content.ops,g.content.ops)}t.equal=i;function o(f,g){const m=[],b=new Map(g||[]);return f.eachLine((A,x)=>{const M=t.create(A,Object.keys(x).length?x:void 0,b);b.set(M.id,M),m.push(M)}),m}t.fromDelta=o;function c(f){let g=new D;return f.forEach(m=>{g=g.concat(m.content),g.insert(`
`,m.attributes)}),g}t.toDelta=c;function l(f=new D,g={},m){const b=f.length()+1;return typeof m!="string"&&(m=d(m)),{id:m,attributes:g,content:f,length:b}}t.create=l;function a(f,g=new D,m){const b=f?f.id:d(m),A=f?f.attributes:{};return{id:b,attributes:A,content:g,length:1}}t.createFrom=a;function h(f){const g=new Map;let m=0;return f.forEach(b=>{g.set(b,[m,m+=b.length])}),g}t.getLineRanges=h;function d(f=us){let g;for(;f[g=Math.random().toString(36).slice(2)];);return g}t.createId=d})(Fe||(Fe={}));const V=Fe;class Gt{lines;index;offset;lineIds;constructor(e,n){this.lines=e,this.index=0,this.offset=0,this.lineIds=n?new Map(n):Fe.linesToLineIds(e)}hasNext(){return!!this.peek()}next(e){e||(e=1/0);const n=this.lines[this.index];if(n){const s=this.offset,r=n.length;if(e>=r-s?(e=r-s,this.index+=1,this.offset=0):this.offset+=e,s===0&&e>=n.length)return n;{const i=s===0?n.id:Fe.createId(this.lineIds),o={id:i,attributes:n.attributes,content:n.content.slice(s,e),length:e-s};return s!==0&&this.lineIds.set(i,o),o}}else return hs}peek(){return this.lines[this.index]}peekLength(){return this.lines[this.index]?this.lines[this.index].length-this.offset:1/0}rest(){if(this.hasNext()){if(this.offset===0)return this.lines.slice(this.index);{const e=this.offset,n=this.index,s=this.next(),r=this.lines.slice(this.index);return this.offset=e,this.index=n,[s].concat(r)}}else return[]}}var it;(t=>{function e(s,r){return new Vt(s,r)}t.iterator=e;function n(s){return X.length(s)}t.length=n})(it||(it={}));const Ce=it;class Vt{lineIterator;opIterator;constructor(e,n){this.lineIterator=V.iterator(e,n);const s=this.lineIterator.peek();this.opIterator=X.iterator(s?.content.ops||[])}hasNext(){return this.opIterator.hasNext()||this.lineIterator.hasNext()}next(e){let n=this.opIterator.next(e);return n.retain===1/0&&this.lineIterator.hasNext()&&(n=St(this.nextLine())),n}nextLine(){const e=this.lineIterator.next(),n=this.lineIterator.peek();return this.opIterator=new pt(n?.content.ops||[]),e}peek(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peek():St(this.peekLine())}peekLine(){return this.lineIterator.peek()}peekLength(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peekLength():1}peekLineLength(){return this.lineIterator.peekLength()}peekType(){return this.opIterator.hasNext()?this.opIterator.peekType():this.lineIterator.hasNext()?"insert":"retain"}restCurrentLine(){return this.opIterator.rest()}restLines(){return this.opIterator.offset&&this.lineIterator.next(this.opIterator.offset),this.lineIterator.rest()}}function St(t){const e={insert:`
`};return t.attributes&&(e.attributes=t.attributes),e}const Rt=[0,0],fs={},ds=new WeakMap,ps=new Set(["id"]);class se{_ranges;byId;lines;length;selection;constructor(e,n=null){if(e&&e.lines){const s=e;this.lines=s.lines,this.byId=s.byId,this._ranges=s._ranges,this.length=s.length}else this.byId=new Map,e&&Array.isArray(e)?this.lines=e:e?this.lines=V.fromDelta(e):this.lines=[V.create()],this.lines.length||this.lines.push(V.create()),this.byId=V.linesToLineIds(this.lines),this.lines.forEach(s=>{if(this.byId.get(s.id)!==s)throw new Error("TextDocument has duplicate line ids: "+s.id)}),this._ranges=V.getLineRanges(this.lines),this.length=this.lines.reduce((s,r)=>s+r.length,0);n&&(n=n.map(s=>Math.min(this.length,Math.max(0,s))),n[0]===n[1]&&n[0]===this.length&&n[0]--),this.selection=n}get change(){const e=new oe(this);return e.apply=()=>this.apply(e),e}getText(e){return e&&(e=q(e)),gt(e?this.slice(e[0],e[1]):this.slice(0,this.length-1))}getLineBy(e){return this.byId.get(e)}getLineAt(e){return this.lines.find(n=>{const[s,r]=this.getLineRange(n);return s<=e&&r>e})}getLinesAt(e,n){let s,r;return Array.isArray(e)?[s,r]=q(e):s=r=e,this.lines.filter(i=>{const[o,c]=this.getLineRange(i);return n?o>=s&&c<=r:(o<r||o===s)&&c>s})}getLineRange(e){const{lines:n,_ranges:s}=this;if(typeof e=="number"){for(let r=0;r<n.length;r++){const i=s.get(n[r])||Rt;if(i[0]<=e&&i[1]>e)return i}return Rt}else return typeof e=="string"&&(e=this.getLineBy(e)),s.get(e)}getLineRanges(e){return e==null?Array.from(this._ranges.values()):this.getLinesAt(e).map(n=>this.getLineRange(n))}getLineFormat(e=this.selection,n){let s=e;return Array.isArray(e)&&([e,s]=q(e)),e===s&&s++,It(V,this.lines,e,s,void 0,n)}getTextFormat(e=this.selection,n){let s=e;return Array.isArray(e)&&([e,s]=q(e)),e===s&&e--,It(Ce,this.lines,e,s,r=>r.insert!==`
`,n)}getFormats(e=this.selection,n){return{...this.getTextFormat(e,n),...this.getLineFormat(e,n)}}slice(e=0,n=1/0){const s=[],r=Ce.iterator(this.lines);let i=0;for(;i<n&&r.hasNext();){let o;i<e?o=r.next(e-i):(o=r.next(n-i),s.push(o)),i+=X.length(o)}return new D(s)}apply(e,n,s){let r;if(e.delta?(r=e.delta,n=e.selection):r=e,!r.ops.length&&(n===void 0||O(this.selection,n)))return this;if(!r.ops.length&&n)return new se(this,n);n===void 0&&this.selection&&(n=[r.transformPosition(this.selection[0]),r.transformPosition(this.selection[1])],O(this.selection,n)&&(n=this.selection));const i=Ce.iterator(this.lines,this.byId),o=X.iterator(r.ops),c=[],l=o.peek();if(l&&l.retain&&!l.attributes){let d=l.retain;for(;i.peekLineLength()<=d;)d-=i.peekLineLength(),c.push(i.nextLine());l.retain-d>0&&o.next(l.retain-d)}if(!i.hasNext()&&s)throw new Error("apply() called with change that extends beyond document");let a=V.createFrom(i.peekLine());function h(d){d.length=d.content.length()+1,c.push(d)}for(;i.hasNext()||o.hasNext();)if(o.peekType()==="insert"){const d=o.peek(),f=typeof d.insert=="string"?d.insert.indexOf(`
`,o.offset):-1;if(f<0)a.content.push(o.next());else{const g=f-o.offset;g&&a.content.push(o.next(g));const m=o.next(1);h(V.create(a.content,m.attributes,a.id)),a=V.create(void 0,a.attributes)}}else{const d=Math.min(i.peekLength(),o.peekLength()),f=i.next(d),g=o.next(d);if(typeof f.retain=="number"){if(s)throw new Error("apply() called with change that extends beyond document");continue}if(typeof g.retain=="number"){const m=f.insert===`
`;let b=f;const A=g.attributes&&te.compose(f.attributes,g.attributes);if(g.attributes&&!O(A,f.attributes)&&(m?a.attributes=A||{}:(b={insert:f.insert},A&&(b.attributes=A))),m?(h(a),a=V.createFrom(i.peekLine())):a.content.push(b),g.retain===1/0||!o.hasNext()){if(i.opIterator.index!==0||i.opIterator.offset!==0){const x=i.restCurrentLine();for(let M=0;M<x.length;M++)a.content.push(x[M]);h(a),i.nextLine()}c.push(...i.restLines());break}}else typeof g.delete=="number"&&f.insert===`
`&&(a=V.create(a.content,i.peekLine()?.attributes,a.id))}return c.length||c.push(a),new se(c,n)}replace(e,n){return new se(e,n)}toDelta(){const e=ds;let n=e.get(this);return n||(n=V.toDelta(this.lines),e.set(this,n)),n}equals(e,n){return this===e||(n?.contentOnly||O(this.selection,e.selection))&&O(this.lines,e.lines,{excludeProps:ps})}toJSON(){return this.toDelta()}toString(){return this.lines.map(e=>e.content.map(n=>typeof n.insert=="string"?n.insert:" ").join("")).join(`
`)+`
`}}function It(t,e,n,s,r,i){const o=t.iterator(e);let c,l=0;for(o.skip&&(l+=o.skip(n));l<s&&o.hasNext();){const a=o.next();l+=t.length(a),l>n&&(!r||r(a))&&(a.attributes?c?i?.allFormats?c=te.compose(c,a.attributes):c=gs(c,a.attributes,i?.nameOnly):c={...a.attributes}:c={})}return c||fs}function gs(t,e,n){return Object.keys(e).reduce(function(s,r){return n?r in t&&r in e&&(s[r]=!0):O(t[r],e[r],{partial:!0})?s[r]=e[r]:O(e[r],t[r],{partial:!0})&&(s[r]=t[r]),s},{})}class oe{_pos;doc;delta;selection;activeFormats;constructor(e,n=new D,s,r){this._pos=0,this.doc=e,this.delta=n,this.selection=s,this.activeFormats=r}get contentChanged(){return this.delta.ops.length>0}get selectionChanged(){return this.selection!==void 0&&!O(this.selection,this.doc?.selection)}apply(){throw new Error("Must be overridden by creator of change (e.g. Editor).")}setDelta(e){return this.delta=e,this._pos=e.length(),this}setActiveFormats(e){return this.activeFormats=e,this}select(e){return this.selection=typeof e=="number"?[e,e]:e,this}delete(e,n){if(!e||!this.doc)return this;let[s,r]=q(e);if(s===r)return this;if(s=Math.min(this.doc.length-1,Math.max(0,s)),r=Math.min(this.doc.length,Math.max(0,r)),s===r)return this;const i=r-s;this.doc.selection&&(this.selection=[s,s]),this.compose(s,c=>c.delete(i),i);const o=this.doc.getLineRange(s);if(!n?.dontFixNewline&&o[1]<=r){const c=this.doc.getLineAt(s).attributes;this.formatLine(r,c)}return this}insert(e,n,s,r){if(!this.doc)return this;if(e=this.normalizePoint(e),this.doc.selection){const c=e+(typeof n=="string"?n.length:1);this.selection=[c,c]}const{id:i,...o}=this.doc.getLineAt(e).attributes;if(typeof n!="string")this.compose(e,c=>c.insert(n,s));else if(n===`
`)r?.dontFixNewline?this.compose(e,c=>c.insert(`
`,{...s})):(this.compose(e,c=>c.insert(`
`,o)),this.formatLine(e,{...s}));else if(s||(s=this.getFormatAt(e)),n.includes(`
`)){const c=n.split(`
`);this.compose(e,l=>(c.forEach((a,h)=>{h&&l.insert(`
`,h===1?o:{}),a.length&&l.insert(a,s)}),l))}else this.compose(e,c=>c.insert(n,s));return this}insertContent(e,n){if(!this.doc)return this;if(e=this.normalizePoint(e),this.doc.selection){const i=n.ops.filter(c=>c.delete);for(;i.length&&i[i.length-1].retain;)i.pop();const o=e+i.reduce((c,l)=>c+X.length(l),0);this.selection=[o,o]}const r=gt(n).indexOf(`
`);return r!==-1&&(n=n.compose(new D().retain(r).retain(1,this.doc.getLineFormat(e)))),this.compose(e,i=>i.concat(n)),this}formatText(e,n){return this.doc?(e=q(e),e[1]-e[0]?(n&&Object.keys(n).forEach(r=>n[r]===!1&&(n[r]=null)),this.doc.getLineRanges(e).forEach(([r,i])=>{r=Math.max(e[0],r),i=Math.min(e[1],i-1);const o=i-r;this.compose(r,c=>c.retain(o,n),o)}),this):this):this}toggleTextFormat(e,n){if(!this.doc)return this;typeof e=="number"&&(e=[e,e]),e=q(e);const s=this.doc.getTextFormat(e);return $e(n,s)&&(n=te.invert(n)),this.formatText(e,n)}formatLine(e,n,s){if(!this.doc)return this;const r=this.doc;return typeof e=="number"&&(e=[e,e]),e=q(e),this.doc.getLineRanges(e).forEach(([,i])=>{i--,s||(n={...te.invert(r.getLineFormat(i)),...n}),this.compose(i,o=>o.retain(1,n),1)}),this.delta.chop(),this}toggleLineFormat(e,n){if(!this.doc)return this;typeof e=="number"&&(e=[e,e]),e=q(e);const s=this.doc.getLineFormat(e);return $e(n,s)&&(n=te.invert(n)),this.formatLine(e,n)}removeFormat(e){if(!this.doc)return this;e=q(e);const n=te.invert(this.doc.getFormats(e)),s=e[1]-e[0];return this.compose(e[0],r=>r.retain(s,n),s)}transform(e,n){const s=this.delta.transform(e.delta,n),r=e.selection&&this.transformSelection(e.selection);return new oe(null,s,r)}transformSelection(e,n){if(!e)return e;const s=this.delta.transformPosition(e[0],n),r=this.delta.transformPosition(e[1],n);return s===e[0]&&r===e[1]?e:[s,r]}transformAgainst(e,n){return(e.ops?new oe(null,e):e).transform(this,!n)}isFor(e){return this.doc===e}clone(){return new oe(this.doc,new D(this.delta.ops.slice()),this.selection?.slice())}compose(e,n,s){return this._pos<=e?this.delta=n(this.delta.retain(e-this._pos)):this.delta=this.delta.compose(n(new D().retain(e))),this._pos=Math.max(e+(s||0),this._pos),this}normalizePoint(e,n=this.doc?this.doc.length-1:0){return Math.max(0,Math.min(n,e))}getFormatAt(e){let n;if(this.doc){const s=this.doc.getTextFormat(e),r=this.doc.getTextFormat(e+1);s&&r&&(n=s===r?s:en(r,Object.keys(s)))}return n}}function $e(t,e){return Object.keys(t).every(n=>O(e[n],t[n]))}function en(t,e){const n={};return Object.keys(t).forEach(s=>{t[s]===e[s]&&(n[s]=t[s])}),n}const ot=new WeakMap,ms=new WeakMap;class tn{on(e,n,s){this.addEventListener(e,n,s)}off(e,n,s){this.removeEventListener(e,n,s)}addEventListener(e,n,s){s?.once&&(n=_t(this,e,n,!0)),Be(this,e,!0).add(n)}removeEventListener(e,n,s){if(s?.once&&(n=_t(this,e,n)),!n)return;const r=Be(this,e);r&&r.delete(n)}dispatchEvent(e,n){let s=!1;e.bubbles&&(e.stopImmediatePropagation=e.stopPropagation=()=>s=!0);const r=Be(this,e.type);if(r)for(let i of r){if(n)try{i.call(this,e)}catch(o){try{this.dispatchEvent(new ErrorEvent("error",{error:o}))}catch{}}else i.call(this,e);if(s)break}}}function Be(t,e,n=!1){let s=ot.get(t);return!s&&n&&ot.set(t,s=Object.create(null)),s&&s[e]||n&&(s[e]=new Set)}function _t(t,e,n,s=!1){let r=ms.get(t);!r&&s&&ot.set(t,r=Object.create(null));const i=r&&r[e]||s&&(r[e]=new Map);if(!i.has(n)&&s){const o=c=>{const l=Be(t,e);l&&l.delete(n),n.call(t,c)};i.set(n,o)}return i&&i.get(n)}var ie=(t=>(t.api="api",t.user="user",t.history="history",t.input="input",t.paste="paste",t))(ie||{});const We={renderKeys:!1},bs=[],ys="http://www.w3.org/2000/svg",ct="data-key",vs=new Set(["value","selected","checked","contentEditable"]),le=t=>t==null?t:t.key,nn=(t,e)=>{e&&e!==t.key&&(t.key=e,We.renderKeys&&t.setAttribute(ct,e)),!e&&t.key&&(delete t.key,We.renderKeys&&t.removeAttribute(ct))},Dt=t=>{t.currentTarget.events[t.type](t)},sn=(t,e,n,s,r)=>{e==="key"||(e[0]==="o"&&e[1]==="n"?((t.events||(t.events={}))[e=e.slice(2)]=s)?n||t.addEventListener(e,Dt):t.removeEventListener(e,Dt):s==null?t.removeAttribute(e):!r&&e!=="list"&&e!=="form"&&e in t?t[e]=s??"":t.setAttribute(e,s))},Ue=(t,e)=>{if(typeof t=="string")return document.createTextNode(t);var n=t.props,s=(e=e||t.type==="svg")?document.createElementNS(ys,t.type,{is:n.is}):document.createElement(t.type,{is:n.is});for(var r in n)sn(s,r,null,n[r],e);return nn(s,le(t)),t.children.forEach(i=>s.appendChild(Ue(be(i),e))),s},rn=(t,e)=>{const n={};for(let s=0;s<t.attributes.length;s++){const{name:r,value:i}=t.attributes[s];r in t&&r!=="list"&&!e?n[r]=t[r]:(!We.renderKeys||r!==ct)&&(n[r]=i===""?!0:i)}return n},me=(t,e,n,s,r)=>{if(typeof s=="string")n!=null&&n.nodeType===Node.TEXT_NODE?n.nodeValue!==s&&(e.nodeValue=s):(e=t.insertBefore(Ue(s,r),e),n!=null&&t.removeChild(n));else if(n==null||n.nodeName.toLowerCase()!==s.type)e=t.insertBefore(Ue(be(s),r),e),n!=null&&t.removeChild(n);else{var i=rn(n,r),o=s.props;r=r||s.type==="svg";for(var c in{...i,...o})(vs.has(c)?e[c]:i[c])!==o[c]&&sn(e,c,i[c],o[c],r);nn(e,s.key),on(e,s.children,r)}return e},on=(t,e,n,s=Array.from(t.childNodes))=>{for(var r,i,o,c,l=0,a=0,h=s.length-1,d=e.length-1;a<=d&&l<=h&&!((o=le(s[l]))==null||o!==le(e[a]));)me(t,s[l],s[l++],e[a]=be(e[a++]),n);for(;a<=d&&l<=h&&!((o=le(s[h]))==null||o!==le(e[d]));)s[h]=me(t,s[h],s[h--],e[d]=be(e[d--]),n);if(l>h){const f=s[l]||s[l-1]&&s[l-1].nextSibling||null;for(;a<=d;)t.insertBefore(Ue(e[a]=be(e[a++]),n),f)}else if(a>d)for(;l<=h;)t.removeChild(s[l++]);else{const f=new Map,g=new Set;for(let m=l;m<=h;m++)(o=le(s[m]))!=null&&f.set(o,s[m]);for(;a<=d;){if(o=le(i=s[l]),c=le(e[a]=be(e[a])),g.has(o)||c!=null&&c===le(s[l+1])){o==null&&t.removeChild(i),l++;continue}c==null?(o==null&&(me(t,i,i,e[a],n),a++),l++):(o===c?(me(t,i,i,e[a],n),g.add(c),l++):(r=f.get(c))!=null?(me(t,t.insertBefore(r,i),r,e[a],n),g.add(c)):me(t,i,null,e[a],n),a++)}for(;l<=h;)le(i=s[l++])==null&&t.removeChild(i);for(const[m,b]of f)g.has(m)||t.removeChild(b)}return t},be=t=>t!==!0&&t!==!1&&t?t:"",cn=(t,e,n,s)=>({type:t,props:e,children:n,key:s}),ln=t=>t.nodeType===Node.TEXT_NODE?t.nodeValue:cn(t.nodeName.toLowerCase(),rn(t),bs.map.call(t.childNodes,ln),le(t)),j=(t,e,n)=>typeof t=="function"?t(e||{},n):cn(t,e||{},Array.isArray(n)?n:n==null?[]:[n],e?.key),Ls={createElement:j},Ee=(t,e,n)=>(Array.isArray(e)?t=on(t,e,t instanceof window.SVGElement,n):t=me(t.parentNode,t,t,e),t),Es=/;\s*$/,ws={name:"decoration",selector:"span.format.decoration",fromDom:!1,render:(t,e)=>Ze(j("span",{},e),t,["format","decoration"])},As={name:"decoration",selector:".embed.decoration",fromDom:!1,noFill:!0,render:(t,e)=>{const n="embed decoration",{name:s,...r}=t.decoration;return r.class=r.class?n+" "+r.class:n,j(s||"span",r,e)}};class an extends Event{old;doc;change;changedLines;constructor(e,n){super(e,n),this.old=n.old,this.doc=n.doc,this.change=n.change,this.changedLines=n.changedLines}}function un(t){t.typeset.formats.add(ws),t.typeset.embeds.add(As);const e=new Map;let n=t.doc,s=n,r=n,i=!1;t.on("change",h),t.on("render",f);function o(g){if(!g)throw new TypeError("A decoration name is required");const m=e.get(g);return new hn(g,t.doc,m,a,c)}function c(g){if(!g)throw new TypeError("A decoration name is required");const m=e.get(g);if(!m)return!1;const b=fn(g,m,n);return e.delete(g),e.size?r=r.apply(b):r=n,i||(t.modules.rendering?.render({old:s,doc:r}),t.modules.selection?.renderSelection()),!0}function l(){e.size&&e.clear(),r=n}function a(g,m){const b=e.get(g),A=b?b.compose(m,!0):m;O(A,b)||!b&&!A.ops.length||(A.ops.length?e.set(g,A):e.delete(g),r=e.size?r.apply(m,null):n,i||(t.modules.rendering?.render({old:s,doc:r}),t.modules.selection?.renderSelection()))}function h(g){const{change:m,changedLines:b}=g;if(n=g.doc,m){if(m.contentChanged){for(let[A,x]of e)x=m.delta.transform(x,!0),x.ops.length?e.set(A,x):e.delete(A);r=e.size?r.apply(m.delta,null):n,e.size&&r.lines.forEach((A,x)=>{const M=n.lines[x];A!==M&&A.id!==M.id&&(A.id=M.id)})}}else l();d(m,b)}function d(g,m){const b={old:s,doc:n,change:g,changedLines:m};i=!0,t.dispatchEvent(new an("decorate",b)),i=!1}function f(){s=r}return{get old(){return s},get doc(){return r},getDecorator:o,removeDecorations:c,clearDecorations:l,gatherDecorations:d,init(){d()},destroy(){t.off("change",h),t.off("render",f)}}}class hn{change;_name;_doc;_decoration;_apply;_remove;constructor(e,n,s,r,i){this._name=e,this._doc=n,this.change=new oe(n),this._decoration=s,this._apply=r,this._remove=i}hasDecorations(){return!!this._decoration&&this._decoration.ops.length>0||this.change.delta.ops.length>0}getDecoration(){return this._decoration?this._decoration.compose(this.change.delta):this.change.delta}apply(){return this._apply(this._name,this.change.delta)}remove(){return this._remove(this._name)}clear(e){return this.hasDecorations()?(e?this.change.setDelta(this.change.delta.compose(this.invert(e))):this.change.setDelta(this.invert()),this):this}clearLines(e){if(!e.length)return this;const n=this._doc,s=[n.getLineRange(e[0])[0],n.getLineRange(e[e.length-1])[1]];if(e.length===1||e.every((l,a)=>!a||n.getLineRange(e[a-1])[1]===n.getLineRange(l)[0]))return this.clear(s);const i=this.invert(s),o=new D;let c=0;return e.forEach(l=>{const[a,h]=n.getLineRange(l);o.retain(a-c).concat(i.slice(a,h)),c=h}),this.change.setDelta(this.change.delta.compose(o)),this}clearLine(e){const n=this._doc,s=typeof e=="number"?n.getLineAt(e):typeof e=="string"?n.getLineBy(e):e;return this.clearLines([s])}invert(e){return this._decoration?fn(this._name,this._decoration,this._doc,e):new D}decorateText(e,n={class:this._name}){return this.change.formatText(e,{decoration:{[this._name]:n}}),this}decorateLine(e,n={class:this._name}){return this.change.formatLine(e,{decoration:{[this._name]:n}},!0),this}insertDecoration(e,n={class:this._name}){if(typeof n=="string")throw new Error("You may only insert embed decorations");return this.change.insert(e,{decoration:n}),this}}function Ze(t,e,n){if(!e||!e.decoration)return t;const s=new Set(n);let r="",i=t.props;Object.values(e.decoration).forEach(c=>{const{class:l,style:a,...h}=c;l&&s.add(l.trim()),a&&(r+=a.trim()),r&&!Es.test(r)&&(r+=";"),i={...h,...i}});const o=Array.from(s).join(" ").trim();return o&&(i.class=i.class?i.class+" "+o:o),r&&(i.style=i.style?i.style+";"+r:r),t.props=i,t}function fn(t,e,n,s){let r=n.toDelta();return s&&(r=r.slice(s[0],s[1]),e=e.slice(s[0],s[1])),e=e.invert(r),e.ops.forEach(i=>{i.attributes?.decoration===null&&(i.attributes.decoration={[t]:null})}),s&&(e=new D().retain(s[0]).concat(e)),e}const Ns=[],Ot=j("br",{}),Pe=new WeakMap,Ct=new WeakMap,Bt=new WeakMap,Pt=new WeakMap,mt=new WeakMap;function ae(t,e){return mt.get(t)?.get(e)?.[0]}function ke(t,e){return mt.get(t)?.get(e)?.[1]}function Je(t){const{root:e,doc:n}=t,s=pe(t,n.lines),r=new WeakMap;for(let o=0;o<e.children.length;o++){const c=e.children[o];if(!c.key)continue;const l=s.byKey[c.key];if(l)if(Array.isArray(l)){r.set(c,[n.getLineRange(l[0])[0],n.getLineRange(l[l.length-1])[1]]);const a=c.querySelectorAll(t.typeset.lines.selector);for(let h=0;h<a.length;h++){const d=a[h],f=n.getLineBy(d.key);f&&r.set(d,n.getLineRange(f))}}else r.set(c,n.getLineRange(l))}const i=e.querySelectorAll(t.typeset.lines.selector);for(let o=0;o<i.length;o++){const c=i[o];if(r.has(c)||!c.key)continue;const l=n.getLineBy(c.key);r.set(c,n.getLineRange(l))}mt.set(e,r)}function Ye(t,e){const{root:n}=t;t.dispatchEvent(new Event("rendering")),Ee(n,bt(t,e)),Je(t),t.dispatchEvent(new Event("render")),t.dispatchEvent(new Event("rendered"))}function lt(t,e,n){const{root:s}=t,r=pe(t,e.lines).combined,i=pe(t,n.lines).combined,[o,c]=Lt(r,i);O(o,c)||(o[0]=Math.max(0,o[0]-1),c[0]=Math.max(0,c[0]-1),o[1]=Math.min(r.length,o[1]+1),c[1]=Math.min(i.length,c[1]+1),s.childNodes.length!==r.length&&(o[1]+=s.childNodes.length-r.length));const l=Array.from(s.childNodes).slice(o[0],o[1]),a=i.slice(c[0],c[1]);if(!l.length&&!a.length)return Ye(t,n);t.dispatchEvent(new Event("rendering")),Ee(s,yt(t,a),l),Je(t),t.dispatchEvent(new Event("render")),t.dispatchEvent(new Event("rendered"))}function bt(t,e,n){return yt(t,pe(t,e.lines).combined,n)}function yt(t,e,n){return e.map(s=>vt(t,s,n)).filter(Boolean)}function vt(t,e,n){return Array.isArray(e)?pn(t,e,n):dn(t,e,n)}function dn(t,e,n){const s=Qe(t,e);if(!s.render)throw new Error("No render method defined for line");const r=s.render(e.attributes,qe(t,e),e,t,n);return Ze(r,e.attributes),r.key=e.id,r}function pn(t,e,n){const s=Qe(t,e[0]);if(!s.renderMultiple)throw new Error("No render method defined for line");const r=s.renderMultiple(e.map(i=>[i.attributes,qe(t,i),i.id]),t,n);return r.key=e[0].id,r}function pe(t,e){const n=Pt.get(e);if(n)return n;const s=[],r={};let i=[];e.forEach((c,l)=>{const a=Qe(t,c);if(a.shouldCombine){i.push(c);const h=e[l+1];if(!h||Qe(t,h)!==a||!a.shouldCombine(i[0].attributes,h.attributes)){const d=Bt.get(i[0]);d&&d.length===i.length&&i.every((f,g)=>d[g]===f)?i=d:Bt.set(i[0],i),s.push(i),r[i[0].id]=i,i=[]}}else a.render&&(s.push(c),r[c.id]=c)});const o={combined:s,byKey:r};return Pt.set(e,o),o}function Lt(t,e){const n=t.length,s=e.length,r=Math.min(n,s);let i=0,o=0,c=0,l=0;for(let a=0;a<r;a++)if(!jt(t[a],e[a])){i=c=a;break}for(let a=0;a<r;a++)if(!jt(t[n-a-1],e[s-a-1])){o=n-a,l=s-a;break}return[[i,o],[c,l]]}function qe(t,e,n){const{lines:s,formats:r,embeds:i}=t.typeset;let o=[],c=[],l=!0,a;return e.content.ops.forEach((h,d,f)=>{let g=[];if(h.insert==="	"&&h.attributes&&(a=s.findByAttributes(h.attributes))&&a.child){a.render&&(o=Xe(o),l&&o.push(Ot),c.push(a.render(h.attributes,o,e,t,n)),o=[]);return}if(typeof h.insert=="string"){const m=f[d-1],b=f[d+1];let A=h.insert.replace(/  /g,"  ").replace(/  /g,"  ");(!m||typeof m.insert=="object")&&(A=A.replace(/^ /," ")),(!b||typeof b.insert=="object"||xs(b))&&(A=A.replace(/ $/," ")),l=!1,g.push(A)}else if(h.insert){const m=i.findByAttributes(h.insert);m?.render&&(g.push(m.render(h.insert,Ns,e,t,n)),m.name==="br"?l=!0:m.noFill||(l=!1))}h.attributes&&Object.keys(h.attributes).sort((m,b)=>r.priority(b)-r.priority(m)).forEach(m=>{const b=r.get(m);if(b?.render){const A=b.render(h.attributes,g,e,t,n);A&&(Pe.set(A,b),g=[A])}}),o.push.apply(o,g)}),o=Xe(o),l&&o.push(Ot),c.length?c:o}function jt(t,e){return t===e?!0:Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,s)=>n===e[s])}function Qe(t,e){let n=Ct.get(e.attributes);return n||(n=t.typeset.lines.findByAttributes(e.attributes,!0),Ct.set(e.attributes,n)),n}function Xe(t){const e=[];if(t.forEach((n,s)=>{const r=e.length-1,i=e[r];i&&typeof i!="string"&&typeof n!="string"&&Pe.has(i)&&Pe.get(i)===Pe.get(n)&&Ts(i.props,n.props)?i.children=i.children.concat(n.children):i&&typeof i=="string"&&typeof n=="string"?e[r]+=n:(e.push(n),i&&typeof i!="string"&&i.children&&(i.children=Xe(i.children)))}),e.length){const n=e[e.length-1];n&&typeof n!="string"&&n.children&&(n.children=Xe(n.children))}return e}function Ts(t,e){return Object.keys({...t,...e}).every(n=>n.slice(0,2)==="on"||t[n]===e[n])}function xs(t){return typeof t.insert=="string"&&t.insert[0]===" "}function gn(t){t.on("change",n);function e(s){if(s){const{doc:r,old:i}=s;i&&r?lt(t,i,r):r&&Ye(t,r)}else{const{doc:r}=t.modules.decorations||t;Ye(t,r)}}function n(s){const{doc:r,old:i}=t.modules.decorations||s;i.lines!==r.lines&&lt(t,i,r)}return{render:e,destroy(){t.off("change",n)}}}const tt=[],mn={},bn={},yn={},Fs=(t,e)=>!0;class vn{lines;formats;embeds;static line=fe;static format=ge;static embed=Ke;constructor(e){const n=e.lines?.map(i=>typeof i=="string"?mn[i]:i).filter(Boolean),s=e.formats?.map(i=>typeof i=="string"?bn[i]:i).filter(Boolean),r=e.embeds?.map(i=>typeof i=="string"?yn[i]:i).filter(Boolean);this.lines=new je(n||tt),this.formats=new je(s||tt),this.embeds=new je(r||tt)}}function fe(t){return t.renderMultiple&&!t.shouldCombine&&(t.shouldCombine=Fs),mn[t.name]=t}function ge(t){return bn[t.name]=t}function Ke(t){return yn[t.name]=t}class je{list;selector;types;priorities;constructor(e){this.list=e,this.init()}get default(){return this.list[0]}init(){this.selector=this.list.map(e=>e.selector||"").filter(Boolean).join(", "),this.types=this.list.reduce((e,n)=>(e[n.name]=n,e),{}),this.priorities=this.list.reduce((e,n,s)=>(e[n.name]=s,e),{})}add(e){this.list.push(e),this.init()}remove(e){const n=typeof e=="string"?e:e.name;this.list=this.list.filter(s=>s.name!==n),this.init()}get(e){return this.types[e]}priority(e){const n=this.priorities[e];return n!==void 0?n:-1}matches(e){if(!e)return!1;if(!e.nodeType)throw new Error("Cannot match against "+e);if(e.nodeType===Node.ELEMENT_NODE)return this.selector?e.matches(this.selector):!1}findByNode(e,n=!1){if(e.nodeType!==Node.ELEMENT_NODE)return;let s=this.list.length;for(;s--;){let r=this.list[s];if(e.matches(r.selector))return r}if(n)return this.default}findByAttributes(e,n=!1){const s=e&&Object.keys(e);let r;return s&&s.every(i=>!(r=this.get(i))),r||(n?this.default:void 0)}}const ks=Ke({name:"image",selector:"img",commands:t=>(e,n)=>t.insert({image:e,...n}),fromDom:t=>{const e={};return["src","alt","width","height"].forEach(n=>{if(!t.hasAttribute(n))return;const s=t.getAttribute(n);n==="src"&&(n="image"),e[n]=s}),e},render:t=>{const{image:e,...n}=t;return n.src=e,j("img",n)}}),Ms=Ke({name:"br",selector:"br",commands:t=>()=>t.insert({br:!0}),render:()=>j("br")}),Ss=ge({name:"underline",selector:"u",styleSelector:'[style*="text-decoration: underline"]',commands:t=>()=>t.toggleTextFormat({underline:!0}),shortcuts:"Mod+Y",render:(t,e)=>j("u",null,e)}),Rs=ge({name:"bold",selector:"strong, b",styleSelector:'[style*="font-weight:bold"], [style*="font-weight: bold"]',commands:t=>()=>t.toggleTextFormat({bold:!0}),shortcuts:"Mod+B",render:(t,e)=>j("strong",null,e)}),Is=ge({name:"italic",selector:"em, i, u,mark",styleSelector:'[style*="font-style:italic"], [style*="font-style: italic"]',commands:t=>()=>t.toggleTextFormat({italic:!0}),shortcuts:"Mod+I",render:(t,e)=>j("i",null,e)}),_s=ge({name:"mark",shortcuts:"Mod+M",selector:"mark",commands:t=>()=>t.toggleTextFormat({mark:!0}),render:(t,e)=>j("mark",null,e)}),Ds=ge({name:"code",selector:"code, u",commands:t=>()=>t.toggleTextFormat({code:!0}),render:(t,e)=>j("code",null,e)}),Os=ge({name:"link",selector:"a[href], u",greedy:!1,commands:t=>e=>t.toggleTextFormat({link:typeof e=="string"?e:!!e}),fromDom:t=>t.href,render:(t,e)=>j("a",{href:t.link,target:"_blank"},e)}),Cs=fe({name:"paragraph",selector:"p",commands:t=>()=>t.formatLine({}),shortcuts:"Mod+0",render:(t,e)=>j("p",null,e)}),Bs=fe({name:"header",selector:"h1, h2, h3, h4, h5, h6",defaultFollows:!0,commands:t=>({header:e=>t.toggleLineFormat({header:e}),header1:()=>t.toggleLineFormat({header:1}),header2:()=>t.toggleLineFormat({header:2}),header3:()=>t.toggleLineFormat({header:3}),header4:()=>t.toggleLineFormat({header:4}),header5:()=>t.toggleLineFormat({header:5}),header6:()=>t.toggleLineFormat({header:6})}),shortcuts:{"Mod+1":"header1","Mod+2":"header2","Mod+3":"header3","Mod+4":"header4","Mod+5":"header5","Mod+6":"header6"},fromDom:t=>({header:parseInt(t.nodeName.replace("H",""))}),render:(t,e)=>j(`h${t.header}`,null,e)}),Ps=fe({name:"list",selector:"ul > li, ol > li",indentable:!0,commands:t=>({bulletList:()=>t.toggleLineFormat({list:"bullet"}),orderedList:()=>t.toggleLineFormat({list:"ordered"}),checkList:()=>t.toggleLineFormat({list:"check"}),indent:()=>t.indent(),outdent:()=>t.outdent(),toggleCheck:e=>{const n=typeof e=="string"?t.doc.getLineBy(e):t.doc.selection?t.doc.getLineAt(t.doc.selection[0]):null;if(!n)return!1;const[s]=t.doc.getLineRange(n),r={list:"check"};n.attributes.checked||(r.checked=!0),t.formatLine(r,s)}}),shortcuts:{"Mod+Space":"toggleCheck"},fromDom(t){let e=-1,n=t.parentNode,s=n&&n.getAttribute("type");const r=t.hasAttribute("data-checked")?"check":n&&n.nodeName==="OL"?"ordered":"bullet";for(;n;){if(/^UL|OL$/.test(n.nodeName))e++;else if(n.nodeName!=="LI")break;n=n.parentNode}!e&&t.className.startsWith("ql-indent-")&&(e=parseInt(t.className.replace("ql-indent-","")));const i={list:r};return e&&(i.indent=e),s&&(i.type=s),t.getAttribute("data-checked")==="true"&&(i.checked=!0),i},nextLineAttributes(t){const{start:e,...n}=t;return n},shouldCombine:(t,e)=>t.list===e.list&&!e.start&&t.type===e.type||e.indent,renderMultiple:(t,e,n)=>{const s=[],r=[];t.forEach(([o,c,l])=>{const a=o.list==="ordered"?"ol":"ul",h=o.indent||0;let d={key:l};if(o.list==="check"){let g=function(b){e.enabled&&(b.preventDefault(),e.commands.toggleCheck(l))};const m=j("button",{class:"check-list-check",onmousedown:g,ontouchstart:g});c.length===1&&c[0].type==="br"?c.push(m):c.unshift(m),d={...d,class:"check-list-item","data-checked":""+(o.checked||!1)}}const f=Ze(j("li",d,c),o);for(;h>=r.length;){const g=j(a,{start:o.start,type:o.type,key:`${l}-outer`}),m=r.length?r[r.length-1].children:s,b=m[m.length-1];typeof b=="object"&&b.type==="li"&&n?b.children.push(g):m.push(g),r.push(g)}if(!i(r[h],a,o)){const g=j(a,{start:o.start,type:o.type});(h?r[h-1].children:s).push(g),r[h]=g}r[h].children.push(f),r.length=h+1});function i(o,c,l){return o.type===c&&(o.props.start===l.start||o.props.start&&!l.start)&&o.props.type===l.type}return s[0]}}),js=fe({name:"blockquote",selector:"blockquote p",commands:t=>(e=!0)=>{typeof e!="string"&&(e=!0),t.toggleLineFormat({blockquote:e})},fromDom(t){const{className:e}=t.parentNode,n=e.match(/quote-(\S+)/);return{blockquote:n&&n[1]!=="true"&&n[1]||!0}},shouldCombine:(t,e)=>t.blockquote===e.blockquote,renderMultiple:t=>{const e=t[0][0].blockquote,n=typeof e=="string"?{className:`quote-${e}`}:null,s=t.map(([r,i,o])=>j("p",{key:o},i));return j("blockquote",n,s)}}),zs=fe({name:"code-block",selector:"pre code",contained:!0,commands:t=>()=>t.toggleLineFormat({"code-block":!0}),renderMultiple:t=>{const e=[];return t.forEach(([n,s,r])=>{s.length&&s[s.length-1].type==="br"&&s.pop(),e.push(j("code",{key:r},s)),e.push(`
`)}),j("pre",{spellcheck:!1},e)}}),Hs=fe({name:"hr",selector:"hr",frozen:!0,commands:t=>()=>{const{doc:e}=t,{selection:n}=e;if(!n)return;const s=q(n),r=t.change.delete(s);if(s[0]===s[1]&&e.getLineAt(s[0]).length===1)r.insert(s[0],`
`,{...e.getLineFormat(s[0])}).formatLine(s[0],{hr:!0});else{const i=new D().insert(`
`,e.getLineAt(s[0]).attributes).insert(`
`,{hr:!0});r.insertContent(s[0],i),r.select(s[0]+2)}t.update(r)},render:()=>j("hr")}),$s=fe({name:"dl",selector:"dl dt, dl dd",fromDom(t){return{dl:t.nodeName.toLowerCase()}},onTab:(t,e)=>{const{doc:n}=t,{selection:s}=n;if(!s)return;const r=e?s[0]===s[1]||s[0]>s[1]?s[1]:s[1]-1:s[0]===s[1]||s[1]>s[0]?s[0]:s[0]-1,i=n.getLineAt(r),o=n.lines.indexOf(i),c=n.lines[o+(e?-1:1)];if((c?.attributes.dl===i.attributes.dl||!c?.attributes.dl)&&!e)if(i.length===1&&i.attributes.dl==="dt")t.formatLine({},n.getLineRange(i));else{const l=n.getLineRange(i)[1]-1;t.insert(`
`,{dl:i.attributes.dl==="dt"?"dd":"dt"},[l,l])}else if(c){let l=n.getLineRange(c);l=[l[0],l[1]-1],e&&!c.attributes.dl&&(l=[l[1],l[1]]),t.select(l)}},commands:t=>()=>t.toggleLineFormat({dl:"dt"}),shouldCombine:()=>!0,nextLineAttributes:t=>({dl:t.dl==="dt"?"dd":"dt"}),renderMultiple:t=>{const e=[];let n="";for(const[s,r,i]of t)(!n||s.dl==="dt")&&e.push(j("div",{},[])),e[e.length-1].children.push(j(s.dl,{key:i},r)),n=s.dl;return j("dl",{},e)}}),Ln={lines:["paragraph","header","list","blockquote","code-block","hr"],formats:["link","bold","italic","mark","underline"],embeds:["image","br"]},Ws={Control:!0,Meta:!0,Shift:!0,Alt:!0},Ge=navigator.userAgent.indexOf("Macintosh")!==-1,En=Ge?/Cmd/:/Ctrl/;class Ve extends KeyboardEvent{shortcut;osShortcut;modShortcut;constructor(e,n){super(e,n),this.shortcut=n?.shortcut||"",this.osShortcut=`${Ge?"mac":"win"}:${this.shortcut}`,this.modShortcut=this.shortcut.replace(En,"Mod")}static fromKeyboardEvent(e){return e.shortcut=Et(e),new Ve("shortcut",e)}}function wn(t){return t.shortcut=Et(t),t.osShortcut=`${Ge?"mac":"win"}:${t.shortcut}`,t.modShortcut=t.shortcut.replace(En,"Mod"),t}function Et(t){const e=[];let n=t.key;return n?(n===" "&&(n="Space"),t.metaKey&&e.push("Cmd"),t.ctrlKey&&e.push("Ctrl"),t.altKey&&e.push("Alt"),t.shiftKey&&e.push("Shift"),Ws[n]||(Ge&&t.altKey&&t.code&&t.code.startsWith("Key")&&(n=t.code.replace("Key","")),n.length===1&&(n=n.toUpperCase()),e.push(n)),e.join("+")):""}const Ie={},Us=window.chrome&&typeof window.chrome=="object";function An(t){function e(h){if(h.defaultPrevented)return;if(t.doc.selection){const{lines:ee}=t.typeset,u=t.doc.getLinesAt(t.doc.selection);if(u.length){const y=ee.findByAttributes(u[0].attributes);if(y?.onEnter&&u.every(p=>y===ee.findByAttributes(p.attributes))){h.preventDefault(),y.onEnter(t);return}}}const{typeset:{lines:d},doc:f}=t;let{selection:g}=f;if(!g)return;h.preventDefault();const[m,b]=g,A=m===b,x=f.getLineAt(g[0]),[M,k]=f.getLineRange(g[0]);let{id:Z,...I}=x.attributes,_;const C=d.findByAttributes(I,!0),J=b===M,re=b===k-1;if(A&&a(x)){const ee=C.onEmptyEnter&&C.onEmptyEnter(t,x),u=!C.onEmptyEnter&&C!==d.default&&!C.contained&&!C.defaultFollows&&!C.frozen;if((ee||u)&&o(d,f.getLineAt(m)))return}m===M&&b===k&&C.frozen?(m===0?(_={dontFixNewline:!0},g=[m,m]):b===f.length?g=[b-1,b-1]:(_={dontFixNewline:!0},g=[b,b]),I=C.nextLineAttributes?C.nextLineAttributes(I):Ie):re&&(C.nextLineAttributes||C.defaultFollows||C.frozen)?I=C.nextLineAttributes?C.nextLineAttributes(I):Ie:J&&!re&&(C.defaultFollows&&(I=Ie),_={dontFixNewline:!0}),t.insert(`
`,I,g,_),m===M&&b===k&&C.frozen&&t.select(m===0?0:b)}function n(h){if(h.defaultPrevented)return;const{typeset:d,doc:f}=t;if(!d.embeds.get("br"))return e(h);f.selection&&(h.preventDefault(),t.insert({br:!0}))}function s(h){i(h,-1)}function r(h){i(h,1)}function i(h,d){if(h.defaultPrevented)return;const{typeset:{lines:f},doc:g}=t,{selection:m}=g;if(!m)return;const[b,A]=m,x=b===A,[M,k]=g.getLineRange(b);if(!(x&&(!Us||h.ctrlKey||h.altKey||h.metaKey)&&(d===-1&&b!==M||d===1&&b!==k-1)))if(h.preventDefault(),d===-1&&m[0]+m[1]===0)o(f,g.getLineAt(b),!0);else{const Z=q(m),I=g.getLineAt(Z[0]),_=f.findByAttributes(I.attributes,!0);if(x&&(d===-1&&b===M||d===1&&b===k-1)&&!_.contained){const J=g.lines[g.lines.indexOf(I)+d],[re,ee]=d===1?[I,J]:[J,I];if(re&&a(re)&&ee&&!a(ee))return t.update(t.change.delete([Z[0]+d,Z[0]],{dontFixNewline:!0}),ie.input)}t.delete(d,{dontFixNewline:_.frozen})}}function o(h,d,f){if(!d)return;const g=h.findByAttributes(d.attributes,!0);if(g){if(g.indentable&&d.attributes.indent)return t.outdent(),!0;if(f||g!==h.default&&!g.defaultFollows)return t.formatLine(Ie),!0}}function c(h){if(h.defaultPrevented)return;if(t.doc.selection){const{lines:f}=t.typeset,g=t.doc.getLinesAt(t.doc.selection);if(g.length){const m=f.findByAttributes(g[0].attributes);if(m?.onTab&&g.every(b=>m===f.findByAttributes(b.attributes))){h.preventDefault(),m.onTab(t,h.shiftKey);return}}}h.preventDefault();const d=h.modShortcut;d==="Tab"||d==="Mod+]"?t.indent():t.outdent()}function l(h){if(h.isComposing)return;wn(h);const d=f=>{const g=f&&t.shortcuts[f];if(g&&t.commands[g])return h.preventDefault(),t.commands[g]()!==!1};if(!t.root.dispatchEvent(Ve.fromKeyboardEvent(h))||d(h.shortcut)||d(h.osShortcut)||d(h.modShortcut)){h.preventDefault();return}switch(h.modShortcut){case"Enter":return e(h);case"Shift+Enter":return n(h);case"Tab":case"Shift+Tab":return c(h)}switch(h.modShortcut?.split("+").pop()){case"Backspace":return s(h);case"Delete":return r(h);default:return}}function a(h){return h.length===1&&!t.typeset.lines.findByAttributes(h.attributes)?.frozen}return{init(){t.root.addEventListener("keydown",l)},destroy(){t.root.removeEventListener("keydown",l)}}}const Ys=NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT;function Re(t,e){return(t.ownerDocument||document).createTreeWalker(t,Ys,{acceptNode(n){if(n.nodeType===Node.TEXT_NODE&&n.nodeValue==="")return NodeFilter.FILTER_REJECT;if(e){const s=e(n);return s?s===!0?NodeFilter.FILTER_ACCEPT:s:NodeFilter.FILTER_REJECT}else return NodeFilter.FILTER_ACCEPT}})}const wt="address, article, aside, blockquote, editor, dd, div, dl, dt, fieldset, figcaption, figure, footer, form,  header, hr, li, main, nav, noscript, ol, output, p, pre, section, table, tfoot, ul, video",Qs=/[\0-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F\xAD\u0600-\u0605\u061C\u06DD\u070F\u180E\u200B-\u200C\u200E-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB\uE000-\uF8FF]|\uD800[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,Xs={STYLE:!0,SCRIPT:!0,LINK:!0,META:!0,TITLE:!0},Zs=/[ \t\n\r]+/g,Js={};function ve(t,e){return e.nodeName!=="BR"?!1:qs(t,e)}function qs(t,e){const n=e.closest&&e.closest(t.typeset.lines.selector);if(!n)return!1;const s=Re(n);s.currentNode=e;const r=s.nextNode();return!r||r instanceof HTMLElement&&r.matches(wt)}function At(t,e){return Ee(document.createElement("div"),bt(t,e,!0)).innerHTML}function Nn(t,e){return Ee(document.createElement("div"),qe(t,V.create(e),!0)).innerHTML}function at(t,e,n){return new se(Nt(t,e),n)}function Nt(t,e,n){const r=new window.DOMParser().parseFromString(e,"text/html"),i=Le(t,{root:r.body,possiblePartial:n?.possiblePartial,collapseWhitespace:n?.collapseWhitespace});return Tt(i),i}function Tn(t,e){return new se(Le(t,{root:e}))}function Ks(t,e){const n=V.fromDelta(Le(t,{root:e}),t.doc.byId);return n.length?t.typeset.lines.findByAttributes(n[0].attributes,!0).renderMultiple?n:n[0]:void 0}function Tt(t){t.ops=t.filter(e=>(typeof e.insert=="string"&&(e.insert=e.insert.replace(Qs,"").replace(/\r\n?/g,`
`)),!!e.insert||!!e.retain||!!e.delete))}function Le(t,e=Js){const{lines:n,embeds:s}=t.typeset,r=e.root||t.root,i=e.collapseWhitespace!=null?e.collapseWhitespace:!0;var o=Re(r,m=>!Xs[m.nodeName]);const c=new D;let l,a=!1,h=!1,d=!0,f,g;for(e.startNode?(o.currentNode=e.startNode,o.previousNode(),e.offset&&c.retain(e.offset,void 0)):o.currentNode=r;(f=o.nextNode())&&f!==e.endNode;)if(ve(t,f))d=!1;else if(f.nodeName==="BR"&&f.className==="Apple-interchange-newline")c.insert(`
`,!l||l.unknownLine?{}:l);else if(f.nodeType===Node.TEXT_NODE){let m=f.parentNode;if(f.nodeValue==null||!f.nodeValue.replace(/\s+/g,"")&&(f.parentNode===r||f.previousSibling&&n.matches(f.previousSibling)||f.nextSibling&&n.matches(f.nextSibling)))continue;const b=f.nodeValue,x=(i?b.replace(Zs," "):b).replace(/\xA0/g," ");if(!x||x===" "&&m.classList.contains("EOP"))continue;const M=zt(m,r,t);d=!1,c.insert(x,M)}else if(s.matches(f)){const m=s.findByNode(f);if(m){const b=zt(f.parentNode,r,t);m.fromDom!==!1&&c.insert(m.fromDom?m.fromDom(f):{[m.name]:!0},b)}}else if(n.matches(f)||f.nodeType===Node.ELEMENT_NODE&&f.matches(wt)){if(h=!n.matches(f),h){let b=f.parentNode;for(;b&&!n.matches(b)&&b!==r;)b=b.parentNode;if(b&&b!==r)continue}const m=n.findByNode(f,!0);if(m===n.default&&(!f.parentNode||n.matches(f.parentNode)))continue;if(m.frozen)for(;o.lastChild(););if(g&&(c.insert("	",g),g=null),m.child||(a?(!l||!l.unknownLine||!d)&&(c.insert(`
`,!l||l.unknownLine?{}:l),d=!0):a=!0),h)l={unknownLine:h};else if(m&&m!==n.default){const b=m.fromDom?m.fromDom(f):{[m.name]:!0};m.child?g=b:l=b}else l={};!m.child&&e.includeIds&&f.key&&(l.id=f.key)}return(!h||!d)&&(a||!e.possiblePartial)&&c.insert(`
`,!l||l.unknownLine?{}:l),c}function zt(t,e,n){const{lines:s,formats:r}=n.typeset,i={};for(;t&&!s.matches(t)&&t!==e;){if(r.matches(t)){const o=r.findByNode(t);o&&o.fromDom!==!1&&(i[o.name]=o.fromDom?o.fromDom(t):!0)}else t.hasAttribute("style")&&r.list.forEach(o=>{o.styleSelector&&t.matches(o.styleSelector)&&(i[o.name]=o.fromDom?o.fromDom(t):!0)});t=t.parentNode}return i}const nt=[null,0];function xn(t,e,n){const s=t.root.ownerDocument;if("caretPositionFromPoint"in s)try{const r=s.caretPositionFromPoint(e,n);if(r)return Me(t,r.offsetNode,r.offset)}catch{}if(s.caretRangeFromPoint){const r=s.caretRangeFromPoint(e,n);if(r)return Me(t,r.startContainer,r.startOffset)}return null}function Gs(t,e){const{root:n}=t;if(!n.ownerDocument)return;const s=Array.from(n.querySelectorAll(t.typeset.lines.selector)).filter(i=>i.key),r=s[s.length-1];for(const i of s){const o=i.getBoundingClientRect();if(o.bottom>=e||i===r)return{line:t.doc.getLineBy(i.key),element:i,rect:o,belowMid:e>o.top+o.height/2}}}function Fn(t,e){e[0]>e[1]&&(e=[e[1],e[0]]);const[n,s,r,i]=Ft(t,e),o=t.root.ownerDocument.createRange();return n&&r&&(o.setStart(n,s),o.setEnd(r,i)),o}function ut(t,e){const n=Fn(t,e);if(n?.endContainer.nodeType===Node.ELEMENT_NODE)try{n.setEnd(n.endContainer,n.endOffset+1)}catch{}return n}function Me(t,e,n,s){const{root:r}=t,{lines:i}=t.typeset;if(!r.contains(e))return-1;if(e.nodeType===Node.ELEMENT_NODE){if(e.childNodes.length===n){if(ke(r,e)!=null)return ke(r,e)-1;e.childNodes.length&&(e=e.childNodes[n-1],n=Mn(t,e))}else e=e.childNodes[n],n=0;const o=ae(r,e);if(o!=null)return i.findByNode(e)?.frozen?o+n:(s==null||s<o?o:o-1)+n}return xt(t,e)+n}function xt(t,e){const{root:n}=t;if(!n.ownerDocument)return-1;const{lines:s,embeds:r}=t.typeset,i=Re(n);i.currentNode=e;let o,c=0,l;for(;(o=i.previousNode())&&o!==n;)if((l=ae(n,o))!=null){c+=l;break}else o.nodeType===Node.TEXT_NODE?c+=Se(s,o):o.classList?.contains("decoration")||(r.matches(o)&&!ve(t,o)||s.matches(o)&&!o.contains(e))&&c++;return c}function kn(t,e){const{root:n}=t;return n.ownerDocument?Array.from(n.querySelectorAll(t.typeset.lines.selector)).find(r=>ae(n,r)<=e&&ke(n,r)>e):void 0}function Mn(t,e){const{lines:n,embeds:s}=t.typeset;if(s.matches(e)&&!ve(t,e))return 1;if(e.nodeType===Node.TEXT_NODE)return Se(n,e);const r=Re(e);let i=n.findByNode(e)?1:0,o;for(;o=r.nextNode();)o.nodeType===Node.TEXT_NODE?i+=Se(n,o):o.classList?.contains("decoration")||(s.matches(o)&&!ve(t,o)||n.matches(o))&&i++;return i}function Ft(t,e){if(e==null)return[null,0,null,0];{const n=e[0]<=e[1],s=n?1:-1,r=e[0]===e[1],[i,o,c]=ht(t,e[0],n?0:1),[l,a]=r&&!c?[i,o]:c&&(r||e[1]-e[0]===s*t.doc.getLineAt(e[0]).length)?[i,o+(n?1:-1)]:ht(t,e[1],n?1:0);return[i,o,l,a]}}function ht(t,e,n){const{root:s}=t;if(!s.ownerDocument)return nt;const{lines:r,embeds:i}=t.typeset,o=Array.from(s.childNodes),c=kn(t,e);if(!c)return nt;if(r.findByNode(c,!0).frozen)return[c.parentNode,o.indexOf(c)+n,!0];e-=ae(s,c);const a=!e,h=Re(c);let d,f=!1;for(;d=h.nextNode();)if(d.nodeType===Node.TEXT_NODE){const g=Se(r,d);if(e<=g)return[d,e];e-=g}else if(!d.classList?.contains("decoration")){if(i.matches(d)&&!ve(t,d)){const g=i.findByNode(d);if(!g||g.fromDom===!1)continue;if(e-=1,e<=0){const m=Array.from(d.parentNode.childNodes);return[d.parentNode,m.indexOf(d)+1+e]}}else if(r.matches(d)&&(f?e-=1:f=!0,e===0)){const g=h.firstChild();if(g&&g.nodeType===Node.TEXT_NODE)return[g,0];if(g){const m=Array.from(d.childNodes);return[d,m.indexOf(g)]}else return[d,0]}}return a?[c,0]:nt}function Se(t,e){const n=e.nodeValue||"";return n.trim()||!(t.matches(e.previousSibling)||t.matches(e.nextSibling))?n.length:0}function kt(t){const{root:e}=t,n=t.doc.selection;if(!e.ownerDocument)return null;const s=e.ownerDocument.getSelection(),{lines:r}=t.typeset;if(s==null||s.anchorNode==null||s.focusNode==null||!e.contains(s.anchorNode))return null;{const i=Me(t,s.anchorNode,s.anchorOffset,n&&n[0]),o=s.anchorNode===s.focusNode&&s.anchorOffset===s.focusOffset,c=r.findByAttributes(t.doc.getLineAt(i)?.attributes,!0).frozen;let l=o?i:Me(t,s.focusNode,s.focusOffset,!c&&n?n[1]:null);return[i,l]}}function Ne(t,e){const{root:n}=t;if(!n.ownerDocument)return;const s=n.ownerDocument.getSelection();if(!s)return;const r=s.anchorNode&&n.contains(s.anchorNode)&&document.activeElement!==document.body;if(e==null)r&&(s.removeAllRanges(),n.classList.contains("focus")&&n.classList.remove("focus"));else{const[i,o,c,l]=Ft(t,e),a=e[0]===e[1]?"Caret":"Range";i&&c&&(s.anchorNode!==i||s.anchorOffset!==o||s.focusNode!==c||s.focusOffset!==l||s.type!==a)&&s.setBaseAndExtent(i,o,c,l),r||n.focus(),n.classList.contains("focus")||n.classList.add("focus")}n.dispatchEvent(new Event("select",{bubbles:!0}))}const Vs=navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),er=Vs||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Ht=!er&&/Mobi|Android/.test(navigator.userAgent)&&!window.MSStream,tr={characterData:!0,characterDataOldValue:!0,subtree:!0,childList:!0};function Sn(t){let e=!1,n=!1,s=[];function r(b){n=!0}function i(b){n=!1,s.length&&(l(s),s=[])}function o(){if(n)return;const b=d.takeRecords();b.length&&l(b)}function c(b){let A=!1;const x=b.ops[b.ops.length-1];return x?.insert&&x.insert.br&&(A=!0),A}function l(b){if(n){s.push(...b);return}if(!t.enabled)return t.render();let A=a(b),x=kt(t);if(!A){const M=sr(t.root,b);A=h(M)}if(e&&(c(A)&&(A.ops.pop(),A.insert(`
`)),x!==null&&(x[0]++,x[1]++),e=!1),A&&A.ops.length){Tt(A);const M=t.doc;t.update(new oe(t.doc,A,x,t.activeFormats),ie.input),t.doc.lines===M.lines&&t.render()}}function a(b){const A=nr(b);if(!A||A.oldValue==null||A.target.nodeValue==null)return null;const x=new D,M=xt(t,A.target);x.retain(M);let k;return t.doc.selection&&(k=q(t.doc.selection)[0]-M,k<0&&(k=0)),he(A.oldValue.replace(/\xA0/g," "),A.target.nodeValue.replace(/\xA0/g," "),k).forEach(([I,_])=>{I===he.EQUAL?x.retain(_.length):I===he.DELETE?x.delete(_.length):I===he.INSERT&&x.insert(_,t.activeFormats)}),x.chop(),x}function h(b){const{doc:A}=t;if(b){const[x,M]=b,k=ae(t.root,x),Z=ke(t.root,M),I=Le(t,{startNode:x,endNode:M.nextElementSibling||void 0,collapseWhitespace:!1});let _=A.toDelta().slice(k,Z).diff(I);return _.ops.length&&k&&(_=new D().retain(k).concat(_)),_}else{const x=Le(t,{collapseWhitespace:!1});return A.toDelta().diff(x)}}const d=new window.MutationObserver(l);function f(){d.disconnect()}function g(){d.observe(t.root,tr)}function m(b){b.data&&b.data?.includes(`
`)&&(e=!0)}return{allowComposition(b=!0){b?(t.root.addEventListener("compositionstart",r),t.root.addEventListener("compositionend",i)):(t.root.removeEventListener("compositionstart",r),t.root.removeEventListener("compositionend",i))},init(){t.root.addEventListener("input",o),t.on("rendering",f),t.on("render",g),Ht&&t.root.addEventListener("beforeinput",m)},destroy(){d.disconnect(),t.root.removeEventListener("input",o),t.root.removeEventListener("compositionstart",r),t.root.removeEventListener("compositionend",i),t.off("rendering",f),t.off("render",g),Ht&&t.root.removeEventListener("beforeinput",m)}}}function nr(t){const e=new Set;if(t=t.filter(o=>o.type!=="characterData"?!0:e.has(o.target)?!1:(e.add(o.target),!0)),t.length>3)return null;const n=t.find(o=>o.type==="characterData");if(!n)return null;const s=t.find(o=>o.addedNodes.length===1&&o.addedNodes[0].nodeName==="#text"),r=t.find(o=>o.addedNodes.length===1&&o.addedNodes[0].nodeName==="BR"||o.removedNodes.length===1&&o.removedNodes[0].nodeName==="BR");return 1+(s?1:0)+(r?1:0)<t.length||s&&s.addedNodes[0]!==n.target?null:n}function sr(t,e){let n,s;for(let r=0;r<e.length;r++){const i=e[r];if(i.target===t)return;const o=rr(t,i.target);if(o&&o.key)(!n||ae(t,o)<ae(t,n))&&(n=o),(!s||ae(t,o)>ae(t,s))&&(s=o);else return}if(n&&s)return[n,s]}function rr(t,e){for(;e&&e.parentNode!==t;)e=e.parentNode;return e}function Rn(t){let e,n,s=!1;function r(){if(!t.enabled)return;const f=kt(t),g=f?.slice()||null;if(!f&&s)return;if(s&&(s=!1),f){f[0]===f[1]&&f[0]===t.doc.length&&f[0]--;let b=t.doc.getLineAt(f[0]),A=t.typeset.lines.findByAttributes(b.attributes,!0);f&&f[0]===f[1]&&t.doc.selection&&t.doc.selection[0]===f[0]&&t.doc.selection[1]===f[0]+1&&(A.frozen&&(f[0]--,f[1]--),b=t.doc.getLineAt(f[0]),A=t.typeset.lines.findByAttributes(b.attributes,!0)),A.frozen&&f[0]===f[1]&&f[1]++}const{doc:m}=t;if(O(m.selection,f))O(g,f)||Ne(t,f);else{if(f&&f[0]===f[1]&&f[0]>=m.length)return;t.select(f)}}function i(){s||!t.enabled||Ne(t,t.doc.selection)}function o(){const{doc:f,typeset:{lines:g}}=t,m=t.modules.decorations.getDecorator("selection");m.clear();const b=f.selection;b&&f.getLinesAt(b).forEach(A=>{if(g.findByAttributes(A.attributes,!0).frozen){const x=O(b,f.getLineRange(A));m.decorateLine(f.getLineRange(A)[0],{class:"selected"+(x?" focus":"")})}}),m.apply()}function c(f){let g=f.target;for(;g.parentNode&&g.parentNode!==t.root;)g=g.parentNode;const m=ae(t.root,g),b=m!=null&&t.doc.getLineAt(m),A=b&&t.typeset.lines.findByAttributes(b.attributes);m!=null&&b&&A&&A.frozen&&(f.preventDefault(),t.select([m,m+b.length]))}function l(f){const g=f.doc?.selection||t.doc.selection;Ne(t,g)}function a(){t.root.classList.toggle("window-inactive",!e.hasFocus())}function h(){s=!0;const{selection:f}=t.doc;e.getSelection()?.empty();const{decorations:g}=t.modules;f&&f[0]!==f[1]&&g&&g.getDecorator("pausedSelection").decorateText(f,{class:"selected"}).apply()}function d(){s=!1;const{decorations:f}=t.modules;f&&f.removeDecorations("pausedSelection"),setTimeout(i)}return{pause:h,resume:d,renderSelection:i,init(){e=t.root.ownerDocument,n=e.defaultView,e.addEventListener("selectionchange",r),n.addEventListener("focus",a),n.addEventListener("blur",a),t.root.addEventListener("mousedown",c),t.on("change",l),t.on("decorate",o)},destroy(){e.removeEventListener("selectionchange",r),n.removeEventListener("focus",a),n.removeEventListener("blur",a),t.root.removeEventListener("mousedown",c),t.off("change",l),t.off("decorate",o),s=!1,e=null,n=null}}}const ir={dontFixNewline:!0},$t={excludeProps:new Set(["id"])};class In extends Event{delta;html;text;constructor(e,n){super(e,n),this.delta=n.delta,this.html=n.html,this.text=n.text}}function _n(t,e){const n=e?.allowHTMLPaste??!0;function s({selection:i,text:o,html:c}){const{doc:l}=t;if(i=i||l.selection,i=i&&q(i),!i)return;const[a,h]=i;let d;if(c)e?.htmlParser?d=e.htmlParser(t,c):d=Nt(t,c,{possiblePartial:!0});else{if(!o)return;d=new D().insert(o.replace(/\xA0/g," ").replace(/\r\n/g,`
`))}const f=d.filter(b=>typeof b.insert=="string"&&b.insert.includes(`
`)).length>0;let g=d.length();if(f){let b=V.fromDelta(d,l.byId);d=V.toDelta(b),g=d.length();const A=l.getLineAt(a),x=l.getLineAt(h),M=_e(A),k=A===x?M:_e(x);c||(b=b.map(ee=>({...ee,attributes:A.attributes})),M!==k&&(b[b.length-1].attributes=x.attributes));const Z=b[0],I=_e(Z),_=b[b.length-1],C=Z===_?I:_e(_);a!==l.getLineRange(A)[0]&&!O(M,I,$t)&&(d=new D().insert(`
`,M).concat(d),g++);const J=d.ops[d.ops.length-1].insert,re=typeof J=="string"&&J.endsWith(`
`);re&&h!==l.getLineRange(x)[1]&&O(k,C,$t)?d=d.slice(0,--g):re&&h===l.getLineRange(x)[1]-1&&(d.delete(1),g--)}const m=new In("paste",{delta:d,html:c,text:o,cancelable:!0});if(t.dispatchEvent(m),d=m.delta,!m.defaultPrevented)if(d&&d.ops.length){const b=t.change.delete(i,f?ir:void 0);b.insertContent(a,d).select(a+g),t.update(b,ie.paste)}else a!==h&&t.delete([a,h])}function r(i){if(!t.enabled||!t.doc.selection||i.defaultPrevented)return;i.preventDefault();const o=i.clipboardData,{doc:c}=t;if(!o||!c.selection)return;const l=n?o.getData("text/html"):void 0,a=o.getData("text/plain");s({text:a,html:l})}return{commands:{paste:s},init(){t.root.addEventListener("paste",r)},destroy(){t.root.removeEventListener("paste",r)}}}function _e(t){const{id:e,...n}=t.attributes;return n}const Dn=On();function On(t={}){return function(e){let n=0,s="",r=!1,i=ft();const o={maxStack:500,delay:0,unrecordedSources:new Set,...t};function c(k){k.inputType==="historyUndo"?(k.preventDefault(),l()):k.inputType==="historyRedo"&&(k.preventDefault(),a())}function l(){m("undo","redo")}function a(){m("redo","undo")}function h(){return i.undo.length>0}function d(){return i.redo.length>0}function f(){n=0}function g(){i=ft()}function m(k,Z){if(i[k].length===0)return;const I=i[k].pop();i[Z].push(I),f(),r=!0,e.update(I[k],ie.history),r=!1}function b(k,Z){const I=Date.now(),_=or(k);i.redo.length=0;const C=new oe(null,k.delta.invert(Z.toDelta()),Z.selection);if((!_||s!==_)&&f(),s=_,n&&(!o.delay||n+o.delay>I)&&i.undo.length){const J=i.undo[i.undo.length-1];J.redo.delta=J.redo.delta.compose(k.delta),J.redo.selection=k.selection,J.undo.delta=C.delta.compose(J.undo.delta)}else{const J=new oe(null,k.delta,k.selection);n=I,i.undo.push({redo:J,undo:C})}i.undo.length>o.maxStack&&i.undo.shift()}function A({change:k,old:Z,source:I}){if(!k)return g();if(!r){if(!k.contentChanged)return f();I!==ie.api&&!o.unrecordedSources.has(I)?b(k,Z):Cn(i,k)}}function x(k){i=k}function M(){return i}return{options:o,hasUndo:h,hasRedo:d,undo:l,redo:a,cutoffHistory:f,clearHistory:g,setStack:x,getStack:M,getActive(){return{undo:h(),redo:d()}},commands:{undo:l,redo:a},shortcuts:{"win:Ctrl+Z":"undo","mac:Cmd+Z":"undo","win:Ctrl+Y":"redo","mac:Cmd+Shift+Z":"redo"},init(){e.on("change",A),e.root.addEventListener("beforeinput",c)},destroy(){e.off("change",A),e.root.removeEventListener("beforeinput",c)}}}}function ft(){return{undo:[],redo:[]}}function Cn(t,e){const n=e.ops?new oe(null,e):e;t.undo.forEach(s=>{s.undo=n.transform(s.undo,!0),s.redo=n.transform(s.redo,!0)}),t.redo.forEach(s=>{s.undo=n.transform(s.undo,!0),s.redo=n.transform(s.redo,!0)})}function or(t){const{ops:e}=t.delta;let n=0,s=e.length-1;if(e[n].retain&&!e[n].attributes&&n++,e[s].retain===1&&e[s].attributes?.id&&s--,n===s){const r=e[n];if(r.delete)return"delete";if(r.insert===`
`)return"newline";if(typeof r.insert=="string")return"insert"}return""}const Bn={keyboard:An,input:Sn,copy:Hn,paste:_n,history:Dn,decorations:un,rendering:gn,selection:Rn},Te={},Pn=[],Wt=["focus","blur","keydown","mousedown","mouseup","click"],Ut=new WeakMap;class ye extends Event{old;doc;change;changedLines;source;constructor(e,n){super(e,n),this.old=n.old,this.doc=n.doc,this.change=n.change,this.changedLines=n.changedLines,this.source=n.source,Object.setPrototypeOf(this,ye.prototype)}modify(e){if(!this.cancelable)throw new Error('Cannot modify an applied change, listen to the "changing" event');this.doc=this.doc.apply(e),this.change&&(this.change.delta=this.change.delta.compose(e)),this.changedLines&&(this.changedLines=this.old.lines===this.doc.lines?Pn:jn(this.old,this.doc))}}class dt extends Event{formats;constructor(e,n){super(e,n),this.formats=n.formats}}class cr extends tn{identifier;typeset;doc;activeFormats=Te;commands={};shortcuts={};modules={};catchErrors;throwOnError;_root;_modules;_enabled;constructor(e={}){super(),this.catchErrors=!e.dev,this.identifier=e.identifier,this.typeset=new vn(e.types||Ln),e.doc?this.doc=e.doc:e.html?this.doc=at(this,e.html):e.text?this.doc=new se(new D().insert(e.text)):this.doc=new se,this.throwOnError=e.throwOnError||!1,this._enabled=e.enabled===void 0?!0:e.enabled;const n=e.includeDefaultModules??!0;this._modules=n?{...Bn,...e.modules}:{...e.modules},e.root&&this.setRoot(e.root)}get root(){return this._root||this.setRoot(document.createElement("div")),this._root}get enabled(){return this._enabled}set enabled(e){e=!!e;const n=this._enabled!==e;!e&&this.doc.selection&&this.select(null,ie.api),this._enabled=e,this._root&&(this._root.contentEditable=e?"true":"inherit"),n&&this.dispatchEvent(new Event("enabledchange"))}get change(){const e=new oe(this.doc);return e.apply=(n=ie.user)=>this.update(e,n),e}setRoot(e){if(!e)throw new TypeError("Root must be set, cannot be "+e);return this.destroy(),this._root=e,this.init(),this.dispatchEvent(new Event("root")),this}update(e,n=ie.user){if(!this.enabled&&n!==ie.api)return this;const s=e.ops?new oe(this.doc,e):e,r=this.doc,i=r.apply(s,void 0,this.throwOnError),o=r.lines===i.lines?Pn:jn(r,i);return this.set(i,n,s,o),this}set(e,n=ie.user,s,r){const i=this.doc,o=e.ops?new se(e):e;if(!this.enabled&&n!==ie.api||!o||i.equals(o))return this;const c=new ye("changing",{cancelable:!0,old:i,doc:o,change:s,changedLines:r,source:n});return this.dispatchEvent(c,this.catchErrors),c.defaultPrevented||i.equals(c.doc)?this:(this.activeFormats=s?.activeFormats?s.activeFormats:De(this,c.doc),this.doc=c.doc,this.dispatchEvent(new ye("change",{...c,cancelable:!1}),this.catchErrors),this.dispatchEvent(new ye("changed",{...c,cancelable:!1}),this.catchErrors),this)}getHTML(){return At(this,this.doc)}setHTML(e,n=this.doc.selection,s){return this.set(at(this,e,n),s)}getDelta(){return this.doc.toDelta()}setDelta(e,n=this.doc.selection,s){return this.set(new se(e,n),s)}getText(e){return this.doc.getText(e)}setText(e,n=this.doc.selection,s){return this.set(new se(new D().insert(e),n),s)}trimSelection(e){if(!e)return e;const n=this.getText(e),[s,r]=q([...e]);if(n.trim()){const[i,o,c,l]=n.match(/(^ *)((?:.|\r|\n)*?)( *$)/);if(c&&(o||l))return[s+o.length,r-l.length]}return e}getActive(){const{selection:e}=this.doc;let n=e?e[0]===e[1]?{...this.activeFormats,...this.doc.getLineFormat(e)}:{...this.doc.getFormats(e)}:{};return Object.values(this.modules).forEach(s=>{s.getActive&&(n={...n,...s.getActive()})}),n}select(e,n){return this.update(this.change.select(e),n)}insert(e,n,s=this.doc.selection,r){if(!s)return this;const i=O(s,this.doc.selection);n==null&&typeof e=="string"&&e!==`
`&&(n=i?this.activeFormats:De(this,this.doc,s));const o=this.typeset.lines.findByAttributes(n,!0),c=this.change.delete(s),l=q(s)[0];if(i&&c.setActiveFormats(e!==`
`&&n||De(this,this.doc,s)),e===`
`&&o.frozen){const a={...this.doc.getLineFormat(l)},h={...n};let d={...a};const f=new D().insert(`
`,a);this.doc.getLineRange(l)[1]-1!==l?f.insert(`
`,h):d=h,c.insertContent(l,f).formatLine(l,d).select(l+2)}else c.insert(l,e,n,r);return this.update(c)}insertContent(e,n=this.doc.selection){if(!n)return this;const s=this.change.delete(n).insertContent(n[0],e);return this.update(s)}delete(e,n){let s,r=0;const{typeset:{lines:i},doc:o}=this;if(Array.isArray(e))s=q(e);else{if(!this.doc.selection)return this;s=q(this.doc.selection),e&&(s[0]===s[1]?e<0?s=[s[0]+e,s[1]]:s=[s[0],Math.min(s[1]+e,this.doc.length-1)]:e<0&&i.findByAttributes(o.getLineAt(s[0]).attributes,!0).frozen&&(r=-1))}const c=De(this,this.doc,[s[0]+1,s[0]+1]),l=this.doc.length-(s[1]-s[0]);let a=Math.max(0,Math.min(l-1,s[0]+r));const h=this.change.delete(s,n).select(a).setActiveFormats(c);return this.update(h)}formatText(e,n=this.doc.selection){return n?(typeof e=="string"&&(e={[e]:!0}),n[0]===n[1]?(this.activeFormats=te.compose(this.activeFormats,e)||Te,this.dispatchEvent(new dt("format",{formats:this.activeFormats})),this):(Ae(this,"formatText",e,n),this)):this}toggleTextFormat(e,n=this.doc.selection){return n?(typeof e=="string"&&(e={[e]:!0}),n[0]===n[1]?($e(e,this.activeFormats)&&(e=te.invert(e)),this.activeFormats=te.compose(this.activeFormats,e)||Te,this.dispatchEvent(new dt("format",{formats:this.activeFormats})),this):(Ae(this,"toggleTextFormat",e,n),this)):this}formatLine(e,n=this.doc.selection){return typeof e=="string"&&(e={[e]:!0}),Ae(this,"formatLine",e,n),this}toggleLineFormat(e,n=this.doc.selection){return typeof e=="string"&&(e={[e]:!0}),Ae(this,"toggleLineFormat",e,n),this}indent(){return Qt(this,1),this}outdent(){return Qt(this,-1),this}removeFormat(e=this.doc.selection){return Ae(this,"removeFormat",null,e),this}getBounds(e,n,s){if(typeof e=="number"&&(e=[e,e]),!e)return;let r=ut(this,e)?.getBoundingClientRect();if(r&&n){const i=n.getBoundingClientRect(),o=(s?n.scrollLeft:0)-i.x,c=(s?n.scrollTop:0)-i.y;r=new DOMRect(r.x+o,r.y+c,r.width,r.height)}return r}getAllBounds(e,n,s){typeof e=="number"&&(e=[e,e]);const r=ut(this,e)?.getClientRects();let i=r&&Array.from(r);if(i&&n){const o=n.getBoundingClientRect(),c=(s?n.scrollLeft:0)-o.x,l=(s?n.scrollTop:0)-o.y;i=i.map(a=>new DOMRect(a.x+c,a.y+l,a.width,a.height))}return i}getIndexFromPoint(e,n){return xn(this,e,n)}render(){return this.modules.decorations?.gatherDecorations(),this.modules.rendering?.render(),this.modules.selection?.renderSelection(),this}init(){const e=this._root;e.editor&&e.editor.destroy(),e.editor=this,this.enabled=this._enabled,this.commands={},Wt.forEach(n=>this._root.addEventListener(n,Xt(this))),this.typeset.lines.list.forEach(n=>n.commands&&Oe(this,n.name,n.commands(this))),this.typeset.formats.list.forEach(n=>n.commands&&Oe(this,n.name,n.commands(this))),this.typeset.embeds.list.forEach(n=>n.commands&&Oe(this,n.name,n.commands(this))),Object.keys(this._modules).forEach(n=>{if(!this._modules[n])return;const s=this.modules[n]=this._modules[n](this);s.commands&&Oe(this,n,s.commands)}),this.shortcuts=ar(this),Object.keys(this.modules).forEach(n=>this.modules[n].init?.()),this.render()}destroy(){const e=this._root;e&&(Wt.forEach(n=>e.removeEventListener(n,Xt(this))),Object.values(this.modules).forEach(n=>n.destroy&&n.destroy()),this._root=void 0,delete e.editor)}}function Ae(t,e,n,s){if(!s)return;if(s=typeof s=="number"?[s,s]:t?.trimSelection(s),!(e in t.change))throw new Error("Invalid operation: "+e);const r=t.change[e](s,n);t.update(r)}function De(t,e,n=e.selection){const{formats:s}=t.typeset;if(!n||n[0]===0)return Te;const r=q(n)[0];let i=r,o=r+1;const c=e.getTextFormat(i),l=e.getTextFormat(o),a={};return Object.keys(c).forEach(h=>{const d=s.get(h);d&&d.greedy!==!1&&(a[h]=c[h])}),Object.keys(l).forEach(h=>{const d=s.get(h);d&&d.greedy===!1&&(a[h]=c[h])}),a}function jn(t,e){const n=new Set(t.lines);return e.lines.filter(s=>!n.has(s))}function Oe(t,e,n){n&&(typeof n=="function"?t.commands[e]=Yt(t,n):Object.keys(n).forEach(s=>t.commands[s]=Yt(t,n[s])))}function Yt(t,e){return(...n)=>{const s=e(...n);return t.doc.selection&&t.root.focus(),s}}function Qt(t,e=1){const{typeset:{lines:n},doc:s}=t,{selection:r}=s;if(!r)return s;const i=t.change;s.getLinesAt(r).forEach(o=>{if(!n.findByAttributes(o.attributes,!0).indentable)return;const l=s.getLineRange(o);let a=(o.attributes.indent||0)+e;a===0&&(a=null),i.formatLine(l[0],a<0?Te:{...o.attributes,indent:a})}),t.update(i)}function Xt(t){let e=Ut.get(t);return e||(e=lr.bind(t),Ut.set(t,e)),e}function lr(t){this.dispatchEvent(t)}function ar(t){const e={},{typeset:{lines:n,formats:s,embeds:r},modules:i}=t;return st(n,e),st(s,e),st(r,e),ur(i,e),e}function st(t,e){t.list.forEach(n=>{const s=n.shortcuts;s&&(typeof s=="string"?e[s]=n.name:zn(s,e))})}function ur(t,e){Object.keys(t).forEach(n=>{const s=t[n]?.shortcuts;s&&zn(s,e)})}function zn(t,e){Object.keys(t).forEach(n=>e[n]=t[n])}const hr={copyPlainText:!0,copyHTML:!0},Zt={text:"",html:""};function Hn(t,e=hr){function n(i){const{doc:o}=t,c=q(i||o.selection);if(!c)return Zt;const l=o.slice(c[0],c[1]);if(!l.ops.length)return Zt;const a=l.map(d=>typeof d.insert=="string"?d.insert:" ").join("");let h;return a.includes(`
`)?(l.push({insert:`
`,attributes:o.getLineFormat(c[1])}),h=At(t,new se(l))):h=Nn(t,l),{text:a,html:h}}function s(i){if(!t.enabled||!t.doc.selection||i.defaultPrevented)return;i.preventDefault();const o=i.clipboardData;if(!o)return;const{text:c,html:l}=n();e.copyHTML&&l&&o.setData("text/html",l),e.copyPlainText&&c&&o.setData("text/plain",c)}function r(i){s(i),t.delete()}return{commands:{getCopy:n},init(){t.root.addEventListener("copy",s),t.root.addEventListener("cut",r)},destroy(){t.root.removeEventListener("copy",s),t.root.removeEventListener("cut",r)}}}function fr(t,e){return n=>{function s({doc:r}){const i=n.modules.decorations.getDecorator("placeholder"),o=(typeof t=="function"?t():t)||"";let c;if(i.hasDecorations()){const d=i.getDecoration().ops;c=d[d.length-1].attributes?.decoration?.placeholder}const{lines:l}=n.typeset,a=l.findByAttributes(r.lines[0]?.attributes,!0),h=l.default===a&&r.length===1;if(h||e?.keepAttribute){const d={"data-placeholder":o||""};h&&(d.class="placeholder"),O(d,c)||(i.remove(),i.decorateLine(0,d).apply())}else i.remove()}return n.addEventListener("decorate",s),{destroy(){n.removeEventListener("decorate",s)}}}}const dr=/(https?:\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,pr=/(www\.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,gr=/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.(com|org|net|io)\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,$n=[[/^(#{1,6}) $/,t=>({header:t.length})],[/^\* $/,(t,{indent:e})=>({list:"bullet",indent:e})],[/^- $/,(t,{indent:e})=>({list:"bullet",type:"dash",indent:e})],[/^1\. $/,(t,{indent:e})=>({list:"ordered",indent:e})],[/^([AaIi])\. $/,(t,{indent:e})=>({list:"ordered",type:t,indent:e})],[/^(-?\d+)\. $/,(t,{indent:e})=>({list:"ordered",start:t,indent:e})],[/^([A-Z])\. $/,(t,{indent:e})=>({list:"ordered",type:"A",indent:e,start:t==="A"?void 0:t.charCodeAt(0)-65+1})],[/^([a-z])\. $/,(t,{indent:e})=>({list:"ordered",type:"a",indent:e,start:t==="a"?void 0:t.charCodeAt(0)-97+1})],[/^([IVXLCDM]+)\. $/i,(t,{indent:e})=>({list:"ordered",type:t[0].toUpperCase()===t[0]?"I":"i",indent:e,start:t.toUpperCase()==="I"?void 0:vr(t)})],[/^> $/,()=>({blockquote:!0})]],Wn=[[/(\*|_){3}(\b(?:(?!\1).)+\b)\1{3}((?:(?!\1).))$/s,()=>({bold:!0,italic:!0})],[/(\*|_){2}(\b(?:(?!\1).)+\b)\1{2}((?:(?!\1).))$/s,()=>({bold:!0})],[/(\*|_){1}(\b(?:(?!\1).)+\b)\1{1}((?:(?!\1).))$/s,()=>({italic:!0})]],Un=[[dr,t=>({link:t})],[pr,t=>({link:"https://"+t})],[gr,t=>({link:"https://"+t})]],Yn=[[/--$/,()=>"—"],[/(\S - \S)$/,t=>t.replace("-","–")],[/\.\.\.$/,()=>"…"]];function Qn(t,e,n){return $n.some(([s,r])=>{const i=n.match(s);if(i){const o=r(i[1],t.doc.getLineFormat(e));if(!t.typeset.lines.findByAttributes(o))return!1;const c=e-n.length,l=t.change.delete([c,e]).formatLine(e,o).select([c,c]);return t.update(l),!0}else return!1})}function Xn(t,e,n){return Un.some(([s,r])=>{const i=n.match(s);if(i){let o=i[0].slice(0,-1);o[o.length-1]==="."&&(o=o.slice(0,-1));const c=e-(i[0].length-o.length),l=r(o,t.doc.getTextFormat(e));return t.typeset.formats.findByAttributes(l)?(t.formatText(l,[c-o.length,c]),!0):!1}else return!1})}function mr(t,e,n,s){return Wn.some(([r,i])=>{const o=n.match(r);if(o){let[c,l,a,h]=o;const d=i(a,t.doc.getTextFormat(e));if(!t.typeset.formats.findByAttributes(d))return!1;e-(c.length-a.length)+h.length,h===" "&&s[e]===" "&&(h="");const f=e-h.length;return t.insert(a,d,[f-c.length+h.length,f]),!0}else return!1})}function Zn(t,e,n){return Yn.some(([s,r])=>{const i=n.match(s);return i?(t.insert(r(i[1]),void 0,[e-i[0].length,e]),!0):!1})}const Jn=[Qn,Zn,Xn];function br(t=Jn){return e=>{let n=!1;function s({change:r,source:i}){if(n||i==="api"||!e.doc.selection||!r||!yr(r.delta))return;const o=e.doc.selection[1],c=e.doc.getText(),l=c.lastIndexOf(`
`,o-2)+1,a=c.slice(l,o);n=!0,t.some(h=>h(e,o,a,c)),n=!1}return e.on("changed",s),{destroy(){e.off("changed",s)}}}}function yr(t){return(t.ops.length===1||t.ops.length===2&&t.ops[0].retain&&!t.ops[0].attributes)&&t.ops[t.ops.length-1].insert}const Jt={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};function vr(t){t=t.toUpperCase();let e=0;for(let n=0;n<t.length;n++){const s=Jt[t[n]],r=Jt[t[n+1]];if(s===void 0)return;s<r?(e+=r-s,n++):e+=s}return e}const Lr=/['"]/g,Er=/[\s\{\[\(\<'"\u2018\u201C]/,qt={'"':{left:"“",right:"”"},"'":{left:"‘",right:"’"}};function wr(t){function e(n){const{change:s,source:r,doc:i,old:o}=n;if(r==="api"||!o.selection||!s)return;const c=Ar(s.delta.ops);if(!c.length)return;const l=i.getText(),a=new D;let h=0;for(let d=0;d<c.length;d++){const[f,g]=c[d],m=l[f],b=!f||Er.test(l[f-1])?qt[m].left:qt[m].right;a.retain(f-h).delete(1).insert(b,g),h=f+1}n.modify(a)}return t.on("changing",e),{destroy(){t.off("changing",e)}}}function Ar(t){const e=[];let n=0;return t.forEach(s=>{if(s.retain)n+=s.retain;else if(typeof s.insert=="string"){let r;for(;r=Lr.exec(s.insert);)e.push([n+r.index,s.attributes]);n+=s.insert.length}else s.insert&&(n+=1)}),e}function Nr(t){let e=0,n=[],s=[],r=xr(t.root),i,o=0,c=40,l,a=null,h=null,d,f=!1,g=!0;r.addEventListener("scroll",re,{passive:!0}),t.on("change",ee);const m=Mr(r,(u,y,p)=>{o=y,p&qn&&(n=[]),A()});function b(u){if(!u||!l){const{doc:y}=t.modules.decorations||t;l=pe(t,y.lines).combined,f=!0,a=y.selection,A()}else{const{doc:y,old:p}=u,w=u.selection||null,E=w&&Sr(w,l).sort((v,L)=>v-L);if(O(E,h)||(f=f||!J(E),h=E),p&&y){const v=pe(t,y.lines).combined,[L,N]=Lt(l,v);if(L[0]+L[1]+N[0]+N[1]>0){f=!0;const T=L[1]-L[0],F=N[1]-N[0];if(T<F){const S=new Array(F-T).fill(void 0);n.splice(L[1],0,...S)}else T>F&&n.splice(L[0],T-F)}l=v}else y&&(l=pe(t,y.lines).combined,f=!0);a=w,f&&A()}}function A(){if(g=!1,!l)return;const{scrollTop:u}=r;i=Z();const y=e,p=n.slice();let w=!1,E=0;for(;x()&&E++<20;)w=!0,f=!1,M(),k();if(E>=20&&console.error("Updated virtual max times"),Ne(t,a),!!w&&e<y){let v=0,L=0,N=d.indexOf(e);for(let F=e;F<y;F++){const S=F-e+N;s[S]&&(v+=_(F,p),L+=_(F))}const T=L-v;r.scrollTo(0,u+T)}}function x(){const{scrollTop:u}=r,y=new Set([0,l.length-1,...h||[]]);let p=0,w=i,E=0;for(;p<l.length;){const L=_(p);if(w+L>u){E=p;break}w+=L,p+=1}for(;p<l.length&&(y.add(p),w+=_(p),p+=1,!(w>u+o)););Math.min(p,l.length-1);const v=Array.from(y).sort((L,N)=>L-N);return O(v,d)?f:(e=E,d=v,!0)}function M(){const u=[],y=new Set(d);let p="",w=0,E=0,v=0;for(let L=0,N=0;L<l.length;L++){if(y.has(L)){if(N){E=C(L,-1),N-=w;const F=j("div",{class:"-spacer-","data-key":p,style:`height:${N}px;margin-top:${w}px;margin-bottom:${E}px;`,key:p});p="",u.push(F)}N=0;const T=vt(t,l[L]);u.push(T)}else L===1?p="spacer-start":L===l.length-2?p="spacer-end":!p&&h&&L>h[1]?p="spacer-selection-end":!p&&h&&L>h[0]&&(p="spacer-selection-start"),N||(w=C(L,-1)),N+=_(L);v+=_(L)}t.dispatchEvent(new Event("rendering")),Ee(t.root,u),Je(t),t.dispatchEvent(new Event("render")),t.dispatchEvent(new Event("rendered"))}function k(){s=Array.from(t.root.children).filter(y=>y.className!=="-spacer-");for(let y=0;y<s.length;y++){const p=d[y];n[p]=I(s[y])}if(!s.length)return;const u=n.filter(Boolean);c=Math.round(C(0,-1,u)+u.reduce((y,p,w,E)=>y+_(w,E),0)/u.length)}function Z(){const{scrollTop:u}=r,{root:y}=t;return r===y?parseInt(getComputedStyle(y).paddingTop):y.getBoundingClientRect().top+parseInt(getComputedStyle(y).paddingTop)+u-r.getBoundingClientRect().top}function I(u){const y=getComputedStyle(u);return[parseInt(y.marginTop),u.offsetHeight,parseInt(y.marginBottom)]}function _(u,y=n){return y[u]?(u===0?C(u,-1,y):0)+y[u][1]+C(u,1,y):c}function C(u,y,p=n){return Math.max(p[u]&&p[u][2]||0,p[u+y]&&p[u+y][0]||0)}function J(u,y){if(!u)return!1;let[p,w]=u;return w++,d.some(E=>E>=p&&E<w)}function re(){g||(requestAnimationFrame(A),g=!0)}function ee(u){const{old:y,doc:p}=t.modules.decorations||u,w=u.doc.selection;b({old:y,doc:p,selection:w})}return{render:b,init(){t.modules.decorations&&t.modules.decorations.gatherDecorations(),b()},destroy(){m(),r.removeEventListener("scroll",re),t.off("change",ee)}}}const Tr=/auto|scroll/;function xr(t){for(;t&&t!==t.ownerDocument.scrollingElement;){if(Tr.test(getComputedStyle(t).overflowY))return t;t=t.parentNode}return t}const qn=1,Fr=2,kr=3;function Mr(t,e){let n=t.offsetWidth,s=t.offsetHeight;if(e(n,s,kr),typeof window.ResizeObserver<"u"){const i=new window.ResizeObserver(r);return i.observe(t),()=>i.disconnect()}else{const i=t.ownerDocument.defaultView;return i.addEventListener("resize",r),()=>i.removeEventListener("resize",r)}function r(){const{offsetWidth:i,offsetHeight:o}=t,c=(n!==i?qn:0)|(s!==o?Fr:0);c&&(n=i,s=o,e(n,s,c))}}function Sr([t,e],n){let s=0,r=0;for(let i=0,o=0;i<n.length;i++){const c=n[i],l=Array.isArray(c)?c.reduce((a,h)=>a+h.length,0):c.length;if(t>=o&&t<o+l&&(s=i),e>=o&&e<o+l){r=i;break}o+=l}return[s,r]}function ze(){}const Rr=Symbol(),de=Symbol()in window?window?.[Symbol()]:{context:null,subscriberQueue:new Map};function Ir(t,e=ze){const{get:n,subscribe:s}=Kn(t,e);return{get:n,subscribe:s}}function Kn(t,e=ze){let n,s=!1;const r=new Map;o[Rr]=r;function i(){if(de.context){const{subscriber:a,unsubscribes:h,invalidate:d}=de.context,f=l(a,d);h.add(f)}if(!r.size&&!s){s=!0;try{(e(o,c)||ze)()}finally{s=!1}}return t}function o(a){t!==a&&(t=a,n&&_r(()=>{r.forEach(([,h],d)=>{de.subscriberQueue.has(d)||(de.subscriberQueue.set(d,t),h&&h())})}))}function c(a){o(a(t))}function l(a,h){let d=r.get(a)?.[0];return d||(d=()=>{r.delete(a),r.size===0&&(n(),n=null)},r.set(a,[d,h]),r.size===1&&(n=e(o,c)||ze),h||a(t),d)}return{get:i,set:o,update:c,subscribe:l}}function _r(t,e){const n=!de.subscriberQueue.size;if(t(),n){const s=de.subscriberQueue.entries();for(;de.subscriberQueue.size>0;){const[r,i]=s.next().value;de.subscriberQueue.delete(r),r(i)}}}function Dr(t){const e=Kn(t),n=Gn(e),s=Vn(e),r=es(e),i=ns(e),o=ts(e);function c(l){l!==t&&e.set(l)}return{active:n,doc:s,selection:r,root:i,focus:o,updateEditor:c}}function we(t,e,n,s,r){let i=e;return Ir(i,o=>{let c;const l=()=>{i=c?s(c):e,!(r&&O(i,o))&&o(i)},a=()=>c&&n.forEach(f=>c.on(f,l)),h=()=>c&&n.forEach(f=>c.off(f,l)),d=t.subscribe(f=>{h(),c=f,c?(l(),a()):o(i=e)});return()=>{h(),d(),c=void 0,l()}})}function Gn(t){return we(t,{},["changed","format"],e=>e.getActive(),!0)}function Vn(t){return we(t,new se,["changed"],e=>e.doc)}function es(t){return we(t,null,["changed"],e=>e.doc.selection)}function ts(t){return we(t,!1,["changed"],e=>!!e.doc.selection)}function ns(t){return we(t,void 0,["root"],e=>e._root)}function Or(t,e){function n(r){e!==r&&(s(),r&&r.setRoot(t),e=r)}t.children.length&&e.set(Tn(e,t)),e&&e.setRoot(t);function s(){e&&e.destroy()}return{update:n,destroy:s}}exports.AttributeMap=te;exports.BLOCK_ELEMENTS=wt;exports.DecorateEvent=an;exports.Decorator=hn;exports.Delta=D;exports.Editor=cr;exports.EditorChangeEvent=ye;exports.EditorFormatEvent=dt;exports.EventDispatcher=tn;exports.Line=V;exports.LineIterator=Gt;exports.LineOp=Ce;exports.LineOpIterator=Vt;exports.Op=X;exports.OpIterator=pt;exports.PasteEvent=In;exports.React=Ls;exports.ShortcutEvent=Ve;exports.Source=ie;exports.TextChange=oe;exports.TextDocument=se;exports.Types=je;exports.Typeset=vn;exports.activeStore=Gn;exports.addShortcutsToEvent=wn;exports.applyDecorations=Ze;exports.asRoot=Or;exports.blockquote=js;exports.bold=Rs;exports.br=Ms;exports.cleanText=Tt;exports.cloneDeep=He;exports.code=Ds;exports.codeblock=zs;exports.combineLines=pe;exports.copy=Hn;exports.decorations=un;exports.defaultHandlers=Jn;exports.defaultModules=Bn;exports.defaultTypes=Ln;exports.deltaFromDom=Le;exports.deltaFromHTML=Nt;exports.deltaToText=gt;exports.derivedEditorStore=we;exports.diff=he;exports.dl=$s;exports.docFromDom=Tn;exports.docFromHTML=at;exports.docStore=Vn;exports.docToHTML=At;exports.editorStores=Dr;exports.embed=Ke;exports.focusStore=ts;exports.format=ge;exports.fromNode=Ks;exports.getBoudingBrowserRange=ut;exports.getBrowserRange=Fn;exports.getChangedRanges=Lt;exports.getIndexFromNode=xt;exports.getIndexFromNodeAndOffset=Me;exports.getIndexFromPoint=xn;exports.getLineElementAt=kn;exports.getLineInfoFromPoint=Gs;exports.getLineNodeEnd=ke;exports.getLineNodeStart=ae;exports.getNodeAndOffset=ht;exports.getNodeLength=Mn;exports.getNodesForRange=Ft;exports.getSelection=kt;exports.h=j;exports.hasFormat=$e;exports.header=Bs;exports.history=Dn;exports.hr=Hs;exports.image=ks;exports.initHistory=On;exports.inlineToHTML=Nn;exports.input=Sn;exports.intersect=en;exports.isBRPlaceholder=ve;exports.isEqual=O;exports.italic=Is;exports.keyboard=An;exports.line=fe;exports.lineReplace=Qn;exports.lineReplacements=$n;exports.link=Os;exports.linkReplace=Xn;exports.linkReplacements=Un;exports.list=Ps;exports.mark=_s;exports.markReplace=mr;exports.markReplacements=Wn;exports.normalizeRange=q;exports.options=We;exports.paragraph=Cs;exports.paste=_n;exports.patch=Ee;exports.placeholder=fr;exports.recycleNode=ln;exports.render=Ye;exports.renderChanges=lt;exports.renderCombined=yt;exports.renderDoc=bt;exports.renderInline=qe;exports.renderLine=vt;exports.renderMultiLine=pn;exports.renderSingleLine=dn;exports.rendering=gn;exports.rootStore=ns;exports.selection=Rn;exports.selectionStore=es;exports.setLineNodesRanges=Je;exports.setSelection=Ne;exports.shortcutFromEvent=Et;exports.smartEntry=br;exports.smartQuotes=wr;exports.textNodeLength=Se;exports.textReplace=Zn;exports.textReplacements=Yn;exports.transformHistoryStack=Cn;exports.underline=Ss;exports.undoStack=ft;exports.virtualRendering=Nr;
