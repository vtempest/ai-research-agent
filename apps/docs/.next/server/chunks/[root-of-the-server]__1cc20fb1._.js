module.exports=[2157,(t,e,i)=>{e.exports=t.x("node:fs",()=>require("node:fs"))},50,t=>{"use strict";var e=t.i(2157),i=t.i(50227),r=new TextDecoder,h=(t,e=0,i=t.length)=>r.decode(t.slice(e,i)),l=(t,e=0,i=t.length)=>t.slice(e,i).reduce((t,e)=>t+`0${e.toString(16)}`.slice(-2),""),n=(t,e)=>new DataView(t.buffer,t.byteOffset+e),f=(t,e=0)=>n(t,e).getInt16(0,!0),a=(t,e=0)=>n(t,e).getUint16(0,!1),s=(t,e=0)=>n(t,e).getUint16(0,!0),o=(t,e=0)=>{let i=n(t,e);return i.getUint16(0,!0)+(i.getUint8(2)<<16)},c=(t,e=0)=>n(t,e).getUint32(0,!1),u=(t,e=0)=>n(t,e).getUint32(0,!0),d=(t,e,i)=>n(t,e).getBigUint64(0,!i),g={readUInt16BE:a,readUInt16LE:s,readUInt32BE:c,readUInt32LE:u};function p(t,e,i=0,r=!1){return g[`readUInt${e}${r?"BE":"LE"}`](t,i)}function w(t,e,i){for(;i<t.length;){let r=function(t,e){if(t.length-e<4)return;let i=c(t,e);if(!(t.length-e<i))return{name:h(t,4+e,8+e),offset:e,size:i}}(t,i);if(!r)break;if(r.name===e)return r;i+=r.size>0?r.size:8}}function m(t,e){let i=t[e];return 0===i?256:i}function v(t,e){let i=6+16*e;return{height:m(t,i+1),width:m(t,i)}}var b={validate(t){let e=s(t,0),i=s(t,4);return 0===e&&0!==i&&1===s(t,2)},calculate(t){let e=s(t,4),i=v(t,0);if(1===e)return i;let r=[];for(let i=0;i<e;i+=1)r.push(v(t,i));return{width:i.width,height:i.height,images:r}}},y=/^GIF8[79]a/,E={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"},x={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024},I=class{constructor(t,e){this.input=t,this.endianness=e,this.byteOffset=2,this.bitOffset=0}getBits(t=1){let e=0,i=0;for(;i<t;){if(this.byteOffset>=this.input.length)throw Error("Reached end of input");let r=this.input[this.byteOffset],h=Math.min(t-i,8-this.bitOffset);if("little-endian"===this.endianness){let t=(1<<h)-1;e|=(r>>this.bitOffset&t)<<i}else{let t=(r&(1<<h)-1<<8-this.bitOffset-h)>>8-this.bitOffset-h;e=e<<h|t}i+=h,this.bitOffset+=h,8===this.bitOffset&&(this.byteOffset++,this.bitOffset=0)}return e}};function T(t,e){if(e)return 8*(1+t.getBits(5));let i=[9,13,18,30][t.getBits(2)];return 1+t.getBits(i)}var P={validate:t=>"ff0a"===l(t,0,2),calculate(t){let e=new I(t,"little-endian"),i=1===e.getBits(1),r=T(e,i),h=e.getBits(3);return{width:i&&0===h?8*(1+e.getBits(5)):0===h?T(e,!1):Math.floor(r*[1,1.2,4/3,1.5,16/9,5/4,2][h-1]),height:r}}},B="CgBI",M={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},k={default:t=>{let e=[];for(;t.length>0;){let i=t.shift();if("#"!==i[0]){e=i.split(" ");break}}if(2===e.length)return{height:Number.parseInt(e[1],10),width:Number.parseInt(e[0],10)};throw TypeError("Invalid PNM")},pam:t=>{let e={};for(;t.length>0;){let i=t.shift();if(i.length>16||i.charCodeAt(0)>128)continue;let[r,h]=i.split(" ");if(r&&h&&(e[r.toLowerCase()]=Number.parseInt(h,10)),e.height&&e.width)break}if(e.height&&e.width)return{height:e.height,width:e.width};throw TypeError("Invalid PAM")}},N=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,O=/\sheight=(['"])([^%]+?)\1/,j=/\sviewBox=(['"])(.+?)\1/i,z=/\swidth=(['"])([^%]+?)\1/,F={in:96,cm:37.79527559055118,em:16,ex:8,m:37.79527559055118*100,mm:37.79527559055118/10,pc:96/72/12,pt:96/72,px:1},U=RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(F).join("|")})?$`);function C(t){let e=U.exec(t);if(e)return Math.round(Number(e[1])*(F[e[2]]||1))}var G=256,S=257,A=259,V=3,$=4,X=16,J=12,L=20,R=2,D=8,H=new Set(["49492a00","4d4d002a","49492b00","4d4d002b"]),W=new Map([["bmp",{validate:t=>"BM"===h(t,0,2),calculate:t=>({height:Math.abs(((t,e=0)=>n(t,e).getInt32(0,!0))(t,22)),width:u(t,18)})}],["cur",{validate(t){let e=s(t,0),i=s(t,4);return 0===e&&0!==i&&2===s(t,2)},calculate:t=>b.calculate(t)}],["dds",{validate:t=>0x20534444===u(t,0),calculate:t=>({height:u(t,12),width:u(t,16)})}],["gif",{validate:t=>y.test(h(t,0,6)),calculate:t=>({height:s(t,8),width:s(t,6)})}],["heif",{validate(t){if("ftyp"!==h(t,4,8))return!1;let e=w(t,"ftyp",0);return!!e&&h(t,e.offset+8,e.offset+12)in E},calculate(t){let e=w(t,"meta",0),i=e&&w(t,"iprp",e.offset+12),r=i&&w(t,"ipco",i.offset+8);if(!r)throw TypeError("Invalid HEIF, no ipco box found");let l=h(t,8,12),n=[],f=r.offset+8;for(;f<r.offset+r.size;){let e=w(t,"ispe",f);if(!e)break;let i=c(t,e.offset+12),h=c(t,e.offset+16),l=w(t,"clap",f),a=i;l&&l.offset<r.offset+r.size&&(a=i-c(t,l.offset+12)),n.push({height:h,width:a}),f=e.offset+e.size}if(0===n.length)throw TypeError("Invalid HEIF, no sizes found");return{width:n[0].width,height:n[0].height,type:l,...n.length>1?{images:n}:{}}}}],["icns",{validate:t=>"icns"===h(t,0,4),calculate(t){let e=t.length,i=c(t,4),r=8,l=[];for(;r<i&&r<e;){let e=function(t,e){let i=e+4;return[h(t,e,i),c(t,i)]}(t,r),i=function(t){let e=x[t];return{width:e,height:e,type:t}}(e[0]);l.push(i),r+=e[1]}if(0===l.length)throw TypeError("Invalid ICNS, no sizes found");return{width:l[0].width,height:l[0].height,...l.length>1?{images:l}:{}}}}],["ico",b],["j2c",{validate:t=>0xff4fff51===c(t,0),calculate:t=>({height:c(t,12),width:c(t,8)})}],["jp2",{validate(t){if("jP  "!==h(t,4,8))return!1;let e=w(t,"ftyp",0);return!!e&&"jp2 "===h(t,e.offset+8,e.offset+12)},calculate(t){let e=w(t,"jp2h",0),i=e&&w(t,"ihdr",e.offset+8);if(i)return{height:c(t,i.offset+8),width:c(t,i.offset+12)};throw TypeError("Unsupported JPEG 2000 format")}}],["jpg",{validate:t=>"ffd8"===l(t,0,2),calculate(t){let e,i,r=t.slice(4);for(;r.length;){var h,n;let t=a(r,0);if(t>r.length)throw TypeError("Corrupt JPG, exceeded buffer limits");if(255!==r[t]){r=r.slice(1);continue}if("45786966"===l(r,2,6)&&(e=function(t,e){let i=t.slice(2,e),r=l(i,6,8),h="4d4d"===r;if(h||"4949"===r)return function(t,e){let i=p(t,16,14,e);for(let r=0;r<i;r++){let i=16+12*r,h=i+12;if(i>t.length)return;let l=t.slice(i,h);if(274===p(l,16,0,e)){if(3!==p(l,16,2,e)||1!==p(l,32,4,e))return;return p(l,16,8,e)}}}(i,h)}(r,t)),192===(i=r[t+1])||193===i||194===i){let i={height:a(h=r,n=t+5),width:a(h,n+2)};if(!e)return i;return{height:i.height,orientation:e,width:i.width}}r=r.slice(t+2)}throw TypeError("Invalid JPG, no size found")}}],["jxl",{validate:t=>{if("JXL "!==h(t,4,8))return!1;let e=w(t,"ftyp",0);return!!e&&"jxl "===h(t,e.offset+8,e.offset+12)},calculate(t){let e=function(t){let e=w(t,"jxlc",0);if(e)return t.slice(e.offset+8,e.offset+e.size);let i=function(t){let e=[],i=0;for(;i<t.length;){let r=w(t,"jxlp",i);if(!r)break;e.push(t.slice(r.offset+12,r.offset+r.size)),i=r.offset+r.size}return e}(t);if(i.length>0){var r=i;let t=new Uint8Array(r.reduce((t,e)=>t+e.length,0)),e=0;for(let i of r)t.set(i,e),e+=i.length;return t}}(t);if(e)return P.calculate(e);throw Error("No codestream found in JXL container")}}],["jxl-stream",P],["ktx",{validate:t=>["KTX 11","KTX 20"].includes(h(t,1,7)),calculate:t=>{let e=49===t[5]?"ktx":"ktx2",i="ktx"===e?36:20;return{height:u(t,i+4),width:u(t,i),type:e}}}],["png",{validate(t){if("PNG\r\n\x1a\n"===h(t,1,8)){let e=h(t,12,16);if(e===B&&(e=h(t,28,32)),"IHDR"!==e)throw TypeError("Invalid PNG");return!0}return!1},calculate:t=>h(t,12,16)===B?{height:c(t,36),width:c(t,32)}:{height:c(t,20),width:c(t,16)}}],["pnm",{validate:t=>h(t,0,2)in M,calculate(t){let e=M[h(t,0,2)],i=h(t,3).split(/[\r\n]+/);return(k[e]||k.default)(i)}}],["psd",{validate:t=>"8BPS"===h(t,0,4),calculate:t=>({height:c(t,14),width:c(t,18)})}],["svg",{validate:t=>N.test(h(t,0,1e3)),calculate(t){let e=h(t).match(N);if(e){var i,r;let t,h,l,n,f=(h=(r=e[0]).match(z),l=r.match(O),n=r.match(j),{height:l&&C(l[2]),viewbox:n&&{height:C((t=n[2].split(" "))[3]),width:C(t[2])},width:h&&C(h[2])});if(f.width&&f.height)return{height:f.height,width:f.width};if(f.viewbox){let t;return t=(i=f.viewbox).width/i.height,f.width?{height:Math.floor(f.width/t),width:f.width}:f.height?{height:f.height,width:Math.floor(f.height*t)}:{height:i.height,width:i.width}}}throw TypeError("Invalid SVG")}}],["tga",{validate:t=>0===s(t,0)&&0===s(t,4),calculate:t=>({height:s(t,14),width:s(t,12)})}],["tiff",{validate:t=>{let e=l(t,0,4);return H.has(e)},calculate(t){let e,i,r=(e=h(t,0,2),i=p(t,16,2,"MM"===e),{isBigEndian:"MM"===e,isBigTiff:43===i});r.isBigTiff&&function(t,e){let i=p(t,16,4,e),r=p(t,16,6,e);if(8!==i||0!==r)throw TypeError("Invalid BigTIFF header")}(t,r.isBigEndian);let l=function(t,{isBigEndian:e,isBigTiff:i}){let r={},h=t;for(;h?.length;){let t=p(h,16,0,e),l=p(h,16,2,e),n=i?Number(d(h,4,e)):p(h,32,4,e);if(0===t)break;if(1===n&&(l===V||l===$||i&&l===X)){let n=i?12:8;r[t]=function(t,e,i,r){switch(e){case V:return p(t,16,i,r);case $:return p(t,32,i,r);case X:{let e=Number(d(t,i,r));if(e>Number.MAX_SAFE_INTEGER)throw TypeError("Value too large");return e}default:return 0}}(h,l,n,e)}h=function(t,e){let i=e?L:J;if(t.length>i)return t.slice(i)}(h,i)}return r}(function(t,{isBigEndian:e,isBigTiff:i}){let r=i?Number(d(t,8,e)):p(t,32,4,e);return t.slice(r+(i?D:R))}(t,r),r),n={height:l[S],width:l[G],type:r.isBigTiff?"bigtiff":"tiff"};if(l[A]&&(n.compression=l[A]),!n.width||!n.height)throw TypeError("Invalid Tiff. Missing tags");return n}}],["webp",{validate(t){let e="RIFF"===h(t,0,4),i="WEBP"===h(t,8,12),r="VP8"===h(t,12,15);return e&&i&&r},calculate(t){let e=h(t,12,16),i=t.slice(20,30);if("VP8X"===e){let t=i[0];if((192&t)==0&&(1&t)==0)return{height:1+o(i,7),width:1+o(i,4)};throw TypeError("Invalid WebP")}if("VP8 "===e&&47!==i[0])return{height:16383&f(i,8),width:16383&f(i,6)};let r=l(i,3,6);if("VP8L"===e&&"9d012a"!==r)return{height:1+((15&i[4])<<10|i[3]<<2|(192&i[2])>>6),width:1+((63&i[2])<<8|i[1])};throw TypeError("Invalid WebP")}}]]),K=Array.from(W.keys()),_=new Map([[0,"heif"],[56,"psd"],[66,"bmp"],[68,"dds"],[71,"gif"],[73,"tiff"],[77,"tiff"],[82,"webp"],[105,"icns"],[137,"png"],[255,"jpg"]]),q=[],Q=[],Y=100,Z=t=>{Y=t},tt=async()=>{let t=Q.splice(0,Y).map(async({filePath:t,resolve:r,reject:h})=>{let l;try{l=await e.promises.open(i.resolve(t),"r")}catch(t){return h(t)}try{let{size:t}=await l.stat();if(t<=0)throw Error("Empty file");let e=Math.min(t,524288),i=new Uint8Array(e);await l.read(i,0,e,0),r(function(t){let e,i,r=(e=t[0],(i=_.get(e))&&W.get(i).validate(t)?i:K.find(e=>W.get(e).validate(t)));if(void 0!==r){if(q.indexOf(r)>-1)throw TypeError(`disabled file type: ${r}`);let e=W.get(r).calculate(t);if(void 0!==e){if(e.type=e.type??r,e.images&&e.images.length>1){let t=e.images.reduce((t,e)=>e.width*e.height>t.width*t.height?e:t,e.images[0]);e.width=t.width,e.height=t.height}return e}}throw TypeError(`unsupported file type: ${r}`)}(i))}catch(t){h(t)}finally{await l.close()}});await Promise.allSettled(t),Q.length&&setTimeout(tt,100)},te=async t=>new Promise((e,i)=>{Q.push({filePath:t,resolve:e,reject:i}),tt()});t.s(["imageSizeFromFile",()=>te,"setConcurrency",()=>Z])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1cc20fb1._.js.map