module.exports=[40507,91094,33383,79240,56515,a=>{"use strict";let b={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},c={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim,czech:/[^A-Z0-9a-zěščřžýáíéúůóťďĚŠČŘŽÝÁÍÉÓÚŮŤĎ-]+/gim},d=Object.keys(b),e=Date.now().toString().slice(5),f=0,g=BigInt(1e3),h=BigInt(1e6),i=BigInt(1e9);function j(a,b){if(b.length<65535)Array.prototype.push.apply(a,b);else{let c=b.length;for(let d=0;d<c;d+=65535)Array.prototype.push.apply(a,b.slice(d,d+65535))}}function k(){return BigInt(Math.floor(1e6*performance.now()))}function l(a){return("number"==typeof a&&(a=BigInt(a)),a<g)?`${a}ns`:a<h?`${a/g}μs`:a<i?`${a/h}ms`:`${a/i}s`}function m(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?k():"undefined"!=typeof process&&process.release&&"node"===process.release.name||"undefined"!=typeof process&&"function"==typeof process?.hrtime?.bigint?process.hrtime.bigint():"undefined"!=typeof performance?k():BigInt(0)}function n(){return`${e}-${f++}`}function o(a,b){return void 0===Object.hasOwn?Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0:Object.hasOwn(a,b)?a[b]:void 0}function p(a,b){return b[1]===a[1]?a[0]-b[0]:b[1]-a[1]}function q(a,b){let c={},d=b.length;for(let e=0;e<d;e++){let d=b[e],f=d.split("."),g=a,h=f.length;for(let a=0;a<h;a++)if("object"==typeof(g=g[f[a]])){if(null!==g&&"lat"in g&&"lon"in g&&"number"==typeof g.lat&&"number"==typeof g.lon){g=c[d]=g;break}else if(!Array.isArray(g)&&null!==g&&a===h-1){g=void 0;break}}else if((null===g||"object"!=typeof g)&&a<h-1){g=void 0;break}void 0!==g&&(c[d]=g)}return c}function r(a,b){return q(a,[b])[b]}let s={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function t(a,b){let c=s[b];if(void 0===c)throw Error(C("INVALID_DISTANCE_SUFFIX",a).message);return a*c}function u(a,b){a.hits=a.hits.map(a=>({...a,document:{...a.document,...b.reduce((a,b)=>{let c=b.split("."),d=c.pop(),e=a;for(let a of c)e[a]=e[a]??{},e=e[a];return e[d]=null,a},a.document)}}))}function v(a){return Array.isArray(a)?a.some(a=>v(a)):a?.constructor?.name==="AsyncFunction"}let w="intersection"in new Set;function x(...a){if(0===a.length)return new Set;if(1===a.length)return a[0];if(2===a.length){let b=a[0],c=a[1];if(w)return b.intersection(c);let d=new Set,e=b.size<c.size?b:c,f=e===b?c:b;for(let a of e)f.has(a)&&d.add(a);return d}let b={index:0,size:a[0].size};for(let c=1;c<a.length;c++)a[c].size<b.size&&(b.index=c,b.size=a[c].size);if(w){let c=a[b.index];for(let d=0;d<a.length;d++)d!==b.index&&(c=c.intersection(a[d]));return c}let c=a[b.index];for(let d=0;d<a.length;d++){if(d===b.index)continue;let e=a[d];for(let a of c)e.has(a)||c.delete(a)}return c}let y="union"in new Set;function z(a,b){return y?a?a.union(b):b:new Set(a?[...a,...b]:b)}let A=d.join("\n - "),B={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${A}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/docs/orama-js/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.orama.com/docs/orama-js for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',UNKNOWN_VECTOR_PROPERTY:'Unknown vector property "%s". Make sure the property exists in the schema and is configured as a vector.',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:'Facet doens\'t support the type "%s".',INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function C(a,...b){let c=Error(function(a,...b){return a.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...a){let{width:c,type:d,position:e}=a[a.length-1],f=e?b[Number.parseInt(e)-1]:b.shift(),g=""===c?0:Number.parseInt(c);switch(d){case"d":return f.toString().padStart(g,"0");case"f":{let a=f,[b,d]=c.split(".").map(a=>Number.parseFloat(a));return"number"==typeof d&&d>=0&&(a=a.toFixed(d)),"number"==typeof b&&b>=0?a.toString().padStart(g,"0"):a.toString()}case"s":return g<0?f.toString().padEnd(-g," "):f.toString().padStart(g," ");default:return f}})}(B[a]??`Unsupported Orama Error code: ${a}`,...b));return c.code=a,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(c),c}function D(a){return{raw:Number(a),formatted:l(a)}}function E(a){if(a.id){if("string"!=typeof a.id)throw C("DOCUMENT_ID_MUST_BE_STRING",typeof a.id);return a.id}return n()}function F(a,b){for(let[c,d]of Object.entries(b)){let b=a[c];if(void 0!==b&&("geopoint"!==d||"object"!=typeof b||"number"!=typeof b.lon||"number"!=typeof b.lat)&&("enum"!==d||"string"!=typeof b&&"number"!=typeof b)){if("enum[]"===d&&Array.isArray(b)){let a=b.length;for(let d=0;d<a;d++)if("string"!=typeof b[d]&&"number"!=typeof b[d])return c+"."+d;continue}if(J(d)){let a=M(d);if(!Array.isArray(b)||b.length!==a)throw C("INVALID_INPUT_VECTOR",c,a,b.length);continue}if(K(d)){if(!Array.isArray(b))return c;let a=H[d],e=b.length;for(let d=0;d<e;d++)if(typeof b[d]!==a)return c+"."+d;continue}if("object"==typeof d){if(!b||"object"!=typeof b)return c;let a=F(b,d);if(a)return c+"."+a;continue}if(typeof b!==d)return c}}}let G={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},H={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function I(a){return"geopoint"===a}function J(a){return"string"==typeof a&&/^vector\[\d+\]$/.test(a)}function K(a){return"string"==typeof a&&G[a]}function L(a){return H[a]}function M(a){let b=Number(a.slice(7,-1));switch(!0){case isNaN(b):throw C("INVALID_VECTOR_VALUE",a);case b<=0:throw C("INVALID_VECTOR_SIZE",a);default:return b}}function N(a){return{internalIdToId:a.internalIdToId}}function O(a,b){let{internalIdToId:c}=b;a.internalDocumentIDStore.idToInternalId.clear(),a.internalDocumentIDStore.internalIdToId=[];let d=c.length;for(let b=0;b<d;b++){let d=c[b];a.internalDocumentIDStore.idToInternalId.set(d,b+1),a.internalDocumentIDStore.internalIdToId.push(d)}}function P(a,b){if("string"==typeof b){let c=a.idToInternalId.get(b);if(c)return c;let d=a.idToInternalId.size+1;return a.idToInternalId.set(b,d),a.internalIdToId.push(b),d}return b>a.internalIdToId.length?P(a,b.toString()):b}function Q(a,b){if(a.internalIdToId.length<b)throw Error(`Invalid internalId ${b}`);return a.internalIdToId[b-1]}function R(a,b){return{sharedInternalDocumentStore:b,docs:{},count:0}}function S(a,b){let c=P(a.sharedInternalDocumentStore,b);return a.docs[c]}function T(a,b){let c=b.length,d=Array.from({length:c});for(let e=0;e<c;e++){let c=P(a.sharedInternalDocumentStore,b[e]);d[e]=a.docs[c]}return d}function U(a){return a.docs}function V(a,b,c,d){return void 0===a.docs[c]&&(a.docs[c]=d,a.count++,!0)}function W(a,b){let c=P(a.sharedInternalDocumentStore,b);return void 0!==a.docs[c]&&(delete a.docs[c],a.count--,!0)}function X(a){return a.count}function Y(a,b){return{docs:b.docs,count:b.count,sharedInternalDocumentStore:a}}function Z(a){return{docs:a.docs,count:a.count}}a.s(["formatElapsedTime",()=>D,"getDocumentIndexId",()=>E,"getInnerType",()=>L,"getVectorSize",()=>M,"isArrayType",()=>K,"isGeoPointType",()=>I,"isVectorType",()=>J,"validateSchema",()=>F],31653);let $=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"],_=["tokenizer","index","documentsStore","sorter","pinning"],aa=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function ab(a,b,c,d,e){if(a.some(v))return(async()=>{for(let f of a)await f(b,c,d,e)})();for(let f of a)f(b,c,d,e)}function ac(a,b,c,d){if(a.some(v))return(async()=>{for(let e of a)await e(b,c,d)})();for(let e of a)e(b,c,d)}class ad{k;v;l=null;r=null;h=1;constructor(a,b){this.k=a,this.v=new Set(b)}updateHeight(){this.h=Math.max(ad.getHeight(this.l),ad.getHeight(this.r))+1}static getHeight(a){return a?a.h:0}getBalanceFactor(){return ad.getHeight(this.l)-ad.getHeight(this.r)}rotateLeft(){let a=this.r;return this.r=a.l,a.l=this,this.updateHeight(),a.updateHeight(),a}rotateRight(){let a=this.l;return this.l=a.r,a.r=this,this.updateHeight(),a.updateHeight(),a}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(a){let b=new ad(a.k,a.v);return b.l=a.l?ad.fromJSON(a.l):null,b.r=a.r?ad.fromJSON(a.r):null,b.h=a.h,b}}class ae{root=null;insertCount=0;constructor(a,b){void 0!==a&&void 0!==b&&(this.root=new ad(a,b))}insert(a,b,c=1e3){this.root=this.insertNode(this.root,a,b,c)}insertMultiple(a,b,c=1e3){for(let d of b)this.insert(a,d,c)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(a){let b=new ae;return b.root=a.root?ad.fromJSON(a.root):null,b.insertCount=a.insertCount||0,b}insertNode(a,b,c,d){if(null===a)return new ad(b,[c]);let e=[],f=a,g=null;for(;null!==f;)if(e.push({parent:g,node:f}),b<f.k)if(null===f.l){f.l=new ad(b,[c]),e.push({parent:f,node:f.l});break}else g=f,f=f.l;else if(!(b>f.k))return f.v.add(c),a;else if(null===f.r){f.r=new ad(b,[c]),e.push({parent:f,node:f.r});break}else g=f,f=f.r;let h=!1;this.insertCount++%d==0&&(h=!0);for(let b=e.length-1;b>=0;b--){let{parent:c,node:d}=e[b];if(d.updateHeight(),h){let b=this.rebalanceNode(d);c?c.l===d?c.l=b:c.r===d&&(c.r=b):a=b}}return a}rebalanceNode(a){let b=a.getBalanceFactor();if(b>1){if(a.l&&a.l.getBalanceFactor()>=0)return a.rotateRight();else if(a.l)return a.l=a.l.rotateLeft(),a.rotateRight()}if(b<-1){if(a.r&&0>=a.r.getBalanceFactor())return a.rotateLeft();else if(a.r)return a.r=a.r.rotateRight(),a.rotateLeft()}return a}find(a){let b=this.findNodeByKey(a);return b?b.v:null}contains(a){return null!==this.find(a)}getSize(){let a=0,b=[],c=this.root;for(;c||b.length>0;){for(;c;)b.push(c),c=c.l;c=b.pop(),a++,c=c.r}return a}isBalanced(){if(!this.root)return!0;let a=[this.root];for(;a.length>0;){let b=a.pop();if(Math.abs(b.getBalanceFactor())>1)return!1;b.l&&a.push(b.l),b.r&&a.push(b.r)}return!0}remove(a){this.root=this.removeNode(this.root,a)}removeDocument(a,b){let c=this.findNodeByKey(a);c&&(1===c.v.size?this.root=this.removeNode(this.root,a):c.v=new Set([...c.v.values()].filter(a=>a!==b)))}findNodeByKey(a){let b=this.root;for(;b;)if(a<b.k)b=b.l;else{if(!(a>b.k))return b;b=b.r}return null}removeNode(a,b){if(null===a)return null;let c=[],d=a;for(;null!==d&&d.k!==b;)c.push(d),d=b<d.k?d.l:d.r;if(null===d)return a;if(null===d.l||null===d.r){let b=d.l?d.l:d.r;if(0===c.length)a=b;else{let a=c[c.length-1];a.l===d?a.l=b:a.r=b}}else{let a=d,b=d.r;for(;null!==b.l;)a=b,b=b.l;d.k=b.k,d.v=b.v,a.l===b?a.l=b.r:a.r=b.r,d=a}c.push(d);for(let b=c.length-1;b>=0;b--){let d=c[b];d.updateHeight();let e=this.rebalanceNode(d);if(b>0){let a=c[b-1];a.l===d?a.l=e:a.r===d&&(a.r=e)}else a=e}return a}rangeSearch(a,b){let c=new Set,d=[],e=this.root;for(;e||d.length>0;){for(;e;)d.push(e),e=e.l;if((e=d.pop()).k>=a&&e.k<=b)for(let a of e.v)c.add(a);if(e.k>b)break;e=e.r}return c}greaterThan(a,b=!1){let c=new Set,d=[],e=this.root;for(;e||d.length>0;){for(;e;)d.push(e),e=e.r;if(e=d.pop(),b&&e.k>=a||!b&&e.k>a)for(let a of e.v)c.add(a);else if(e.k<=a)break;e=e.l}return c}lessThan(a,b=!1){let c=new Set,d=[],e=this.root;for(;e||d.length>0;){for(;e;)d.push(e),e=e.l;if(e=d.pop(),b&&e.k<=a||!b&&e.k<a)for(let a of e.v)c.add(a);else if(e.k>a)break;e=e.r}return c}}class af{numberToDocumentId;constructor(){this.numberToDocumentId=new Map}insert(a,b){this.numberToDocumentId.has(a)?this.numberToDocumentId.get(a).add(b):this.numberToDocumentId.set(a,new Set([b]))}find(a){let b=this.numberToDocumentId.get(a);return b?Array.from(b):null}remove(a){this.numberToDocumentId.delete(a)}removeDocument(a,b){let c=this.numberToDocumentId.get(b);c&&(c.delete(a),0===c.size&&this.numberToDocumentId.delete(b))}contains(a){return this.numberToDocumentId.has(a)}getSize(){let a=0;for(let b of this.numberToDocumentId.values())a+=b.size;return a}filter(a){let b=Object.keys(a);if(1!==b.length)throw Error("Invalid operation");let c=b[0];switch(c){case"eq":{let b=a[c],d=this.numberToDocumentId.get(b);return d?Array.from(d):[]}case"in":{let b=a[c],d=new Set;for(let a of b){let b=this.numberToDocumentId.get(a);if(b)for(let a of b)d.add(a)}return Array.from(d)}case"nin":{let b=new Set(a[c]),d=new Set;for(let[a,c]of this.numberToDocumentId.entries())if(!b.has(a))for(let a of c)d.add(a);return Array.from(d)}default:throw Error("Invalid operation")}}filterArr(a){let b=Object.keys(a);if(1!==b.length)throw Error("Invalid operation");let c=b[0];switch(c){case"containsAll":{let b=a[c].map(a=>this.numberToDocumentId.get(a)??new Set);if(0===b.length)return[];return Array.from(b.reduce((a,b)=>new Set([...a].filter(a=>b.has(a)))))}case"containsAny":{let b=a[c].map(a=>this.numberToDocumentId.get(a)??new Set);if(0===b.length)return[];return Array.from(b.reduce((a,b)=>new Set([...a,...b])))}default:throw Error("Invalid operation")}}static fromJSON(a){if(!a.numberToDocumentId)throw Error("Invalid Flat Tree JSON");let b=new af;for(let[c,d]of a.numberToDocumentId)b.numberToDocumentId.set(c,new Set(d));return b}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([a,b])=>[a,Array.from(b)])}}}function ag(a,b,c){let d=function(a,b,c){if(c<0)return -1;if(a===b)return 0;let d=a.length,e=b.length;if(0===d)return e<=c?e:-1;if(0===e)return d<=c?d:-1;let f=Math.abs(d-e);if(a.startsWith(b))return f<=c?f:-1;if(b.startsWith(a))return 0;if(f>c)return -1;let g=[];for(let a=0;a<=d;a++){g[a]=[a];for(let b=1;b<=e;b++)g[a][b]=0===a?b:0}for(let f=1;f<=d;f++){let d=1/0;for(let c=1;c<=e;c++)a[f-1]===b[c-1]?g[f][c]=g[f-1][c-1]:g[f][c]=Math.min(g[f-1][c]+1,g[f][c-1]+1,g[f-1][c-1]+1),d=Math.min(d,g[f][c]);if(d>c)return -1}return g[d][e]<=c?g[d][e]:-1}(a,b,c);return{distance:d,isBounded:d>=0}}class ah{k;s;c=new Map;d=new Set;e;w="";constructor(a,b,c){this.k=a,this.s=b,this.e=c}updateParent(a){this.w=a.w+this.s}addDocument(a){this.d.add(a)}removeDocument(a){return this.d.delete(a)}findAllWords(a,b,c,d){let e=[this];for(;e.length>0;){let f=e.pop();if(f.e){let{w:e,d:g}=f;if(c&&e!==b)continue;if(null!==o(a,e))if(d){if(!(Math.abs(b.length-e.length)<=d)||!ag(b,e,d).isBounded)continue;a[e]=[]}else a[e]=[];if(null!=o(a,e)&&g.size>0){let b=a[e];for(let a of g)b.includes(a)||b.push(a)}}f.c.size>0&&e.push(...f.c.values())}return a}insert(a,b){let c=this,d=0,e=a.length;for(;d<e;){let f=a[d],g=c.c.get(f);if(g){let f=g.s,h=f.length,i=0;for(;i<h&&d+i<e&&f[i]===a[d+i];)i++;if(i===h){if(c=g,(d+=i)===e){g.e||(g.e=!0),g.addDocument(b);return}continue}let j=f.slice(0,i),k=f.slice(i),l=a.slice(d+i),m=new ah(j[0],j,!1);if(c.c.set(j[0],m),m.updateParent(c),g.s=k,g.k=k[0],m.c.set(k[0],g),g.updateParent(m),l){let a=new ah(l[0],l,!0);a.addDocument(b),m.c.set(l[0],a),a.updateParent(m)}else m.e=!0,m.addDocument(b);return}{let e=new ah(f,a.slice(d),!0);e.addDocument(b),c.c.set(f,e),e.updateParent(c);return}}c.e||(c.e=!0),c.addDocument(b)}_findLevenshtein(a,b,c,d,e){let f=[{node:this,index:b,tolerance:c}];for(;f.length>0;){let{node:b,index:c,tolerance:g}=f.pop();if(b.w.startsWith(a)){b.findAllWords(e,a,!1,0);continue}if(g<0)continue;if(b.e){let{w:c,d:f}=b;if(c&&(ag(a,c,d).isBounded&&(e[c]=[]),void 0!==o(e,c)&&f.size>0)){let a=new Set(e[c]);for(let b of f)a.add(b);e[c]=Array.from(a)}}if(c>=a.length)continue;let h=a[c];if(b.c.has(h)){let a=b.c.get(h);f.push({node:a,index:c+1,tolerance:g})}for(let[a,d]of(f.push({node:b,index:c+1,tolerance:g-1}),b.c))f.push({node:d,index:c,tolerance:g-1}),a!==h&&f.push({node:d,index:c+1,tolerance:g-1})}}find(a){let{term:b,exact:c,tolerance:d}=a;if(d&&!c){let a={};return this._findLevenshtein(b,0,d,d,a),a}{let a=this,e=0,f=b.length;for(;e<f;){let g=b[e],h=a.c.get(g);if(!h)return{};{let g=h.s,i=g.length,j=0;for(;j<i&&e+j<f&&g[j]===b[e+j];)j++;if(j===i)a=h,e+=j;else{if(e+j!==f||j!==f-e||c)return{};let a={};return h.findAllWords(a,b,c,d),a}}}let g={};return a.findAllWords(g,b,c,d),g}}contains(a){let b=this,c=0,d=a.length;for(;c<d;){let e=a[c],f=b.c.get(e);if(!f)return!1;{let e=f.s,g=e.length,h=0;for(;h<g&&c+h<d&&e[h]===a[c+h];)h++;if(h<g)return!1;c+=g,b=f}}return!0}removeWord(a){if(!a)return!1;let b=this,c=a.length,d=[];for(let e=0;e<c;e++){let c=a[e];if(!b.c.has(c))return!1;{let a=b.c.get(c);d.push({parent:b,character:c}),e+=a.s.length-1,b=a}}for(b.d.clear(),b.e=!1;d.length>0&&0===b.c.size&&!b.e&&0===b.d.size;){let{parent:a,character:c}=d.pop();a.c.delete(c),b=a}return!0}removeDocumentByWord(a,b,c=!0){if(!a)return!0;let d=this,e=a.length;for(let f=0;f<e;f++){let e=a[f];if(!d.c.has(e))return!1;{let g=d.c.get(e);f+=g.s.length-1,d=g,c&&d.w!==a||d.removeDocument(b)}}return!0}static getCommonPrefix(a,b){let c=Math.min(a.length,b.length),d=0;for(;d<c&&a.charCodeAt(d)===b.charCodeAt(d);)d++;return a.slice(0,d)}toJSON(){return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:Array.from(this.c?.entries())?.map(([a,b])=>[a,b.toJSON()])}}static fromJSON(a){let b=new ah(a.k,a.s,a.e);return b.w=a.w,b.d=new Set(a.d),b.c=new Map(a?.c?.map(([a,b])=>[a,ah.fromJSON(b)])||[]),b}}class ai extends ah{constructor(){super("","",!1)}static fromJSON(a){let b=new ai;return b.w=a.w,b.s=a.s,b.e=a.e,b.k=a.k,b.d=new Set(a.d),b.c=new Map(a?.c?.map(([a,b])=>[a,ah.fromJSON(b)])||[]),b}toJSON(){return super.toJSON()}}class aj{point;docIDs;left;right;parent;constructor(a,b){this.point=a,this.docIDs=new Set(b),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(a,b=null){let c=new aj(a.point,a.docIDs);return c.parent=b,a.left&&(c.left=aj.fromJSON(a.left,c)),a.right&&(c.right=aj.fromJSON(a.right,c)),c}}class ak{root;nodeMap;constructor(){this.root=null,this.nodeMap=new Map}getPointKey(a){return`${a.lon},${a.lat}`}insert(a,b){let c=this.getPointKey(a),d=this.nodeMap.get(c);if(d)return void b.forEach(a=>d.docIDs.add(a));let e=new aj(a,b);if(this.nodeMap.set(c,e),null==this.root){this.root=e;return}let f=this.root,g=0;for(;;){if(0==g%2)if(a.lon<f.point.lon){if(null==f.left){f.left=e,e.parent=f;return}f=f.left}else{if(null==f.right){f.right=e,e.parent=f;return}f=f.right}else if(a.lat<f.point.lat){if(null==f.left){f.left=e,e.parent=f;return}f=f.left}else{if(null==f.right){f.right=e,e.parent=f;return}f=f.right}g++}}contains(a){let b=this.getPointKey(a);return this.nodeMap.has(b)}getDocIDsByCoordinates(a){let b=this.getPointKey(a),c=this.nodeMap.get(b);return c?Array.from(c.docIDs):null}removeDocByID(a,b){let c=this.getPointKey(a),d=this.nodeMap.get(c);d&&(d.docIDs.delete(b),0===d.docIDs.size&&(this.nodeMap.delete(c),this.deleteNode(d)))}deleteNode(a){let b=a.parent,c=a.left?a.left:a.right;c&&(c.parent=b),b?b.left===a?b.left=c:b.right===a&&(b.right=c):(this.root=c,this.root&&(this.root.parent=null))}searchByRadius(a,b,c=!0,d="asc",e=!1){let f=e?ak.vincentyDistance:ak.haversineDistance,g=[{node:this.root,depth:0}],h=[];for(;g.length>0;){let{node:d,depth:e}=g.pop();if(null==d)continue;let i=f(a,d.point);(c?i<=b:i>b)&&h.push({point:d.point,docIDs:Array.from(d.docIDs)}),null!=d.left&&g.push({node:d.left,depth:e+1}),null!=d.right&&g.push({node:d.right,depth:e+1})}return d&&h.sort((b,c)=>{let e=f(a,b.point),g=f(a,c.point);return"asc"===d.toLowerCase()?e-g:g-e}),h}searchByPolygon(a,b=!0,c=null,d=!1){let e=[{node:this.root,depth:0}],f=[];for(;e.length>0;){let{node:c,depth:d}=e.pop();if(null==c)continue;null!=c.left&&e.push({node:c.left,depth:d+1}),null!=c.right&&e.push({node:c.right,depth:d+1});let g=ak.isPointInPolygon(a,c.point);(g&&b||!g&&!b)&&f.push({point:c.point,docIDs:Array.from(c.docIDs)})}let g=ak.calculatePolygonCentroid(a);if(c){let a=d?ak.vincentyDistance:ak.haversineDistance;f.sort((b,d)=>{let e=a(g,b.point),f=a(g,d.point);return"asc"===c.toLowerCase()?e-f:f-e})}return f}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(a){let b=new ak;return a.root&&(b.root=aj.fromJSON(a.root),b.buildNodeMap(b.root)),b}buildNodeMap(a){if(null==a)return;let b=this.getPointKey(a.point);this.nodeMap.set(b,a),a.left&&this.buildNodeMap(a.left),a.right&&this.buildNodeMap(a.right)}static calculatePolygonCentroid(a){let b=0,c=0,d=0,e=a.length;for(let f=0,g=e-1;f<e;g=f++){let e=a[f].lon,h=a[f].lat,i=a[g].lon,j=a[g].lat,k=e*j-i*h;b+=k,c+=(e+i)*k,d+=(h+j)*k}let f=6*(b/=2);return{lon:c/=f,lat:d/=f}}static isPointInPolygon(a,b){let c=!1,d=b.lon,e=b.lat,f=a.length;for(let b=0,g=f-1;b<f;g=b++){let f=a[b].lon,h=a[b].lat,i=a[g].lon,j=a[g].lat;h>e!=j>e&&d<(i-f)*(e-h)/(j-h)+f&&(c=!c)}return c}static haversineDistance(a,b){let c=Math.PI/180,d=a.lat*c,e=b.lat*c,f=(b.lat-a.lat)*c,g=(b.lon-a.lon)*c,h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(d)*Math.cos(e)*Math.sin(g/2)*Math.sin(g/2);return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371e3}static vincentyDistance(a,b){let c,d,e,f,g,h,i,j=1/298.257223563,k=(1-1/298.257223563)*6378137,l=Math.PI/180,m=a.lat*l,n=b.lat*l,o=(b.lon-a.lon)*l,p=Math.atan((1-j)*Math.tan(m)),q=Math.atan((1-j)*Math.tan(n)),r=Math.sin(p),s=Math.cos(p),t=Math.sin(q),u=Math.cos(q),v=o,w=1e3;do{let a=Math.sin(v),b=Math.cos(v);if(0===(d=Math.sqrt(u*a*(u*a)+(s*t-r*u*b)*(s*t-r*u*b))))return 0;f=Math.atan2(d,e=r*t+s*u*b),isNaN(i=e-2*r*t/(h=1-(g=s*u*a/d)*g))&&(i=0);let k=j/16*h*(4+j*(4-3*h));c=v,v=o+(1-k)*j*g*(f+k*d*(i+k*e*(-1+2*i*i)))}while(Math.abs(v-c)>1e-12&&--w>0)if(0===w)return NaN;let x=h*(0x24ffb2985f71-k*k)/(k*k),y=1+x/16384*(4096+x*(-768+x*(320-175*x))),z=x/1024*(256+x*(-128+x*(74-47*x)));return k*y*(f-z*d*(i+z/4*(e*(-1+2*i*i)-z/6*i*(-3+4*d*d)*(-3+4*i*i))))}}class al{true;false;constructor(){this.true=new Set,this.false=new Set}insert(a,b){b?this.true.add(a):this.false.add(a)}delete(a,b){b?this.true.delete(a):this.false.delete(a)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(a){let b=new al;return b.true=new Set(a.true),b.false=new Set(a.false),b}}class am{size;vectors=new Map;constructor(a){this.size=a}add(a,b){b instanceof Float32Array||(b=new Float32Array(b));let c=an(b,this.size);this.vectors.set(a,[c,b])}remove(a){this.vectors.delete(a)}find(a,b,c){return a instanceof Float32Array||(a=new Float32Array(a)),function(a,b,c,d,e){let f=an(a,d),g=[];for(let h of b||c.keys()){let b=c.get(h);if(!b)continue;let i=b[0],j=b[1],k=0;for(let b=0;b<d;b++)k+=a[b]*j[b];let l=k/(f*i);l>=e&&g.push([h,l])}return g}(a,c,this.vectors,this.size,b)}toJSON(){let a=[];for(let[b,[c,d]]of this.vectors)a.push([b,[c,Array.from(d)]]);return{size:this.size,vectors:a}}static fromJSON(a){let b=new am(a.size);for(let[c,[d,e]]of a.vectors)b.vectors.set(c,[d,new Float32Array(e)]);return b}}function an(a,b){let c=0;for(let d=0;d<b;d++)c+=a[d]*a[d];return Math.sqrt(c)}function ao(a,b,c,d,e){let f=P(a.sharedInternalDocumentStore,c);a.avgFieldLength[b]=((a.avgFieldLength[b]??0)*(e-1)+d.length)/e,a.fieldLengths[b][f]=d.length,a.frequencies[b][f]={}}function ap(a,b,c,d,e){let f=0;for(let a of d)a===e&&f++;let g=P(a.sharedInternalDocumentStore,c),h=f/d.length;a.frequencies[b][g][e]=h,e in a.tokenOccurrences[b]||(a.tokenOccurrences[b][e]=0),a.tokenOccurrences[b][e]=(a.tokenOccurrences[b][e]??0)+1}function aq(a,b,c,d){let e=P(a.sharedInternalDocumentStore,c);d>1?a.avgFieldLength[b]=(a.avgFieldLength[b]*d-a.fieldLengths[b][e])/(d-1):a.avgFieldLength[b]=void 0,a.fieldLengths[b][e]=void 0,a.frequencies[b][e]=void 0}function ar(a,b,c){a.tokenOccurrences[b][c]--}function as(a,b,c,d,e,f,g,h,i,j,k){if(J(g)){var l,m,n,o;return l=b,m=c,n=f,o=e,void l.vectorIndexes[m].node.add(o,n)}let p=d=>{let{type:f,node:g}=b.indexes[c];switch(f){case"Bool":g[d?"true":"false"].add(e);break;case"AVL":{let a=k?.avlRebalanceThreshold??1;g.insert(d,e,a);break}case"Radix":{let f=i.tokenize(d,h,c,!1);for(let d of(a.insertDocumentScoreParameters(b,c,e,f,j),f))a.insertTokenScoreParameters(b,c,e,f,d),g.insert(d,e);break}case"Flat":g.insert(d,e);break;case"BKD":g.insert(d,[e])}};if(!K(g))return p(f);let q=f.length;for(let a=0;a<q;a++)p(f[a])}function at(a,b,c,d,e,f,g,h,i,j){if(J(g))return b.vectorIndexes[c].node.remove(e),!0;let{type:k,node:l}=b.indexes[c];switch(k){case"AVL":return l.removeDocument(f,e),!0;case"Bool":return l[f?"true":"false"].delete(e),!0;case"Radix":{let g=i.tokenize(f,h,c);for(let f of(a.removeDocumentScoreParameters(b,c,d,j),g))a.removeTokenScoreParameters(b,c,f),l.removeDocumentByWord(f,e);return!0}case"Flat":return l.removeDocument(e,f),!0;case"BKD":return l.removeDocByID(f,e),!1}}function au(a,b,c,d,e,f,g,h,i,j){if(!K(g))return at(a,b,c,d,e,f,g,h,i,j);let k=H[g],l=f.length;for(let g=0;g<l;g++)at(a,b,c,d,e,f[g],k,h,i,j);return!0}function av(a,b,c,d,e,f,g,h,i,j){let k=Array.from(d),l=a.avgFieldLength[b],m=a.fieldLengths[b],n=a.tokenOccurrences[b],o=a.frequencies[b],p="number"==typeof n[c]?n[c]??0:0,q=k.length;for(let a=0;a<q;a++){let d=k[a];if(i&&!i.has(d))continue;j.has(d)||j.set(d,new Map);let n=j.get(d);n.set(b,(n.get(b)||0)+1);let q=function(a,b,c,d,e,{k:f,b:g,d:h}){return Math.log(1+(c-b+.5)/(b+.5))*(h+a*(f+1))/(a+f*(1-g+g*d/e))}(o?.[d]?.[c]??0,p,e,m[d],l,f);g.has(d)?g.set(d,g.get(d)+q*h):g.set(d,q*h)}}function aw(a,b,c,d,e,f,g,h,i,j,k,l=0){let m=c.tokenize(b,d),n=m.length||1,o=new Map,p=new Map,q=new Map;for(let c of e){if(!(c in a.indexes))continue;let d=a.indexes[c],{type:e}=d;if("Radix"!==e)throw C("WRONG_SEARCH_PROPERTY_TYPE",c);let l=h[c]??1;if(l<=0)throw C("INVALID_BOOST_VALUE",l);0!==m.length||b||m.push("");let n=m.length;for(let b=0;b<n;b++){let e=m[b],h=d.node.find({term:e,exact:f,tolerance:g}),n=Object.keys(h);n.length>0&&p.set(e,!0);let r=n.length;for(let b=0;b<r;b++){let d=n[b],e=h[d];av(a,c,d,e,j,i,q,l,k,o)}}}let r=Array.from(q.entries()).map(([a,b])=>[a,b]).sort((a,b)=>b[1]-a[1]);if(0===r.length)return[];if(1===l)return r;if(0===l){if(1===n)return r;for(let a of m)if(!p.get(a))return[];return r.filter(([a])=>{let b=o.get(a);return!!b&&Array.from(b.values()).some(a=>a===n)})}let s=r.filter(([a])=>{let b=o.get(a);return!!b&&Array.from(b.values()).some(a=>a===n)});if(s.length>0){let a=r.filter(([a])=>!s.some(([b])=>b===a)),b=Math.ceil(a.length*l);return[...s,...a.slice(0,b)]}return r}function ax(a){return a.searchableProperties}function ay(a){return a.searchablePropertiesWithTypes}function az(a,b){let{indexes:c,vectorIndexes:d,searchableProperties:e,searchablePropertiesWithTypes:f,frequencies:g,tokenOccurrences:h,avgFieldLength:i,fieldLengths:j}=b,k={},l={};for(let a of Object.keys(c)){let{node:b,type:d,isArray:e}=c[a];switch(d){case"Radix":k[a]={type:"Radix",node:ai.fromJSON(b),isArray:e};break;case"Flat":k[a]={type:"Flat",node:af.fromJSON(b),isArray:e};break;case"AVL":k[a]={type:"AVL",node:ae.fromJSON(b),isArray:e};break;case"BKD":k[a]={type:"BKD",node:ak.fromJSON(b),isArray:e};break;case"Bool":k[a]={type:"Bool",node:al.fromJSON(b),isArray:e};break;default:k[a]=c[a]}}for(let a of Object.keys(d))l[a]={type:"Vector",isArray:!1,node:am.fromJSON(d[a])};return{sharedInternalDocumentStore:a,indexes:k,vectorIndexes:l,searchableProperties:e,searchablePropertiesWithTypes:f,frequencies:g,tokenOccurrences:h,avgFieldLength:i,fieldLengths:j}}function aA(a){let{indexes:b,vectorIndexes:c,searchableProperties:d,searchablePropertiesWithTypes:e,frequencies:f,tokenOccurrences:g,avgFieldLength:h,fieldLengths:i}=a,j={};for(let a of Object.keys(c))j[a]=c[a].node.toJSON();let k={};for(let a of Object.keys(b)){let{type:c,node:d,isArray:e}=b[a];"Flat"===c||"Radix"===c||"AVL"===c||"BKD"===c||"Bool"===c?k[a]={type:c,node:d.toJSON(),isArray:e}:(k[a]=b[a],k[a].node=k[a].node.toJSON())}return{indexes:k,vectorIndexes:j,searchableProperties:d,searchablePropertiesWithTypes:e,frequencies:f,tokenOccurrences:g,avgFieldLength:h,fieldLengths:i}}function aB(a,b){a||(a=new Set);let c=b.length;for(let d=0;d<c;d++){let c=b[d].docIDs,e=c.length;for(let b=0;b<e;b++)a.add(c[b])}return a}function aC(a,b,c=!1){let d=c?ak.vincentyDistance:ak.haversineDistance,e=[],f=[];for(let{point:c}of a)f.push(d(b,c));let g=Math.max(...f),h=0;for(let{docIDs:b}of a){let a=g-f[h]+1;for(let c of b)e.push([c,a]);h++}return e.sort((a,b)=>b[1]-a[1]),e}function aD(a,b,c,d){return d?.enabled===!1?{disabled:!0}:function a(b,c,d,e,f){let g={language:b.tokenizer.language,sharedInternalDocumentStore:c,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[h,i]of Object.entries(d)){let d=`${f}${f?".":""}${h}`;if(!e.includes(d)){if("object"==typeof i&&!Array.isArray(i)){let f=a(b,c,i,e,d);j(g.sortableProperties,f.sortableProperties),g.sorts={...g.sorts,...f.sorts},g.sortablePropertiesWithTypes={...g.sortablePropertiesWithTypes,...f.sortablePropertiesWithTypes};continue}if(!J(i))switch(i){case"boolean":case"number":case"string":g.sortableProperties.push(d),g.sortablePropertiesWithTypes[d]=i,g.sorts[d]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:i};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw C("INVALID_SORT_SCHEMA_TYPE",Array.isArray(i)?"array":i,d)}}}return g}(a,b,c,(d||{}).unsortableProperties||[],"")}function aE(a,b,c,d){if(!a.enabled)return;a.isSorted=!1;let e=P(a.sharedInternalDocumentStore,c),f=a.sorts[b];f.orderedDocsToRemove.has(e)&&aJ(a,b),f.docs.set(e,f.orderedDocs.length),f.orderedDocs.push([e,d])}function aF(a){if(!a.isSorted&&a.enabled){for(let b of Object.keys(a.sorts))!function(a,b){let c,d=a.sorts[b];switch(d.type){case"string":c=aG.bind(null,a.language);break;case"number":c=aH.bind(null);break;case"boolean":c=aI.bind(null)}d.orderedDocs.sort(c);let e=d.orderedDocs.length;for(let a=0;a<e;a++){let b=d.orderedDocs[a][0];d.docs.set(b,a)}}(a,b);a.isSorted=!0}}function aG(a,c,e){return c[1].localeCompare(e[1],void 0!==a&&d.includes(a)?b[a]:void 0)}function aH(a,b){return a[1]-b[1]}function aI(a,b){return b[1]?-1:1}function aJ(a,b){let c=a.sorts[b];c.orderedDocsToRemove.size&&(c.orderedDocs=c.orderedDocs.filter(a=>!c.orderedDocsToRemove.has(a[0])),c.orderedDocsToRemove.clear())}function aK(a,b,c){if(!a.enabled)return;let d=a.sorts[b],e=P(a.sharedInternalDocumentStore,c);d.docs.get(e)&&(d.docs.delete(e),d.orderedDocsToRemove.set(e,!0))}function aL(a,b,c){if(!a.enabled)throw C("SORT_DISABLED");let d=c.property,e="DESC"===c.order,f=a.sorts[d];if(!f)throw C("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",d,a.sortableProperties.join(", "));return aJ(a,d),aF(a),b.sort((b,c)=>{let d=f.docs.get(P(a.sharedInternalDocumentStore,b[0])),g=f.docs.get(P(a.sharedInternalDocumentStore,c[0])),h=void 0!==d,i=void 0!==g;return h||i?h?i?e?g-d:d-g:-1:1:0}),b}function aM(a){return a.enabled?a.sortableProperties:[]}function aN(a){return a.enabled?a.sortablePropertiesWithTypes:{}}function aO(a,b){if(!b.enabled)return{enabled:!1};let c=Object.keys(b.sorts).reduce((a,c)=>{let{docs:d,orderedDocs:e,type:f}=b.sorts[c];return a[c]={docs:new Map(Object.entries(d).map(([a,b])=>[+a,b])),orderedDocsToRemove:new Map,orderedDocs:e,type:f},a},{});return{sharedInternalDocumentStore:a,language:b.language,sortableProperties:b.sortableProperties,sortablePropertiesWithTypes:b.sortablePropertiesWithTypes,sorts:c,enabled:!0,isSorted:b.isSorted}}function aP(a){if(!a.enabled)return{enabled:!1};for(let b of Object.keys(a.sorts))aJ(a,b);aF(a);let b=Object.keys(a.sorts).reduce((b,c)=>{let{docs:d,orderedDocs:e,type:f}=a.sorts[c];return b[c]={docs:Object.fromEntries(d.entries()),orderedDocs:e,type:f},b},{});return{language:a.language,sortableProperties:a.sortableProperties,sortablePropertiesWithTypes:a.sortablePropertiesWithTypes,sorts:b,enabled:a.enabled,isSorted:a.isSorted}}let aQ=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115],aR={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},aS={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},aT="[aeiouy]",aU="[^aeiou][^aeiouy]*",aV=aT+"[aeiou]*",aW="^("+aU+")?"+aV+aU,aX="^("+aU+")?"+aV+aU+"("+aV+")?$",aY="^("+aU+")?"+aV+aU+aV+aU,aZ="^("+aU+")?"+aT;function a$(a){let b,c,d,e,f,g;if(a.length<3)return a;let h=a.substring(0,1);if("y"==h&&(a=h.toUpperCase()+a.substring(1)),e=/^(.+?)([^s])s$/,(d=/^(.+?)(ss|i)es$/).test(a)?a=a.replace(d,"$1$2"):e.test(a)&&(a=a.replace(e,"$1$2")),e=/^(.+?)(ed|ing)$/,(d=/^(.+?)eed$/).test(a)){let b=d.exec(a);(d=new RegExp(aW)).test(b[1])&&(d=/.$/,a=a.replace(d,""))}else e.test(a)&&(b=e.exec(a)[1],(e=new RegExp(aZ)).test(b)&&(a=b,e=/(at|bl|iz)$/,f=RegExp("([^aeiouylsz])\\1$"),g=RegExp("^"+aU+aT+"[^aeiouwxy]$"),e.test(a)?a+="e":f.test(a)?(d=/.$/,a=a.replace(d,"")):g.test(a)&&(a+="e")));if((d=/^(.+?)y$/).test(a)){let c=d.exec(a);b=c?.[1],d=new RegExp(aZ),b&&d.test(b)&&(a=b+"i")}if((d=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(a)){let e=d.exec(a);b=e?.[1],c=e?.[2],d=new RegExp(aW),b&&d.test(b)&&(a=b+aR[c])}if((d=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(a)){let e=d.exec(a);b=e?.[1],c=e?.[2],d=new RegExp(aW),b&&d.test(b)&&(a=b+aS[c])}if(e=/^(.+?)(s|t)(ion)$/,(d=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(a)){let c=d.exec(a);b=c?.[1],d=new RegExp(aY),b&&d.test(b)&&(a=b)}else if(e.test(a)){let c=e.exec(a);b=c?.[1]??""+c?.[2]??"",(e=new RegExp(aY)).test(b)&&(a=b)}if((d=/^(.+?)e$/).test(a)){let c=d.exec(a);b=c?.[1],d=new RegExp(aY),e=new RegExp(aX),f=RegExp("^"+aU+aT+"[^aeiouwxy]$"),b&&(d.test(b)||e.test(b)&&!f.test(b))&&(a=b)}return d=/ll$/,e=new RegExp(aY),d.test(a)&&e.test(a)&&(d=/.$/,a=a.replace(d,"")),"y"==h&&(a=h.toLowerCase()+a.substring(1)),a}function a_(a,b,c=!0){let d=`${this.language}:${a}:${b}`;return c&&this.normalizationCache.has(d)?this.normalizationCache.get(d):this.stopWords?.includes(b)?(c&&this.normalizationCache.set(d,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(a)&&(b=this.stemmer(b)),b=function(a){let b=[];for(let d=0;d<a.length;d++){var c;b[d]=(c=a.charCodeAt(d))<192||c>383?c:aQ[c-192]||c}return String.fromCharCode(...b)}(b),c&&this.normalizationCache.set(d,b),b)}function a0(a,b,d,e=!0){let f;if(b&&b!==this.language)throw C("LANGUAGE_NOT_SUPPORTED",b);if("string"!=typeof a)return[a];let g=this.normalizeToken.bind(this,d??"");if(d&&this.tokenizeSkipProperties.has(d))f=[g(a,e)];else{let b=c[this.language];f=a.toLowerCase().split(b).map(a=>g(a,e)).filter(Boolean)}let h=function(a){for(;""===a[a.length-1];)a.pop();for(;""===a[0];)a.shift();return a}(f);return this.allowDuplicates?h:Array.from(new Set(h))}function a1(a={}){let b,c;if(a.language){if(!d.includes(a.language))throw C("LANGUAGE_NOT_SUPPORTED",a.language)}else a.language="english";if(a.stemming||a.stemmer&&!("stemming"in a))if(a.stemmer){if("function"!=typeof a.stemmer)throw C("INVALID_STEMMER_FUNCTION_TYPE");b=a.stemmer}else if("english"===a.language)b=a$;else throw C("MISSING_STEMMER",a.language);if(!1!==a.stopWords){if(c=[],Array.isArray(a.stopWords))c=a.stopWords;else if("function"==typeof a.stopWords)c=a.stopWords(c);else if(a.stopWords)throw C("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(c))throw C("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let a of c)if("string"!=typeof a)throw C("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let e={tokenize:a0,language:a.language,stemmer:b,stemmerSkipProperties:new Set(a.stemmerSkipProperties?[a.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(a.tokenizeSkipProperties?[a.tokenizeSkipProperties].flat():[]),stopWords:c,allowDuplicates:!!a.allowDuplicates,normalizeToken:a_,normalizationCache:new Map};return e.tokenize=a0.bind(e),e.normalizeToken=a_,e}function a2(a){return{sharedInternalDocumentStore:a,rules:new Map}}function a3(a,b){if(a.rules.has(b.id))throw Error(`PINNING_RULE_ALREADY_EXISTS: A pinning rule with id "${b.id}" already exists. Use updateRule to modify it.`);a.rules.set(b.id,b)}function a4(a,b){if(!a.rules.has(b.id))throw Error(`PINNING_RULE_NOT_FOUND: Cannot update pinning rule with id "${b.id}" because it does not exist. Use addRule to create it.`);a.rules.set(b.id,b)}function a5(a,b){return a.rules.delete(b)}function a6(a,b){return a.rules.get(b)}function a7(a){return Array.from(a.rules.values())}function a8(a,b){if(!b)return[];let c=[];for(let d of a.rules.values())(function(a,b){return!!a&&b.conditions.every(b=>(function(a,b){let c=a.toLowerCase().trim(),d=b.pattern.toLowerCase().trim();switch(b.anchoring){case"is":return c===d;case"starts_with":return c.startsWith(d);case"contains":return c.includes(d);default:return!1}})(a,b))})(b,d)&&c.push(d);return c}function a9(a,b){return{sharedInternalDocumentStore:a,rules:new Map(b?.rules??[])}}function ba(a){return{rules:Array.from(a.rules.entries())}}function bb({schema:a,sort:b,language:c,components:d,id:e,plugins:f}){for(let b of(d||(d={}),f??[])){if(!("getComponents"in b)||"function"!=typeof b.getComponents)continue;let c=b.getComponents(a);for(let a of Object.keys(c))if(d[a])throw C("PLUGIN_COMPONENT_CONFLICT",a,b.name);d={...d,...c}}e||(e=n());let g=d.tokenizer,h=d.index,i=d.documentsStore,j=d.sorter,k=d.pinning;if(g=g?g.tokenize?g:a1(g):a1({language:c??"english"}),d.tokenizer&&c)throw C("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let l={idToInternalId:new Map,internalIdToId:[],save:N,load:O};h||={create:function a(b,c,d,e,f=""){for(let[g,h]of(e||(e={sharedInternalDocumentStore:c,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(d))){let d=`${f}${f?".":""}${g}`;if("object"==typeof h&&!Array.isArray(h)){a(b,c,h,e,d);continue}if(J(h))e.searchableProperties.push(d),e.searchablePropertiesWithTypes[d]=h,e.vectorIndexes[d]={type:"Vector",node:new am(M(h)),isArray:!1};else{let a=/\[/.test(h);switch(h){case"boolean":case"boolean[]":e.indexes[d]={type:"Bool",node:new al,isArray:a};break;case"number":case"number[]":e.indexes[d]={type:"AVL",node:new ae(0,[]),isArray:a};break;case"string":case"string[]":e.indexes[d]={type:"Radix",node:new ai,isArray:a},e.avgFieldLength[d]=0,e.frequencies[d]={},e.tokenOccurrences[d]={},e.fieldLengths[d]={};break;case"enum":case"enum[]":e.indexes[d]={type:"Flat",node:new af,isArray:a};break;case"geopoint":e.indexes[d]={type:"BKD",node:new ak,isArray:a};break;default:throw C("INVALID_SCHEMA_TYPE",Array.isArray(h)?"array":h,d)}e.searchableProperties.push(d),e.searchablePropertiesWithTypes[d]=h}}return e},insert:as,remove:au,insertDocumentScoreParameters:ao,insertTokenScoreParameters:ap,removeDocumentScoreParameters:aq,removeTokenScoreParameters:ar,calculateResultScores:av,search:aw,searchByWhereClause:function a(b,c,d,e){if("and"in d&&d.and&&Array.isArray(d.and)){let f=d.and;return 0===f.length?new Set:x(...f.map(d=>a(b,c,d,e)))}if("or"in d&&d.or&&Array.isArray(d.or)){let f=d.or;return 0===f.length?new Set:f.map(d=>a(b,c,d,e)).reduce((a,b)=>z(a,b),new Set)}if("not"in d&&d.not){let f=d.not,g=new Set,h=b.sharedInternalDocumentStore;for(let a=1;a<=h.internalIdToId.length;a++)g.add(a);let i=a(b,c,f,e),j=new Set;for(let a of g)i.has(a)||j.add(a);return j}let f=Object.keys(d),g=f.reduce((a,b)=>({[b]:new Set,...a}),{});for(let a of f){let f=d[a];if(void 0===b.indexes[a])throw C("UNKNOWN_FILTER_PROPERTY",a);let{node:h,type:i,isArray:j}=b.indexes[a];if("Bool"===i){let b=f?h.true:h.false;g[a]=z(g[a],b);continue}if("BKD"===i){let b;if("radius"in f)b="radius";else if("polygon"in f)b="polygon";else throw Error(`Invalid operation ${f}`);if("radius"===b){let{value:c,coordinates:d,unit:e="m",inside:i=!0,highPrecision:j=!1}=f[b],k=t(c,e),l=h.searchByRadius(d,k,i,void 0,j);g[a]=aB(g[a],l)}else{let{coordinates:c,inside:d=!0,highPrecision:e=!1}=f[b],i=h.searchByPolygon(c,d,void 0,e);g[a]=aB(g[a],i)}continue}if("Radix"===i&&("string"==typeof f||Array.isArray(f))){for(let b of[f].flat())for(let d of c.tokenize(b,e,a)){let b=h.find({term:d,exact:!0});g[a]=function(a,b){a||(a=new Set);let c=Object.keys(b),d=c.length;for(let e=0;e<d;e++){let d=b[c[e]],f=d.length;for(let b=0;b<f;b++)a.add(d[b])}return a}(g[a],b)}continue}let k=Object.keys(f);if(k.length>1)throw C("INVALID_FILTER_OPERATION",k.length);if("Flat"===i){let b=new Set(j?h.filterArr(f):h.filter(f));g[a]=z(g[a],b);continue}if("AVL"===i){let b,c=k[0],d=f[c];switch(c){case"gt":b=h.greaterThan(d,!1);break;case"gte":b=h.greaterThan(d,!0);break;case"lt":b=h.lessThan(d,!1);break;case"lte":b=h.lessThan(d,!0);break;case"eq":b=h.find(d)??new Set;break;case"between":{let[a,c]=d;b=h.rangeSearch(a,c);break}default:throw C("INVALID_FILTER_OPERATION",c)}g[a]=z(g[a],b)}}return x(...Object.values(g))},getSearchableProperties:ax,getSearchablePropertiesWithTypes:ay,load:az,save:aA},j||={create:aD,insert:aE,remove:aK,save:aP,load:aO,sortBy:aL,getSortableProperties:aM,getSortablePropertiesWithTypes:aN},i||={create:R,get:S,getMultiple:T,getAll:U,store:V,remove:W,count:X,load:Y,save:Z},k||={create:a2,addRule:a3,updateRule:a4,removeRule:a5,getRule:a6,getAllRules:a7,getMatchingRules:a8,load:a9,save:ba};var m=d;let o={formatElapsedTime:D,getDocumentIndexId:E,getDocumentProperties:q,validateSchema:F};for(let a of aa)if(m[a]){if("function"!=typeof m[a])throw C("COMPONENT_MUST_BE_FUNCTION",a)}else m[a]=o[a];for(let a of Object.keys(m))if(!_.includes(a)&&!aa.includes(a))throw C("UNSUPPORTED_COMPONENT",a);let{getDocumentProperties:p,getDocumentIndexId:r,validateSchema:s,formatElapsedTime:u}=d,w={data:{},caches:{},schema:a,tokenizer:g,index:h,sorter:j,documentsStore:i,pinning:k,internalDocumentIDStore:l,getDocumentProperties:p,getDocumentIndexId:r,validateSchema:s,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:u,id:e,plugins:f,version:"{{VERSION}}"};for(let c of(w.data={index:w.index.create(w,l,a),docs:w.documentsStore.create(w,l),sorting:w.sorter.create(w,l,a,b),pinning:w.pinning.create(l)},$))w[c]=(w[c]??[]).concat(function(a,b){let c=[],d=a.plugins?.length;if(!d)return c;for(let e=0;e<d;e++)try{let d=a.plugins[e];"function"==typeof d[b]&&c.push(d[b])}catch(a){throw console.error("Caught error in getAllPluginsByHook:",a),C("PLUGIN_CRASHED")}return c}(w,c));let y=w.afterCreate;return y&&function(a,b){if(a.some(v))return(async()=>{for(let c of a)await c(b)})();for(let c of a)c(b)}(y,w),w}function bc(a,b){return a.documentsStore.get(a.data.docs,b)}function bd(a){return a.documentsStore.count(a.data.docs)}a.s(["create",()=>bb],91094),a.s(["count",()=>bd,"getByID",()=>bc],33383),a.i(31653),a.s(["fetchDocuments",()=>bw,"fetchDocumentsWithDistinct",()=>bv,"search",()=>bu],79240);let be="fulltext";function bf(a,b){return a[1]-b[1]}function bg(a,b){return b[1]-a[1]}function bh(a,b,c){let d={},e=b.map(([a])=>a),f=a.documentsStore.getMultiple(a.data.docs,e),g=Object.keys(c),h=a.index.getSearchablePropertiesWithTypes(a.data.index);for(let a of g){let b;if("number"===h[a]){let{ranges:d}=c[a],e=d.length,f=Array.from({length:e});for(let a=0;a<e;a++){let b=d[a];f[a]=[`${b.from}-${b.to}`,0]}b=Object.fromEntries(f)}d[a]={count:0,values:b??{}}}let i=f.length;for(let a=0;a<i;a++){let b=f[a];for(let a of g){let e=a.includes(".")?r(b,a):b[a],f=h[a],g=d[a].values;switch(f){case"number":bi(c[a].ranges,g)(e);break;case"number[]":{let b=new Set,d=bi(c[a].ranges,g,b);for(let a of e)d(a);break}case"boolean":case"enum":case"string":bj(g,f)(e);break;case"boolean[]":case"enum[]":case"string[]":{let a=bj(g,"boolean[]"===f?"boolean":"string",new Set);for(let b of e)a(b);break}default:throw C("FACET_NOT_SUPPORTED",f)}}}for(let a of g){let b=d[a];if(b.count=Object.keys(b.values).length,"string"===h[a]){let d=c[a],e=function(a="desc"){return"asc"===a.toLowerCase()?bf:bg}(d.sort);b.values=Object.fromEntries(Object.entries(b.values).sort(e).slice(d.offset??0,d.limit??10))}}return d}function bi(a,b,c){return d=>{for(let e of a){let a=`${e.from}-${e.to}`;!c?.has(a)&&d>=e.from&&d<=e.to&&(void 0===b[a]?b[a]=1:(b[a]++,c?.add(a)))}}}function bj(a,b,c){let d="boolean"===b?"false":"";return b=>{let e=b?.toString()??d;c?.has(e)||(a[e]=(a[e]??0)+1,c?.add(e))}}let bk={reducer:(a,b,c,d)=>(b[d]=c,b),getInitialValue:a=>Array.from({length:a})},bl=["string","number","boolean"];function bm(a,b,c){let d=c.properties,e=d.length,f=a.index.getSearchablePropertiesWithTypes(a.data.index);for(let a=0;a<e;a++){let b=d[a];if(void 0===f[b])throw C("UNKNOWN_GROUP_BY_PROPERTY",b);if(!bl.includes(f[b]))throw C("INVALID_GROUP_BY_PROPERTY",b,bl.join(", "),f[b])}let g=b.map(([b])=>Q(a.internalDocumentIDStore,b)),h=a.documentsStore.getMultiple(a.data.docs,g),i=h.length,k=c.maxResult||Number.MAX_SAFE_INTEGER,l=[],m={};for(let a=0;a<e;a++){let b=d[a],c={property:b,perValue:{}},e=new Set;for(let a=0;a<i;a++){let d=r(h[a],b);if(void 0===d)continue;let f="boolean"!=typeof d?d:""+d,g=c.perValue[f]??{indexes:[],count:0};g.count>=k||(g.indexes.push(a),g.count++,c.perValue[f]=g,e.add(d))}l.push(Array.from(e)),m[b]=c}let n=function a(b,c=0){if(c+1===b.length)return b[c].map(a=>[a]);let d=b[c],e=a(b,c+1),f=[];for(let a of d)for(let b of e){let c=[a];j(c,b),f.push(c)}return f}(l),o=n.length,p=[];for(let a=0;a<o;a++){let b=n[a],c=b.length,e={values:[],indexes:[]},f=[];for(let a=0;a<c;a++){let c=b[a],g=d[a];f.push(m[g].perValue["boolean"!=typeof c?c:""+c].indexes),e.values.push(c)}e.indexes=(function(a){if(0===a.length)return[];if(1===a.length)return a[0];for(let b=1;b<a.length;b++)if(a[b].length<a[0].length){let c=a[0];a[0]=a[b],a[b]=c}let b=new Map;for(let c of a[0])b.set(c,1);for(let c=1;c<a.length;c++){let d=0;for(let e of a[c]){let a=b.get(e);a===c&&(b.set(e,a+1),d++)}if(0===d)return[]}return a[0].filter(c=>{let d=b.get(c);return void 0!==d&&b.set(c,0),d===a.length})})(f).sort((a,b)=>a-b),0!==e.indexes.length&&p.push(e)}let q=p.length,s=Array.from({length:q});for(let a=0;a<q;a++){let d=p[a],e=c.reduce||bk,f=d.indexes.map(a=>({id:g[a],score:b[a][1],document:h[a]})),i=e.reducer.bind(null,d.values),j=e.getInitialValue(d.indexes.length),k=f.reduce(i,j);s[a]={values:d.values,result:k}}return s}function bn(a,b,c,d){let e=a8(b,d);if(0===e.length)return c;let f=e.flatMap(a=>a.consequence.promote);f.sort((a,b)=>a.position-b.position);let g=new Set,h=new Map,i=new Set;for(let b of f){let c=P(a.internalDocumentIDStore,b.doc_id);if(void 0!==c){if(h.has(c)){let a=h.get(c);b.position<a&&h.set(c,b.position);continue}i.has(b.position)||(g.add(c),h.set(c,b.position),i.add(b.position))}}if(0===h.size)return c;let j=c.filter(([a])=>!g.has(a)),k=[];for(let[b,d]of h.entries())c.find(([a])=>a===b)?k.push([b,1e6-d]):a.documentsStore.get(a.data.docs,b)&&k.push([b,0]);k.sort((a,b)=>(h.get(a[0])??1/0)-(h.get(b[0])??1/0));let l=[],m=new Map;for(let a of k){let b=h.get(a[0]);m.set(b,a)}let n=0,o=0;for(;o<j.length+k.length;)if(m.has(o))l.push(m.get(o)),o++;else if(n<j.length)l.push(j[n]),n++,o++;else break;for(let[a,b]of m.entries())a>=l.length&&l.push(b);return l}function bo(a,b,c){let d,e,{term:f,properties:g}=b,h=a.data.index,i=a.caches.propertiesToSearch;if(!i){let b=a.index.getSearchablePropertiesWithTypes(h);i=(i=a.index.getSearchableProperties(h)).filter(a=>b[a].startsWith("string")),a.caches.propertiesToSearch=i}if(g&&"*"!==g){for(let a of g)if(!i.includes(a))throw C("UNKNOWN_INDEX",a,i.join(", "));i=i.filter(a=>g.includes(a))}let j=Object.keys(b.where??{}).length>0;j&&(d=a.index.searchByWhereClause(h,a.tokenizer,b.where,c));let k=void 0!==b.threshold&&null!==b.threshold?b.threshold:1;if(f||g){let g,j=bd(a);if(e=a.index.search(h,f||"",a.tokenizer,c,i,b.exact||!1,b.tolerance||0,b.boost||{},((g=b.relevance??{}).k=g.k??bp,g.b=g.b??bq,g.d=g.d??br,g),j,d,k),b.exact&&f){let b=f.trim().split(/\s+/);e=e.filter(([c])=>{let d=a.documentsStore.get(a.data.docs,c);if(!d)return!1;for(let a of i){let c=function(a,b){let c=b.split("."),d=a;for(let a of c)if(!d||"object"!=typeof d||!(a in d))return;else d=d[a];return d}(d,a);if("string"==typeof c&&b.every(a=>RegExp(`\\b${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`).test(c)))return!0}return!1})}}else if(j){let a=function(a,b){let c,d=function(a,b){let c=Object.keys(a);if(1!==c.length)return{isGeoOnly:!1};let d=c[0],e=a[d];if(void 0===b.indexes[d])return{isGeoOnly:!1};let{type:f}=b.indexes[d];return"BKD"===f&&e&&("radius"in e||"polygon"in e)?{isGeoOnly:!0,geoProperty:d,geoOperation:e}:{isGeoOnly:!1}}(b,a);if(!d.isGeoOnly||!d.geoProperty||!d.geoOperation)return null;let{node:e}=a.indexes[d.geoProperty],f=d.geoOperation;if("radius"in f){let{value:a,coordinates:b,unit:d="m",inside:g=!0,highPrecision:h=!1}=f.radius,i=t(a,d);return aC(c=e.searchByRadius(b,i,g,"asc",h),b,h)}if("polygon"in f){let{coordinates:a,inside:b=!0,highPrecision:d=!1}=f.polygon;return aC(c=e.searchByPolygon(a,b,"asc",d),ak.calculatePolygonCentroid(a),d)}return null}(h,b.where);e=a||(d?Array.from(d):[]).map(a=>[+a,0])}else e=Object.keys(a.documentsStore.getAll(a.data.docs)).map(a=>[+a,0]);return e}let bp=1.2,bq=.75,br=.5;function bs(a,b,c){let d,e=b.vector;if(e&&(!("value"in e)||!("property"in e)))throw C("INVALID_VECTOR_INPUT",Object.keys(e).join(", "));let f=a.data.index.vectorIndexes[e.property];if(!f)throw C("UNKNOWN_VECTOR_PROPERTY",e.property);let g=f.node.size;if(e?.value.length!==g){if(e?.property===void 0||e?.value.length===void 0)throw C("INVALID_INPUT_VECTOR","undefined",g,"undefined");throw C("INVALID_INPUT_VECTOR",e.property,g,e.value.length)}let h=a.data.index;return Object.keys(b.where??{}).length>0&&(d=a.index.searchByWhereClause(h,a.tokenizer,b.where,c)),f.node.find(e.value,b.similarity??.8,d)}function bt(a){return a[1]}function bu(a,b,c){let d=b.mode??be;if(d===be){let d=m();function e(){let e,f=Object.keys(a.data.index.vectorIndexes),g=b.facets&&Object.keys(b.facets).length>0,{limit:h=10,offset:i=0,distinctOn:j,includeVectors:k=!1}=b,l=!0===b.preflight,n=bo(a,b,c);if(b.sortBy)if("function"==typeof b.sortBy){let c=n.map(([a])=>a),d=a.documentsStore.getMultiple(a.data.docs,c).map((a,b)=>[n[b][0],n[b][1],a]);d.sort(b.sortBy),n=d.map(([a,b])=>[a,b])}else n=a.sorter.sortBy(a.data.sorting,n,b.sortBy).map(([b,c])=>[P(a.internalDocumentIDStore,b),c]);else n=n.sort(p);n=bn(a,a.data.pinning,n,b.term),l||(e=j?bv(a,n,i,h,j):bw(a,n,i,h));let o={elapsed:{formatted:"",raw:0},hits:[],count:n.length};return void 0!==e&&(o.hits=e.filter(Boolean),k||u(o,f)),g&&(o.facets=bh(a,n,b.facets)),b.groupBy&&(o.groups=bm(a,n,b.groupBy)),o.elapsed=a.formatElapsedTime(m()-d),o}async function f(){a.beforeSearch&&await ac(a.beforeSearch,a,b,c);let d=e();return a.afterSearch&&await ab(a.afterSearch,a,b,c,d),d}return a.beforeSearch?.length||a.afterSearch?.length?f():e()}if("vector"===d)return function(a,b,c="english"){let d=m();function e(){let e=bs(a,b,c).sort(p);e=bn(a,a.data.pinning,e,void 0);let f=[];b.facets&&Object.keys(b.facets).length>0&&(f=bh(a,e,b.facets));let g=b.vector.property,h=b.includeVectors??!1,i=b.limit??10,j=b.offset??0,k=Array.from({length:i});for(let b=0;b<i;b++){let c=e[b+j];if(!c)break;let d=a.data.docs.docs[c[0]];if(d){h||(d[g]=null);let e={id:Q(a.internalDocumentIDStore,c[0]),score:c[1],document:d};k[b]=e}}let n=[];b.groupBy&&(n=bm(a,e,b.groupBy));let o=m()-d;return{count:e.length,hits:k.filter(Boolean),elapsed:{raw:Number(o),formatted:l(o)},...f?{facets:f}:{},...n?{groups:n}:{}}}async function f(){a.beforeSearch&&await ac(a.beforeSearch,a,b,c);let d=e();return a.afterSearch&&await ab(a.afterSearch,a,b,c,d),d}return a.beforeSearch?.length||a.afterSearch?.length?f():e()}(a,b);if("hybrid"===d)return function(a,b,c){let d=m();function e(){var c,e;let f,g,h,i,j,k,n=(e=bo(a,b,c=void 0),f=Math.max.apply(Math,e.map(bt)),g=e.map(([a,b])=>[a,b/f]),h=bs(a,b,c),i=b.hybridWeights,function(a,b,c,d){let e=Math.max.apply(Math,a.map(bt)),f=Math.max.apply(Math,b.map(bt)),{text:g,vector:h}=d&&d.text&&d.vector?d:{text:.5,vector:.5},i=new Map,j=a.length,k=(a,b)=>a*g+b*h;for(let b=0;b<j;b++){let[c,d]=a[b],f=k(d/e,0);i.set(c,f)}let l=b.length;for(let a=0;a<l;a++){let[c,d]=b[a],e=d/f,g=i.get(c)??0;i.set(c,g+k(0,e))}return[...i].sort((a,b)=>b[1]-a[1])}(g,h,b.term??"",i));n=bn(a,a.data.pinning,n,b.term),b.facets&&Object.keys(b.facets).length>0&&(j=bh(a,n,b.facets)),b.groupBy&&(k=bm(a,n,b.groupBy));let o=bw(a,n,b.offset??0,b.limit??10).filter(Boolean),p=m(),q={count:n.length,elapsed:{raw:Number(p-d),formatted:l(p-d)},hits:o,...j?{facets:j}:{},...k?{groups:k}:{}};return b.includeVectors||u(q,Object.keys(a.data.index.vectorIndexes)),q}async function f(){a.beforeSearch&&await ac(a.beforeSearch,a,b,void 0);let c=e();return a.afterSearch&&await ab(a.afterSearch,a,b,void 0,c),c}return a.beforeSearch?.length||a.afterSearch?.length?f():e()}(a,b);throw C("INVALID_SEARCH_MODE",d)}function bv(a,b,c,d,e){let f=a.data.docs,g=new Map,h=[],i=new Set,j=b.length,k=0;for(let l=0;l<j;l++){let j=b[l];if(void 0===j)continue;let[m,n]=j;if(i.has(m))continue;let o=a.documentsStore.get(f,m),p=r(o,e);if(!(void 0===p||g.has(p))&&(g.set(p,!0),!(++k<=c)&&(h.push({id:Q(a.internalDocumentIDStore,m),score:n,document:o}),i.add(m),k>=c+d)))break}return h}function bw(a,b,c,d){let e=a.data.docs,f=Array.from({length:d}),g=new Set;for(let h=c;h<d+c;h++){let c=b[h];if(void 0===c)break;let[d,i]=c;if(!g.has(d)){let b=a.documentsStore.get(e,d);f[h]={id:Q(a.internalDocumentIDStore,d),score:i,document:b},g.add(d)}}return f}function bx(a,b){a.internalDocumentIDStore.load(a,b.internalDocumentIDStore),a.data.index=a.index.load(a.internalDocumentIDStore,b.index),a.data.docs=a.documentsStore.load(a.internalDocumentIDStore,b.docs),a.data.sorting=a.sorter.load(a.internalDocumentIDStore,b.sorting),a.data.pinning=a.pinning.load(a.internalDocumentIDStore,b.pinning),a.tokenizer.language=b.language}a.s(["load",()=>bx],56515),Symbol("orama.insertions"),Symbol("orama.removals"),a.s([],40507)}];

//# sourceMappingURL=f9abc_%40orama_orama_dist_esm_index_f455208a.js.map