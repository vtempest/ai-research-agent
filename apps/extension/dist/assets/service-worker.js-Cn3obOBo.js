import{s as u}from"./_commonjsHelpers-DbgfNesX.js";import"./marked.esm-CZ11A-2D.js";function c(e,t,r){chrome.runtime.sendMessage({type:"updateTabLists",updateType:e,tabId:t,changeInfo:r})}chrome.tabs.onUpdated.addListener((e,t,r)=>{(t.status==="complete"||t.title)&&c("updated",e,{url:r.url,title:r.title})});chrome.tabs.onCreated.addListener(e=>{c("created",e.id,{url:e.url,title:e.title})});chrome.tabs.onRemoved.addListener((e,t)=>{c("removed",e,{})});chrome.tabs.onActivated.addListener(e=>{chrome.tabs.get(e.tabId,t=>{c("activated",t.id,{url:t.url,title:t.title})})});chrome.tabs.onUpdated.addListener(async(e,t,r)=>{await chrome.sidePanel.setOptions({tabId:e,path:"src/pages/sidepanel/index.html",enabled:!0}),c("updated",e,{url:r.url,title:r.title})});chrome.contextMenus.removeAll(function(){chrome.contextMenus.create({title:"Search With...",id:"searchWithParent",contexts:["selection"]});for(var e in u)chrome.contextMenus.create({title:` ${u[e].name}`,parentId:"searchWithParent",id:"searchWith"+e,contexts:["selection"]});chrome.contextMenus.create({title:"Reading Mode",id:"readingMode",contexts:["page","frame","image","link","video","audio"]})});chrome.contextMenus.onClicked.addListener((e,t)=>{const{menuItemId:r,selectionText:i}=e;if(r.startsWith("searchWith")){const a=r.replace("searchWith",""),o=u[a].url+encodeURIComponent(i);chrome.tabs.create({url:o,active:!1},n=>{setTimeout(()=>{chrome.tabs.update(n.id,{active:!0},l=>{chrome.runtime.lastError&&console.error("Error updating tab:",chrome.runtime.lastError)})},1500)})}else r==="readingMode"&&chrome.tabs.query({active:!0,currentWindow:!0},function(a){let o=a[0];o&&chrome.tabs.sendMessage(o.id,{action:"activateReadingMode"})})});const f=["qwksearch.com","debate-ai.com"];chrome.runtime.onInstalled.addListener(()=>{b(f)});function b(e="*://*/*",t="*"){var r;return(r=chrome==null?void 0:chrome.declarativeNetRequest)==null?void 0:r.updateDynamicRules({removeRuleIds:[1],addRules:[{id:1,priority:1,action:{type:"modifyHeaders",responseHeaders:[{header:"Access-Control-Allow-Origin",operation:"set",value:"*"},{header:"Access-Control-Allow-Methods",operation:"set",value:"GET, POST, OPTIONS, PUT, DELETE, PATCH"}]},condition:{urlFilter:t,initiatorDomains:e,resourceTypes:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","csp_report","media","websocket","other"]}}]})}chrome.runtime.onMessage.addListener(function(e,t,r){var{type:i,url:a}=e;return i==="extractURL"&&chrome.tabs.create({url:a,selected:!1,active:!1},o=>{const n=o.id,l=(h,p)=>{h===n&&p.status==="complete"&&(chrome.tabs.onUpdated.removeListener(l),chrome.scripting.executeScript({target:{tabId:n},func:()=>document.documentElement.outerHTML}).then(s=>{var m;r({success:!0,html:(m=s==null?void 0:s[0])==null?void 0:m.result}),chrome.tabs.remove(n)}).catch(s=>{r({success:!1,error:s.message}),chrome.tabs.remove(n)}))};chrome.tabs.onUpdated.addListener(l)}),i==="openTab"&&chrome.tabs.create({url:a,active:!e.bg,selected:!e.bg}),i==="updateTabOrder"&&v(e.newOrder),i==="openDebateApp"&&chrome.runtime.openOptionsPage(),i==="requestFullScreen"&&chrome.tabs.query({active:!0,currentWindow:!0},function(o){let n=o[0];n&&chrome.scripting.executeScript({target:{tabId:n.id},function:g},()=>{chrome.sidePanel.open({windowId:n.windowId}).then(()=>{chrome.sidePanel.setOptions({enabled:!0,path:"sidepanel.html",mobile:!0,active:!0})})})}),!0});function g(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().then(()=>{chrome.runtime.sendMessage({type:"fullScreenDeactivated"})}):document.documentElement.requestFullscreen().then(()=>{chrome.runtime.sendMessage({type:"fullScreenActivated"})}).catch(e=>{console.error(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e));function d(e,t,r){chrome.runtime.sendMessage({type:"updateTabLists",updateType:e,tabId:t,changeInfo:r})}chrome.tabs.onUpdated.addListener((e,t,r)=>{(t.status==="complete"||t.title)&&d("updated",e,{url:r.url,title:r.title})});chrome.tabs.onCreated.addListener(e=>{d("created",e.id,{url:e.url,title:e.title})});chrome.tabs.onRemoved.addListener((e,t)=>{d("removed",e,{})});chrome.tabs.onActivated.addListener(e=>{chrome.tabs.get(e.tabId,t=>{d("activated",t.id,{url:t.url,title:t.title})})});chrome.tabs.onUpdated.addListener(async(e,t,r)=>{await chrome.sidePanel.setOptions({tabId:e,path:"src/pages/sidepanel/index.html",enabled:!0}),d("updated",e,{url:r.url,title:r.title})});function v(e){console.log("Updating tab order:",e),chrome.windows.getCurrent({populate:!0},function(t){const r=t.tabs,i=new Map(r.map((a,o)=>[a.id,o]));e.forEach((a,o)=>{const n=i.get(parseInt(a));n!==void 0&&n!==o&&chrome.tabs.move(parseInt(a),{index:o},l=>{chrome.runtime.lastError?console.error(`Error moving tab ${a}: ${chrome.runtime.lastError.message}`):console.log(`Moved tab ${a} to index ${o}`)})}),setTimeout(()=>{console.log("Tab reordering complete"),chrome.runtime.sendMessage({type:"tabReorderComplete"})},500)})}
