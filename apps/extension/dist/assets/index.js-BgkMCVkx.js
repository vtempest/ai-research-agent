var hd=Object.defineProperty;var fd=(r,e,t)=>e in r?hd(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var w=(r,e,t)=>fd(r,typeof e!="symbol"?e+"":e,t);import{s as pd,g as sn,e as md}from"./_commonjsHelpers-DbgfNesX.js";import{J as Ot,K as Ct,L as Rt,M as kt,N as gt,O as $t,P as Be,cH as gd,aU as Ye,cI as yd,aS as cr,bT as _d,c6 as vd,cJ as sl,bS as wd,bf as bd,bi as al,cK as ui,ba as Ed,c5 as Td,$ as Sd,R as xd,U as fs,ac as Id,ad as Ad,a0 as Od,X as $r,V as pn,t as mn,W as Cd,g as Oe,a4 as Pt,_ as we,ai as Dr,a9 as st,a3 as De,u as Hi,a6 as gn,a2 as Rd,ab as kd}from"./api-BS-Ti-VQ.js";import"./marked.esm-YAkW4s6j.js";function $d(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M12 8V4H8"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}],["path",{d:"M2 14h2"}],["path",{d:"M20 14h2"}],["path",{d:"M15 13v2"}],["path",{d:"M9 13v2"}]];Ct(r,Rt({name:"bot"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Nd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"m15 18-6-6 6-6"}]];Ct(r,Rt({name:"chevron-left"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Pd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"m9 18 6-6-6-6"}]];Ct(r,Rt({name:"chevron-right"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Ld(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]];Ct(r,Rt({name:"circle-x"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Md(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}]];Ct(r,Rt({name:"clipboard"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function jd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21"}],["path",{d:"m5.082 11.09 8.828 8.828"}]];Ct(r,Rt({name:"eraser"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Dd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"m9 11-6 6v3h9l3-3"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"}]];Ct(r,Rt({name:"highlighter"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Fd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]];Ct(r,Rt({name:"image"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Ud(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];Ct(r,Rt({name:"pencil"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}function Bd(r,e){const t=Ot(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20"}]];Ct(r,Rt({name:"underline"},()=>t,{get iconNode(){return n},children:(s,a)=>{var i=kt(),o=gt(i);$t(o,e,"default",{}),Be(s,i)},$$slots:{default:!0}}))}class Vi{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??Ye,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var d,h,f;var n;const s=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.schema;const o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);const c=(h=(d=e._zod).toJSONSchema)==null?void 0:h.call(d);if(c)o.schema=c;else{const m={...t,schemaPath:[...t.schemaPath,e],path:t.path},v=e._zod.parent;if(v)o.ref=v,this.process(v,m),this.seen.get(v).isParent=!0;else{const g=o.schema;switch(s.type){case"string":{const y=g;y.type="string";const{minimum:T,maximum:b,format:A,patterns:x,contentEncoding:I}=e._zod.bag;if(typeof T=="number"&&(y.minLength=T),typeof b=="number"&&(y.maxLength=b),A&&(y.format=a[A]??A,y.format===""&&delete y.format),I&&(y.contentEncoding=I),x&&x.size>0){const P=[...x];P.length===1?y.pattern=P[0].source:P.length>1&&(o.schema.allOf=[...P.map(E=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{const y=g,{minimum:T,maximum:b,format:A,multipleOf:x,exclusiveMaximum:I,exclusiveMinimum:P}=e._zod.bag;typeof A=="string"&&A.includes("int")?y.type="integer":y.type="number",typeof P=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(y.minimum=P,y.exclusiveMinimum=!0):y.exclusiveMinimum=P),typeof T=="number"&&(y.minimum=T,typeof P=="number"&&this.target!=="draft-4"&&(P>=T?delete y.minimum:delete y.exclusiveMinimum)),typeof I=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(y.maximum=I,y.exclusiveMaximum=!0):y.exclusiveMaximum=I),typeof b=="number"&&(y.maximum=b,typeof I=="number"&&this.target!=="draft-4"&&(I<=b?delete y.maximum:delete y.exclusiveMaximum)),typeof x=="number"&&(y.multipleOf=x);break}case"boolean":{const y=g;y.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(g.type="string",g.nullable=!0,g.enum=[null]):g.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{g.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const y=g,{minimum:T,maximum:b}=e._zod.bag;typeof T=="number"&&(y.minItems=T),typeof b=="number"&&(y.maxItems=b),y.type="array",y.items=this.process(s.element,{...m,path:[...m.path,"items"]});break}case"object":{const y=g;y.type="object",y.properties={};const T=s.shape;for(const x in T)y.properties[x]=this.process(T[x],{...m,path:[...m.path,"properties",x]});const b=new Set(Object.keys(T)),A=new Set([...b].filter(x=>{const I=s.shape[x]._zod;return this.io==="input"?I.optin===void 0:I.optout===void 0}));A.size>0&&(y.required=Array.from(A)),((f=s.catchall)==null?void 0:f._zod.def.type)==="never"?y.additionalProperties=!1:s.catchall?s.catchall&&(y.additionalProperties=this.process(s.catchall,{...m,path:[...m.path,"additionalProperties"]})):this.io==="output"&&(y.additionalProperties=!1);break}case"union":{const y=g,T=s.options.map((b,A)=>this.process(b,{...m,path:[...m.path,"anyOf",A]}));y.anyOf=T;break}case"intersection":{const y=g,T=this.process(s.left,{...m,path:[...m.path,"allOf",0]}),b=this.process(s.right,{...m,path:[...m.path,"allOf",1]}),A=I=>"allOf"in I&&Object.keys(I).length===1,x=[...A(T)?T.allOf:[T],...A(b)?b.allOf:[b]];y.allOf=x;break}case"tuple":{const y=g;y.type="array";const T=this.target==="draft-2020-12"?"prefixItems":"items",b=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",A=s.items.map((E,ce)=>this.process(E,{...m,path:[...m.path,T,ce]})),x=s.rest?this.process(s.rest,{...m,path:[...m.path,b,...this.target==="openapi-3.0"?[s.items.length]:[]]}):null;this.target==="draft-2020-12"?(y.prefixItems=A,x&&(y.items=x)):this.target==="openapi-3.0"?(y.items={anyOf:A},x&&y.items.anyOf.push(x),y.minItems=A.length,x||(y.maxItems=A.length)):(y.items=A,x&&(y.additionalItems=x));const{minimum:I,maximum:P}=e._zod.bag;typeof I=="number"&&(y.minItems=I),typeof P=="number"&&(y.maxItems=P);break}case"record":{const y=g;y.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(y.propertyNames=this.process(s.keyType,{...m,path:[...m.path,"propertyNames"]})),y.additionalProperties=this.process(s.valueType,{...m,path:[...m.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const y=g,T=yd(s.entries);T.every(b=>typeof b=="number")&&(y.type="number"),T.every(b=>typeof b=="string")&&(y.type="string"),y.enum=T;break}case"literal":{const y=g,T=[];for(const b of s.values)if(b===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof b=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");T.push(Number(b))}else T.push(b);if(T.length!==0)if(T.length===1){const b=T[0];y.type=b===null?"null":typeof b,this.target==="draft-4"||this.target==="openapi-3.0"?y.enum=[b]:y.const=b}else T.every(b=>typeof b=="number")&&(y.type="number"),T.every(b=>typeof b=="string")&&(y.type="string"),T.every(b=>typeof b=="boolean")&&(y.type="string"),T.every(b=>b===null)&&(y.type="null"),y.enum=T;break}case"file":{const y=g,T={type:"string",format:"binary",contentEncoding:"binary"},{minimum:b,maximum:A,mime:x}=e._zod.bag;b!==void 0&&(T.minLength=b),A!==void 0&&(T.maxLength=A),x?x.length===1?(T.contentMediaType=x[0],Object.assign(y,T)):y.anyOf=x.map(I=>({...T,contentMediaType:I})):Object.assign(y,T);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const y=this.process(s.innerType,m);this.target==="openapi-3.0"?(o.ref=s.innerType,g.nullable=!0):g.anyOf=[y,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,m),o.ref=s.innerType;break}case"success":{const y=g;y.type="boolean";break}case"default":{this.process(s.innerType,m),o.ref=s.innerType,g.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,m),o.ref=s.innerType,this.io==="input"&&(g._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,m),o.ref=s.innerType;let y;try{y=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}g.default=y;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const y=g,T=e._zod.pattern;if(!T)throw new Error("Pattern not found in template literal");y.type="string",y.pattern=T.source;break}case"pipe":{const y=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(y,m),o.ref=y;break}case"readonly":{this.process(s.innerType,m),o.ref=s.innerType,g.readOnly=!0;break}case"promise":{this.process(s.innerType,m),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,m),o.ref=s.innerType;break}case"lazy":{const y=e._zod.innerType;this.process(y,m),o.ref=y;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const l=this.metadataRegistry.get(e);return l&&Object.assign(o.schema,l),this.io==="input"&&Le(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var u,d,h,f,m,v;const n={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=g=>{var x;const y=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const I=(x=n.external.registry.get(g[0]))==null?void 0:x.id,P=n.external.uri??(ce=>ce);if(I)return{ref:P(I)};const E=g[1].defId??g[1].schema.id??`schema${this.counter++}`;return g[1].defId=E,{defId:E,ref:`${P("__shared")}#/${y}/${E}`}}if(g[1]===s)return{ref:"#"};const b=`#/${y}/`,A=g[1].schema.id??`__schema${this.counter++}`;return{defId:A,ref:b+A}},i=g=>{if(g[1].schema.$ref)return;const y=g[1],{ref:T,defId:b}=a(g);y.def={...y.schema},b&&(y.defId=b);const A=y.schema;for(const x in A)delete A[x];A.$ref=T};if(n.cycles==="throw")for(const g of this.seen.entries()){const y=g[1];if(y.cycle)throw new Error(`Cycle detected: #/${(u=y.cycle)==null?void 0:u.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const g of this.seen.entries()){const y=g[1];if(e===g[0]){i(g);continue}if(n.external){const b=(d=n.external.registry.get(g[0]))==null?void 0:d.id;if(e!==g[0]&&b){i(g);continue}}if((h=this.metadataRegistry.get(g[0]))==null?void 0:h.id){i(g);continue}if(y.cycle){i(g);continue}if(y.count>1&&n.reused==="ref"){i(g);continue}}const o=(g,y)=>{const T=this.seen.get(g),b=T.def??T.schema,A={...b};if(T.ref===null)return;const x=T.ref;if(T.ref=null,x){o(x,y);const I=this.seen.get(x).schema;I.$ref&&(y.target==="draft-7"||y.target==="draft-4"||y.target==="openapi-3.0")?(b.allOf=b.allOf??[],b.allOf.push(I)):(Object.assign(b,I),Object.assign(b,A))}T.isParent||this.override({zodSchema:g,jsonSchema:b,path:T.path??[]})};for(const g of[...this.seen.entries()].reverse())o(g[0],{target:this.target});const c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?c.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),(f=n.external)!=null&&f.uri){const g=(m=n.external.registry.get(e))==null?void 0:m.id;if(!g)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(g)}Object.assign(c,s.def);const l=((v=n.external)==null?void 0:v.defs)??{};for(const g of this.seen.entries()){const y=g[1];y.def&&y.defId&&(l[y.defId]=y.def)}n.external||Object.keys(l).length>0&&(this.target==="draft-2020-12"?c.$defs=l:c.definitions=l);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}}function Zi(r,e){if(r instanceof gd){const n=new Vi(e),s={};for(const o of r._idmap.entries()){const[c,l]=o;n.process(l)}const a={},i={registry:r,uri:e==null?void 0:e.uri,defs:s};for(const o of r._idmap.entries()){const[c,l]=o;a[c]=n.emit(l,{...e,external:i})}if(Object.keys(s).length>0){const o=n.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[o]:s}}return{schemas:a}}const t=new Vi(e);return t.process(r),t.emit(r,e)}function Le(r,e){const t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);const s=r._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Le(s.element,t);case"object":{for(const a in s.shape)if(Le(s.shape[a],t))return!0;return!1}case"union":{for(const a of s.options)if(Le(a,t))return!0;return!1}case"intersection":return Le(s.left,t)||Le(s.right,t);case"tuple":{for(const a of s.items)if(Le(a,t))return!0;return!!(s.rest&&Le(s.rest,t))}case"record":return Le(s.keyType,t)||Le(s.valueType,t);case"map":return Le(s.keyType,t)||Le(s.valueType,t);case"set":return Le(s.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Le(s.innerType,t);case"lazy":return Le(s.getter(),t);case"default":return Le(s.innerType,t);case"prefault":return Le(s.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return Le(s.in,t)||Le(s.out,t);case"success":return!1;case"catch":return!1;case"function":return!1}throw new Error(`Unknown schema type: ${s.type}`)}function zd(r,e=!1){var t=pd[0].url;if(r)r=encodeURIComponent(r),chrome?chrome.runtime.sendMessage({type:"openTab",bg:e,url:t+r}):n(t+r,!0);else return;function n(s,a=!1){const i=window.open(s,"_blank");i&&!a&&i.focus()}}function qd(r){var e;return(e=Array.from(r.querySelectorAll("a[href]:has(h3)")))==null?void 0:e.map(t=>{var c,l,u;var n=t.querySelector("h3").textContent.replace(/[\u{0080}-\u{10FFFF}]/gu,""),s=t.closest(".g"),a=(c=s==null?void 0:s.querySelector("span>em"))==null?void 0:c.parentNode;if(a)var i=(u=(l=a==null?void 0:a.textContent)==null?void 0:l.replace(/\.\.\./g,""))==null?void 0:u.replace(/[\u{0080}-\u{10FFFF}]/gu,"").trim();var o=t.getAttribute("href");return o&&o.indexOf("/url?q")>-1&&(o=new URLSearchParams(o.slice(5)).get("q")),{title:n,url:o,snippet:i}})}var Gd=Object.defineProperty,ge=(r,e)=>{for(var t in e)Gd(r,t,{get:e[t],enumerable:!0})};function Re(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function je(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Hd(r){return Re(r)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),je(r)}function an(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(Re(r)||je(r))}function il(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodLiteral"}function ol(r){return Re(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="literal":!1}function Vd(r){return!!(il(r)||ol(r))}async function cl(r,e){if(Re(r))try{return{success:!0,data:await sl(r,e)}}catch(t){return{success:!1,error:t}}if(je(r))return await r.safeParseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function di(r,e){if(Re(r))return await sl(r,e);if(je(r))return await r.parseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Zd(r,e){if(Re(r))try{return{success:!0,data:ui(r,e)}}catch(t){return{success:!1,error:t}}if(je(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Jd(r,e){if(Re(r))return ui(r,e);if(je(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hi(r){var e;if(Re(r))return(e=Ye.get(r))==null?void 0:e.description;if(je(r)||"description"in r&&typeof r.description=="string")return r.description}function Wd(r){if(!an(r))return!1;if(je(r)){const e=r._def;if(e.typeName==="ZodObject"){const t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(Re(r)){const e=r._zod.def;if(e.type==="object"){const t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof r=="object"&&r!==null&&!("shape"in r)}function ll(r){return an(r)?je(r)?r._def.typeName==="ZodString":Re(r)?r._zod.def.type==="string":!1:!1}function fi(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodObject"}function Tt(r){return Re(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function Jn(r){return Re(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function Kd(r){return!!(fi(r)||Tt(r))}function $a(r){if(je(r))return r.shape;if(Re(r))return r._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Yd(r,e){if(je(r))return r.extend(e);if(Re(r))return Ed(r,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Xd(r){if(je(r))return r.partial();if(Re(r))return bd(al,r,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function kn(r,e=!1){if(je(r))return r.strict();if(Tt(r)){const t=r._zod.def.shape;if(e)for(const[a,i]of Object.entries(r._zod.def.shape)){if(Tt(i)){const c=kn(i,e);t[a]=c}else if(Jn(i)){let c=i._zod.def.element;Tt(c)&&(c=kn(c,e)),t[a]=cr(i,{...i._zod.def,element:c})}else t[a]=i;const o=Ye.get(i);o&&Ye.add(t[a],o)}const n=cr(r,{...r._zod.def,shape:t,catchall:_d(vd)}),s=Ye.get(r);return s&&Ye.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Na(r,e=!1){if(fi(r))return r.passthrough();if(Tt(r)){const t=r._zod.def.shape;if(e)for(const[a,i]of Object.entries(r._zod.def.shape)){if(Tt(i)){const c=Na(i,e);t[a]=c}else if(Jn(i)){let c=i._zod.def.element;Tt(c)&&(c=Na(c,e)),t[a]=cr(i,{...i._zod.def,element:c})}else t[a]=i;const o=Ye.get(i);o&&Ye.add(t[a],o)}const n=cr(r,{...r._zod.def,shape:t,catchall:wd(Td)}),s=Ye.get(r);return s&&Ye.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Qd(r){if(je(r))try{const e=r.parse(void 0);return()=>e}catch{return}if(Re(r))try{const e=ui(r,void 0);return()=>e}catch{return}}function eh(r){return je(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function th(r){return Re(r)&&r._zod.def.type==="pipe"}function br(r,e=!1){if(je(r))return eh(r)?br(r._def.schema,e):r;if(Re(r)){let t=r;if(th(r)&&(t=br(r._zod.def.in,e)),e){if(Tt(t)){const s=t._zod.def.shape;for(const[a,i]of Object.entries(t._zod.def.shape))s[a]=br(i,e);t=cr(t,{...t._zod.def,shape:s})}else if(Jn(t)){const s=br(t._zod.def.element,e);t=cr(t,{...t._zod.def,element:s})}}const n=Ye.get(r);return n&&Ye.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function rh(r,e){if(je(r)){const t=$a(r),n={};for(const[s,a]of Object.entries(t))e(s,a)?n[s]=a.optional():n[s]=a;return r.extend(n)}if(Re(r)){const t=$a(r),n={...r._zod.def.shape};for(const[i,o]of Object.entries(t))e(i,o)&&(n[i]=new al({type:"optional",innerType:o}));const s=cr(r,{...r._zod.def,shape:n}),a=Ye.get(r);return a&&Ye.add(s,a),s}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}const nh=Symbol("Let zodToJsonSchema decide on which parser to use"),sh={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},ah=r=>({...sh,...r}),ih=r=>{const e=ah(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}},ul=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function tt(r){if(r.target!=="openAi")return{};const e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?ul(e,r.currentPath):e.join("/")}}function dl(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function _e(r,e,t,n,s){r[e]=t,dl(r,e,n,s)}var he;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(he||(he={}));var Ji;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Ji||(Ji={}));const q=he.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ht=r=>{switch(typeof r){case"undefined":return q.undefined;case"string":return q.string;case"number":return Number.isNaN(r)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(r)?q.array:r===null?q.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?q.promise:typeof Map<"u"&&r instanceof Map?q.map:typeof Set<"u"&&r instanceof Set?q.set:typeof Date<"u"&&r instanceof Date?q.date:q.object;default:return q.unknown}},C=he.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ft extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,c=0;for(;c<i.path.length;){const l=i.path[c];c===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return s(this),n}static assert(e){if(!(e instanceof Ft))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,he.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];t[a]=t[a]||[],t[a].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ft.create=r=>new Ft(r);const Pa=(r,e)=>{let t;switch(r.code){case C.invalid_type:r.received===q.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case C.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,he.jsonStringifyReplacer)}`;break;case C.unrecognized_keys:t=`Unrecognized key(s) in object: ${he.joinValues(r.keys,", ")}`;break;case C.invalid_union:t="Invalid input";break;case C.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${he.joinValues(r.options)}`;break;case C.invalid_enum_value:t=`Invalid enum value. Expected ${he.joinValues(r.options)}, received '${r.received}'`;break;case C.invalid_arguments:t="Invalid function arguments";break;case C.invalid_return_type:t="Invalid function return type";break;case C.invalid_date:t="Invalid date";break;case C.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:he.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case C.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case C.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case C.custom:t="Invalid input";break;case C.invalid_intersection_types:t="Intersection results could not be merged";break;case C.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case C.not_finite:t="Number must be finite";break;default:t=e.defaultError,he.assertNever(r)}return{message:t}};let oh=Pa;function ch(){return oh}const lh=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=n.filter(l=>!!l).slice().reverse();for(const l of c)o=l(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}};function j(r,e){const t=ch(),n=lh({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Pa?void 0:Pa].filter(s=>!!s)});r.common.issues.push(n)}class rt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return re;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return rt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return re;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const re=Object.freeze({status:"aborted"}),zr=r=>({status:"dirty",value:r}),at=r=>({status:"valid",value:r}),Wi=r=>r.status==="aborted",Ki=r=>r.status==="dirty",Sr=r=>r.status==="valid",$n=r=>typeof Promise<"u"&&r instanceof Promise;var H;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(H||(H={}));class Kt{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Yi=(r,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ft(r.common.issues);return this._error=t,this._error}}};function ie(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??t??o.defaultError}},description:s}}class de{get description(){return this._def.description}_getType(e){return Ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new rt,ctx:{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if($n(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Yi(n,s)}"~validate"(e){var n,s;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:t});return Sr(a)?{value:a.value}:{issues:t.common.issues}}catch(a){(s=(n=a==null?void 0:a.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(a=>Sr(a)?{value:a.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await($n(s)?s:Promise.resolve(s));return Yi(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:C.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Ir({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Jt.create(this,this._def)}nullable(){return Ar.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return St.create(this)}promise(){return Mn.create(this,this._def)}or(e){return Pn.create([this,e],this._def)}and(e){return Ln.create(this,e,this._def)}transform(e){return new Ir({...ie(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ja({...ie(this._def),innerType:this,defaultValue:t,typeName:k.ZodDefault})}brand(){return new $h({typeName:k.ZodBranded,type:this,...ie(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Da({...ie(this._def),innerType:this,catchValue:t,typeName:k.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return pi.create(this,e)}readonly(){return Fa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const uh=/^c[^\s-]{8,}$/i,dh=/^[0-9a-z]+$/,hh=/^[0-9A-HJKMNP-TV-Z]{26}$/i,fh=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ph=/^[a-z0-9_-]{21}$/i,mh=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,gh=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,yh=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_h="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ps;const vh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,bh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Eh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Th=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Sh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,hl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",xh=new RegExp(`^${hl}$`);function fl(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Ih(r){return new RegExp(`^${fl(r)}$`)}function Ah(r){let e=`${hl}T${fl(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Oh(r,e){return!!((e==="v4"||!e)&&vh.test(r)||(e==="v6"||!e)&&bh.test(r))}function Ch(r,e){if(!mh.test(r))return!1;try{const[t]=r.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Rh(r,e){return!!((e==="v4"||!e)&&wh.test(r)||(e==="v6"||!e)&&Eh.test(r))}class Vt extends de{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){const a=this._getOrReturnCtx(e);return j(a,{code:C.invalid_type,expected:q.string,received:a.parsedType}),re}const n=new rt;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),j(s,{code:C.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),j(s,{code:C.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?j(s,{code:C.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(s,{code:C.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")yh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"email",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")ps||(ps=new RegExp(_h,"u")),ps.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"emoji",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")fh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"uuid",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")ph.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"nanoid",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")uh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"cuid",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")dh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"cuid2",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")hh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"ulid",code:C.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),j(s,{validation:"url",code:C.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"regex",code:C.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Ah(a).test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?xh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?Ih(a).test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{code:C.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?gh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"duration",code:C.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?Oh(e.data,a.version)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"ip",code:C.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?Ch(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"jwt",code:C.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Rh(e.data,a.version)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"cidr",code:C.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?Th.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"base64",code:C.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?Sh.test(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{validation:"base64url",code:C.invalid_string,message:a.message}),n.dirty()):he.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:C.invalid_string,...H.errToObj(n)})}_addCheck(e){return new Vt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...H.errToObj(e)})}url(e){return this._addCheck({kind:"url",...H.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...H.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...H.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...H.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...H.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...H.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...H.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...H.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...H.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...H.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...H.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...H.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...H.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...H.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...H.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...H.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...H.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...H.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...H.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...H.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...H.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...H.errToObj(t)})}nonempty(e){return this.min(1,H.errToObj(e))}trim(){return new Vt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Vt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Vt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Vt.create=r=>new Vt({checks:[],typeName:k.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...ie(r)});function kh(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=Number.parseInt(r.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}class Wr extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){const a=this._getOrReturnCtx(e);return j(a,{code:C.invalid_type,expected:q.number,received:a.parsedType}),re}let n;const s=new rt;for(const a of this._def.checks)a.kind==="int"?he.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:C.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?kh(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:C.not_finite,message:a.message}),s.dirty()):he.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,H.toString(t))}gt(e,t){return this.setLimit("min",e,!1,H.toString(t))}lte(e,t){return this.setLimit("max",e,!0,H.toString(t))}lt(e,t){return this.setLimit("max",e,!1,H.toString(t))}setLimit(e,t,n,s){return new Wr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:H.toString(s)}]})}_addCheck(e){return new Wr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:H.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:H.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:H.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:H.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:H.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&he.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Wr.create=r=>new Wr({checks:[],typeName:k.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...ie(r)});class Kr extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let n;const s=new rt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),j(n,{code:C.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):he.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return j(t,{code:C.invalid_type,expected:q.bigint,received:t.parsedType}),re}gte(e,t){return this.setLimit("min",e,!0,H.toString(t))}gt(e,t){return this.setLimit("min",e,!1,H.toString(t))}lte(e,t){return this.setLimit("max",e,!0,H.toString(t))}lt(e,t){return this.setLimit("max",e,!1,H.toString(t))}setLimit(e,t,n,s){return new Kr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:H.toString(s)}]})}_addCheck(e){return new Kr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:H.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Kr.create=r=>new Kr({checks:[],typeName:k.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...ie(r)});class Xi extends de{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.boolean,received:n.parsedType}),re}return at(e.data)}}Xi.create=r=>new Xi({typeName:k.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...ie(r)});class Nn extends de{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){const a=this._getOrReturnCtx(e);return j(a,{code:C.invalid_type,expected:q.date,received:a.parsedType}),re}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return j(a,{code:C.invalid_date}),re}const n=new rt;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),j(s,{code:C.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),j(s,{code:C.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):he.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Nn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:H.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:H.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Nn.create=r=>new Nn({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:k.ZodDate,...ie(r)});class Qi extends de{_parse(e){if(this._getType(e)!==q.symbol){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.symbol,received:n.parsedType}),re}return at(e.data)}}Qi.create=r=>new Qi({typeName:k.ZodSymbol,...ie(r)});class eo extends de{_parse(e){if(this._getType(e)!==q.undefined){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.undefined,received:n.parsedType}),re}return at(e.data)}}eo.create=r=>new eo({typeName:k.ZodUndefined,...ie(r)});class to extends de{_parse(e){if(this._getType(e)!==q.null){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.null,received:n.parsedType}),re}return at(e.data)}}to.create=r=>new to({typeName:k.ZodNull,...ie(r)});class La extends de{constructor(){super(...arguments),this._any=!0}_parse(e){return at(e.data)}}La.create=r=>new La({typeName:k.ZodAny,...ie(r)});class ro extends de{constructor(){super(...arguments),this._unknown=!0}_parse(e){return at(e.data)}}ro.create=r=>new ro({typeName:k.ZodUnknown,...ie(r)});class Yt extends de{_parse(e){const t=this._getOrReturnCtx(e);return j(t,{code:C.invalid_type,expected:q.never,received:t.parsedType}),re}}Yt.create=r=>new Yt({typeName:k.ZodNever,...ie(r)});class no extends de{_parse(e){if(this._getType(e)!==q.undefined){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.void,received:n.parsedType}),re}return at(e.data)}}no.create=r=>new no({typeName:k.ZodVoid,...ie(r)});class St extends de{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==q.array)return j(t,{code:C.invalid_type,expected:q.array,received:t.parsedType}),re;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(j(t,{code:i?C.too_big:C.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(j(t,{code:C.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(j(t,{code:C.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new Kt(t,i,t.path,o)))).then(i=>rt.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new Kt(t,i,t.path,o)));return rt.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new St({...this._def,minLength:{value:e,message:H.toString(t)}})}max(e,t){return new St({...this._def,maxLength:{value:e,message:H.toString(t)}})}length(e,t){return new St({...this._def,exactLength:{value:e,message:H.toString(t)}})}nonempty(e){return this.min(1,e)}}St.create=(r,e)=>new St({type:r,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...ie(e)});function vr(r){if(r instanceof ke){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Jt.create(vr(n))}return new ke({...r._def,shape:()=>e})}else return r instanceof St?new St({...r._def,type:vr(r.element)}):r instanceof Jt?Jt.create(vr(r.unwrap())):r instanceof Ar?Ar.create(vr(r.unwrap())):r instanceof lr?lr.create(r.items.map(e=>vr(e))):r}class ke extends de{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=he.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==q.object){const l=this._getOrReturnCtx(e);return j(l,{code:C.invalid_type,expected:q.object,received:l.parsedType}),re}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Yt&&this._def.unknownKeys==="strip"))for(const l in s.data)i.includes(l)||o.push(l);const c=[];for(const l of i){const u=a[l],d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Kt(s,d,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof Yt){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(l==="strict")o.length>0&&(j(s,{code:C.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Kt(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const d=await u.key,h=await u.value;l.push({key:d,value:h,alwaysSet:u.alwaysSet})}return l}).then(l=>rt.mergeObjectSync(n,l)):rt.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return H.errToObj,new ke({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var a,i;const s=((i=(a=this._def).errorMap)==null?void 0:i.call(a,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:H.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new ke({...this._def,unknownKeys:"strip"})}passthrough(){return new ke({...this._def,unknownKeys:"passthrough"})}extend(e){return new ke({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ke({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ke({...this._def,catchall:e})}pick(e){const t={};for(const n of he.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new ke({...this._def,shape:()=>t})}omit(e){const t={};for(const n of he.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new ke({...this._def,shape:()=>t})}deepPartial(){return vr(this)}partial(e){const t={};for(const n of he.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new ke({...this._def,shape:()=>t})}required(e){const t={};for(const n of he.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Jt;)a=a._def.innerType;t[n]=a}return new ke({...this._def,shape:()=>t})}keyof(){return pl(he.objectKeys(this.shape))}}ke.create=(r,e)=>new ke({shape:()=>r,unknownKeys:"strip",catchall:Yt.create(),typeName:k.ZodObject,...ie(e)});ke.strictCreate=(r,e)=>new ke({shape:()=>r,unknownKeys:"strict",catchall:Yt.create(),typeName:k.ZodObject,...ie(e)});ke.lazycreate=(r,e)=>new ke({shape:r,unknownKeys:"strip",catchall:Yt.create(),typeName:k.ZodObject,...ie(e)});class Pn extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new Ft(o.ctx.common.issues));return j(t,{code:C.invalid_union,unionErrors:i}),re}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of n){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new Ft(c));return j(t,{code:C.invalid_union,unionErrors:o}),re}}get options(){return this._def.options}}Pn.create=(r,e)=>new Pn({options:r,typeName:k.ZodUnion,...ie(e)});function Ma(r,e){const t=Ht(r),n=Ht(e);if(r===e)return{valid:!0,data:r};if(t===q.object&&n===q.object){const s=he.objectKeys(e),a=he.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const c=Ma(r[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===q.array&&n===q.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],c=Ma(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===q.date&&n===q.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Ln extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(Wi(a)||Wi(i))return re;const o=Ma(a.value,i.value);return o.valid?((Ki(a)||Ki(i))&&t.dirty(),{status:t.value,value:o.data}):(j(n,{code:C.invalid_intersection_types}),re)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ln.create=(r,e,t)=>new Ln({left:r,right:e,typeName:k.ZodIntersection,...ie(t)});class lr extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.array)return j(n,{code:C.invalid_type,expected:q.array,received:n.parsedType}),re;if(n.data.length<this._def.items.length)return j(n,{code:C.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),re;!this._def.rest&&n.data.length>this._def.items.length&&(j(n,{code:C.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new Kt(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>rt.mergeArray(t,i)):rt.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new lr({...this._def,rest:e})}}lr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new lr({items:r,typeName:k.ZodTuple,rest:null,...ie(e)})};class so extends de{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.map)return j(n,{code:C.invalid_type,expected:q.map,received:n.parsedType}),re;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,c],l)=>({key:s._parse(new Kt(n,o,n.path,[l,"key"])),value:a._parse(new Kt(n,c,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return re;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return re;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}so.create=(r,e,t)=>new so({valueType:e,keyType:r,typeName:k.ZodMap,...ie(t)});class Yr extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.set)return j(n,{code:C.invalid_type,expected:q.set,received:n.parsedType}),re;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(j(n,{code:C.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(j(n,{code:C.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const l=new Set;for(const u of c){if(u.status==="aborted")return re;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((c,l)=>a._parse(new Kt(n,c,n.path,l)));return n.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new Yr({...this._def,minSize:{value:e,message:H.toString(t)}})}max(e,t){return new Yr({...this._def,maxSize:{value:e,message:H.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Yr.create=(r,e)=>new Yr({valueType:r,minSize:null,maxSize:null,typeName:k.ZodSet,...ie(e)});class ao extends de{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ao.create=(r,e)=>new ao({getter:r,typeName:k.ZodLazy,...ie(e)});class io extends de{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return j(t,{received:t.data,code:C.invalid_literal,expected:this._def.value}),re}return{status:"valid",value:e.data}}get value(){return this._def.value}}io.create=(r,e)=>new io({value:r,typeName:k.ZodLiteral,...ie(e)});function pl(r,e){return new xr({values:r,typeName:k.ZodEnum,...ie(e)})}class xr extends de{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return j(t,{expected:he.joinValues(n),received:t.parsedType,code:C.invalid_type}),re}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return j(t,{received:t.data,code:C.invalid_enum_value,options:n}),re}return at(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return xr.create(e,{...this._def,...t})}exclude(e,t=this._def){return xr.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}xr.create=pl;class oo extends de{_parse(e){const t=he.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==q.string&&n.parsedType!==q.number){const s=he.objectValues(t);return j(n,{expected:he.joinValues(s),received:n.parsedType,code:C.invalid_type}),re}if(this._cache||(this._cache=new Set(he.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=he.objectValues(t);return j(n,{received:n.data,code:C.invalid_enum_value,options:s}),re}return at(e.data)}get enum(){return this._def.values}}oo.create=(r,e)=>new oo({values:r,typeName:k.ZodNativeEnum,...ie(e)});class Mn extends de{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==q.promise&&t.common.async===!1)return j(t,{code:C.invalid_type,expected:q.promise,received:t.parsedType}),re;const n=t.parsedType===q.promise?t.data:Promise.resolve(t.data);return at(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Mn.create=(r,e)=>new Mn({type:r,typeName:k.ZodPromise,...ie(e)});class Ir extends de{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{j(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return re;const c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?re:c.status==="dirty"||t.value==="dirty"?zr(c.value):c});{if(t.value==="aborted")return re;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?re:o.status==="dirty"||t.value==="dirty"?zr(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Sr(i))return re;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Sr(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):re);he.assertNever(s)}}Ir.create=(r,e,t)=>new Ir({schema:r,typeName:k.ZodEffects,effect:e,...ie(t)});Ir.createWithPreprocess=(r,e,t)=>new Ir({schema:e,effect:{type:"preprocess",transform:r},typeName:k.ZodEffects,...ie(t)});class Jt extends de{_parse(e){return this._getType(e)===q.undefined?at(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Jt.create=(r,e)=>new Jt({innerType:r,typeName:k.ZodOptional,...ie(e)});class Ar extends de{_parse(e){return this._getType(e)===q.null?at(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ar.create=(r,e)=>new Ar({innerType:r,typeName:k.ZodNullable,...ie(e)});class ja extends de{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===q.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ja.create=(r,e)=>new ja({innerType:r,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ie(e)});class Da extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return $n(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ft(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ft(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Da.create=(r,e)=>new Da({innerType:r,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ie(e)});class co extends de{_parse(e){if(this._getType(e)!==q.nan){const n=this._getOrReturnCtx(e);return j(n,{code:C.invalid_type,expected:q.nan,received:n.parsedType}),re}return{status:"valid",value:e.data}}}co.create=r=>new co({typeName:k.ZodNaN,...ie(r)});class $h extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class pi extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?re:a.status==="dirty"?(t.dirty(),zr(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?re:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new pi({in:e,out:t,typeName:k.ZodPipeline})}}class Fa extends de{_parse(e){const t=this._def.innerType._parse(e),n=s=>(Sr(s)&&(s.value=Object.freeze(s.value)),s);return $n(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Fa.create=(r,e)=>new Fa({innerType:r,typeName:k.ZodReadonly,...ie(e)});var k;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(k||(k={}));const mi=Vt.create,lo=La.create;Yt.create;St.create;const gi=ke.create;Pn.create;Ln.create;lr.create;xr.create;Mn.create;Jt.create;Ar.create;function Nh(r,e){var n,s,a;const t={type:"array"};return(n=r.type)!=null&&n._def&&((a=(s=r.type)==null?void 0:s._def)==null?void 0:a.typeName)!==k.ZodAny&&(t.items=me(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&_e(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&_e(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(_e(t,"minItems",r.exactLength.value,r.exactLength.message,e),_e(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Ph(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?_e(t,"minimum",n.value,n.message,e):_e(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),_e(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?_e(t,"maximum",n.value,n.message,e):_e(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),_e(t,"maximum",n.value,n.message,e));break;case"multipleOf":_e(t,"multipleOf",n.value,n.message,e);break}return t}function Lh(){return{type:"boolean"}}function ml(r,e){return me(r.type._def,e)}const Mh=(r,e)=>me(r.innerType._def,e);function gl(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(s=>gl(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return jh(r,e)}}const jh=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":_e(t,"minimum",n.value,n.message,e);break;case"max":_e(t,"maximum",n.value,n.message,e);break}return t};function Dh(r,e){return{...me(r.innerType._def,e),default:r.defaultValue()}}function Fh(r,e){return e.effectStrategy==="input"?me(r.schema._def,e):tt(e)}function Uh(r){return{type:"string",enum:Array.from(r.values)}}const Bh=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function zh(r,e){const t=[me(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),me(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(Bh(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function qh(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let ms;const ot={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ms===void 0&&(ms=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ms),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function yl(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":_e(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":_e(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ct(t,"email",n.message,e);break;case"format:idn-email":ct(t,"idn-email",n.message,e);break;case"pattern:zod":qe(t,ot.email,n.message,e);break}break;case"url":ct(t,"uri",n.message,e);break;case"uuid":ct(t,"uuid",n.message,e);break;case"regex":qe(t,n.regex,n.message,e);break;case"cuid":qe(t,ot.cuid,n.message,e);break;case"cuid2":qe(t,ot.cuid2,n.message,e);break;case"startsWith":qe(t,RegExp(`^${gs(n.value,e)}`),n.message,e);break;case"endsWith":qe(t,RegExp(`${gs(n.value,e)}$`),n.message,e);break;case"datetime":ct(t,"date-time",n.message,e);break;case"date":ct(t,"date",n.message,e);break;case"time":ct(t,"time",n.message,e);break;case"duration":ct(t,"duration",n.message,e);break;case"length":_e(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),_e(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":qe(t,RegExp(gs(n.value,e)),n.message,e);break;case"ip":n.version!=="v6"&&ct(t,"ipv4",n.message,e),n.version!=="v4"&&ct(t,"ipv6",n.message,e);break;case"base64url":qe(t,ot.base64url,n.message,e);break;case"jwt":qe(t,ot.jwt,n.message,e);break;case"cidr":n.version!=="v6"&&qe(t,ot.ipv4Cidr,n.message,e),n.version!=="v4"&&qe(t,ot.ipv6Cidr,n.message,e);break;case"emoji":qe(t,ot.emoji(),n.message,e);break;case"ulid":qe(t,ot.ulid,n.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":ct(t,"binary",n.message,e);break;case"contentEncoding:base64":_e(t,"contentEncoding","base64",n.message,e);break;case"pattern:zod":qe(t,ot.base64,n.message,e);break}break;case"nanoid":qe(t,ot.nanoid,n.message,e);break}return t}function gs(r,e){return e.patternStrategy==="escape"?Hh(r):r}const Gh=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Hh(r){let e="";for(let t=0;t<r.length;t++)Gh.has(r[t])||(e+="\\"),e+=r[t];return e}function ct(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):_e(r,"format",e,t,n)}function qe(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:uo(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):_e(r,"pattern",uo(e,n),t,n)}function uo(r,e){var c;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",a=!1,i=!1,o=!1;for(let l=0;l<n.length;l++){if(a){s+=n[l],a=!1;continue}if(t.i){if(i){if(n[l].match(/[a-z]/)){o?(s+=n[l],s+=`${n[l-2]}-${n[l]}`.toUpperCase(),o=!1):n[l+1]==="-"&&((c=n[l+2])!=null&&c.match(/[a-z]/))?(s+=n[l],o=!0):s+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){s+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(t.m){if(n[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[l]==="."){s+=i?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}s+=n[l],n[l]==="\\"?a=!0:i&&n[l]==="]"?i=!1:!i&&n[l]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function _l(r,e){var n,s,a,i,o,c;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===k.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((l,u)=>({...l,[u]:me(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??tt(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:me(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===k.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const{type:l,...u}=yl(r.keyType._def,e);return{...t,propertyNames:u}}else{if(((i=r.keyType)==null?void 0:i._def.typeName)===k.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===k.ZodBranded&&r.keyType._def.type._def.typeName===k.ZodString&&((c=r.keyType._def.type._def.checks)!=null&&c.length)){const{type:l,...u}=ml(r.keyType._def,e);return{...t,propertyNames:u}}}return t}function Vh(r,e){if(e.mapStrategy==="record")return _l(r,e);const t=me(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||tt(e),n=me(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||tt(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Zh(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function Jh(r){return r.target==="openAi"?void 0:{not:tt({...r,currentPath:[...r.currentPath,"not"]})}}function Wh(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const jn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Kh(r,e){if(e.target==="openApi3")return ho(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in jn&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=jn[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":return a._def.value===null?[...s,"null"]:s;case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return ho(r,e)}const ho=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>me(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Yh(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:jn[r.innerType._def.typeName],nullable:!0}:{type:[jn[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=me(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=me(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Xh(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",dl(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?_e(t,"minimum",n.value,n.message,e):_e(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),_e(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?_e(t,"maximum",n.value,n.message,e):_e(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),_e(t,"maximum",n.value,n.message,e));break;case"multipleOf":_e(t,"multipleOf",n.value,n.message,e);break}return t}function Qh(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],a=r.shape();for(const o in a){let c=a[o];if(c===void 0||c._def===void 0)continue;let l=tf(c);l&&t&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),l=!1);const u=me(c._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(n.properties[o]=u,l||s.push(o))}s.length&&(n.required=s);const i=ef(r,e);return i!==void 0&&(n.additionalProperties=i),n}function ef(r,e){if(r.catchall._def.typeName!=="ZodNever")return me(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function tf(r){try{return r.isOptional()}catch{return!0}}const rf=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return me(r.innerType._def,e);const t=me(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:tt(e)},t]}:tt(e)},nf=(r,e)=>{if(e.pipeStrategy==="input")return me(r.in._def,e);if(e.pipeStrategy==="output")return me(r.out._def,e);const t=me(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=me(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function sf(r,e){return me(r.type._def,e)}function af(r,e){const n={type:"array",uniqueItems:!0,items:me(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&_e(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&_e(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function of(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>me(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:me(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>me(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function cf(r){return{not:tt(r)}}function lf(r){return tt(r)}const uf=(r,e)=>me(r.innerType._def,e),df=(r,e,t)=>{switch(e){case k.ZodString:return yl(r,t);case k.ZodNumber:return Xh(r,t);case k.ZodObject:return Qh(r,t);case k.ZodBigInt:return Ph(r,t);case k.ZodBoolean:return Lh();case k.ZodDate:return gl(r,t);case k.ZodUndefined:return cf(t);case k.ZodNull:return Wh(t);case k.ZodArray:return Nh(r,t);case k.ZodUnion:case k.ZodDiscriminatedUnion:return Kh(r,t);case k.ZodIntersection:return zh(r,t);case k.ZodTuple:return of(r,t);case k.ZodRecord:return _l(r,t);case k.ZodLiteral:return qh(r,t);case k.ZodEnum:return Uh(r);case k.ZodNativeEnum:return Zh(r);case k.ZodNullable:return Yh(r,t);case k.ZodOptional:return rf(r,t);case k.ZodMap:return Vh(r,t);case k.ZodSet:return af(r,t);case k.ZodLazy:return()=>r.getter()._def;case k.ZodPromise:return sf(r,t);case k.ZodNaN:case k.ZodNever:return Jh(t);case k.ZodEffects:return Fh(r,t);case k.ZodAny:return tt(t);case k.ZodUnknown:return lf(t);case k.ZodDefault:return Dh(r,t);case k.ZodBranded:return ml(r,t);case k.ZodReadonly:return uf(r,t);case k.ZodCatch:return Mh(r,t);case k.ZodPipeline:return nf(r,t);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(n=>{})()}};function me(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const c=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(c!==nh)return c}if(n&&!t){const c=hf(n,e);if(c!==void 0)return c}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=df(r,r.typeName,e),i=typeof a=="function"?me(a(),e):a;if(i&&ff(r,e,i),e.postProcess){const c=e.postProcess(i,r,e);return s.jsonSchema=i,c}return s.jsonSchema=i,i}const hf=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:ul(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),tt(e)):e.$refStrategy==="seen"?tt(e):void 0}},ff=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),pf=(r,e)=>{const t=ih(e);let n;const s=e==null?void 0:e.name,a=me(r._def,t,!1)??tt(t);t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const i=s===void 0?n?{...a,[t.definitionPath]:n}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:a}};return t.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function ar(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!ar(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!ar(r[i],e[i]))return!1;return!0}return r===e}function ut(r){return encodeURI(mf(r))}function mf(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}const gf={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},yf={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},_f={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let vf=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Zt(r,e=Object.create(null),t=vf,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){const a=r.$id||r.id;if(a){const i=new URL(a,t.href);i.hash.length>1?e[i.href]=r:(i.hash="",n===""?t=i:Zt(r,e,t))}}else if(r!==!0&&r!==!1)return e;const s=t.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:s}),r.$ref&&r.__absolute_ref__===void 0){const a=new URL(r.$ref,t.href);a.hash=a.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:a.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){const a=new URL(r.$recursiveRef,t.href);a.hash=a.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:a.href})}if(r.$anchor){const a=new URL("#"+r.$anchor,t.href);e[a.href]=r}for(let a in r){if(_f[a])continue;const i=`${n}/${ut(a)}`,o=r[a];if(Array.isArray(o)){if(gf[a]){const c=o.length;for(let l=0;l<c;l++)Zt(o[l],e,t,`${i}/${l}`)}}else if(yf[a])for(let c in o)Zt(o[c],e,t,`${i}/${ut(c)}`);else Zt(o,e,t,i)}return e}const wf=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,bf=[0,31,28,31,30,31,30,31,31,30,31,30,31],Ef=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Tf=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Sf=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,xf=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,If=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Af=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Of=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Cf=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Rf=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,kf=r=>{if(r[0]==='"')return!1;const[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},$f=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Nf=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,Pf=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function bt(r){return r.test.bind(r)}const fo={date:vl,time:wl.bind(void 0,!1),"date-time":jf,duration:Pf,uri:Uf,"uri-reference":bt(Sf),"uri-template":bt(xf),url:bt(If),email:kf,hostname:bt(Tf),ipv4:bt($f),ipv6:bt(Nf),regex:zf,uuid:bt(Af),"json-pointer":bt(Of),"json-pointer-uri-fragment":bt(Cf),"relative-json-pointer":bt(Rf)};function Lf(r){return r%4===0&&(r%100!==0||r%400===0)}function vl(r){const e=r.match(wf);if(!e)return!1;const t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&Lf(t)?29:bf[n])}function wl(r,e){const t=e.match(Ef);if(!t)return!1;const n=+t[1],s=+t[2],a=+t[3],i=!!t[5];return(n<=23&&s<=59&&a<=59||n==23&&s==59&&a==60)&&(!r||i)}const Mf=/t|\s/i;function jf(r){const e=r.split(Mf);return e.length==2&&vl(e[0])&&wl(!0,e[1])}const Df=/\/|:/,Ff=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Uf(r){return Df.test(r)&&Ff.test(r)}const Bf=/[^\\]\\Z/;function zf(r){if(Bf.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function qf(r){let e=0,t=r.length,n=0,s;for(;n<t;)e++,s=r.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=r.charCodeAt(n),(s&64512)==56320&&n++);return e}function xe(r,e,t="2019-09",n=Zt(e),s=!0,a=null,i="#",o="#",c=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};const l=typeof r;let u;switch(l){case"boolean":case"number":case"string":u=l;break;case"object":r===null?u="null":Array.isArray(r)?u="array":u="object";break;default:throw new Error(`Instances of "${l}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:m,const:v,enum:g,required:y,not:T,anyOf:b,allOf:A,oneOf:x,if:I,then:P,else:E,format:ce,properties:be,patternProperties:oe,additionalProperties:Ne,unevaluatedProperties:it,minProperties:N,maxProperties:$,propertyNames:R,dependentRequired:z,dependentSchemas:G,dependencies:U,prefixItems:Z,items:ne,additionalItems:ee,unevaluatedItems:ue,contains:Ee,minContains:le,maxContains:_,minItems:p,maxItems:O,uniqueItems:S,minimum:ae,maximum:ye,exclusiveMinimum:ve,exclusiveMaximum:Te,multipleOf:Pe,minLength:Xe,maxLength:Se,pattern:Ze,__absolute_ref__:vt,__absolute_recursive_ref__:gr}=e,M=[];if(f===!0&&a===null&&(a=e),h==="#"){const K=a===null?n[gr]:a,V=`${o}/$recursiveRef`,Q=xe(r,a===null?e:a,t,n,s,K,i,V,c);Q.valid||M.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:V,error:"A subschema had errors."},...Q.errors)}if(d!==void 0){const V=n[vt||d];if(V===void 0){let L=`Unresolved $ref "${d}".`;throw vt&&vt!==d&&(L+=`  Absolute URI "${vt}".`),L+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(L)}const Q=`${o}/$ref`,D=xe(r,V,t,n,s,a,i,Q,c);if(D.valid||M.push({instanceLocation:i,keyword:"$ref",keywordLocation:Q,error:"A subschema had errors."},...D.errors),t==="4"||t==="7")return{valid:M.length===0,errors:M}}if(Array.isArray(m)){let K=m.length,V=!1;for(let Q=0;Q<K;Q++)if(u===m[Q]||m[Q]==="integer"&&u==="number"&&r%1===0&&r===r){V=!0;break}V||M.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m.join('", "')}".`})}else m==="integer"?(u!=="number"||r%1||r!==r)&&M.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`}):m!==void 0&&u!==m&&M.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`});if(v!==void 0&&(u==="object"||u==="array"?ar(r,v)||M.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(v)}.`}):r!==v&&M.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(v)}.`})),g!==void 0&&(u==="object"||u==="array"?g.some(K=>ar(r,K))||M.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(K=>r===K)||M.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),T!==void 0){const K=`${o}/not`;xe(r,T,t,n,s,a,i,K).valid&&M.push({instanceLocation:i,keyword:"not",keywordLocation:K,error:'Instance matched "not" schema.'})}let Nt=[];if(b!==void 0){const K=`${o}/anyOf`,V=M.length;let Q=!1;for(let D=0;D<b.length;D++){const L=b[D],X=Object.create(c),Y=xe(r,L,t,n,s,f===!0?a:null,i,`${K}/${D}`,X);M.push(...Y.errors),Q=Q||Y.valid,Y.valid&&Nt.push(X)}Q?M.length=V:M.splice(V,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:K,error:"Instance does not match any subschemas."})}if(A!==void 0){const K=`${o}/allOf`,V=M.length;let Q=!0;for(let D=0;D<A.length;D++){const L=A[D],X=Object.create(c),Y=xe(r,L,t,n,s,f===!0?a:null,i,`${K}/${D}`,X);M.push(...Y.errors),Q=Q&&Y.valid,Y.valid&&Nt.push(X)}Q?M.length=V:M.splice(V,0,{instanceLocation:i,keyword:"allOf",keywordLocation:K,error:"Instance does not match every subschema."})}if(x!==void 0){const K=`${o}/oneOf`,V=M.length,Q=x.filter((D,L)=>{const X=Object.create(c),Y=xe(r,D,t,n,s,f===!0?a:null,i,`${K}/${L}`,X);return M.push(...Y.errors),Y.valid&&Nt.push(X),Y.valid}).length;Q===1?M.length=V:M.splice(V,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:K,error:`Instance does not match exactly one subschema (${Q} matches).`})}if((u==="object"||u==="array")&&Object.assign(c,...Nt),I!==void 0){const K=`${o}/if`;if(xe(r,I,t,n,s,a,i,K,c).valid){if(P!==void 0){const Q=xe(r,P,t,n,s,a,i,`${o}/then`,c);Q.valid||M.push({instanceLocation:i,keyword:"if",keywordLocation:K,error:'Instance does not match "then" schema.'},...Q.errors)}}else if(E!==void 0){const Q=xe(r,E,t,n,s,a,i,`${o}/else`,c);Q.valid||M.push({instanceLocation:i,keyword:"if",keywordLocation:K,error:'Instance does not match "else" schema.'},...Q.errors)}}if(u==="object"){if(y!==void 0)for(const D of y)D in r||M.push({instanceLocation:i,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${D}".`});const K=Object.keys(r);if(N!==void 0&&K.length<N&&M.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${N} properties.`}),$!==void 0&&K.length>$&&M.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${$} properties.`}),R!==void 0){const D=`${o}/propertyNames`;for(const L in r){const X=`${i}/${ut(L)}`,Y=xe(L,R,t,n,s,a,X,D);Y.valid||M.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:D,error:`Property name "${L}" does not match schema.`},...Y.errors)}}if(z!==void 0){const D=`${o}/dependantRequired`;for(const L in z)if(L in r){const X=z[L];for(const Y of X)Y in r||M.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:D,error:`Instance has "${L}" but does not have "${Y}".`})}}if(G!==void 0)for(const D in G){const L=`${o}/dependentSchemas`;if(D in r){const X=xe(r,G[D],t,n,s,a,i,`${L}/${ut(D)}`,c);X.valid||M.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:L,error:`Instance has "${D}" but does not match dependant schema.`},...X.errors)}}if(U!==void 0){const D=`${o}/dependencies`;for(const L in U)if(L in r){const X=U[L];if(Array.isArray(X))for(const Y of X)Y in r||M.push({instanceLocation:i,keyword:"dependencies",keywordLocation:D,error:`Instance has "${L}" but does not have "${Y}".`});else{const Y=xe(r,X,t,n,s,a,i,`${D}/${ut(L)}`);Y.valid||M.push({instanceLocation:i,keyword:"dependencies",keywordLocation:D,error:`Instance has "${L}" but does not match dependant schema.`},...Y.errors)}}}const V=Object.create(null);let Q=!1;if(be!==void 0){const D=`${o}/properties`;for(const L in be){if(!(L in r))continue;const X=`${i}/${ut(L)}`,Y=xe(r[L],be[L],t,n,s,a,X,`${D}/${ut(L)}`);if(Y.valid)c[L]=V[L]=!0;else if(Q=s,M.push({instanceLocation:i,keyword:"properties",keywordLocation:D,error:`Property "${L}" does not match schema.`},...Y.errors),Q)break}}if(!Q&&oe!==void 0){const D=`${o}/patternProperties`;for(const L in oe){const X=new RegExp(L,"u"),Y=oe[L];for(const pe in r){if(!X.test(pe))continue;const wt=`${i}/${ut(pe)}`,yr=xe(r[pe],Y,t,n,s,a,wt,`${D}/${ut(L)}`);yr.valid?c[pe]=V[pe]=!0:(Q=s,M.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:D,error:`Property "${pe}" matches pattern "${L}" but does not match associated schema.`},...yr.errors))}}}if(!Q&&Ne!==void 0){const D=`${o}/additionalProperties`;for(const L in r){if(V[L])continue;const X=`${i}/${ut(L)}`,Y=xe(r[L],Ne,t,n,s,a,X,D);Y.valid?c[L]=!0:(Q=s,M.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:D,error:`Property "${L}" does not match additional properties schema.`},...Y.errors))}}else if(!Q&&it!==void 0){const D=`${o}/unevaluatedProperties`;for(const L in r)if(!c[L]){const X=`${i}/${ut(L)}`,Y=xe(r[L],it,t,n,s,a,X,D);Y.valid?c[L]=!0:M.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:D,error:`Property "${L}" does not match unevaluated properties schema.`},...Y.errors)}}}else if(u==="array"){O!==void 0&&r.length>O&&M.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${O}).`}),p!==void 0&&r.length<p&&M.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${p}).`});const K=r.length;let V=0,Q=!1;if(Z!==void 0){const D=`${o}/prefixItems`,L=Math.min(Z.length,K);for(;V<L;V++){const X=xe(r[V],Z[V],t,n,s,a,`${i}/${V}`,`${D}/${V}`);if(c[V]=!0,!X.valid&&(Q=s,M.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:D,error:"Items did not match schema."},...X.errors),Q))break}}if(ne!==void 0){const D=`${o}/items`;if(Array.isArray(ne)){const L=Math.min(ne.length,K);for(;V<L;V++){const X=xe(r[V],ne[V],t,n,s,a,`${i}/${V}`,`${D}/${V}`);if(c[V]=!0,!X.valid&&(Q=s,M.push({instanceLocation:i,keyword:"items",keywordLocation:D,error:"Items did not match schema."},...X.errors),Q))break}}else for(;V<K;V++){const L=xe(r[V],ne,t,n,s,a,`${i}/${V}`,D);if(c[V]=!0,!L.valid&&(Q=s,M.push({instanceLocation:i,keyword:"items",keywordLocation:D,error:"Items did not match schema."},...L.errors),Q))break}if(!Q&&ee!==void 0){const L=`${o}/additionalItems`;for(;V<K;V++){const X=xe(r[V],ee,t,n,s,a,`${i}/${V}`,L);c[V]=!0,X.valid||(Q=s,M.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:L,error:"Items did not match additional items schema."},...X.errors))}}}if(Ee!==void 0)if(K===0&&le===void 0)M.push({instanceLocation:i,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(le!==void 0&&K<le)M.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${K}) than minContains (${le}).`});else{const D=`${o}/contains`,L=M.length;let X=0;for(let Y=0;Y<K;Y++){const pe=xe(r[Y],Ee,t,n,s,a,`${i}/${Y}`,D);pe.valid?(c[Y]=!0,X++):M.push(...pe.errors)}X>=(le||0)&&(M.length=L),le===void 0&&_===void 0&&X===0?M.splice(L,0,{instanceLocation:i,keyword:"contains",keywordLocation:D,error:"Array does not contain item matching schema."}):le!==void 0&&X<le?M.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${le} items matching schema. Only ${X} items were found.`}):_!==void 0&&X>_&&M.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${_} items matching schema. ${X} items were found.`})}if(!Q&&ue!==void 0){const D=`${o}/unevaluatedItems`;for(V;V<K;V++){if(c[V])continue;const L=xe(r[V],ue,t,n,s,a,`${i}/${V}`,D);c[V]=!0,L.valid||M.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:D,error:"Items did not match unevaluated items schema."},...L.errors)}}if(S)for(let D=0;D<K;D++){const L=r[D],X=typeof L=="object"&&L!==null;for(let Y=0;Y<K;Y++){if(D===Y)continue;const pe=r[Y];(L===pe||X&&(typeof pe=="object"&&pe!==null)&&ar(L,pe))&&(M.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${D} and ${Y}.`}),D=Number.MAX_SAFE_INTEGER,Y=Number.MAX_SAFE_INTEGER)}}}else if(u==="number"){if(t==="4"?(ae!==void 0&&(ve===!0&&r<=ae||r<ae)&&M.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${ve?"or equal to ":""} ${ae}.`}),ye!==void 0&&(Te===!0&&r>=ye||r>ye)&&M.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Te?"or equal to ":""} ${ye}.`})):(ae!==void 0&&r<ae&&M.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${ae}.`}),ye!==void 0&&r>ye&&M.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${ye}.`}),ve!==void 0&&r<=ve&&M.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${ve}.`}),Te!==void 0&&r>=Te&&M.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${Te}.`})),Pe!==void 0){const K=r%Pe;Math.abs(0-K)>=11920929e-14&&Math.abs(Pe-K)>=11920929e-14&&M.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${Pe}.`})}}else if(u==="string"){const K=Xe===void 0&&Se===void 0?0:qf(r);Xe!==void 0&&K<Xe&&M.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${K} < ${Xe}).`}),Se!==void 0&&K>Se&&M.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${K} > ${Se}).`}),Ze!==void 0&&!new RegExp(Ze,"u").test(r)&&M.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),ce!==void 0&&fo[ce]&&!fo[ce](r)&&M.push({instanceLocation:i,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${ce}".`})}return{valid:M.length===0,errors:M}}class Gf{constructor(e,t="2019-09",n=!0){w(this,"schema");w(this,"draft");w(this,"shortCircuit");w(this,"lookup");this.schema=e,this.draft=t,this.shortCircuit=n,this.lookup=Zt(e)}validate(e){return xe(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),Zt(e,this.lookup)}}var Hf={};ge(Hf,{Validator:()=>Gf,deepCompareStrict:()=>ar,toJsonSchema:()=>Nr,validatesOnlyStrings:()=>On});function Nr(r){if(Re(r)){const e=br(r,!0);if(Tt(e)){const t=kn(e,!0);return Zi(t)}else return Zi(r)}return je(r)?pf(r):r}function On(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>On(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){const e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>On(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){const e=r.$ref,t=Zt(r);return t[e]?On(t[e]):!1}return!1}function Xt(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function yi(r){return Xt(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function _i(r){return Xt(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function Vf(r){return Xt(r)&&r.source_type==="text"&&"text"in r&&typeof r.text=="string"}function bl(r){return Xt(r)&&r.source_type==="id"&&"id"in r&&typeof r.id=="string"}function El(r){if(Xt(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function Zf(r){const e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);const t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);const s={};for(const a of r.split(";").slice(1)){const i=a.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);const o=i[0].trim(),c=i[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);s[o]=c}return{type:t,subtype:n,parameters:s}}function Ua({dataUrl:r,asTypedArray:e=!1}){const t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(t){n=t[1].toLowerCase();const s=e?Uint8Array.from(atob(t[2]),a=>a.charCodeAt(0)):t[2];return{mime_type:n,data:s}}}function Jf(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}var ys,po;function Wf(){return po||(po=1,ys=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),ys}var Kf=Wf();const Yf=sn(Kf);var yn={exports:{}},mo;function Xf(){if(mo)return yn.exports;mo=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),c=(h,f,m)=>{let v=!1,g=!1,y=!1;for(let T=0;T<h.length;T++){const b=h[T];v&&r.test(b)?(h=h.slice(0,T)+"-"+h.slice(T),v=!1,y=g,g=!0,T++):g&&y&&e.test(b)?(h=h.slice(0,T-1)+"-"+h.slice(T-1),y=g,g=!1,v=!0):(v=f(b)===b&&m(b)!==b,y=g,g=m(b)===b&&f(b)!==b)}return h},l=(h,f)=>(t.lastIndex=0,h.replace(t,m=>f(m))),u=(h,f)=>(i.lastIndex=0,o.lastIndex=0,h.replace(i,(m,v)=>f(v)).replace(o,m=>f(m))),d=(h,f)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(h)?h=h.map(y=>y.trim()).filter(y=>y.length).join("-"):h=h.trim(),h.length===0)return"";const m=f.locale===!1?y=>y.toLowerCase():y=>y.toLocaleLowerCase(f.locale),v=f.locale===!1?y=>y.toUpperCase():y=>y.toLocaleUpperCase(f.locale);return h.length===1?f.pascalCase?v(h):m(h):(h!==m(h)&&(h=c(h,m,v)),h=h.replace(a,""),f.preserveConsecutiveUppercase?h=l(h,m):h=m(h),f.pascalCase&&(h=v(h.charAt(0))+h.slice(1)),u(h,v))};return yn.exports=d,yn.exports.default=d,yn.exports}Xf();function Qf(r,e){return(e==null?void 0:e[r])||Yf(r)}function ep(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}var tp={};ge(tp,{Serializable:()=>Or,get_lc_unique_name:()=>vi});function go(r){return Array.isArray(r)?[...r]:{...r}}function rp(r,e){const t=go(r);for(const[n,s]of Object.entries(e)){const[a,...i]=n.split(".").reverse();let o=t;for(const c of i.reverse()){if(o[c]===void 0)break;o[c]=go(o[c]),o=o[c]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function vi(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Or=class Tl{constructor(e,...t){w(this,"lc_serializable",!1);w(this,"lc_kwargs");this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,vi(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Tl||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=n;const[o,...c]=s.split(".").reverse();for(const l of c.reverse()){if(!(l in a)||a[l]===void 0)return;(!(l in i)||i[l]===void 0)&&(typeof a[l]=="object"&&a[l]!=null?i[l]={}:Array.isArray(a[l])&&(i[l]=[])),a=a[l],i=i[l]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:ep(Object.keys(t).length?rp(n,t):n,Qf,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function W(r,e){return te(r)&&r.type===e}function te(r){return typeof r=="object"&&r!==null}function xt(r){return Array.isArray(r)}function F(r){return typeof r=="string"}function dt(r){return typeof r=="number"}function wi(r){return r instanceof Uint8Array}function yo(r){try{return JSON.parse(r)}catch{return}}const Xr=r=>r();function np(r){if(r.type==="char_location"&&F(r.document_title)&&dt(r.start_char_index)&&dt(r.end_char_index)&&F(r.cited_text)){const{document_title:e,start_char_index:t,end_char_index:n,cited_text:s,...a}=r;return{...a,type:"citation",source:"char",title:e??void 0,startIndex:t,endIndex:n,citedText:s}}if(r.type==="page_location"&&F(r.document_title)&&dt(r.start_page_number)&&dt(r.end_page_number)&&F(r.cited_text)){const{document_title:e,start_page_number:t,end_page_number:n,cited_text:s,...a}=r;return{...a,type:"citation",source:"page",title:e??void 0,startIndex:t,endIndex:n,citedText:s}}if(r.type==="content_block_location"&&F(r.document_title)&&dt(r.start_block_index)&&dt(r.end_block_index)&&F(r.cited_text)){const{document_title:e,start_block_index:t,end_block_index:n,cited_text:s,...a}=r;return{...a,type:"citation",source:"block",title:e??void 0,startIndex:t,endIndex:n,citedText:s}}if(r.type==="web_search_result_location"&&F(r.url)&&F(r.title)&&F(r.encrypted_index)&&F(r.cited_text)){const{url:e,title:t,encrypted_index:n,cited_text:s,...a}=r;return{...a,type:"citation",source:"url",url:e,title:t,startIndex:Number(n),endIndex:Number(n),citedText:s}}if(r.type==="search_result_location"&&F(r.source)&&F(r.title)&&dt(r.start_block_index)&&dt(r.end_block_index)&&F(r.cited_text)){const{source:e,title:t,start_block_index:n,end_block_index:s,cited_text:a,...i}=r;return{...i,type:"citation",source:"search",url:e,title:t??void 0,startIndex:n,endIndex:s,citedText:a}}}function Sl(r){if(W(r,"document")&&te(r.source)&&"type"in r.source){if(r.source.type==="base64"&&F(r.source.media_type)&&F(r.source.data))return{type:"file",mimeType:r.source.media_type,data:r.source.data};if(r.source.type==="url"&&F(r.source.url))return{type:"file",url:r.source.url};if(r.source.type==="file"&&F(r.source.file_id))return{type:"file",fileId:r.source.file_id};if(r.source.type==="text"&&F(r.source.data))return{type:"file",mimeType:String(r.source.media_type??"text/plain"),data:r.source.data}}else if(W(r,"image")&&te(r.source)&&"type"in r.source){if(r.source.type==="base64"&&F(r.source.media_type)&&F(r.source.data))return{type:"image",mimeType:r.source.media_type,data:r.source.data};if(r.source.type==="url"&&F(r.source.url))return{type:"image",url:r.source.url};if(r.source.type==="file"&&F(r.source.file_id))return{type:"image",fileId:r.source.file_id}}}function sp(r){function*e(){for(const t of r){const n=Sl(t);n?yield n:yield t}}return Array.from(e())}function _o(r){function*e(){var n;const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const s of t){if(W(s,"text")&&F(s.text)){const{text:a,citations:i,...o}=s;if(xt(i)&&i.length){const c=i.reduce((l,u)=>{const d=np(u);return d?[...l,d]:l},[]);yield{...o,type:"text",text:a,annotations:c};continue}else{yield{...o,type:"text",text:a};continue}}else if(W(s,"thinking")&&F(s.thinking)){const{thinking:a,signature:i,...o}=s;yield{...o,type:"reasoning",reasoning:a,signature:i};continue}else if(W(s,"redacted_thinking")){yield{type:"non_standard",value:s};continue}else if(W(s,"tool_use")&&F(s.name)&&F(s.id)){yield{type:"tool_call",id:s.id,name:s.name,args:s.input};continue}else if(W(s,"input_json_delta")){if(ip(r)&&((n=r.tool_call_chunks)!=null&&n.length)){const a=r.tool_call_chunks[0];yield{type:"tool_call_chunk",id:a.id,name:a.name,args:a.args,index:a.index};continue}}else if(W(s,"server_tool_use")&&F(s.name)&&F(s.id)){const{name:a,id:i}=s;if(a==="web_search"){const o=Xr(()=>{if(typeof s.input=="string")return s.input;if(te(s.input)&&F(s.input.query))return s.input.query;if(F(s.partial_json)){const c=yo(s.partial_json);if(c!=null&&c.query)return c.query}return""});yield{id:i,type:"server_tool_call",name:"web_search",args:{query:o}};continue}else if(s.name==="code_execution"){const o=Xr(()=>{if(typeof s.input=="string")return s.input;if(te(s.input)&&F(s.input.code))return s.input.code;if(F(s.partial_json)){const c=yo(s.partial_json);if(c!=null&&c.code)return c.code}return""});yield{id:i,type:"server_tool_call",name:"code_execution",args:{code:o}};continue}}else if(W(s,"web_search_tool_result")&&F(s.tool_use_id)&&xt(s.content)){const{content:a,tool_use_id:i}=s,o=a.reduce((c,l)=>W(l,"web_search_result")?[...c,l.url]:c,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:i,status:"success",output:{urls:o}};continue}else if(W(s,"code_execution_tool_result")&&F(s.tool_use_id)&&te(s.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(W(s,"mcp_tool_use")){yield{id:s.id,type:"server_tool_call",name:"mcp_tool_use",args:s.input};continue}else if(W(s,"mcp_tool_result")&&F(s.tool_use_id)&&te(s.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(W(s,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:s.input};continue}else if(W(s,"search_result")){yield{id:s.id,type:"non_standard",value:s};continue}else if(W(s,"tool_result")){yield{id:s.id,type:"non_standard",value:s};continue}else{const a=Sl(s);if(a){yield a;continue}}yield{type:"non_standard",value:s}}}return Array.from(e())}const ap={translateContent:_o,translateContentChunk:_o};function ip(r){return typeof(r==null?void 0:r._getType)=="function"&&typeof r.concat=="function"&&r._getType()==="ai"}function op(r){return yi(r)?{type:r.type,mimeType:r.mime_type,url:r.url,metadata:r.metadata}:_i(r)?{type:r.type,mimeType:r.mime_type??"application/octet-stream",data:r.data,metadata:r.metadata}:bl(r)?{type:r.type,mimeType:r.mime_type,fileId:r.id,metadata:r.metadata}:r}function cp(r){return r.map(op)}function lp(r){return!!(W(r,"image_url")&&te(r.image_url)||W(r,"input_audio")&&te(r.input_audio)||W(r,"file")&&te(r.file))}function up(r){if(W(r,"image_url")&&te(r.image_url)&&F(r.image_url.url)){const e=Ua({dataUrl:r.image_url.url});return e?{type:"image",mimeType:e.mime_type,data:e.data}:{type:"image",url:r.image_url.url}}else{if(W(r,"input_audio")&&te(r.input_audio)&&F(r.input_audio.data)&&F(r.input_audio.format))return{type:"audio",data:r.input_audio.data,mimeType:`audio/${r.input_audio.format}`};if(W(r,"file")&&te(r.file)&&F(r.file.data)){const e=Ua({dataUrl:r.file.data});if(e)return{type:"file",data:e.data,mimeType:e.mime_type};if(F(r.file.file_id))return{type:"file",fileId:r.file.file_id}}}return r}function dp(r){const e=[];typeof r.content=="string"?e.push({type:"text",text:r.content}):e.push(...bi(r.content));for(const t of r.tool_calls??[])e.push({type:"tool_call",id:t.id,name:t.name,args:t.args});return e}function hp(r){const e=[];typeof r.content=="string"?e.push({type:"text",text:r.content}):e.push(...bi(r.content));for(const t of r.tool_calls??[])e.push({type:"tool_call",id:t.id,name:t.name,args:t.args});return e}function bi(r){const e=[];for(const t of r)lp(t)?e.push(up(t)):e.push(t);return e}function fp(r){if(r.type==="url_citation"){const{url:e,title:t,start_index:n,end_index:s}=r;return{type:"citation",url:e,title:t,startIndex:n,endIndex:s}}if(r.type==="file_citation"){const{file_id:e,filename:t,index:n}=r;return{type:"citation",title:t,startIndex:n,endIndex:n,fileId:e}}return r}function xl(r){function*e(){var n;te((n=r.additional_kwargs)==null?void 0:n.reasoning)&&xt(r.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:r.additional_kwargs.reasoning.summary.reduce((a,i)=>te(i)&&F(i.text)?`${a}${i.text}`:a,"")});const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const s of t)if(W(s,"text")){const{text:a,annotations:i,...o}=s;Array.isArray(i)?yield{...o,type:"text",text:String(a),annotations:i.map(fp)}:yield{...o,type:"text",text:String(a)}}for(const s of r.tool_calls??[])yield{type:"tool_call",id:s.id,name:s.name,args:s.args};if(te(r.additional_kwargs)&&xt(r.additional_kwargs.tool_outputs))for(const s of r.additional_kwargs.tool_outputs){if(W(s,"web_search_call")){yield{id:s.id,type:"server_tool_call",name:"web_search",args:{query:s.query}};continue}else if(W(s,"file_search_call")){yield{id:s.id,type:"server_tool_call",name:"file_search",args:{query:s.query}};continue}else if(W(s,"computer_call")){yield{type:"non_standard",value:s};continue}else if(W(s,"code_interpreter_call")){if(F(s.code)&&(yield{id:s.id,type:"server_tool_call",name:"code_interpreter",args:{code:s.code}}),xt(s.outputs)){const a=Xr(()=>{if(s.status!=="in_progress"){if(s.status==="completed")return 0;if(s.status==="incomplete")return 127;if(s.status!=="interpreting"&&s.status==="failed")return 1}});for(const i of s.outputs)if(W(i,"logs")){yield{type:"server_tool_call_result",toolCallId:s.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:a??0,stderr:[0,void 0].includes(a)?void 0:String(i.logs),stdout:[0,void 0].includes(a)?String(i.logs):void 0}};continue}}continue}else if(W(s,"mcp_call")){yield{id:s.id,type:"server_tool_call",name:"mcp_call",args:s.input};continue}else if(W(s,"mcp_list_tools")){yield{id:s.id,type:"server_tool_call",name:"mcp_list_tools",args:s.input};continue}else if(W(s,"mcp_approval_request")){yield{type:"non_standard",value:s};continue}else if(W(s,"image_generation_call")){yield{type:"non_standard",value:s};continue}te(s)&&(yield{type:"non_standard",value:s})}}return Array.from(e())}function pp(r){function*e(){yield*xl(r);for(const t of r.tool_call_chunks??[])yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args}}return Array.from(e())}const mp={translateContent:r=>typeof r.content=="string"?dp(r):xl(r),translateContentChunk:r=>typeof r.content=="string"?hp(r):pp(r)};function Il(r){return typeof r=="object"&&r!==null&&"type"in r&&"content"in r&&(typeof r.content=="string"||Array.isArray(r.content))}function gp(r,e="pretty"){return e==="pretty"?yp(r):JSON.stringify(r)}function yp(r){const e=[],t=` ${r.type.charAt(0).toUpperCase()+r.type.slice(1)} Message `,n=Math.floor((80-t.length)/2),s="=".repeat(n),a=t.length%2===0?s:`${s}=`;if(e.push(`${s}${t}${a}`),r.type==="ai"){const i=r;if(i.tool_calls&&i.tool_calls.length>0){e.push("Tool Calls:");for(const o of i.tool_calls){e.push(`  ${o.name} (${o.id})`),e.push(` Call ID: ${o.id}`),e.push("  Args:");for(const[c,l]of Object.entries(o.args))e.push(`    ${c}: ${l}`)}}}if(r.type==="tool"){const i=r;i.name&&e.push(`Name: ${i.name}`)}return typeof r.content=="string"&&r.content.trim()&&(e.length>1&&e.push(""),e.push(r.content)),e.join(`
`)}const _s=Symbol.for("langchain.message");function hr(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Xt(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?on(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Xt(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function Al(r,e){return r==="error"||e==="error"?"error":"success"}function _p(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,s+1));const a={};for(const i of Object.keys(n))a[i]=t(n[i],s+1);return a}return JSON.stringify(t(r,0),null,2)}var nl,Bt=class extends Or{constructor(e){const t=typeof e=="string"||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={});super(t);w(this,"lc_namespace",["langchain_core","messages"]);w(this,"lc_serializable",!0);w(this,nl,!0);w(this,"id");w(this,"name");w(this,"content");w(this,"additional_kwargs");w(this,"response_metadata");this.name=t.name,t.content===void 0&&t.contentBlocks!==void 0?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):t.content!==void 0?(this.content=t.content??[],this.response_metadata=t.response_metadata):(this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}_getType(){return this.type}getType(){return this._getType()}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){const e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[cp,bi,sp].reduce((s,a)=>a(s),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&_s in e&&e[_s]===!0&&Il(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[(nl=_s,Symbol.toStringTag)](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=_p(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}toFormattedString(e="pretty"){return gp(this,e)}};function vp(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function ze(r={},e={}){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;["id","name","output_version","model_provider"].includes(n)?t[n]=s:t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=ze(t[n],s);else if(Array.isArray(t[n]))t[n]=on(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function on(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&n!==null&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(a=>{const i=typeof a=="object",o="index"in a&&a.index===n.index,c="id"in a&&"id"in n&&(a==null?void 0:a.id)===(n==null?void 0:n.id),l=!("id"in a)||!(a!=null&&a.id)||!("id"in n)||!(n!=null&&n.id);return i&&o&&(c||l)});s!==-1&&typeof t[s]=="object"&&t[s]!==null?t[s]=ze(t[s],n):t.push(n)}else{if(typeof n=="object"&&n!==null&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function Ol(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return on(r,e);if(typeof r=="object"&&typeof e=="object")return ze(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var fr=class extends Bt{static isInstance(r){return super.isInstance(r)&&"concat"in r&&typeof r.concat=="function"}};function Cl(r){return typeof r.role=="string"}function Mt(r){return typeof(r==null?void 0:r._getType)=="function"}function Ei(r){return Mt(r)&&typeof r.concat=="function"}function Ba(r,e=Wn){r=r.trim();const t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const s=n.indexOf("```");let a=n;return s!==-1&&(a=n.substring(0,s)),e(a.trim())}function Wn(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let a of r){if(n)a==='"'&&!s?n=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')n=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}n&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}function Ti(r){switch(r){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function wp(r){if(te(r.document)&&te(r.document.source)){const e=te(r.document)&&F(r.document.format)?r.document.format:"",t=Ti(e);if(te(r.document.source)){if(te(r.document.source.s3Location)&&F(r.document.source.s3Location.uri))return{type:"file",mimeType:t,fileId:r.document.source.s3Location.uri};if(wi(r.document.source.bytes))return{type:"file",mimeType:t,data:r.document.source.bytes};if(F(r.document.source.text))return{type:"file",mimeType:t,data:Buffer.from(r.document.source.text).toString("base64")};if(xt(r.document.source.content)){const n=r.document.source.content.reduce((s,a)=>te(a)&&F(a.text)?s+a.text:s,"");return{type:"file",mimeType:t,data:n}}}}return{type:"non_standard",value:r}}function bp(r){if(W(r,"image")&&te(r.image)){const e=te(r.image)&&F(r.image.format)?r.image.format:"",t=Ti(e);if(te(r.image.source)){if(te(r.image.source.s3Location)&&F(r.image.source.s3Location.uri))return{type:"image",mimeType:t,fileId:r.image.source.s3Location.uri};if(wi(r.image.source.bytes))return{type:"image",mimeType:t,data:r.image.source.bytes}}}return{type:"non_standard",value:r}}function Ep(r){if(W(r,"video")&&te(r.video)){const e=te(r.video)&&F(r.video.format)?r.video.format:"",t=Ti(e);if(te(r.video.source)){if(te(r.video.source.s3Location)&&F(r.video.source.s3Location.uri))return{type:"video",mimeType:t,fileId:r.video.source.s3Location.uri};if(wi(r.video.source.bytes))return{type:"video",mimeType:t,data:r.video.source.bytes}}}return{type:"non_standard",value:r}}function vo(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(W(n,"cache_point")){yield{type:"non_standard",value:n};continue}else if(W(n,"citations_content")&&te(n.citationsContent)){const s=xt(n.citationsContent.content)?n.citationsContent.content.reduce((i,o)=>te(o)&&F(o.text)?i+o.text:i,""):"",a=xt(n.citationsContent.citations)?n.citationsContent.citations.reduce((i,o)=>{if(te(o)){const c=xt(o.sourceContent)?o.sourceContent.reduce((u,d)=>te(d)&&F(d.text)?u+d.text:u,""):"",l=Xr(()=>{if(te(o.location)){const u=o.location.documentChar||o.location.documentPage||o.location.documentChunk;if(te(u))return{source:dt(u.documentIndex)?u.documentIndex.toString():void 0,startIndex:dt(u.start)?u.start:void 0,endIndex:dt(u.end)?u.end:void 0}}return{}});i.push({type:"citation",citedText:c,...l})}return i},[]):[];yield{type:"text",text:s,annotations:a};continue}else if(W(n,"document")&&te(n.document)){yield wp(n);continue}else if(W(n,"guard_content")){yield{type:"non_standard",value:n};continue}else if(W(n,"image")&&te(n.image)){yield bp(n);continue}else if(W(n,"reasoning_content")&&F(n.reasoningText)){yield{type:"reasoning",reasoning:n.reasoningText};continue}else if(W(n,"text")&&F(n.text)){yield{type:"text",text:n.text};continue}else if(W(n,"tool_result")){yield{type:"non_standard",value:n};continue}else{if(W(n,"tool_call"))continue;if(W(n,"video")&&te(n.video)){yield Ep(n);continue}}yield{type:"non_standard",value:n}}}return Array.from(e())}const Tp={translateContent:vo,translateContentChunk:vo};function wo(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(W(n,"text")&&F(n.text)){yield{type:"text",text:n.text};continue}else if(W(n,"inlineData")&&te(n.inlineData)&&F(n.inlineData.mimeType)&&F(n.inlineData.data)){yield{type:"file",mimeType:n.inlineData.mimeType,data:n.inlineData.data};continue}else if(W(n,"functionCall")&&te(n.functionCall)&&F(n.functionCall.name)&&te(n.functionCall.args)){yield{type:"tool_call",id:r.id,name:n.functionCall.name,args:n.functionCall.args};continue}else if(W(n,"functionResponse")){yield{type:"non_standard",value:n};continue}else if(W(n,"fileData")&&te(n.fileData)&&F(n.fileData.mimeType)&&F(n.fileData.fileUri)){yield{type:"file",mimeType:n.fileData.mimeType,fileId:n.fileData.fileUri};continue}else if(W(n,"executableCode")){yield{type:"non_standard",value:n};continue}else if(W(n,"codeExecutionResult")){yield{type:"non_standard",value:n};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const Sp={translateContent:wo,translateContentChunk:wo};function bo(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(W(n,"reasoning")&&F(n.reasoning)){const s=Xr(()=>{var i;const a=t.indexOf(n);if(xt((i=r.additional_kwargs)==null?void 0:i.signatures)&&a>=0)return r.additional_kwargs.signatures.at(a)});F(s)?yield{type:"reasoning",reasoning:n.reasoning,signature:s}:yield{type:"reasoning",reasoning:n.reasoning};continue}else if(W(n,"text")&&F(n.text)){yield{type:"text",text:n.text};continue}else if(W(n,"image_url")){if(F(n.image_url))if(n.image_url.startsWith("data:")){const s=/^data:([^;]+);base64,(.+)$/,a=n.image_url.match(s);a?yield{type:"image",data:a[2],mimeType:a[1]}:yield{type:"image",url:n.image_url}}else yield{type:"image",url:n.image_url};continue}else if(W(n,"media")&&F(n.mimeType)&&F(n.data)){yield{type:"file",mimeType:n.mimeType,data:n.data};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const xp={translateContent:bo,translateContentChunk:bo};globalThis.lc_block_translators_registry??(globalThis.lc_block_translators_registry=new Map([["anthropic",ap],["bedrock-converse",Tp],["google-genai",Sp],["google-vertexai",xp],["openai",mp]]));function Rl(r){return globalThis.lc_block_translators_registry.get(r)}function kl(r,e){return ze(r??{},e??{})}function $l(r,e){const t={};return((r==null?void 0:r.audio)!==void 0||(e==null?void 0:e.audio)!==void 0)&&(t.audio=((r==null?void 0:r.audio)??0)+((e==null?void 0:e.audio)??0)),((r==null?void 0:r.image)!==void 0||(e==null?void 0:e.image)!==void 0)&&(t.image=((r==null?void 0:r.image)??0)+((e==null?void 0:e.image)??0)),((r==null?void 0:r.video)!==void 0||(e==null?void 0:e.video)!==void 0)&&(t.video=((r==null?void 0:r.video)??0)+((e==null?void 0:e.video)??0)),((r==null?void 0:r.document)!==void 0||(e==null?void 0:e.document)!==void 0)&&(t.document=((r==null?void 0:r.document)??0)+((e==null?void 0:e.document)??0)),((r==null?void 0:r.text)!==void 0||(e==null?void 0:e.text)!==void 0)&&(t.text=((r==null?void 0:r.text)??0)+((e==null?void 0:e.text)??0)),t}function Ip(r,e){const t={...$l(r,e)};return((r==null?void 0:r.cache_read)!==void 0||(e==null?void 0:e.cache_read)!==void 0)&&(t.cache_read=((r==null?void 0:r.cache_read)??0)+((e==null?void 0:e.cache_read)??0)),((r==null?void 0:r.cache_creation)!==void 0||(e==null?void 0:e.cache_creation)!==void 0)&&(t.cache_creation=((r==null?void 0:r.cache_creation)??0)+((e==null?void 0:e.cache_creation)??0)),t}function Ap(r,e){const t={...$l(r,e)};return((r==null?void 0:r.reasoning)!==void 0||(e==null?void 0:e.reasoning)!==void 0)&&(t.reasoning=((r==null?void 0:r.reasoning)??0)+((e==null?void 0:e.reasoning)??0)),t}function Nl(r,e){return{input_tokens:((r==null?void 0:r.input_tokens)??0)+((e==null?void 0:e.input_tokens)??0),output_tokens:((r==null?void 0:r.output_tokens)??0)+((e==null?void 0:e.output_tokens)??0),total_tokens:((r==null?void 0:r.total_tokens)??0)+((e==null?void 0:e.total_tokens)??0),input_token_details:Ip(r==null?void 0:r.input_token_details,e==null?void 0:e.input_token_details),output_token_details:Ap(r==null?void 0:r.output_token_details,e==null?void 0:e.output_token_details)}}var Op={};ge(Op,{ToolMessage:()=>Pr,ToolMessageChunk:()=>Kn,defaultToolCallParser:()=>Si,isDirectToolOutput:()=>Pl,isToolMessage:()=>Ll,isToolMessageChunk:()=>Ml});function Pl(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var Pr=class extends Bt{constructor(e,t,n){const s=typeof e=="string"||Array.isArray(e)?{content:e,name:n,tool_call_id:t}:e;super(s);w(this,"lc_direct_tool_output",!0);w(this,"type","tool");w(this,"status");w(this,"tool_call_id");w(this,"metadata");w(this,"artifact");this.tool_call_id=s.tool_call_id,this.artifact=s.artifact,this.status=s.status,this.metadata=s.metadata}static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},Kn=class extends fr{constructor(e){super(e);w(this,"type","tool");w(this,"tool_call_id");w(this,"status");w(this,"artifact");this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){const t=this.constructor;return new t({content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),artifact:Ol(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Al(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function Si(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const a=JSON.parse(n.function.arguments);e.push({name:s||"",args:a||{},id:n.id})}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}function Ll(r){return typeof r=="object"&&r!==null&&"getType"in r&&typeof r.getType=="function"&&r.getType()==="tool"}function Ml(r){return r._getType()==="tool"}var Qt=class extends Bt{constructor(e){var n;let t;if(typeof e=="string"||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const s=(n=t.additional_kwargs)==null?void 0:n.tool_calls,a=t.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){const[i,o]=Si(s);t.tool_calls=i??[],t.invalid_tool_calls=o??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(t.response_metadata!==void 0&&"output_version"in t.response_metadata&&t.response_metadata.output_version==="v1"&&(t.contentBlocks=t.content,t.content=void 0),t.contentBlocks!==void 0){t.contentBlocks.push(...t.tool_calls.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})));const i=t.contentBlocks.filter(o=>o.type==="tool_call").filter(o=>{var c;return!((c=t.tool_calls)!=null&&c.some(l=>l.id===o.id&&l.name===o.name))});i.length>0&&(t.tool_calls=i.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})))}}super(t);w(this,"type","ai");w(this,"tool_calls",[]);w(this,"invalid_tool_calls",[]);w(this,"usage_metadata");typeof t!="string"&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=Rl(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls){const t=this.tool_calls.filter(n=>!e.some(s=>s.id===n.id&&s.name===n.name));e.push(...t.map(n=>({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function xi(r){return r._getType()==="ai"}function za(r){return r._getType()==="ai"}var pr=class extends fr{constructor(e){var n,s;let t;if(typeof e=="string"||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const i=(e.tool_call_chunks??[]).reduce((l,u)=>{const d=l.findIndex(([h])=>"id"in u&&u.id&&"index"in u&&u.index!==void 0?u.id===h.id&&u.index===h.index:"id"in u&&u.id?u.id===h.id:"index"in u&&u.index!==void 0?u.index===h.index:!1);return d!==-1?l[d].push(u):l.push([u]),l},[]),o=[],c=[];for(const l of i){let u=null;const d=((n=l[0])==null?void 0:n.name)??"",h=l.map(v=>v.args||"").join(""),f=h.length?h:"{}",m=(s=l[0])==null?void 0:s.id;try{if(u=Wn(f),!m||u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");o.push({name:d,args:u,id:m,type:"tool_call"})}catch{c.push({name:d,args:f,id:m,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:o,invalid_tool_calls:c,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t);w(this,"type","ai");w(this,"tool_calls",[]);w(this,"invalid_tool_calls",[]);w(this,"tool_call_chunks",[]);w(this,"usage_metadata");this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=Rl(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){const t=this.content.filter(n=>n.type==="tool_call").map(n=>n.id);for(const n of this.tool_calls)n.id&&!t.includes(n.id)&&e.push({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:kl(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const s=on(this.tool_call_chunks,e.tool_call_chunks);s!==void 0&&s.length>0&&(t.tool_call_chunks=s)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(t.usage_metadata=Nl(this.usage_metadata,e.usage_metadata));const n=this.constructor;return new n(t)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}},cn=class jl extends Bt{constructor(t,n){(typeof t=="string"||Array.isArray(t))&&(t={content:t,role:n});super(t);w(this,"type","generic");w(this,"role");this.role=t.role}static lc_name(){return"ChatMessage"}static _chatMessageClass(){return jl}static isInstance(t){return super.isInstance(t)&&t.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Yn=class extends fr{constructor(e,t){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:t});super(e);w(this,"type","generic");w(this,"role");this.role=e.role}static lc_name(){return"ChatMessageChunk"}concat(e){const t=this.constructor;return new t({content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function Cp(r){return r._getType()==="generic"}function Rp(r){return r._getType()==="generic"}var Xn=class extends Bt{constructor(e){super(e);w(this,"type","function");w(this,"name");this.name=e.name}static lc_name(){return"FunctionMessage"}},Qn=class extends fr{constructor(){super(...arguments);w(this,"type","function")}static lc_name(){return"FunctionMessageChunk"}concat(e){const t=this.constructor;return new t({content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function kp(r){return r._getType()==="function"}function $p(r){return r._getType()==="function"}var zt=class extends Bt{constructor(e){super(e);w(this,"type","human")}static lc_name(){return"HumanMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},es=class extends fr{constructor(e){super(e);w(this,"type","human")}static lc_name(){return"HumanMessageChunk"}concat(e){const t=this.constructor;return new t({content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function Np(r){return r.getType()==="human"}function Pp(r){return r.getType()==="human"}var er=class extends Bt{constructor(e){super(e);w(this,"type","system")}static lc_name(){return"SystemMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="system"}},Cr=class extends fr{constructor(e){super(e);w(this,"type","system")}static lc_name(){return"SystemMessageChunk"}concat(e){const t=this.constructor;return new t({content:hr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function Lp(r){return r._getType()==="system"}function Mp(r){return r._getType()==="system"}function Dl(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Fl(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}var jp=class extends Error{constructor(e,t){super(e);w(this,"output");this.output=t}},Dn=class extends Bt{constructor(e){super({...e,content:[]});w(this,"type","remove");w(this,"id");this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}};const Dp=r=>r();function Fp(r){return Fl(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function Up(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function vs(r){let e,t;if(Up(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new zt(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new Qt(t);const a=n.map(Fp);return new Qt({...s,tool_calls:a})}else{if(e==="system")return new er(t);if(e==="developer")return new er({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Pr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});if(e==="remove"&&"id"in t&&typeof t.id=="string")return new Dn({...t,id:t.id});throw Dl(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Hr(r){if(typeof r=="string")return new zt(r);if(Mt(r))return r;if(Array.isArray(r)){const[e,t]=r;return vs({type:e,content:t})}else if(Cl(r)){const{role:e,...t}=r;return vs({...t,type:e})}else return vs(r)}function Ii(r,e="Human",t="AI"){const n=[];for(const s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${a}: ${i}${o}`)}return n.join(`
`)}function Bp(r){if(r.data!==void 0)return r;{const e=r;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function Ai(r){const e=Bp(r);switch(e.type){case"human":return new zt(e.data);case"ai":return new Qt(e.data);case"system":return new er(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new Xn(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new Pr(e.data);case"generic":if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new cn(e.data);default:throw new Error(`Got unexpected type: ${e.type}`)}}function zp(r){return r.map(Ai)}function qp(r){return r.map(e=>e.toDict())}function Fn(r){var t;const e=r._getType();if(e==="human")return new es({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new pr({...n})}else{if(e==="system")return new Cr({...r});if(e==="function")return new Qn({...r});if(cn.isInstance(r))return new Yn({...r});throw new Error("Unknown message type.")}}var ws={},Gp={};ge(Gp,{getEnv:()=>Gl,getEnvironmentVariable:()=>Wt,getRuntimeEnvironment:()=>Hl,isBrowser:()=>Ul,isDeno:()=>ts,isJsDom:()=>zl,isNode:()=>ql,isWebWorker:()=>Bl});const Ul=()=>typeof window<"u"&&typeof window.document<"u",Bl=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",zl=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),ts=()=>typeof Deno<"u",ql=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!ts(),Gl=()=>{let r;return Ul()?r="browser":ql()?r="node":Bl()?r="webworker":zl()?r="jsdom":ts()?r="deno":r="other",r};let bs;function Hl(){return bs===void 0&&(bs={library:"langchain-js",runtime:Gl()}),bs}function Wt(r){try{return typeof process<"u"?ws==null?void 0:ws[r]:ts()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}const Hp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Vr(r){return typeof r=="string"&&Hp.test(r)}function Vp(r){if(!Vr(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Ue=[];for(var Es=0;Es<256;++Es)Ue.push((Es+256).toString(16).slice(1));function Vl(r,e=0){return(Ue[r[e+0]]+Ue[r[e+1]]+Ue[r[e+2]]+Ue[r[e+3]]+"-"+Ue[r[e+4]]+Ue[r[e+5]]+"-"+Ue[r[e+6]]+Ue[r[e+7]]+"-"+Ue[r[e+8]]+Ue[r[e+9]]+"-"+Ue[r[e+10]]+Ue[r[e+11]]+Ue[r[e+12]]+Ue[r[e+13]]+Ue[r[e+14]]+Ue[r[e+15]]).toLowerCase()}var _n,Zp=new Uint8Array(16);function Jp(){if(!_n&&(_n=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _n(Zp)}function Wp(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var Kp="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Yp="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Xp(r,e,t){function n(s,a,i,o){var c;if(typeof s=="string"&&(s=Wp(s)),typeof a=="string"&&(a=Vp(a)),((c=a)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+s.length);if(l.set(a),l.set(s,a.length),l=t(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,i){o=o||0;for(var u=0;u<16;++u)i[o+u]=l[u];return i}return Vl(l)}try{n.name=r}catch{}return n.DNS=Kp,n.URL=Yp,n}var Qp=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Eo={randomUUID:Qp};function He(r,e,t){if(Eo.randomUUID&&!r)return Eo.randomUUID();r=r||{};var n=r.random||(r.rng||Jp)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Vl(n)}function em(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Ts(r,e){return r<<e|r>>>32-e}function tm(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var s=0;s<n.length;++s)r.push(n.charCodeAt(s))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var a=r.length/4+2,i=Math.ceil(a/16),o=new Array(i),c=0;c<i;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=r[c*64+u*4]<<24|r[c*64+u*4+1]<<16|r[c*64+u*4+2]<<8|r[c*64+u*4+3];o[c]=l}o[i-1][14]=(r.length-1)*8/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=(r.length-1)*8&4294967295;for(var d=0;d<i;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=o[d][f];for(var m=16;m<80;++m)h[m]=Ts(h[m-3]^h[m-8]^h[m-14]^h[m-16],1);for(var v=t[0],g=t[1],y=t[2],T=t[3],b=t[4],A=0;A<80;++A){var x=Math.floor(A/20),I=Ts(v,5)+em(x,g,y,T)+b+e[x]+h[A]>>>0;b=T,T=y,y=Ts(g,30)>>>0,g=v,v=I}t[0]=t[0]+v>>>0,t[1]=t[1]+g>>>0,t[2]=t[2]+y>>>0,t[3]=t[3]+T>>>0,t[4]=t[4]+b>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var To=Xp("v5",80,tm),rm={};ge(rm,{BaseCallbackHandler:()=>ln,callbackHandlerPrefersStreaming:()=>Zl,isBaseCallbackHandler:()=>Jl});var nm=class{};function Zl(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var ln=class extends nm{constructor(e){super();w(this,"lc_serializable",!1);w(this,"lc_kwargs");w(this,"ignoreLLM",!1);w(this,"ignoreChain",!1);w(this,"ignoreAgent",!1);w(this,"ignoreRetriever",!1);w(this,"ignoreCustomEvent",!1);w(this,"raiseError",!1);w(this,"awaitHandlers",Wt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false");this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,vi(this.constructor)]}copy(){return new this.constructor(this)}toJSON(){return Or.prototype.toJSON.call(this)}toJSONNotImplemented(){return Or.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ln{constructor(){super();w(this,"name",He());Object.assign(this,e)}}return new t}};const Jl=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},sm="gen_ai.operation.name",am="gen_ai.system",So="gen_ai.request.model",im="gen_ai.response.model",xo="gen_ai.usage.input_tokens",Io="gen_ai.usage.output_tokens",Ao="gen_ai.usage.total_tokens",om="gen_ai.request.max_tokens",cm="gen_ai.request.temperature",lm="gen_ai.request.top_p",um="gen_ai.request.frequency_penalty",dm="gen_ai.request.presence_penalty",hm="gen_ai.response.finish_reasons",fm="gen_ai.prompt",pm="gen_ai.completion",mm="gen_ai.request.extra_query",gm="gen_ai.request.extra_body",ym="gen_ai.serialized.name",_m="gen_ai.serialized.signature",vm="gen_ai.serialized.doc",wm="gen_ai.response.id",bm="gen_ai.response.service_tier",Em="gen_ai.response.system_fingerprint",Tm="gen_ai.usage.input_token_details",Sm="gen_ai.usage.output_token_details",xm="langsmith.trace.session_id",Im="langsmith.trace.session_name",Am="langsmith.span.kind",Om="langsmith.trace.name",Cm="langsmith.metadata",Oo="langsmith.span.tags",Rm="langsmith.request.streaming",km="langsmith.request.headers",$m=(...r)=>fetch(...r),Wl=Symbol.for("ls:fetch_implementation"),Nm=()=>{const r=globalThis[Wl];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},Pm=r=>async(...e)=>{if(r||Ke("DEBUG")==="true"){const[n,s]=e;console.log(` ${(s==null?void 0:s.method)||"GET"} ${n}`)}const t=await(globalThis[Wl]??$m)(...e);return(r||Ke("DEBUG")==="true")&&console.log(` ${t.status} ${t.statusText} ${t.url}`),t},Kl=()=>Ke("PROJECT")??At("LANGCHAIN_SESSION")??"default",Yl="0.3.74";var Zr={};let Et;const Lm=()=>typeof window<"u"&&typeof window.document<"u",Mm=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",jm=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Xl=()=>typeof Deno<"u",Dm=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Xl(),Ql=()=>Et||(typeof Bun<"u"?Et="bun":Lm()?Et="browser":Dm()?Et="node":Mm()?Et="webworker":jm()?Et="jsdom":Xl()?Et="deno":Et="other",Et);let Ss;function eu(){if(Ss===void 0){const r=Ql(),e=Um();Ss={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Yl,...e}}return Ss}function tu(){const r=Fm(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function Fm(){const r={};try{if(typeof process<"u"&&Zr)for(const[e,t]of Object.entries(Zr))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?r[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):r[e]=t)}catch{}return r}function At(r){try{return typeof process<"u"?Zr==null?void 0:Zr[r]:void 0}catch{return}}function Ke(r){return At(`LANGSMITH_${r}`)||At(`LANGCHAIN_${r}`)}let xs;function Um(){if(xs!==void 0)return xs;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=At(t);n!==void 0&&(e[t]=n)}return xs=e,e}function ru(){return At("OTEL_ENABLED")==="true"||Ke("OTEL_ENABLED")==="true"}class Bm{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&ru()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}}class zm{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Bm})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class qm{active(){return{}}with(e,t){return t()}}const Is=Symbol.for("ls:otel_trace"),As=Symbol.for("ls:otel_context"),Co=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Gm=new zm,Hm=new qm;class Vm{getTraceInstance(){return globalThis[Is]??Gm}getContextInstance(){return globalThis[As]??Hm}initializeGlobalInstances(e){globalThis[Is]===void 0&&(globalThis[Is]=e.trace),globalThis[As]===void 0&&(globalThis[As]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Co]=e}getDefaultOTLPTracerComponents(){return globalThis[Co]??void 0}}const Oi=new Vm;function nu(){return Oi.getTraceInstance()}function Zm(){return Oi.getContextInstance()}function Jm(){return Oi.getDefaultOTLPTracerComponents()}const Wm={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function Km(r){return Wm[r]||r}class Ym{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const n of e)try{if(!n.run)continue;if(n.operation==="post"){const s=this.createSpanForRun(n,n.run,t.get(n.id));s&&!n.run.end_time&&this.spans.set(n.id,s)}else this.updateSpanForRun(n,n.run)}catch(s){console.error(`Error processing operation ${n.id}:`,s)}}createSpanForRun(e,t,n){const s=n&&nu().getSpan(n);if(s)try{return this.finishSpanSetup(s,t,e)}catch(a){console.error(`Failed to create span for run ${e.id}:`,a);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{const n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});const s=t.end_time;s&&(n.end(new Date(s)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){var t;if((t=e.extra)!=null&&t.metadata){const n=e.extra.metadata;if(n.ls_model_name)return n.ls_model_name;if(n.invocation_params){const s=n.invocation_params;if(s.model)return s.model;if(s.model_name)return s.model_name}}}setSpanAttributes(e,t,n){var o;if("run_type"in t&&t.run_type){e.setAttribute(Am,t.run_type);const c=Km(t.run_type||"chain");e.setAttribute(sm,c)}"name"in t&&t.name&&e.setAttribute(Om,t.name),"session_id"in t&&t.session_id&&e.setAttribute(xm,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(Im,t.session_name),this.setGenAiSystem(e,t);const s=this.extractModelName(t);s&&e.setAttribute(So,s),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(xo,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(Io,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(Ao,t.total_tokens),this.setInvocationParameters(e,t);const a=((o=t.extra)==null?void 0:o.metadata)||{};for(const[c,l]of Object.entries(a))l!=null&&e.setAttribute(`${Cm}.${c}`,String(l));const i=t.tags;if(i&&Array.isArray(i)?e.setAttribute(Oo,i.join(", ")):i&&e.setAttribute(Oo,String(i)),"serialized"in t&&typeof t.serialized=="object"){const c=t.serialized;c.name&&e.setAttribute(ym,String(c.name)),c.signature&&e.setAttribute(_m,String(c.signature)),c.doc&&e.setAttribute(vm,String(c.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain";const s=this.extractModelName(t);if(s){const a=s.toLowerCase();a.includes("anthropic")||a.startsWith("claude")?n="anthropic":a.includes("bedrock")?n="aws.bedrock":a.includes("azure")&&a.includes("openai")?n="az.ai.openai":a.includes("azure")&&a.includes("inference")?n="az.ai.inference":a.includes("cohere")?n="cohere":a.includes("deepseek")?n="deepseek":a.includes("gemini")?n="gemini":a.includes("groq")?n="groq":a.includes("watson")||a.includes("ibm")?n="ibm.watsonx.ai":a.includes("mistral")?n="mistral_ai":a.includes("gpt")||a.includes("openai")?n="openai":a.includes("perplexity")||a.includes("sonar")?n="perplexity":a.includes("vertex")?n="vertex_ai":(a.includes("xai")||a.includes("grok"))&&(n="xai")}e.setAttribute(am,n)}setInvocationParameters(e,t){var s,a;if(!((a=(s=t.extra)==null?void 0:s.metadata)!=null&&a.invocation_params))return;const n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(om,n.max_tokens),n.temperature!==void 0&&e.setAttribute(cm,n.temperature),n.top_p!==void 0&&e.setAttribute(lm,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(um,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(dm,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(So,n.model),n.stream!==void 0&&e.setAttribute(Rm,n.stream),n.extra_headers&&e.setAttribute(km,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(mm,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(gm,JSON.stringify(n.extra_body))),e.setAttribute(fm,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{const n=t.run.outputs,s=this.getUnifiedRunTokens(n);if(s&&(e.setAttribute(xo,s[0]),e.setAttribute(Io,s[1]),e.setAttribute(Ao,s[0]+s[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(im,String(n.model)),n.id&&e.setAttribute(wm,n.id),n.choices&&Array.isArray(n.choices)){const a=n.choices.map(i=>i.finish_reason).filter(i=>i).map(String);a.length>0&&e.setAttribute(hm,a.join(", "))}if(n.service_tier&&e.setAttribute(bm,n.service_tier),n.system_fingerprint&&e.setAttribute(Em,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){const a=n.usage_metadata;a.input_token_details&&e.setAttribute(Tm,JSON.stringify(a.input_token_details)),a.output_token_details&&e.setAttribute(Sm,JSON.stringify(a.output_token_details))}}e.setAttribute(pm,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const n=Object.keys(e);for(const i of n){const o=e[i];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}const s=e.generations||[];if(!Array.isArray(s))return null;const a=Array.isArray(s[0])?s.flat():s;for(const i of a)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}var Fr={exports:{}},Os={},Cs,Ro;function Xm(){if(Ro)return Cs;Ro=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Cs=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var a=this._errors[s],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=n&&(t=a,n=o)}return t},Cs}var ko;function Qm(){return ko||(ko=1,(function(r){var e=Xm();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<n.retries;i++)a.push(this.createTimeout(i,n));return t&&t.forever&&!a.length&&a.push(this.createTimeout(i,n)),a.sort(function(o,c){return o-c}),a},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,a=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return a=Math.min(a,n.maxTimeout),a},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],c=t[o];t[o]=(function(u){var d=r.operation(n),h=Array.prototype.slice.call(arguments,1),f=h.pop();h.push(function(m){d.retry(m)||(m&&(arguments[0]=d.mainError()),f.apply(this,arguments))}),d.attempt(function(){u.apply(t,h)})}).bind(t,c),t[o].options=n}}})(Os)),Os}var Rs,$o;function eg(){return $o||($o=1,Rs=Qm()),Rs}var No;function tg(){if(No)return Fr.exports;No=1;const r=eg(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(i,o,c)=>{const l=c.retries-(o-1);return i.attemptNumber=o,i.retriesLeft=l,i},s=i=>e.includes(i),a=(i,o)=>new Promise((c,l)=>{o={onFailedAttempt:()=>{},retries:10,...o};const u=r.operation(o);u.attempt(async d=>{try{c(await i(d))}catch(h){if(!(h instanceof Error)){l(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof t)u.stop(),l(h.originalError);else if(h instanceof TypeError&&!s(h.message))u.stop(),l(h);else{n(h,d,o);try{await o.onFailedAttempt(h)}catch(f){l(f);return}u.retry(h)||l(u.mainError())}}})});return Fr.exports=a,Fr.exports.default=a,Fr.exports.AbortError=t,Fr.exports}var rg=tg();const Un=sn(rg);var vn={},ks={exports:{}},Po;function ng(){return Po||(Po=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function a(c,l,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||c,h),m=t?t+l:l;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],f]:c._events[m].push(f):(c._events[m]=f,c._eventsCount++),c}function i(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)e.call(u,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},o.prototype.listeners=function(l){var u=t?t+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,m=new Array(f);h<f;h++)m[h]=d[h].fn;return m},o.prototype.listenerCount=function(l){var u=t?t+l:l,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,u,d,h,f,m){var v=t?t+l:l;if(!this._events[v])return!1;var g=this._events[v],y=arguments.length,T,b;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,m),!0}for(b=1,T=new Array(y-1);b<y;b++)T[b-1]=arguments[b];g.fn.apply(g.context,T)}else{var A=g.length,x;for(b=0;b<A;b++)switch(g[b].once&&this.removeListener(l,g[b].fn,void 0,!0),y){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,h);break;default:if(!T)for(x=1,T=new Array(y-1);x<y;x++)T[x-1]=arguments[x];g[b].fn.apply(g[b].context,T)}}return!0},o.prototype.on=function(l,u,d){return a(this,l,u,d,!1)},o.prototype.once=function(l,u,d){return a(this,l,u,d,!0)},o.prototype.removeListener=function(l,u,d,h){var f=t?t+l:l;if(!this._events[f])return this;if(!u)return i(this,f),this;var m=this._events[f];if(m.fn)m.fn===u&&(!h||m.once)&&(!d||m.context===d)&&i(this,f);else{for(var v=0,g=[],y=m.length;v<y;v++)(m[v].fn!==u||h&&!m[v].once||d&&m[v].context!==d)&&g.push(m[v]);g.length?this._events[f]=g.length===1?g[0]:g:i(this,f)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&i(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(ks)),ks.exports}var Ur={exports:{}},$s,Lo;function sg(){return Lo||(Lo=1,$s=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),$s}var Mo;function ag(){if(Mo)return Ur.exports;Mo=1;const r=sg();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(n);return}const c=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const l=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,u=a instanceof Error?a:new e(l);typeof n.cancel=="function"&&n.cancel(),o(u)},s);r(n.then(i,o),()=>{clearTimeout(c)})});return Ur.exports=t,Ur.exports.default=t,Ur.exports.TimeoutError=e,Ur.exports}var wn={},bn={},jo;function ig(){if(jo)return bn;jo=1,Object.defineProperty(bn,"__esModule",{value:!0});function r(e,t,n){let s=0,a=e.length;for(;a>0;){const i=a/2|0;let o=s+i;n(e[o],t)<=0?(s=++o,a-=i+1):a=i}return s}return bn.default=r,bn}var Do;function og(){if(Do)return wn;Do=1,Object.defineProperty(wn,"__esModule",{value:!0});const r=ig();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=r.default(this._queue,a,(o,c)=>c.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return wn.default=e,wn}var Fo;function cg(){if(Fo)return vn;Fo=1,Object.defineProperty(vn,"__esModule",{value:!0});const r=ng(),e=ag(),t=og(),n=()=>{},s=new e.TimeoutError;class a extends r{constructor(o){var c,l,u,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(l=(c=o.intervalCap)===null||c===void 0?void 0:c.toString())!==null&&l!==void 0?l:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(u=o.interval)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const c=this._intervalEnd-o;if(c<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},c)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const c=this._queue.dequeue();return c?(this.emit("active"),c(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,c={}){return new Promise((l,u)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&c.timeout===void 0?o():e.default(Promise.resolve(o()),c.timeout===void 0?this._timeout:c.timeout,()=>{(c.throwOnTimeout===void 0?this._throwOnTimeout:c.throwOnTimeout)&&u(s)});l(await h)}catch(h){u(h)}this._next()};this._queue.enqueue(d,c),this._tryToStartAnother(),this.emit("add")})}async addAll(o,c){return Promise.all(o.map(async l=>this.add(l,c)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const c=this._resolveEmpty;this._resolveEmpty=()=>{c(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const c=this._resolveIdle;this._resolveIdle=()=>{c(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return vn.default=a,vn}var lg=cg();const jt=sn(lg),ug=[429,500,502,503,504];let Uo=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in jt?this.queue=new jt.default({concurrency:this.maxConcurrency}):this.queue=new jt({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>Un(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.name==="TimeoutError"||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response;if(n&&await n(a))return;const i=(a==null?void 0:a.status)??(s==null?void 0:s.status);if(i&&!ug.includes(+i))throw s},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}};function Bo(r){return typeof(r==null?void 0:r._getType)=="function"}function zo(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}const dg=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function se(r,e){if(!dg.test(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const qo={};function qa(r){qo[r]||(console.warn(r),qo[r]=!0)}var En={exports:{}},Ns,Go;function rs(){if(Go)return Ns;Go=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return Ns={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Ns}var Ps,Ho;function ns(){if(Ho)return Ps;Ho=1;var r={};return Ps=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},Ps}var Vo;function un(){return Vo||(Vo=1,(function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=rs(),a=ns();e=r.exports={};const i=e.re=[],o=e.safeRe=[],c=e.src=[],l=e.safeSrc=[],u=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,n]],m=g=>{for(const[y,T]of f)g=g.split(`${y}*`).join(`${y}{0,${T}}`).split(`${y}+`).join(`${y}{1,${T}}`);return g},v=(g,y,T)=>{const b=m(y),A=d++;a(g,A,y),u[g]=A,c[A]=y,l[A]=b,i[A]=new RegExp(y,T?"g":void 0),o[A]=new RegExp(b,T?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*"),v("NUMERICIDENTIFIERLOOSE","\\d+"),v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),v("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),v("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASEIDENTIFIER",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIER]})`),v("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),v("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),v("BUILDIDENTIFIER",`${h}+`),v("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),v("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),v("FULL",`^${c[u.FULLPLAIN]}$`),v("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),v("LOOSE",`^${c[u.LOOSEPLAIN]}$`),v("GTLT","((?:<|>)?=?)"),v("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),v("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),v("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),v("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),v("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),v("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),v("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),v("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?(?:${c[u.BUILD]})?(?:$|[^\\d])`),v("COERCERTL",c[u.COERCE],!0),v("COERCERTLFULL",c[u.COERCEFULL],!0),v("LONETILDE","(?:~>?)"),v("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",v("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),v("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),v("LONECARET","(?:\\^)"),v("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",v("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),v("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),v("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),v("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),v("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",v("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),v("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),v("STAR","(<|>)?=?\\s*\\*"),v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(En,En.exports)),En.exports}var Ls,Zo;function Ci(){if(Zo)return Ls;Zo=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Ls=n=>n?typeof n!="object"?r:n:e,Ls}var Ms,Jo;function su(){if(Jo)return Ms;Jo=1;const r=/^[0-9]+$/,e=(n,s)=>{const a=r.test(n),i=r.test(s);return a&&i&&(n=+n,s=+s),n===s?0:a&&!i?-1:i&&!a?1:n<s?-1:1};return Ms={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},Ms}var js,Wo;function Ve(){if(Wo)return js;Wo=1;const r=ns(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=rs(),{safeRe:n,t:s}=un(),a=Ci(),{compareIdentifiers:i}=su();class o{constructor(l,u){if(u=a(u),l instanceof o){if(l.loose===!!u.loose&&l.includePrerelease===!!u.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof l}".`);if(l.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",l,u),this.options=u,this.loose=!!u.loose,this.includePrerelease=!!u.includePrerelease;const d=l.trim().match(u.loose?n[s.LOOSE]:n[s.FULL]);if(!d)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const f=+h;if(f>=0&&f<t)return f}return h}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(r("SemVer.compare",this.version,this.options,l),!(l instanceof o)){if(typeof l=="string"&&l===this.version)return 0;l=new o(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof o||(l=new o(l,this.options)),i(this.major,l.major)||i(this.minor,l.minor)||i(this.patch,l.patch)}comparePre(l){if(l instanceof o||(l=new o(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let u=0;do{const d=this.prerelease[u],h=l.prerelease[u];if(r("prerelease compare",u,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d===h)continue;return i(d,h)}while(++u)}compareBuild(l){l instanceof o||(l=new o(l,this.options));let u=0;do{const d=this.build[u],h=l.build[u];if(r("build compare",u,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d===h)continue;return i(d,h)}while(++u)}inc(l,u,d){if(l.startsWith("pre")){if(!u&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(u){const h=`-${u}`.match(this.options.loose?n[s.PRERELEASELOOSE]:n[s.PRERELEASE]);if(!h||h[1]!==u)throw new Error(`invalid identifier: ${u}`)}}switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",u,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",u,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",u,d),this.inc("pre",u,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",u,d),this.inc("pre",u,d);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(d)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let f=this.prerelease.length;for(;--f>=0;)typeof this.prerelease[f]=="number"&&(this.prerelease[f]++,f=-2);if(f===-1){if(u===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(u){let f=[u,h];d===!1&&(f=[u]),i(this.prerelease[0],u)===0?isNaN(this.prerelease[1])&&(this.prerelease=f):this.prerelease=f}break}default:throw new Error(`invalid increment argument: ${l}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return js=o,js}var Ds,Ko;function Lr(){if(Ko)return Ds;Ko=1;const r=Ve();return Ds=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(a){if(!s)return null;throw a}},Ds}var Fs,Yo;function hg(){if(Yo)return Fs;Yo=1;const r=Lr();return Fs=(t,n)=>{const s=r(t,n);return s?s.version:null},Fs}var Us,Xo;function fg(){if(Xo)return Us;Xo=1;const r=Lr();return Us=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Us}var Bs,Qo;function pg(){if(Qo)return Bs;Qo=1;const r=Ve();return Bs=(t,n,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,a,i).version}catch{return null}},Bs}var zs,ec;function mg(){if(ec)return zs;ec=1;const r=Lr();return zs=(t,n)=>{const s=r(t,null,!0),a=r(n,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,c=o?s:a,l=o?a:s,u=!!c.prerelease.length;if(!!l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(l.compareMain(c)===0)return l.minor&&!l.patch?"minor":"patch"}const h=u?"pre":"";return s.major!==a.major?h+"major":s.minor!==a.minor?h+"minor":s.patch!==a.patch?h+"patch":"prerelease"},zs}var qs,tc;function gg(){if(tc)return qs;tc=1;const r=Ve();return qs=(t,n)=>new r(t,n).major,qs}var Gs,rc;function yg(){if(rc)return Gs;rc=1;const r=Ve();return Gs=(t,n)=>new r(t,n).minor,Gs}var Hs,nc;function _g(){if(nc)return Hs;nc=1;const r=Ve();return Hs=(t,n)=>new r(t,n).patch,Hs}var Vs,sc;function vg(){if(sc)return Vs;sc=1;const r=Lr();return Vs=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Vs}var Zs,ac;function yt(){if(ac)return Zs;ac=1;const r=Ve();return Zs=(t,n,s)=>new r(t,s).compare(new r(n,s)),Zs}var Js,ic;function wg(){if(ic)return Js;ic=1;const r=yt();return Js=(t,n,s)=>r(n,t,s),Js}var Ws,oc;function bg(){if(oc)return Ws;oc=1;const r=yt();return Ws=(t,n)=>r(t,n,!0),Ws}var Ks,cc;function Ri(){if(cc)return Ks;cc=1;const r=Ve();return Ks=(t,n,s)=>{const a=new r(t,s),i=new r(n,s);return a.compare(i)||a.compareBuild(i)},Ks}var Ys,lc;function Eg(){if(lc)return Ys;lc=1;const r=Ri();return Ys=(t,n)=>t.sort((s,a)=>r(s,a,n)),Ys}var Xs,uc;function Tg(){if(uc)return Xs;uc=1;const r=Ri();return Xs=(t,n)=>t.sort((s,a)=>r(a,s,n)),Xs}var Qs,dc;function ss(){if(dc)return Qs;dc=1;const r=yt();return Qs=(t,n,s)=>r(t,n,s)>0,Qs}var ea,hc;function ki(){if(hc)return ea;hc=1;const r=yt();return ea=(t,n,s)=>r(t,n,s)<0,ea}var ta,fc;function au(){if(fc)return ta;fc=1;const r=yt();return ta=(t,n,s)=>r(t,n,s)===0,ta}var ra,pc;function iu(){if(pc)return ra;pc=1;const r=yt();return ra=(t,n,s)=>r(t,n,s)!==0,ra}var na,mc;function $i(){if(mc)return na;mc=1;const r=yt();return na=(t,n,s)=>r(t,n,s)>=0,na}var sa,gc;function Ni(){if(gc)return sa;gc=1;const r=yt();return sa=(t,n,s)=>r(t,n,s)<=0,sa}var aa,yc;function ou(){if(yc)return aa;yc=1;const r=au(),e=iu(),t=ss(),n=$i(),s=ki(),a=Ni();return aa=(o,c,l,u)=>{switch(c){case"===":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o===l;case"!==":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o!==l;case"":case"=":case"==":return r(o,l,u);case"!=":return e(o,l,u);case">":return t(o,l,u);case">=":return n(o,l,u);case"<":return s(o,l,u);case"<=":return a(o,l,u);default:throw new TypeError(`Invalid operator: ${c}`)}},aa}var ia,_c;function Sg(){if(_c)return ia;_c=1;const r=Ve(),e=Lr(),{safeRe:t,t:n}=un();return ia=(a,i)=>{if(a instanceof r)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const f=i.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let m;for(;(m=f.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||m.index+m[0].length!==o.index+o[0].length)&&(o=m),f.lastIndex=m.index+m[1].length+m[2].length;f.lastIndex=-1}if(o===null)return null;const c=o[2],l=o[3]||"0",u=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",h=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${c}.${l}.${u}${d}${h}`,i)},ia}var oa,vc;function xg(){if(vc)return oa;vc=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,n)}return this}}return oa=r,oa}var ca,wc;function _t(){if(wc)return ca;wc=1;const r=/\s+/g;class e{constructor($,R){if(R=s(R),$ instanceof e)return $.loose===!!R.loose&&$.includePrerelease===!!R.includePrerelease?$:new e($.raw,R);if($ instanceof a)return this.raw=$.value,this.set=[[$]],this.formatted=void 0,this;if(this.options=R,this.loose=!!R.loose,this.includePrerelease=!!R.includePrerelease,this.raw=$.trim().replace(r," "),this.set=this.raw.split("||").map(z=>this.parseRange(z.trim())).filter(z=>z.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const z=this.set[0];if(this.set=this.set.filter(G=>!v(G[0])),this.set.length===0)this.set=[z];else if(this.set.length>1){for(const G of this.set)if(G.length===1&&g(G[0])){this.set=[G];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let $=0;$<this.set.length;$++){$>0&&(this.formatted+="||");const R=this.set[$];for(let z=0;z<R.length;z++)z>0&&(this.formatted+=" "),this.formatted+=R[z].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange($){const z=((this.options.includePrerelease&&f)|(this.options.loose&&m))+":"+$,G=n.get(z);if(G)return G;const U=this.options.loose,Z=U?c[l.HYPHENRANGELOOSE]:c[l.HYPHENRANGE];$=$.replace(Z,Ne(this.options.includePrerelease)),i("hyphen replace",$),$=$.replace(c[l.COMPARATORTRIM],u),i("comparator trim",$),$=$.replace(c[l.TILDETRIM],d),i("tilde trim",$),$=$.replace(c[l.CARETTRIM],h),i("caret trim",$);let ne=$.split(" ").map(le=>T(le,this.options)).join(" ").split(/\s+/).map(le=>oe(le,this.options));U&&(ne=ne.filter(le=>(i("loose invalid filter",le,this.options),!!le.match(c[l.COMPARATORLOOSE])))),i("range list",ne);const ee=new Map,ue=ne.map(le=>new a(le,this.options));for(const le of ue){if(v(le))return[le];ee.set(le.value,le)}ee.size>1&&ee.has("")&&ee.delete("");const Ee=[...ee.values()];return n.set(z,Ee),Ee}intersects($,R){if(!($ instanceof e))throw new TypeError("a Range is required");return this.set.some(z=>y(z,R)&&$.set.some(G=>y(G,R)&&z.every(U=>G.every(Z=>U.intersects(Z,R)))))}test($){if(!$)return!1;if(typeof $=="string")try{$=new o($,this.options)}catch{return!1}for(let R=0;R<this.set.length;R++)if(it(this.set[R],$,this.options))return!0;return!1}}ca=e;const t=xg(),n=new t,s=Ci(),a=as(),i=ns(),o=Ve(),{safeRe:c,t:l,comparatorTrimReplace:u,tildeTrimReplace:d,caretTrimReplace:h}=un(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:m}=rs(),v=N=>N.value==="<0.0.0-0",g=N=>N.value==="",y=(N,$)=>{let R=!0;const z=N.slice();let G=z.pop();for(;R&&z.length;)R=z.every(U=>G.intersects(U,$)),G=z.pop();return R},T=(N,$)=>(i("comp",N,$),N=I(N,$),i("caret",N),N=A(N,$),i("tildes",N),N=E(N,$),i("xrange",N),N=be(N,$),i("stars",N),N),b=N=>!N||N.toLowerCase()==="x"||N==="*",A=(N,$)=>N.trim().split(/\s+/).map(R=>x(R,$)).join(" "),x=(N,$)=>{const R=$.loose?c[l.TILDELOOSE]:c[l.TILDE];return N.replace(R,(z,G,U,Z,ne)=>{i("tilde",N,z,G,U,Z,ne);let ee;return b(G)?ee="":b(U)?ee=`>=${G}.0.0 <${+G+1}.0.0-0`:b(Z)?ee=`>=${G}.${U}.0 <${G}.${+U+1}.0-0`:ne?(i("replaceTilde pr",ne),ee=`>=${G}.${U}.${Z}-${ne} <${G}.${+U+1}.0-0`):ee=`>=${G}.${U}.${Z} <${G}.${+U+1}.0-0`,i("tilde return",ee),ee})},I=(N,$)=>N.trim().split(/\s+/).map(R=>P(R,$)).join(" "),P=(N,$)=>{i("caret",N,$);const R=$.loose?c[l.CARETLOOSE]:c[l.CARET],z=$.includePrerelease?"-0":"";return N.replace(R,(G,U,Z,ne,ee)=>{i("caret",N,G,U,Z,ne,ee);let ue;return b(U)?ue="":b(Z)?ue=`>=${U}.0.0${z} <${+U+1}.0.0-0`:b(ne)?U==="0"?ue=`>=${U}.${Z}.0${z} <${U}.${+Z+1}.0-0`:ue=`>=${U}.${Z}.0${z} <${+U+1}.0.0-0`:ee?(i("replaceCaret pr",ee),U==="0"?Z==="0"?ue=`>=${U}.${Z}.${ne}-${ee} <${U}.${Z}.${+ne+1}-0`:ue=`>=${U}.${Z}.${ne}-${ee} <${U}.${+Z+1}.0-0`:ue=`>=${U}.${Z}.${ne}-${ee} <${+U+1}.0.0-0`):(i("no pr"),U==="0"?Z==="0"?ue=`>=${U}.${Z}.${ne}${z} <${U}.${Z}.${+ne+1}-0`:ue=`>=${U}.${Z}.${ne}${z} <${U}.${+Z+1}.0-0`:ue=`>=${U}.${Z}.${ne} <${+U+1}.0.0-0`),i("caret return",ue),ue})},E=(N,$)=>(i("replaceXRanges",N,$),N.split(/\s+/).map(R=>ce(R,$)).join(" ")),ce=(N,$)=>{N=N.trim();const R=$.loose?c[l.XRANGELOOSE]:c[l.XRANGE];return N.replace(R,(z,G,U,Z,ne,ee)=>{i("xRange",N,z,G,U,Z,ne,ee);const ue=b(U),Ee=ue||b(Z),le=Ee||b(ne),_=le;return G==="="&&_&&(G=""),ee=$.includePrerelease?"-0":"",ue?G===">"||G==="<"?z="<0.0.0-0":z="*":G&&_?(Ee&&(Z=0),ne=0,G===">"?(G=">=",Ee?(U=+U+1,Z=0,ne=0):(Z=+Z+1,ne=0)):G==="<="&&(G="<",Ee?U=+U+1:Z=+Z+1),G==="<"&&(ee="-0"),z=`${G+U}.${Z}.${ne}${ee}`):Ee?z=`>=${U}.0.0${ee} <${+U+1}.0.0-0`:le&&(z=`>=${U}.${Z}.0${ee} <${U}.${+Z+1}.0-0`),i("xRange return",z),z})},be=(N,$)=>(i("replaceStars",N,$),N.trim().replace(c[l.STAR],"")),oe=(N,$)=>(i("replaceGTE0",N,$),N.trim().replace(c[$.includePrerelease?l.GTE0PRE:l.GTE0],"")),Ne=N=>($,R,z,G,U,Z,ne,ee,ue,Ee,le,_)=>(b(z)?R="":b(G)?R=`>=${z}.0.0${N?"-0":""}`:b(U)?R=`>=${z}.${G}.0${N?"-0":""}`:Z?R=`>=${R}`:R=`>=${R}${N?"-0":""}`,b(ue)?ee="":b(Ee)?ee=`<${+ue+1}.0.0-0`:b(le)?ee=`<${ue}.${+Ee+1}.0-0`:_?ee=`<=${ue}.${Ee}.${le}-${_}`:N?ee=`<${ue}.${Ee}.${+le+1}-0`:ee=`<=${ee}`,`${R} ${ee}`.trim()),it=(N,$,R)=>{for(let z=0;z<N.length;z++)if(!N[z].test($))return!1;if($.prerelease.length&&!R.includePrerelease){for(let z=0;z<N.length;z++)if(i(N[z].semver),N[z].semver!==a.ANY&&N[z].semver.prerelease.length>0){const G=N[z].semver;if(G.major===$.major&&G.minor===$.minor&&G.patch===$.patch)return!0}return!1}return!0};return ca}var la,bc;function as(){if(bc)return la;bc=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(u,d){if(d=t(d),u instanceof e){if(u.loose===!!d.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),i("comparator",u,d),this.options=d,this.loose=!!d.loose,this.parse(u),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(u){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=u.match(d);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(u){if(i("Comparator.test",u,this.options.loose),this.semver===r||u===r)return!0;if(typeof u=="string")try{u=new o(u,this.options)}catch{return!1}return a(u,this.operator,this.semver,this.options)}intersects(u,d){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(u.value,d).test(this.value):u.operator===""?u.value===""?!0:new c(this.value,d).test(u.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||a(this.semver,"<",u.semver,d)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||a(this.semver,">",u.semver,d)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}la=e;const t=Ci(),{safeRe:n,t:s}=un(),a=ou(),i=ns(),o=Ve(),c=_t();return la}var ua,Ec;function is(){if(Ec)return ua;Ec=1;const r=_t();return ua=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},ua}var da,Tc;function Ig(){if(Tc)return da;Tc=1;const r=_t();return da=(t,n)=>new r(t,n).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),da}var ha,Sc;function Ag(){if(Sc)return ha;Sc=1;const r=Ve(),e=_t();return ha=(n,s,a)=>{let i=null,o=null,c=null;try{c=new e(s,a)}catch{return null}return n.forEach(l=>{c.test(l)&&(!i||o.compare(l)===-1)&&(i=l,o=new r(i,a))}),i},ha}var fa,xc;function Og(){if(xc)return fa;xc=1;const r=Ve(),e=_t();return fa=(n,s,a)=>{let i=null,o=null,c=null;try{c=new e(s,a)}catch{return null}return n.forEach(l=>{c.test(l)&&(!i||o.compare(l)===1)&&(i=l,o=new r(i,a))}),i},fa}var pa,Ic;function Cg(){if(Ic)return pa;Ic=1;const r=Ve(),e=_t(),t=ss();return pa=(s,a)=>{s=new e(s,a);let i=new r("0.0.0");if(s.test(i)||(i=new r("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const c=s.set[o];let l=null;c.forEach(u=>{const d=new r(u.semver.version);switch(u.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!l||t(d,l))&&(l=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),l&&(!i||t(i,l))&&(i=l)}return i&&s.test(i)?i:null},pa}var ma,Ac;function Rg(){if(Ac)return ma;Ac=1;const r=_t();return ma=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},ma}var ga,Oc;function Pi(){if(Oc)return ga;Oc=1;const r=Ve(),e=as(),{ANY:t}=e,n=_t(),s=is(),a=ss(),i=ki(),o=Ni(),c=$i();return ga=(u,d,h,f)=>{u=new r(u,f),d=new n(d,f);let m,v,g,y,T;switch(h){case">":m=a,v=o,g=i,y=">",T=">=";break;case"<":m=i,v=c,g=a,y="<",T="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(u,d,f))return!1;for(let b=0;b<d.set.length;++b){const A=d.set[b];let x=null,I=null;if(A.forEach(P=>{P.semver===t&&(P=new e(">=0.0.0")),x=x||P,I=I||P,m(P.semver,x.semver,f)?x=P:g(P.semver,I.semver,f)&&(I=P)}),x.operator===y||x.operator===T||(!I.operator||I.operator===y)&&v(u,I.semver))return!1;if(I.operator===T&&g(u,I.semver))return!1}return!0},ga}var ya,Cc;function kg(){if(Cc)return ya;Cc=1;const r=Pi();return ya=(t,n,s)=>r(t,n,">",s),ya}var _a,Rc;function $g(){if(Rc)return _a;Rc=1;const r=Pi();return _a=(t,n,s)=>r(t,n,"<",s),_a}var va,kc;function Ng(){if(kc)return va;kc=1;const r=_t();return va=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),va}var wa,$c;function Pg(){if($c)return wa;$c=1;const r=is(),e=yt();return wa=(t,n,s)=>{const a=[];let i=null,o=null;const c=t.sort((h,f)=>e(h,f,s));for(const h of c)r(h,n,s)?(o=h,i||(i=h)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const l=[];for(const[h,f]of a)h===f?l.push(h):!f&&h===c[0]?l.push("*"):f?h===c[0]?l.push(`<=${f}`):l.push(`${h} - ${f}`):l.push(`>=${h}`);const u=l.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return u.length<d.length?u:n},wa}var ba,Nc;function Lg(){if(Nc)return ba;Nc=1;const r=_t(),e=as(),{ANY:t}=e,n=is(),s=yt(),a=(d,h,f={})=>{if(d===h)return!0;d=new r(d,f),h=new r(h,f);let m=!1;e:for(const v of d.set){for(const g of h.set){const y=c(v,g,f);if(m=m||y!==null,y)continue e}if(m)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],c=(d,h,f)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;f.includePrerelease?d=i:d=o}if(h.length===1&&h[0].semver===t){if(f.includePrerelease)return!0;h=o}const m=new Set;let v,g;for(const E of d)E.operator===">"||E.operator===">="?v=l(v,E,f):E.operator==="<"||E.operator==="<="?g=u(g,E,f):m.add(E.semver);if(m.size>1)return null;let y;if(v&&g){if(y=s(v.semver,g.semver,f),y>0)return null;if(y===0&&(v.operator!==">="||g.operator!=="<="))return null}for(const E of m){if(v&&!n(E,String(v),f)||g&&!n(E,String(g),f))return null;for(const ce of h)if(!n(E,String(ce),f))return!1;return!0}let T,b,A,x,I=g&&!f.includePrerelease&&g.semver.prerelease.length?g.semver:!1,P=v&&!f.includePrerelease&&v.semver.prerelease.length?v.semver:!1;I&&I.prerelease.length===1&&g.operator==="<"&&I.prerelease[0]===0&&(I=!1);for(const E of h){if(x=x||E.operator===">"||E.operator===">=",A=A||E.operator==="<"||E.operator==="<=",v){if(P&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===P.major&&E.semver.minor===P.minor&&E.semver.patch===P.patch&&(P=!1),E.operator===">"||E.operator===">="){if(T=l(v,E,f),T===E&&T!==v)return!1}else if(v.operator===">="&&!n(v.semver,String(E),f))return!1}if(g){if(I&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===I.major&&E.semver.minor===I.minor&&E.semver.patch===I.patch&&(I=!1),E.operator==="<"||E.operator==="<="){if(b=u(g,E,f),b===E&&b!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(E),f))return!1}if(!E.operator&&(g||v)&&y!==0)return!1}return!(v&&A&&!g&&y!==0||g&&x&&!v&&y!==0||P||I)},l=(d,h,f)=>{if(!d)return h;const m=s(d.semver,h.semver,f);return m>0?d:m<0||h.operator===">"&&d.operator===">="?h:d},u=(d,h,f)=>{if(!d)return h;const m=s(d.semver,h.semver,f);return m<0?d:m>0||h.operator==="<"&&d.operator==="<="?h:d};return ba=a,ba}var Ea,Pc;function Mg(){if(Pc)return Ea;Pc=1;const r=un(),e=rs(),t=Ve(),n=su(),s=Lr(),a=hg(),i=fg(),o=pg(),c=mg(),l=gg(),u=yg(),d=_g(),h=vg(),f=yt(),m=wg(),v=bg(),g=Ri(),y=Eg(),T=Tg(),b=ss(),A=ki(),x=au(),I=iu(),P=$i(),E=Ni(),ce=ou(),be=Sg(),oe=as(),Ne=_t(),it=is(),N=Ig(),$=Ag(),R=Og(),z=Cg(),G=Rg(),U=Pi(),Z=kg(),ne=$g(),ee=Ng(),ue=Pg(),Ee=Lg();return Ea={parse:s,valid:a,clean:i,inc:o,diff:c,major:l,minor:u,patch:d,prerelease:h,compare:f,rcompare:m,compareLoose:v,compareBuild:g,sort:y,rsort:T,gt:b,lt:A,eq:x,neq:I,gte:P,lte:E,cmp:ce,coerce:be,Comparator:oe,Range:Ne,satisfies:it,toComparators:N,maxSatisfying:$,minSatisfying:R,minVersion:z,validRange:G,outside:U,gtr:Z,ltr:ne,intersects:ee,simplifyRange:ue,subset:Ee,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Ea}Mg();function qt(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${r}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class jg extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function J(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}if(r.status===403)try{const i=await r.json();(i==null?void 0:i.error)==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${r.status} ${r.statusText}`);throw o.status=r==null?void 0:r.status,o}if(n===void 0)try{n=await r.text()}catch{n=""}const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Message: ${n}`;if(r.status===409)throw new jg(s);const a=new Error(s);throw a.status=r.status,a}const cu="ERR_CONFLICTING_ENDPOINTS";class Dg extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:cu}),this.name="ConflictingEndpointsError"}}function Fg(r){return typeof r=="object"&&r!==null&&r.code===cu}var Lc="[...]",Ug={result:"[Circular]"},Bn=[],Er=[];const Bg=new TextEncoder;function zg(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Tn(r){return Bg.encode(r)}function lu(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function qg(r){return function(e,t){return lu(t)}}function Qe(r,e,t,n,s){var a;try{const i=JSON.stringify(r,qg(t),n);return Tn(i)}catch(i){if(!((a=i.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Tn("[Unserializable]");Ke("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=zg()),Ga(r,"",0,[],void 0,0,s);let o;try{Er.length===0?o=JSON.stringify(r,t,n):o=JSON.stringify(r,Gg(t),n)}catch{return Tn("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Bn.length!==0;){const c=Bn.pop();c.length===4?Object.defineProperty(c[0],c[1],c[3]):c[0][c[1]]=c[2]}}return Tn(o)}}function Ta(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Bn.push([n,t,e,s])):Er.push([e,t,r]):(n[t]=r,Bn.push([n,t,e]))}function Ga(r,e,t,n,s,a,i){a+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Ta(Ug,r,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Ta(Lc,r,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Ta(Lc,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Ga(r[o],o,o,n,r,a,i);else{r=lu(r);var c=Object.keys(r);for(o=0;o<c.length;o++){var l=c[o];Ga(r[l],l,o,n,r,a,i)}}n.pop()}}function Gg(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Er.length>0)for(var n=0;n<Er.length;n++){var s=Er[n];if(s[1]===e&&s[0]===t){t=s[2],Er.splice(n,1);break}}return r.call(this,e,t)}}function Mc(r,e){const t=eu(),n=e??tu(),s=r.extra??{},a=s.metadata;return r.extra={...s,runtime:{...t,...s==null?void 0:s.runtime},metadata:{...n,...n.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??n.revision_id}:{},...a}},r}const Hg=r=>{const e=(r==null?void 0:r.toString())??Ke("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Vg=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function Zg(r){const e=[];for await(const t of r)e.push(t);return e}function Sn(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Jg=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function jc(r){return typeof r=="number"?Number(r.toFixed(4)):r}class Wg{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(a=>{t=a}),s=Qe(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop({upToSizeBytes:e,upToSize:t}){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let s=0;for(;s+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0&&n.length<t;){const i=this.items.shift();i&&(n.push(i),s+=i.size,this.sizeBytes-=i.size)}if(n.length===0&&this.items.length>0){const i=this.items.shift();n.push(i),s+=i.size,this.sizeBytes-=i.size}return[n.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl})),()=>n.forEach(i=>i.itemPromiseResolve())]}}const Kg=24*1024*1024,Yg=1e4,Xg=100,Dc="https://api.smith.langchain.com";class Qr{get _fetch(){return this.fetchImplementation||Pm(this.debug)}constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Wg}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:At("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:At("LANGSMITH_DEBUG")==="true"});const t=Qr.getDefaultClientConfig();if(this.tracingSampleRate=Hg(e.tracingSamplingRate),this.apiUrl=Sn(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Sn(e.apiKey??t.apiKey),this.webUrl=Sn(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=Sn(e.workspaceId??Ke("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Uo({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new Uo({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:Jg,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,ru()&&(this.langSmithToOTELTranslator=new Ym),this.cachedLSEnvVarsForMetadata=tu()}static getDefaultClientConfig(){const e=Ke("API_KEY"),t=Ke("ENDPOINT")??Dc,n=Ke("HIDE_INPUTS")==="true",s=Ke("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:Vg(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Yl}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{const i=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(i,`fetch ${e}`),i})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(async()=>{const l=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(l,`fetch ${e}`),l}),c=n?n(await o.json()):await o.json();if(c.length===0||(yield c,c.length<a))break;s+=c.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const a=t?{...t}:{};for(;;){const i=JSON.stringify(a),c=await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(u,`fetch ${e}`),u})).json();if(!c||!c[s])break;yield c[s];const l=c.cursors;if(!l||!l.next)break;a.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):n.push(s);return n}else{const n=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?n.push(s):this.filteredPostUuids.add(a):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??Kg}async _getBatchSizeLimit(){var t;const e=await this._ensureServerInfo();return this.batchSizeLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit)??Xg}async _getDatasetExamplesMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){const n=[];for(;this.autoBatchQueue.items.length>0;){const[s,a]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!s.length){a();break}const i=s.reduce((l,u)=>{const d=u.apiUrl??this.apiUrl,h=u.apiKey??this.apiKey,m=u.apiKey===this.apiKey&&u.apiUrl===this.apiUrl?"default":`${d}|${h}`;return l[m]||(l[m]=[]),l[m].push(u),l},{}),o=[];for(const[l,u]of Object.entries(i)){const d=this._processBatch(u,{apiUrl:l==="default"?void 0:l.split("|")[0],apiKey:l==="default"?void 0:l.split("|")[1]});o.push(d)}const c=Promise.all(o).finally(a);n.push(c)}return Promise.all(n)}async _processBatch(e,t){var n,s;if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const a={runCreates:e.filter(o=>o.action==="create").map(o=>o.item),runUpdates:e.filter(o=>o.action==="update").map(o=>o.item)},i=await this._ensureServerInfo();if((n=i==null?void 0:i.batch_ingest_config)!=null&&n.use_multipart_endpoint){const o=(s=i==null?void 0:i.instance_flags)==null?void 0:s.gzip_body_enabled;await this.multipartIngestRuns(a,{...t,useGzip:o})}else await this.batchIngestRuns(a,t)}}catch(a){console.error("Error exporting batch:",a)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const t=new Map,n=[];for(const s of e)s.item.id&&s.otelContext&&(t.set(s.item.id,s.otelContext),s.action==="create"?n.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):n.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=Mc(e.item,this.cachedLSEnvVarsForMetadata);const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const t=await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(Yg),...this.fetchOptions});return await J(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){const e=nu(),t=Zm();if(this.langSmithToOTELTranslator!==void 0){const n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const c=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:c,apiKey:t==null?void 0:t.apiKey,apiUrl:t==null?void 0:t.apiUrl}).catch(console.error);return}const i=Mc(a,this.cachedLSEnvVarsForMetadata);(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey),(t==null?void 0:t.workspaceId)!==void 0&&(n["x-tenant-id"]=t.workspaceId);const o=Qe(i,`Creating run with id: ${i.id}`);await this.caller.call(async()=>{const c=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await J(c,"create run",!0),c})}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let s=await Promise.all((e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[]),a=await Promise.all((t==null?void 0:t.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[]);if(s.length>0&&a.length>0){const c=s.reduce((u,d)=>(d.id&&(u[d.id]=d),u),{}),l=[];for(const u of a)u.id!==void 0&&c[u.id]?c[u.id]={...c[u.id],...u}:l.push(u);s=Object.values(c),a=l}const i={post:s,patch:a};if(!i.post.length&&!i.patch.length)return;const o={post:[],patch:[]};for(const c of["post","patch"]){const l=c,u=i[l].reverse();let d=u.pop();for(;d!==void 0;)o[l].push(d),d=u.pop()}if(o.post.length>0||o.patch.length>0){const c=o.post.map(l=>l.id).concat(o.patch.map(l=>l.id)).join(",");await this._postBatchIngestRuns(Qe(o,`Ingesting runs with ids: ${c}`),n)}}async _postBatchIngestRuns(e,t){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{const s=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await J(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;const s={};let a=[];for(const d of e??[]){const h=await this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(s[h.id]=h.attachments),delete h.attachments,a.push(h)}let i=[];for(const d of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(d));if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){const d=a.reduce((f,m)=>(m.id&&(f[m.id]=m),f),{}),h=[];for(const f of i)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);a=Object.values(d),i=h}if(a.length===0&&i.length===0)return;const l=[],u=[];for(const[d,h]of[["post",a],["patch",i]])for(const f of h){const{inputs:m,outputs:v,events:g,extra:y,error:T,serialized:b,attachments:A,...x}=f,I={inputs:m,outputs:v,events:g,extra:y,error:T,serialized:b},P=Qe(x,`Serializing for multipart ingestion of run with id: ${x.id}`);u.push({name:`${d}.${x.id}`,payload:new Blob([P],{type:`application/json; length=${P.length}`})});for(const[E,ce]of Object.entries(I)){if(ce===void 0)continue;const be=Qe(ce,`Serializing ${E} for multipart ingestion of run with id: ${x.id}`);u.push({name:`${d}.${x.id}.${E}`,payload:new Blob([be],{type:`application/json; length=${be.length}`})})}if(x.id!==void 0){const E=s[x.id];if(E){delete s[x.id];for(const[ce,be]of Object.entries(E)){let oe,Ne;if(Array.isArray(be)?[oe,Ne]=be:(oe=be.mimeType,Ne=be.data),ce.includes(".")){console.warn(`Skipping attachment '${ce}' for run ${x.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${x.id}.${ce}`,payload:new Blob([Ne],{type:`${oe}; length=${Ne.byteLength}`})})}}}l.push(`trace=${x.trace_id},id=${x.id}`)}await this._sendMultipartRequest(u,l.join("; "),n)}async _createNodeFetchBody(e,t){const n=[];for(const i of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),n.push(i.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){const n=new TextEncoder;return new ReadableStream({async start(a){const i=async o=>{typeof o=="string"?a.enqueue(n.encode(o)):a.enqueue(o)};for(const o of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${o.name}"\r
`),await i(`Content-Type: ${o.payload.type}\r
\r
`);const l=o.payload.stream().getReader();try{let u;for(;!(u=await l.read()).done;)a.enqueue(u.value)}finally{l.releaseLock()}await i(`\r
`)}await i(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t,n){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=Nm(),i=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),c=async l=>this.batchIngestCaller.call(async()=>{const u=await l(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};(n==null?void 0:n.apiKey)!==void 0&&(d["x-api-key"]=n.apiKey);let h=u;n!=null&&n.useGzip&&typeof u=="object"&&"pipeThrough"in u&&(h=u.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");const f=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(f,"Failed to send multipart request",!0),f});try{let l,u=!1;!a&&!this.multipartStreamingDisabled&&Ql()!=="bun"?(u=!0,l=await c(o)):l=await c(i),(!this.multipartStreamingDisabled||u)&&l.status===422&&((n==null?void 0:n.apiUrl)??this.apiUrl)!==Dc&&(console.warn(`Streaming multipart upload to ${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,l=await c(i))}catch(l){console.warn(`${l.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){se(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const s={...t,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"};(n==null?void 0:n.apiKey)!==void 0&&(a["x-api-key"]=n.apiKey),(n==null?void 0:n.workspaceId)!==void 0&&(a["x-tenant-id"]=n.workspaceId);const i=Qe(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(o,"update run",!0),o})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){se(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:Ke("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var a;const t=await Zg(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},s={};t.sort((i,o)=>((i==null?void 0:i.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);(a=i.dotted_order)!=null&&a.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i)}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:c,isRoot:l,runType:u,error:d,id:h,query:f,filter:m,traceFilter:v,treeFilter:g,limit:y,select:T,order:b}=e;let A=[];if(t&&(A=Array.isArray(t)?t:[t]),n){const E=Array.isArray(n)?n:[n],ce=await Promise.all(E.map(be=>this.readProject({projectName:be}).then(oe=>oe.id)));A.push(...ce)}const x=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],I={session:A.length?A:null,run_type:u,reference_example:i,query:f,filter:m,trace_filter:v,tree_filter:g,execution_order:c,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:y,trace:a,select:T||x,is_root:l,order:b};I.select.includes("child_run_ids")&&qa("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let P=0;for await(const E of this._getCursorPaginatedList("/runs/query",I))if(y){if(P>=y)break;if(E.length+P>y){yield*E.slice(0,y-P);break}P+=E.length,yield*E}else yield*E}async*listGroupRuns(e){const{projectId:t,projectName:n,groupBy:s,filter:a,startTime:i,endTime:o,limit:c,offset:l}=e,d={session_id:t||(await this.readProject({projectName:n})).id,group_by:s,filter:a,start_time:i?i.toISOString():null,end_time:o?o.toISOString():null,limit:Number(c)||100};let h=Number(l)||0;const f="/runs/group",m=`${this.apiUrl}${f}`;for(;;){const v={...d,offset:h},g=Object.fromEntries(Object.entries(v).filter(([I,P])=>P!==void 0)),y=JSON.stringify(g),b=await(await this.caller.call(async()=>{const I=await this._fetch(m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await J(I,`Failed to fetch ${f}`),I})).json(),{groups:A,total:x}=b;if(A.length===0)break;for(const I of A)yield I;if(h+=A.length,h>=x)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:c,endTime:l,error:u,query:d,filter:h,traceFilter:f,treeFilter:m,isRoot:v,dataSourceType:g}){let y=i||[];a&&(y=[...i||[],...await Promise.all(a.map(P=>this.readProject({projectName:P}).then(E=>E.id)))]);const b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:y,reference_example:o,start_time:c,end_time:l,error:u,query:d,filter:h,trace_filter:f,tree_filter:m,is_root:v,data_source_type:g}).filter(([P,E])=>E!==void 0)),A=JSON.stringify(b);return await(await this.caller.call(async()=>{const P=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:A});return await J(P,"get run stats"),P})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||He()};se(e);const s=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await J(o,"share run"),o})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){se(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(t,"unshare run",!0),t})}async readRunSharedLink(e){se(e);const n=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(s,"read run shared link"),s})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)n.append("id",i);return se(e),await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(i,"list shared runs"),i})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),se(e);const s=await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(a,"read dataset shared schema"),a})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};se(e);const s=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await J(o,"share dataset"),o})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){se(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(t,"unshare dataset",!0),t})}async readSharedDataset(e){return se(e),await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(s,"read shared dataset"),s})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,c])=>{Array.isArray(c)?c.forEach(l=>s.append(o,l)):s.append(o,c)});const a=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(o,"list shared examples"),o}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,l=a||{};n&&(l.metadata=n);const u={name:e,extra:l,description:t};i!==null&&(u.reference_dataset_id=i);const d=JSON.stringify(u);return await(await this.caller.call(async()=>{const m=await this._fetch(c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await J(m,"create project"),m})).json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=a;s&&(c={...c||{},metadata:s});const l=JSON.stringify({name:t,extra:c,description:n,end_time:i?new Date(i).toISOString():null});return await(await this.caller.call(async()=>{const h=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await J(h,"update project"),h})).json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)se(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(i,"has project"),i});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)se(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,includeStats:i,datasetVersion:o,referenceFree:c,metadata:l}={}){const u=new URLSearchParams;if(e!==void 0)for(const d of e)u.append("id",d);if(t!==void 0&&u.append("name",t),n!==void 0&&u.append("name_contains",n),s!==void 0)u.append("reference_dataset",s);else if(a!==void 0){const d=await this.readDataset({datasetName:a});u.append("reference_dataset",d.id)}i!==void 0&&u.append("include_stats",i.toString()),o!==void 0&&u.append("dataset_version",o),c!==void 0&&u.append("reference_free",c.toString()),l!==void 0&&u.append("metadata",JSON.stringify(l));for await(const d of this._getPaginated("/sessions",u))yield*d}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,se(n),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(s,`delete session ${n} (${t})`,!0),s})}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){const c=`${this.apiUrl}/datasets/upload`,l=new FormData;return l.append("file",e,t),n.forEach(h=>{l.append("input_keys",h)}),s.forEach(h=>{l.append("output_keys",h)}),a&&l.append("description",a),i&&l.append("data_type",i),o&&l.append("name",o),await(await this.caller.call(async()=>{const h=await this._fetch(c,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await J(h,"upload CSV"),h})).json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const c=JSON.stringify(o);return await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await J(d,"create dataset"),d})).json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)se(e),n+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",c=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const l of n)c.append("id",l);s!==void 0&&c.append("name",s),a!==void 0&&c.append("name_contains",a),i!==void 0&&c.append("metadata",JSON.stringify(i));for await(const l of this._getPaginated(o,c))yield*l}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;se(a);const i=JSON.stringify(s);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(c,"update dataset"),c})).json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;se(i);const o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a});await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await J(c,"update dataset tags",!0),c})}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)se(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const a=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(a,`delete ${n}`,!0),a})}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),se(s);const i=JSON.stringify({tag:n});await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(c,"index dataset"),c})).json()}async similarExamples(e,t,n,{filter:s}={}){const a={limit:n,inputs:e};s!==void 0&&(a.filter=s),se(t);const i=JSON.stringify(a);return(await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:i});return await J(l,"fetch similar examples"),l})).json()).examples}async createExample(e,t,n){var u;if(Fc(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const a=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;Fc(e)?o=e:o={inputs:e,outputs:t,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const c=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((u=c.example_ids)==null?void 0:u[0])??He())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const T=e;let b=T[0].dataset_id;const A=T[0].dataset_name;if(b===void 0&&A===void 0)throw new Error("Must provide either datasetName or datasetId");if(b!==void 0&&A!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");b===void 0&&(b=(await this.readDataset({datasetName:A})).id);const x=await this._uploadExamplesMultipart(b,T);return await Promise.all(x.example_ids.map(P=>this.readExample(P)))}const{inputs:t,outputs:n,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:c,attachments:l,exampleIds:u,datasetId:d,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const m=h;if(f===void 0&&m===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&m!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:m})).id);const v=t.map((T,b)=>({dataset_id:f,inputs:T,outputs:n==null?void 0:n[b],metadata:s==null?void 0:s[b],split:a==null?void 0:a[b],id:u==null?void 0:u[b],attachments:l==null?void 0:l[b],source_run_id:i==null?void 0:i[b],use_source_run_io:o==null?void 0:o[b],use_source_run_attachments:c==null?void 0:c[b]})),g=await this._uploadExamplesMultipart(f,v);return await Promise.all(g.example_ids.map(T=>this.readExample(T)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(i=>Bo(i)?zo(i):i),a=Bo(t)?zo(t):t;return this.createExample({input:s},{output:a},n)}async readExample(e){se(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...a}=n,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[c,l])=>(o[c.slice(11)]={presigned_url:l.presigned_url,mime_type:l.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:c,offset:l,filter:u,includeAttachments:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),m=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;m&&f.append("as_of",m);const v=i??!0;if(f.append("inline_s3_urls",v.toString()),n!==void 0)for(const y of n)f.append("id",y);if(a!==void 0)for(const y of a)f.append("splits",y);if(o!==void 0){const y=JSON.stringify(o);f.append("metadata",y)}c!==void 0&&f.append("limit",c.toString()),l!==void 0&&f.append("offset",l.toString()),u!==void 0&&f.append("filter",u),d===!0&&["attachment_urls","outputs","metadata"].forEach(y=>f.append("select",y));let g=0;for await(const y of this._getPaginated("/examples",f)){for(const T of y){const{attachment_urls:b,...A}=T,x=A;b&&(x.attachments=Object.entries(b).reduce((I,[P,E])=>(I[P.slice(11)]={presigned_url:E.presigned_url,mime_type:E.mime_type||void 0},I),{})),yield x,g++}if(c!==void 0&&g>=c)break}}async deleteExample(e){se(e);const t=`/examples/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(n,`delete ${t}`,!0),n})}async updateExample(e,t){let n;t?n=e:n=e.id,se(n);let s;t?s={id:n,...t}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,se(a),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;return n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&i.append("tag",s),await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(c,"read dataset version"),c})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,se(s);const a=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,se(i);const o={split_name:n,examples:s.map(l=>(se(l),l)),remove:a},c=JSON.stringify(o);await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await J(l,"update dataset splits",!0),l})}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){qa("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a),[c,l]=await this._logEvaluationFeedback(o,i,n);return l[0]}async createFeedback(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:l,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var T;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const m={type:c??"api",metadata:o??{}};l!==void 0&&(m==null?void 0:m.metadata)!==void 0&&!m.metadata.__run&&(m.metadata.__run={run_id:l}),(m==null?void 0:m.metadata)!==void 0&&((T=m.metadata.__run)==null?void 0:T.run_id)!==void 0&&se(m.metadata.__run.run_id);const v={id:u??He(),run_id:e,key:t,score:jc(n),value:s,correction:a,comment:i,feedback_source:m,comparative_experiment_id:f,feedbackConfig:d,session_id:h},g=JSON.stringify(v),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const b=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await J(b,"create feedback",!0),b}),v}async updateFeedback(e,{score:t,value:n,correction:s,comment:a}){const i={};t!=null&&(i.score=jc(t)),n!=null&&(i.value=n),s!=null&&(i.correction=s),a!=null&&(i.comment=a),se(e);const o=JSON.stringify(i);await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await J(c,"update feedback",!0),c})}async readFeedback(e){se(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){se(e);const t=`/feedback/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(n,`delete ${t}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e)for(const a of e)se(a),s.append("run",a);if(t)for(const a of t)s.append("key",a);if(n)for(const a of n)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const a={run_id:e,feedback_key:t,feedback_config:s};n?typeof n=="string"?a.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(a.expires_in=n):a.expires_in={hours:3};const i=JSON.stringify(a);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(c,"create presigned feedback token"),c})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const c={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:a,created_at:(d=s??new Date)==null?void 0:d.toISOString(),extra:{}};i&&(c.extra.metadata=i);const l=JSON.stringify(c);return(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await J(h,"create comparative experiment"),h})).json()}async*listPresignedFeedbackTokens(e){se(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let c=null;i.targetRunId?c=i.targetRunId:t&&(c=t.id),a.push(await this.createFeedback(c,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((c,l)=>{se(c,`queueIds[${l}]`),i.append("ids",c)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const c of this._getPaginated("/annotation-queues",i))if(yield*c,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s,rubricInstructions:a}=e,i={name:t,description:n,id:s||He(),rubric_instructions:a},o=JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,u])=>u!==void 0)));return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await J(l,"create annotation queue"),l})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,t){const{name:n,description:s,rubricInstructions:a}=t,i=JSON.stringify({name:n,description:s,rubric_instructions:a});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){const n=JSON.stringify(t.map((s,a)=>se(s,`runIds[${a}]`).toString()));await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await J(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${se(e,"queueId")}/run`;return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(a,"get run from annotation queue"),a})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}/runs/${se(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${se(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const n=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(s,"get latest commit hash"),s})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,a]=qt(e),i=JSON.stringify({like:t});return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(c,`${t?"like":"unlike"} prompt`),c})).json()}async _getPromptUrl(e){const[t,n,s]=qt(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=qt(e),a=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return(o==null?void 0:o.status)===404?null:(await J(o,"get prompt"),o)}),i=await(a==null?void 0:a.json());return i!=null&&i.repo?i.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=qt(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},c=JSON.stringify(o),l=await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await J(d,"create prompt"),d}),{repo:u}=await l.json();return u}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=qt(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):n==null?void 0:n.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=JSON.stringify(c),d=await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await J(h,"create commit"),h})).json();return this._getPromptUrl(`${s}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var i;if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const o of t){const c=o.id,l={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},u=Qe(l,`Serializing body for example with id: ${c}`),d=new Blob([u],{type:"application/json"});if(n.append(c,d),o.inputs){const h=Qe(o.inputs,`Serializing inputs for example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.inputs`,f)}if(o.outputs){const h=Qe(o.outputs,`Serializing outputs whle updating example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.outputs`,f)}if(o.attachments)for(const[h,f]of Object.entries(o.attachments)){let m,v;Array.isArray(f)?[m,v]=f:(m=f.mimeType,v=f.data);const g=new Blob([v],{type:`${m}; length=${v.byteLength}`});n.append(`${c}.attachment.${h}`,g)}if(o.attachments_operations){const h=Qe(o.attachments_operations,`Serializing attachments while updating example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.attachments_operations`,f)}}const s=e??((i=t[0])==null?void 0:i.dataset_id);return(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await J(o,"update examples"),o})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of t){const i=(a.id??He()).toString(),o={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=Qe(o,`Serializing body for uploaded example with id: ${i}`),l=new Blob([c],{type:"application/json"});if(n.append(i,l),a.inputs){const u=Qe(a.inputs,`Serializing inputs for uploaded example with id: ${i}`),d=new Blob([u],{type:"application/json"});n.append(`${i}.inputs`,d)}if(a.outputs){const u=Qe(a.outputs,`Serializing outputs for uploaded example with id: ${i}`),d=new Blob([u],{type:"application/json"});n.append(`${i}.outputs`,d)}if(a.attachments)for(const[u,d]of Object.entries(a.attachments)){let h,f;Array.isArray(d)?[h,f]=d:(h=d.mimeType,f=d.data);const m=new Blob([f],{type:`${h}; length=${f.byteLength}`});n.append(`${i}.attachment.${u}`,m)}}return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await J(a,"upload examples"),a})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=qt(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=JSON.stringify(a);return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await J(c,"update prompt"),c})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=qt(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(i,"delete prompt"),i})).json()}async pullPromptCommit(e,t){const[n,s,a]=qt(e),o=await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/commits/${n}/${s}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await J(c,"pull prompt commit"),c})).json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,n),o=new Qr({apiUrl:a,apiKey:"placeholder"}),c=await o.readSharedDataset(i),l=s||c.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}const u=await o.listSharedExamples(i),d=await this.createDataset(l,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(h=>h.inputs),outputs:u.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),h}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return se(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}async awaitPendingTraceBatches(){var e,t;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:n})=>n),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((t=(e=Jm())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:t.forceFlush())}}function Fc(r){return"dataset_id"in r||"dataset_name"in r}const Qg=r=>!!["TRACING_V2","TRACING"].find(t=>Ke(t)==="true"),Sa=Symbol.for("lc:context_variables");function ey(r){return r.replace(/[-:.]/g,"")}function uu(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0"),s=`${new Date(r).toISOString().slice(0,-1)}${n}Z`;return{dottedOrder:ey(s)+e,microsecondPrecisionDatestring:s}}class zn{constructor(e,t,n,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=s}static fromHeader(e){const t=e.split(",");let n={},s=[],a,i;for(const o of t){const[c,l]=o.split("="),u=decodeURIComponent(l);c==="langsmith-metadata"?n=JSON.parse(u):c==="langsmith-tags"?s=u.split(","):c==="langsmith-project"?a=u:c==="langsmith-replicas"&&(i=JSON.parse(u))}return new zn(n,s,a,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class We{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),ty(e)){Object.assign(this,{...e});return}const t=We.getDefaultConfig(),{metadata:n,...s}=e,a=s.client??We.getSharedClient(),i={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=iy(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const{dottedOrder:c,microsecondPrecisionDatestring:l}=uu(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+c:this.dotted_order=c,this._serialized_start_time=l}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:He(),run_type:"chain",project_name:Kl(),child_runs:[],api_url:At("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:At("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return We.sharedClient||(We.sharedClient=new Qr),We.sharedClient}createChild(e){var c,l,u,d,h,f;const t=this.child_execution_order+1,n=new We({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Sa in this&&(n[Sa]=this[Sa]);const s=Symbol.for("lc:child_config"),a=((c=e.extra)==null?void 0:c[s])??this.extra[s];if(ny(a)){const m={...a},v=ry(m.callbacks)?(u=(l=m.callbacks).copy)==null?void 0:u.call(l):void 0;v&&(Object.assign(v,{_parentRunId:n.id}),(f=(h=(d=v.handlers)==null?void 0:d.find(du))==null?void 0:h.updateFromRunTree)==null||f.call(h,n),m.callbacks=v),n.extra[s]=m}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var o,c;const s=e.extra??{};if(((o=s==null?void 0:s.runtime)==null?void 0:o.library)===void 0&&(s.runtime||(s.runtime={}),t))for(const[l,u]of Object.entries(t))s.runtime[l]||(s.runtime[l]=u);let a,i;return n?(i=((c=e.parent_run)==null?void 0:c.id)??e.parent_run_id,a=[]):(a=e.child_runs.map(l=>this._convertToCreate(l,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){const s=this._convertToCreate(this,t,n);if(e===this.project_name)return s;const a=d=>To(`${d}:${e}`,To.DNS),i=a(s.id),o=s.trace_id?a(s.trace_id):void 0,c=s.parent_run_id?a(s.parent_run_id):void 0;let l;if(s.dotted_order){const d=sy(s.dotted_order),h=[];for(let m=0;m<d.length-1;m++){const[v,g]=d[m],y=a(g);h.push(v.toISOString().replace(/[-:]/g,"").replace(".","")+y)}const[f]=d[d.length-1];h.push(f.toISOString().replace(/[-:]/g,"").replace(".","")+i),l=h.join(".")}else l=void 0;return{...s,id:i,trace_id:o,parent_run_id:c,dotted_order:l,session_name:e}}async postRun(e=!0){try{const t=eu();if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:s,apiUrl:a,workspaceId:i}of this.replicas){const o=this._remapForProject(n??this.project_name,t,!0);await this.client.createRun(o,{apiKey:s,apiUrl:a,workspaceId:i})}else{const n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){qa("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){var t;if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:s,apiUrl:a,workspaceId:i,updates:o}of this.replicas){const c=this._remapForProject(n??this.project_name),l={id:c.id,outputs:c.outputs,error:c.error,parent_run_id:c.parent_run_id,session_name:c.session_name,reference_example_id:c.reference_example_id,end_time:c.end_time,dotted_order:c.dotted_order,trace_id:c.trace_id,events:c.events,tags:c.tags,extra:c.extra,attachments:this.attachments,...o};e!=null&&e.excludeInputs||(l.inputs=c.inputs),await this.client.updateRun(c.id,l,{apiKey:s,apiUrl:a,workspaceId:i})}else try{const n={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:((t=this.parent_run)==null?void 0:t.id)??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e!=null&&e.excludeInputs||(n.inputs=this.inputs),await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var l,u,d,h;const n=e==null?void 0:e.callbacks;let s,a,i,o=Qg();if(n){const f=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",m=(u=n==null?void 0:n.handlers)==null?void 0:u.find(v=>(v==null?void 0:v.name)=="langchain_tracer");s=(d=m==null?void 0:m.getRun)==null?void 0:d.call(m,f),a=m==null?void 0:m.projectName,i=m==null?void 0:m.client,o=o||!!m}return s?new We({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new We({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var l;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(u=>{const[d,h]=u.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=i[0].uuid,c={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(l=i.at(-1))==null?void 0:l.uuid,trace_id:o,dotted_order:a};if(n.baggage&&typeof n.baggage=="string"){const u=zn.fromHeader(n.baggage);c.metadata=u.metadata,c.tags=u.tags,c.project_name=u.project_name,c.replicas=u.replicas}return new We(c)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new zn((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[s,a]of Object.entries(t))e.set(s,a);return t}}Object.defineProperty(We,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function ty(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function du(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Uc(r){return Array.isArray(r)&&r.some(e=>du(e))}function ry(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function ny(r){var e;return r!=null&&typeof r.callbacks=="object"&&(Uc((e=r.callbacks)==null?void 0:e.handlers)||Uc(r.callbacks))}function sy(r){return r.split(".").map(t=>{const n=t.slice(0,-36),s=t.slice(-36),a=parseInt(n.slice(0,4)),i=parseInt(n.slice(4,6))-1,o=parseInt(n.slice(6,8)),c=parseInt(n.slice(9,11)),l=parseInt(n.slice(11,13)),u=parseInt(n.slice(13,15)),d=parseInt(n.slice(15,21));return[new Date(a,i,o,c,l,u,d/1e3),s]})}function ay(){const r=At("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{const e=JSON.parse(r);if(Array.isArray(e)){const t=[];for(const n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){oy(e);const t=[];for(const[n,s]of Object.entries(e)){const a=n.replace(/\/$/,"");if(typeof s=="string")t.push({apiUrl:a,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof s}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(Fg(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function iy(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):ay()}function oy(r){if(Object.keys(r).length>0&&Ke("ENDPOINT"))throw new Dg}var cy={};ge(cy,{BaseTracer:()=>Mr,isBaseTracer:()=>wr});const ly=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function Ha(r,e){if(r)return new We({...r,start_time:r._serialized_start_time??r.start_time,parent_run:Ha(e),child_runs:r.child_runs.map(t=>Ha(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:Hl()},tracingEnabled:!1})}function xa(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function wr(r){return typeof r._addRunToRunMap=="function"}var Mr=class extends ln{constructor(e){super(...arguments);w(this,"runMap",new Map);w(this,"runTreeMap",new Map);w(this,"usesRunTreeMap",!1)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?ly(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const{dottedOrder:t,microsecondPrecisionDatestring:n}=uu(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},a=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?a&&(this._addChildRun(a,s),a.child_execution_order=Math.max(a.child_execution_order,s.child_execution_order),s.trace_id=a.trace_id,a.dotted_order!==void 0&&(s.dotted_order=[a.dotted_order,t].join("."),s._serialized_start_time=n)):(s.trace_id=s.id,s.dotted_order=t,s._serialized_start_time=n),this.usesRunTreeMap){const i=Ha(s,a);i!==void 0&&this.runTreeMap.set(s.id,i)}else this.runMap.set(s.id,s);return s}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,a,i,o,c){const l=this._getExecutionOrder(s),u=Date.now(),d=o?{...a,metadata:o}:a,h={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,n,s,a,i,o,c){var u,d;const l=this.getRunById(n)??this._createRunForLLMStart(e,t,n,s,a,i,o,c);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}_createRunForChatModelStart(e,t,n,s,a,i,o,c){const l=this._getExecutionOrder(s),u=Date.now(),d=o?{...a,metadata:o}:a,h={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,n,s,a,i,o,c){var u,d;const l=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,s,a,i,o,c);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}async handleLLMEnd(e,t,n,s,a){var o;const i=this.getRunById(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,t,n,s,a){var o;const i=this.getRunById(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,t,n,s,a,i,o,c){const l=this._getExecutionOrder(s),u=Date.now(),d={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,a,i,o,c){var u,d;const l=this.getRunById(n)??this._createRunForChainStart(e,t,n,s,a,i,o,c);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((d=this.onChainStart)==null?void 0:d.call(this,l)),l}async handleChainEnd(e,t,n,s,a){var o;const i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=xa(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=xa(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,t,n,s,a){var o;const i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=xa(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,t,n,s,a,i,o){const c=this._getExecutionOrder(s),l=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:c,child_execution_order:c,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,n,s,a,i,o){var l,u;const c=this.getRunById(n)??this._createRunForToolStart(e,t,n,s,a,i,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((u=this.onToolStart)==null?void 0:u.call(this,c)),c}async handleToolEnd(e,t){var s;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,a,i,o){const c=this._getExecutionOrder(s),l=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:c,child_execution_order:c,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,n,s,a,i,o){var l,u;const c=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,s,a,i,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((u=this.onRetrieverStart)==null?void 0:u.call(this,c)),c}async handleRetrieverEnd(e,t){var s;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,a,i){var c;const o=this.getRunById(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}},Cn={exports:{}};Cn.exports;var Bc;function uy(){return Bc||(Bc=1,(function(r){const t=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,n=(a=0)=>(i,o,c)=>`\x1B[${38+a};2;${i};${o};${c}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,c]of Object.entries(i)){for(const[l,u]of Object.entries(c))i[l]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},c[l]=i[l],a.set(u[0],u[1]);Object.defineProperty(i,o,{value:c,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=n(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,c,l)=>o===c&&c===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:l}=c.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const u=Number.parseInt(l,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(r,"exports",{enumerable:!0,get:s})})(Cn)),Cn.exports}var dy=uy();const hu=sn(dy);var hy={};ge(hy,{ConsoleCallbackHandler:()=>Va});function Ge(r,e){return`${r.open}${e}${r.close}`}function nt(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function zc(r){return typeof r=="string"?r.trim():r==null?r:nt(r,r.toString())}function Gt(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Je}=hu;var Va=class extends Mr{constructor(){super(...arguments);w(this,"name","console_callback_handler")}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?Ge(hu.bold,o):o}).join(" > ");return Ge(Je.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.green,"[chain/start]")} [${t}] Entering Chain run with input: ${nt(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.cyan,"[chain/end]")} [${t}] [${Gt(e)}] Exiting Chain run with output: ${nt(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.red,"[chain/error]")} [${t}] [${Gt(e)}] Chain run errored with error: ${nt(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ge(Je.green,"[llm/start]")} [${t}] Entering LLM run with input: ${nt(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.cyan,"[llm/end]")} [${t}] [${Gt(e)}] Exiting LLM run with output: ${nt(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.red,"[llm/error]")} [${t}] [${Gt(e)}] LLM run errored with error: ${nt(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.green,"[tool/start]")} [${t}] Entering Tool run with input: "${zc(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.cyan,"[tool/end]")} [${t}] [${Gt(e)}] Exiting Tool run with output: "${zc((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.red,"[tool/error]")} [${t}] [${Gt(e)}] Tool run errored with error: ${nt(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${nt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.cyan,"[retriever/end]")} [${t}] [${Gt(e)}] Exiting Retriever run with output: ${nt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(Je.red,"[retriever/error]")} [${t}] [${Gt(e)}] Retriever run errored with error: ${nt(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${Ge(Je.blue,"[agent/action]")} [${n}] Agent selected action: ${nt(t.actions[t.actions.length-1],"[action]")}`)}};let Ia;const fu=()=>{if(Ia===void 0){const r=Wt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Ia=new Qr(r)}return Ia};let fy=class{getStore(){}run(e,t){return t()}};const Aa=Symbol.for("ls:tracing_async_local_storage"),py=new fy;let my=class{getInstance(){return globalThis[Aa]??py}initializeGlobalInstance(e){globalThis[Aa]===void 0&&(globalThis[Aa]=e)}};const gy=new my;function yy(r=!1){const e=gy.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Li(r){return typeof r=="function"&&"langsmith:traceable"in r}var _y={};ge(_y,{LangChainTracer:()=>Rn});var Rn=class pu extends Mr{constructor(t={}){super(t);w(this,"name","langchain_tracer");w(this,"projectName");w(this,"exampleId");w(this,"client");w(this,"replicas");w(this,"usesRunTreeMap",!0);const{exampleId:n,projectName:s,client:a,replicas:i}=t;this.projectName=s??Kl(),this.replicas=i,this.exampleId=n,this.client=a??fu();const o=pu.getTraceableRunTree();o&&this.updateFromRunTree(o)}async persistRun(t){}async onRunCreate(t){const n=this.getRunTreeWithTracingConfig(t.id);await(n==null?void 0:n.postRun())}async onRunUpdate(t){const n=this.getRunTreeWithTracingConfig(t.id);await(n==null?void 0:n.patchRun())}getRun(t){return this.runTreeMap.get(t)}updateFromRunTree(t){this.runTreeMap.set(t.id,t);let n=t;const s=new Set;for(;n.parent_run&&!(s.has(n.id)||(s.add(n.id),!n.parent_run));)n=n.parent_run;s.clear();const a=[n];for(;a.length>0;){const i=a.shift();!i||s.has(i.id)||(s.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&a.push(...i.child_runs))}this.client=t.client??this.client,this.replicas=t.replicas??this.replicas,this.projectName=t.project_name??this.projectName,this.exampleId=t.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(t){const n=this.runTreeMap.get(t);if(n)return new We({...n,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return yy(!0)}catch{return}}};const mu=Symbol.for("ls:tracing_async_local_storage"),Jr=Symbol.for("lc:context_variables"),vy=r=>{globalThis[mu]=r},en=()=>globalThis[mu];let ir;function wy(){const r="default"in jt?jt.default:jt;return new r({autoStart:!0,concurrency:1})}function by(){return typeof ir>"u"&&(ir=wy()),ir}async function $e(r,e){if(e===!0){const t=en();t!==void 0?await t.run(void 0,async()=>r()):await r()}else ir=by(),ir.add(async()=>{const t=en();t!==void 0?await t.run(void 0,async()=>r()):await r()})}async function Ey(){const r=fu();await Promise.allSettled([typeof ir<"u"?ir.onIdle():Promise.resolve(),r.awaitPendingTraceBatches()])}var Ty={};ge(Ty,{awaitAllCallbacks:()=>Ey,consumeCallback:()=>$e});const Sy=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Wt(t)==="true");function gu(r){var n;const e=en();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Jr])==null?void 0:n[r]}const xy=Symbol("lc:configure_hooks"),Iy=()=>gu(xy)||[];var Ay={};ge(Ay,{BaseCallbackManager:()=>yu,BaseRunManager:()=>dn,CallbackManager:()=>It,CallbackManagerForChainRun:()=>vu,CallbackManagerForLLMRun:()=>Za,CallbackManagerForRetrieverRun:()=>_u,CallbackManagerForToolRun:()=>wu,ensureHandler:()=>tn,parseCallbackConfigArg:()=>Oy});function Oy(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var yu=class{setHandler(r){return this.setHandlers([r])}},dn=class{constructor(r,e,t,n,s,a,i,o){this.runId=r,this.handlers=e,this.inheritableHandlers=t,this.tags=n,this.inheritableTags=s,this.metadata=a,this.inheritableMetadata=i,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;try{await((t=e.handleText)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleText: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleCustomEvent(r,e,t,n,s){await Promise.all(this.handlers.map(a=>$e(async()=>{var i;try{await((i=a.handleCustomEvent)==null?void 0:i.call(a,r,e,this.runId,this.tags,this.metadata))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},_u=class extends dn{getChild(r){const e=new It(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleRetrieverEnd(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreRetriever)try{await((t=e.handleRetrieverEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetriever`),e.raiseError)throw n}},e.awaitHandlers)))}async handleRetrieverError(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreRetriever)try{await((t=e.handleRetrieverError)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetrieverError: ${n}`),e.raiseError)throw r}},e.awaitHandlers)))}},Za=class extends dn{async handleLLMNewToken(r,e,t,n,s,a){await Promise.all(this.handlers.map(i=>$e(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMNewToken)==null?void 0:o.call(i,r,e??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMNewToken: ${c}`),i.raiseError)throw c}},i.awaitHandlers)))}async handleLLMError(r,e,t,n,s){await Promise.all(this.handlers.map(a=>$e(async()=>{var i;if(!a.ignoreLLM)try{await((i=a.handleLLMError)==null?void 0:i.call(a,r,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMEnd(r,e,t,n,s){await Promise.all(this.handlers.map(a=>$e(async()=>{var i;if(!a.ignoreLLM)try{await((i=a.handleLLMEnd)==null?void 0:i.call(a,r,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},vu=class extends dn{getChild(r){const e=new It(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleChainError(r,e,t,n,s){await Promise.all(this.handlers.map(a=>$e(async()=>{var i;if(!a.ignoreChain)try{await((i=a.handleChainError)==null?void 0:i.call(a,r,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleChainEnd(r,e,t,n,s){await Promise.all(this.handlers.map(a=>$e(async()=>{var i;if(!a.ignoreChain)try{await((i=a.handleChainEnd)==null?void 0:i.call(a,r,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleAgentAction(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleAgentAction)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentAction: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleAgentEnd(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleAgentEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},wu=class extends dn{getChild(r){const e=new It(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleToolError(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleToolError)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolError: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleToolEnd(r){await Promise.all(this.handlers.map(e=>$e(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleToolEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},It=class qr extends yu{constructor(t,n){super();w(this,"handlers",[]);w(this,"inheritableHandlers",[]);w(this,"tags",[]);w(this,"inheritableTags",[]);w(this,"metadata",{});w(this,"inheritableMetadata",{});w(this,"name","callback_manager");w(this,"_parentRunId");this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,n,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0,l=void 0){return Promise.all(n.map(async(u,d)=>{const h=d===0&&s?s:He();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return wr(f)&&f._createRunForLLMStart(t,[u],h,this._parentRunId,i,this.tags,this.metadata,l),$e(async()=>{var m;try{await((m=f.handleLLMStart)==null?void 0:m.call(f,t,[u],h,this._parentRunId,i,this.tags,this.metadata,l))}catch(v){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${v}`),f.raiseError)throw v}},f.awaitHandlers)})),new Za(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,n,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0,l=void 0){return Promise.all(n.map(async(u,d)=>{const h=d===0&&s?s:He();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return wr(f)&&f._createRunForChatModelStart(t,[u],h,this._parentRunId,i,this.tags,this.metadata,l),$e(async()=>{var m,v;try{if(f.handleChatModelStart)await((m=f.handleChatModelStart)==null?void 0:m.call(f,t,[u],h,this._parentRunId,i,this.tags,this.metadata,l));else if(f.handleLLMStart){const g=Ii(u);await((v=f.handleLLMStart)==null?void 0:v.call(f,t,[g],h,this._parentRunId,i,this.tags,this.metadata,l))}}catch(g){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${g}`),f.raiseError)throw g}},f.awaitHandlers)})),new Za(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,n,s=He(),a=void 0,i=void 0,o=void 0,c=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return wr(l)&&l._createRunForChainStart(t,n,s,this._parentRunId,this.tags,this.metadata,a,c),$e(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,t,n,s,this._parentRunId,this.tags,this.metadata,a,c))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new vu(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,n,s=He(),a=void 0,i=void 0,o=void 0,c=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return wr(l)&&l._createRunForToolStart(t,n,s,this._parentRunId,this.tags,this.metadata,c),$e(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,t,n,s,this._parentRunId,this.tags,this.metadata,c))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new wu(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,n,s=He(),a=void 0,i=void 0,o=void 0,c=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return wr(l)&&l._createRunForRetrieverStart(t,n,s,this._parentRunId,this.tags,this.metadata,c),$e(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,t,n,s,this._parentRunId,this.tags,this.metadata,c))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new _u(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,n,s,a,i){await Promise.all(this.handlers.map(o=>$e(async()=>{var c;if(!o.ignoreCustomEvent)try{await((c=o.handleCustomEvent)==null?void 0:c.call(o,t,n,s,this.tags,this.metadata))}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}addHandler(t,n=!0){this.handlers.push(t),n&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(n=>n!==t),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==t)}setHandlers(t,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const s of t)this.addHandler(s,n)}addTags(t,n=!0){this.removeTags(t),this.tags.push(...t),n&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(n=>!t.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!t.includes(n))}addMetadata(t,n=!0){this.metadata={...this.metadata,...t},n&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const n of Object.keys(t))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(t=[],n=!0){const s=new qr(this._parentRunId);for(const a of this.handlers){const i=this.inheritableHandlers.includes(a);s.addHandler(a,i)}for(const a of this.tags){const i=this.inheritableTags.includes(a);s.addTags([a],i)}for(const a of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(a);s.addMetadata({[a]:this.metadata[a]},i)}for(const a of t)s.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||s.addHandler(a,n);return s}static fromHandlers(t){class n extends ln{constructor(){super();w(this,"name",He());Object.assign(this,t)}}const s=new this;return s.addHandler(new n),s}static configure(t,n,s,a,i,o,c){return this._configureSync(t,n,s,a,i,o,c)}static _configureSync(t,n,s,a,i,o,c){var f;let l;(t||n)&&(Array.isArray(t)||!t?(l=new qr,l.setHandlers((t==null?void 0:t.map(tn))??[],!0)):l=t,l=l.copy(Array.isArray(n)?n.map(tn):n==null?void 0:n.handlers,!1));const u=Wt("LANGCHAIN_VERBOSE")==="true"||(c==null?void 0:c.verbose),d=((f=Rn.getTraceableRunTree())==null?void 0:f.tracingEnabled)||Sy(),h=d||(Wt("LANGCHAIN_TRACING")??!1);if(u||h){if(l||(l=new qr),u&&!l.handlers.some(m=>m.name===Va.prototype.name)){const m=new Va;l.addHandler(m,!0)}if(h&&!l.handlers.some(m=>m.name==="langchain_tracer")&&d){const m=new Rn;l.addHandler(m,!0)}if(d){const m=Rn.getTraceableRunTree();if(m&&l._parentRunId===void 0){l._parentRunId=m.id;const v=l.handlers.find(g=>g.name==="langchain_tracer");v==null||v.updateFromRunTree(m)}}}for(const{contextVar:m,inheritable:v=!0,handlerClass:g,envVar:y}of Iy()){const T=y&&Wt(y)==="true"&&g;let b;const A=m!==void 0?gu(m):void 0;A&&Jl(A)?b=A:T&&(b=new g({})),b!==void 0&&(l||(l=new qr),l.handlers.some(x=>x.name===b.name)||l.addHandler(b,v))}return(s||a)&&l&&(l.addTags(s??[]),l.addTags(a??[],!1)),(i||o)&&l&&(l.addMetadata(i??{}),l.addMetadata(o??{},!1)),l}};function tn(r){return"name"in r?r:ln.fromMethods(r)}var bu=class{getStore(){}run(r,e){return e()}enterWith(r){}};const Cy=new bu,qc=Symbol.for("lc:child_config");var Ry=class{getInstance(){return en()??Cy}getRunnableConfig(){var e,t;return(t=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:t[qc]}runWithConfig(r,e,t){var l;const n=It._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata),s=this.getInstance(),a=s.getStore(),i=n==null?void 0:n.getParentRunId(),o=(l=n==null?void 0:n.handlers)==null?void 0:l.find(u=>(u==null?void 0:u.name)==="langchain_tracer");let c;return o&&i?c=o.getRunTreeWithTracingConfig(i):t||(c=new We({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[qc]:r}),a!==void 0&&a[Jr]!==void 0&&(c===void 0&&(c={}),c[Jr]=a[Jr]),s.run(c,e)}initializeGlobalInstance(r){en()===void 0&&vy(r)}};const Ut=new Ry;var ky={};ge(ky,{AsyncLocalStorageProviderSingleton:()=>Ut,MockAsyncLocalStorage:()=>bu,_CONTEXT_VARIABLES_KEY:()=>Jr});const Oa=25;async function et(r){return It._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Ja(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(tn(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(tn(o),!0);e.callbacks=i}else e.callbacks=new It(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const $y=new Set(["string","number","boolean"]);function fe(r){var n;const e=Ut.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;t=Object.entries(i).reduce((o,[c,l])=>(l!==void 0&&(o[c]=l),o),t)}if(r&&(t=Object.entries(r).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))$y.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function Ie(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:a,runId:i}={}){const o=fe(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function ur(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function tr(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(qn(e))},e.addEventListener("abort",t),e.aborted&&s(qn(e))})]).finally(()=>e.removeEventListener("abort",t))}function qn(r){return(r==null?void 0:r.reason)instanceof Error?r.reason:typeof(r==null?void 0:r.reason)=="string"?new Error(r.reason):new Error("Aborted")}var Ny={};ge(Ny,{AsyncGeneratorWithSetup:()=>mr,IterableReadableStream:()=>pt,atee:()=>Mi,concat:()=>dr,pipeGeneratorWithSetup:()=>Eu});var pt=class Wa extends ReadableStream{constructor(){super(...arguments);w(this,"reader")}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const t=await this.reader.read();return t.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:t.value}}catch(t){throw this.reader.releaseLock(),t}}async return(){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}return{done:!0,value:void 0}}async throw(t){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw t}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){const n=t.getReader();return new Wa({start(s){return a();function a(){return n.read().then(({done:i,value:o})=>{if(i){s.close();return}return s.enqueue(o),a()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(t){return new Wa({async pull(n){const{value:s,done:a}=await t.next();a&&n.close(),n.enqueue(s)},async cancel(n){await t.return(n)}})}};function Mi(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const a=await r.next();for(const i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function dr(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=dr(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var mr=class{constructor(r){w(this,"generator");w(this,"setup");w(this,"config");w(this,"signal");w(this,"firstResult");w(this,"firstResultUsed",!1);var e;this.generator=r.generator,this.config=r.config,this.signal=r.signal??((e=this.config)==null?void 0:e.signal),this.setup=new Promise((t,n)=>{Ut.runWithConfig(ur(r.config),async()=>{this.firstResult=r.generator.next(),r.startSetup?this.firstResult.then(r.startSetup).then(t,n):this.firstResult.then(s=>t(void 0),n)},!0)})}async next(...r){var e;return(e=this.signal)==null||e.throwIfAborted(),this.firstResultUsed?Ut.runWithConfig(ur(this.config),this.signal?async()=>tr(this.generator.next(...r),this.signal):async()=>this.generator.next(...r),!0):(this.firstResultUsed=!0,this.firstResult)}async return(r){return this.generator.return(r)}async throw(r){return this.generator.throw(r)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function Eu(r,e,t,n,...s){const a=new mr({generator:e,startSetup:t,signal:n}),i=await a.setup;return{output:r(a,i,...s),setup:i}}var Py={};ge(Py,{ChatGenerationChunk:()=>Ya,GenerationChunk:()=>rn,RUN_KEY:()=>Ka});const Ka="__run";var rn=class Tu{constructor(e){w(this,"text");w(this,"generationInfo");this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Tu({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ya=class Su extends rn{constructor(t){super(t);w(this,"message");this.message=t.message}concat(t){return new Su({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};/*!
* https://github.com/Starcounter-Jack/JSON-Patch
* (c) 2017-2022 Joachim Wester
* MIT licensed
*/const Ly=Object.prototype.hasOwnProperty;function Xa(r,e){return Ly.call(r,e)}function Qa(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Xa(r,t)&&e.push(t);return e}function ht(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function ei(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function _r(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function My(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function ti(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ti(r[t]))return!0}else if(typeof r=="object"){const t=Qa(r),n=t.length;for(var e=0;e<n;e++)if(ti(r[t[e]]))return!0}}return!1}function Gc(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var jy=class extends Error{constructor(r,e,t,n,s){super(Gc(r,{name:e,index:t,operation:n,tree:s})),this.name=e,this.index=t,this.operation=n,this.tree=s,Object.setPrototypeOf(this,new.target.prototype),this.message=Gc(r,{name:e,index:t,operation:n,tree:s})}},xu={};ge(xu,{JsonPatchError:()=>Ae,_areEquals:()=>nn,applyOperation:()=>or,applyPatch:()=>Rr,applyReducer:()=>Uy,deepClone:()=>Dy,getValueByPointer:()=>Gn,validate:()=>Iu,validator:()=>Hn});const Ae=jy,Dy=ht,Tr={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Gn(t,this.path);n&&(n=ht(n));const s=or(t,{op:"remove",path:this.from}).removed;return or(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=Gn(t,this.from);return or(t,{op:"add",path:this.path,value:ht(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:nn(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var Fy={add:function(r,e,t){return ei(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Tr.move,copy:Tr.copy,test:Tr.test,_get:Tr._get};function Gn(r,e){if(e=="")return r;var t={op:"_get",path:e};return or(r,t),t.value}function or(r,e,t=!1,n=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Hn(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Gn(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=nn(r,e.value),i.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new Ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,r);return i}}else{n||(r=ht(r));const o=(e.path||"").split("/");let c=r,l=1,u=o.length,d,h,f;for(typeof t=="function"?f=t:f=Hn;;){if(h=o[l],h&&h.indexOf("~")!=-1&&(h=My(h)),s&&(h=="__proto__"||h=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(c[h]===void 0?d=o.slice(0,l).join("/"):l==u-1&&(d=e.path),d!==void 0&&f(e,0,r,d)),l++,Array.isArray(c)){if(h==="-")h=c.length;else{if(t&&!ei(h))throw new Ae("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,r);ei(h)&&(h=~~h)}if(l>=u){if(t&&e.op==="add"&&h>c.length)throw new Ae("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,r);const m=Fy[e.op].call(e,c,h,r);if(m.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return m}}else if(l>=u){const m=Tr[e.op].call(e,c,h,r);if(m.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return m}if(c=c[h],t&&l<u&&(!c||typeof c!="object"))throw new Ae("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,r)}}}function Rr(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new Ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=ht(r));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=or(r,e[i],t,!0,s,i),r=a[i].newDocument;return a.newDocument=r,a}function Uy(r,e,t){const n=or(r,e);if(n.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function Hn(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new Ae("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Tr[r.op]){if(typeof r.path!="string")throw new Ae("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new Ae('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new Ae("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new Ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&ti(r.value))throw new Ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new Ae("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new Ae("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=Iu([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ae("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new Ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Iu(r,e,t){try{if(!Array.isArray(r))throw new Ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Rr(ht(e),ht(r),t||!0);else{t=t||Hn;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof Ae)return s;throw s}}function nn(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,a,i;if(t&&n){if(a=r.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!nn(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!nn(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}function Au(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=Qa(e),i=Qa(r),o=!1,c=i.length-1;c>=0;c--){var l=i[c],u=r[l];if(Xa(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?Au(u,d,t,n+"/"+_r(l),s):u!==d&&(s&&t.push({op:"test",path:n+"/"+_r(l),value:ht(u)}),t.push({op:"replace",path:n+"/"+_r(l),value:ht(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+_r(l),value:ht(u)}),t.push({op:"remove",path:n+"/"+_r(l)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&a.length==i.length))for(var c=0;c<a.length;c++){var l=a[c];!Xa(r,l)&&e[l]!==void 0&&t.push({op:"add",path:n+"/"+_r(l),value:ht(e[l])})}}}function ji(r,e,t=!1){var n=[];return Au(r,e,n,"",t),n}({...xu});var By={};ge(By,{LogStreamCallbackHandler:()=>ni,RunLog:()=>Di,RunLogPatch:()=>Lt,isLogStreamHandler:()=>Ou});var Lt=class{constructor(r){w(this,"ops");this.ops=r.ops??[]}concat(r){const e=this.ops.concat(r.ops),t=Rr({},e);return new Di({ops:e,state:t[t.length-1].newDocument})}},Di=class ri extends Lt{constructor(t){super(t);w(this,"state");this.state=t.state}concat(t){const n=this.ops.concat(t.ops),s=Rr(this.state,t.ops);return new ri({ops:n,state:s[s.length-1].newDocument})}static fromRunLogPatch(t){const n=Rr({},t.ops);return new ri({ops:t.ops,state:n[n.length-1].newDocument})}};const Ou=r=>r.name==="log_stream_tracer";async function Hc(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Vc(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function zy(r){return r!==void 0&&r.message!==void 0}var ni=class extends Mr{constructor(e){super({_awaitHandler:!0,...e});w(this,"autoClose",!0);w(this,"includeNames");w(this,"includeTypes");w(this,"includeTags");w(this,"excludeNames");w(this,"excludeTypes");w(this,"excludeTags");w(this,"_schemaFormat","original");w(this,"rootId");w(this,"keyMapByRunId",{});w(this,"counterMapByRunName",{});w(this,"transformStream");w(this,"writer");w(this,"receiveStream");w(this,"name","log_stream_tracer");w(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=pt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Lt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Lt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Hc(e,this._schemaFormat)),await this.writer.write(new Lt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Hc(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Vc(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Lt({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Lt({ops:[{op:"replace",path:"/final_output",value:await Vc(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?zy(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new pr({id:`run-${e.id}`,content:t}):i=t;const o=new Lt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}};function xn({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const qy=r=>r.name==="event_stream_tracer";var Gy=class extends Mr{constructor(e){super({_awaitHandler:!0,...e});w(this,"autoClose",!0);w(this,"includeNames");w(this,"includeTypes");w(this,"includeTags");w(this,"excludeNames");w(this,"excludeTypes");w(this,"excludeTags");w(this,"runInfoMap",new Map);w(this,"tappedPromises",new Map);w(this,"transformStream");w(this,"writer");w(this,"receiveStream");w(this,"name","event_stream_tracer");w(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=pt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function a(o,c){return o==="llm"&&typeof c=="string"?new rn({text:c}):c}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(c=>{o=c}),this.tappedPromises.set(e,i);try{const c={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...c,data:{chunk:a(s.runType,n.value)}},s),yield n.value;for await(const l of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...c,data:{chunk:a(s.runType,l)}},s),yield l}finally{o==null||o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var i,o;const t=xn(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?a=new pr({content:t,id:`run-${e.id}`}):a=n.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?a=new rn({text:t}):a=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,c;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(t.runType==="chat_model"){for(const l of s??[]){if(a!==void 0)break;a=(o=l[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")a={generations:s==null?void 0:s.map(l=>l.map(u=>({text:u.text,generationInfo:u.generationInfo}))),llmOutput:((c=e.outputs)==null?void 0:c.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var i,o;const t=xn(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,a;const t=xn(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,i;const t=xn(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}},Hy={};ge(Hy,{AsyncCaller:()=>os});const Vy=[400,401,402,403,404,405,406,407,409],Zy=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&Vy.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};var os=class{constructor(r){w(this,"maxConcurrency");w(this,"maxRetries");w(this,"onFailedAttempt");w(this,"queue");this.maxConcurrency=r.maxConcurrency??1/0,this.maxRetries=r.maxRetries??6,this.onFailedAttempt=r.onFailedAttempt??Zy;const e="default"in jt?jt.default:jt;this.queue=new e({concurrency:this.maxConcurrency})}call(r,...e){return this.queue.add(()=>Un(()=>r(...e).catch(t=>{throw t instanceof Error?t:new Error(t)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(r,e,...t){return r.signal?Promise.race([this.call(e,...t),new Promise((n,s)=>{var a;(a=r.signal)==null||a.addEventListener("abort",()=>{s(qn(r.signal))})})]):this.call(e,...t)}fetch(...r){return this.call(()=>fetch(...r).then(e=>e.ok?e:Promise.reject(e)))}},Cu=class extends Mr{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0});w(this,"name","RootListenersTracer");w(this,"rootId");w(this,"config");w(this,"argOnStart");w(this,"argOnEnd");w(this,"argOnError");this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function Fi(r){return r?r.lc_runnable:!1}var Jy=class{constructor(r){w(this,"includeNames");w(this,"includeTypes");w(this,"includeTags");w(this,"excludeNames");w(this,"excludeTypes");w(this,"excludeTags");this.includeNames=r.includeNames,this.includeTypes=r.includeTypes,this.includeTags=r.includeTags,this.excludeNames=r.excludeNames,this.excludeTypes=r.excludeTypes,this.excludeTags=r.excludeTags}includeEvent(r,e){let t=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const n=r.tags??[];return this.includeNames!==void 0&&(t=t||this.includeNames.includes(r.name)),this.includeTypes!==void 0&&(t=t||this.includeTypes.includes(e)),this.includeTags!==void 0&&(t=t||n.some(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})),this.excludeNames!==void 0&&(t=t&&!this.excludeNames.includes(r.name)),this.excludeTypes!==void 0&&(t=t&&!this.excludeTypes.includes(e)),this.excludeTags!==void 0&&(t=t&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),t}};function Ca(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const Wy=["*","_","`"];function Ky(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function Yy(r,e,t){const{firstNode:n,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:c=9}=t??{};let l=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const f="default",m={[f]:"{0}({1})"};n!==void 0&&(m[n]="{0}([{1}]):::first"),s!==void 0&&(m[s]="{0}([{1}]):::last");for(const[v,g]of Object.entries(r)){const y=g.name.split(":").pop()??"";let b=Wy.some(x=>y.startsWith(x)&&y.endsWith(x))?`<p>${y}</p>`:y;Object.keys(g.metadata??{}).length&&(b+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([x,I])=>`${x} = ${I}`).join(`
`)}</em></small>`);const A=(m[v]??m[f]).replace("{0}",Ca(v)).replace("{1}",b);l+=`	${A}
`}}const u={};for(const f of e){const m=f.source.split(":"),v=f.target.split(":"),g=m.filter((y,T)=>y===v[T]).join(":");u[g]||(u[g]=[]),u[g].push(f)}const d=new Set;function h(f,m){const v=f.length===1&&f[0].source===f[0].target;if(m&&!v){const g=m.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),l+=`	subgraph ${g}
`}for(const g of f){const{source:y,target:T,data:b,conditional:A}=g;let x="";if(b!==void 0){let I=b;const P=I.split(" ");P.length>c&&(I=Array.from({length:Math.ceil(P.length/c)},(E,ce)=>P.slice(ce*c,(ce+1)*c).join(" ")).join("&nbsp;<br>&nbsp;")),x=A?` -. &nbsp;${I}&nbsp; .-> `:` -- &nbsp;${I}&nbsp; --> `}else x=A?" -.-> ":" --> ";l+=`	${Ca(y)}${x}${Ca(T)};
`}for(const g in u)g.startsWith(`${m}:`)&&g!==m&&h(u[g],g);m&&!v&&(l+=`	end
`)}h(u[""]??[],"");for(const f in u)!f.includes(":")&&f!==""&&h(u[f],f);return i&&(l+=Ky(a??{})),l}async function Xy(r,e){let t=(e==null?void 0:e.backgroundColor)??"white";const n=(e==null?void 0:e.imageType)??"png",s=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const a=`https://mermaid.ink/img/${s}?bgColor=${t}&type=${n}`,i=await fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}var Qy={};ge(Qy,{Graph:()=>Ui});function e_(r,e){if(r!==void 0&&!Vr(r))return r;if(Fi(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function t_(r){return Fi(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Nr(r.data.schema),title:r.data.name}}}var Ui=class Ru{constructor(e){w(this,"nodes",{});w(this,"edges",[]);this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Vr(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...t_(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??He(),a={id:s,data:e,name:e_(t,e),metadata:n};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(a),a}firstNode(){return Zc(this)}lastNode(){return Jc(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(l=>l.id).every(Vr)&&(n="");const a=l=>n?`${n}:${l}`:l;Object.entries(e.nodes).forEach(([l,u])=>{this.nodes[a(l)]={...u,id:a(l)}});const i=e.edges.map(l=>({...l,source:a(l.source),target:a(l.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),c=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,c?{id:a(c.id),data:c.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Zc(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Jc(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const a=e[s];return Vr(s)&&t.get(a)===1?a:s};return new Ru({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[n(s),{...a,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),c=i.lastNode();return Yy(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:c==null?void 0:c.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return Xy(t,{backgroundColor:e==null?void 0:e.backgroundColor})}};function Zc(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function Jc(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function r_(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return pt.fromReadableStream(t)}function Wc(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const n_=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function si(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Kc(r,e){for(;;){const{value:t,done:n}=Ut.runWithConfig(ur(r),e.next.bind(e),!0);if(n)break;yield t}}async function*ai(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await Ut.runWithConfig(ur(r),t.next.bind(e),!0);if(s)break;yield n}}function Me(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var Ce=class extends Or{constructor(){super(...arguments);w(this,"lc_runnable",!0);w(this,"name")}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new Bi({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new kr({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new Mu({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(fe);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>fe(a===0?e:n))}return Array.from({length:t},()=>fe(e))}async batch(e,t,n){var c;const s=this._getOptionsList(t??{},e.length),a=((c=s[0])==null?void 0:c.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new os({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),o=e.map((l,u)=>i.call(async()=>{try{return await this.invoke(l,s[u])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=fe(t),s=new mr({generator:this._streamIterator(e,n),config:n});return await s.setup,pt.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=fe(e):t=fe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=fe(n),a=await et(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Me(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const c=e.call(this,t,s,i);o=await tr(c,n==null?void 0:n.signal)}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(Me(o,"output"))),o}async _batchWithConfig(e,t,n,s){var l;const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(et)),o=await Promise.all(i.map(async(u,d)=>{const h=await(u==null?void 0:u.handleChainStart(this.toJSON(),Me(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,h}));let c;try{const u=e.call(this,t,a,o,s);c=await tr(u,(l=a==null?void 0:a[0])==null?void 0:l.signal)}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Me(c,"output")))),c}_concatOutputChunks(e,t){return dr(e,t)}async*_transformStreamWithConfig(e,t,n){let s,a=!0,i,o=!0;const c=fe(n),l=await et(c),u=this;async function*d(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=u._concatOutputChunks(s,f)}catch{s=void 0,a=!1}yield f}}let h;try{const f=await Eu(t.bind(this),d(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},c.runId,c.runType,void 0,void 0,c.runName??this.getName()),n==null?void 0:n.signal,c);delete c.runId,h=f.setup;const m=h==null?void 0:h.handlers.find(qy);let v=f.output;m!==void 0&&h!==void 0&&(v=m.tapOutputIterable(h.runId,v));const g=h==null?void 0:h.handlers.find(Ou);g!==void 0&&h!==void 0&&(v=g.tapOutputIterable(h.runId,v));for await(const y of v)if(yield y,o)if(i===void 0)i=y;else try{i=this._concatOutputChunks(i,y)}catch{i=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:Me(s,"input")})),f}await(h==null?void 0:h.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:Me(s,"input")}))}getGraph(e){const t=new Ui,n=t.addNode({name:`${this.getName()}Input`,schema:lo()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:lo()});return t.addEdge(n,s),t.addEdge(s,a),t}pipe(e){return new cs({first:this,last:ft(e)})}pick(e){return this.pipe(new ju(e))}assign(e){return this.pipe(new zi(new jr({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=this._concatOutputChunks(n,s);yield*this._streamIterator(n,fe(t))}async*streamLog(e,t,n){const s=new ni({...n,autoClose:!1,_schemaFormat:"original"}),a=fe(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const c=s.copy();c.addHandler(t,!0),n.callbacks=c}const a=this.stream(e,n);async function i(){try{const c=await a;for await(const l of c){const u=new Lt({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(u)}}finally{await t.writer.close()}}const o=i();try{for await(const c of t)yield c}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?r_(s):pt.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var m;const s=new Gy({...n,autoClose:!1}),a=fe(t),i=a.runId??He();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const v=o.copy();v.addHandler(s,!0),a.callbacks=v}const c=new AbortController,l=this;async function u(){let v,g=null;try{t!=null&&t.signal?"any"in AbortSignal?v=AbortSignal.any([c.signal,t.signal]):(v=t.signal,g=()=>{c.abort()},t.signal.addEventListener("abort",g,{once:!0})):v=c.signal;const y=await l.stream(e,{...a,signal:v}),T=s.tapOutputIterable(i,y);for await(const b of T)if(c.signal.aborted)break}finally{await s.finish(),v&&g&&v.removeEventListener("abort",g)}}const d=u();let h=!1,f;try{for await(const v of s){if(!h){v.data.input=e,h=!0,f=v.run_id,yield v;continue}v.run_id===f&&v.event.endsWith("_end")&&(m=v.data)!=null&&m.input&&delete v.data.input,yield v}}finally{c.abort(),await d}}async*_streamEventsV1(e,t,n){let s,a=!1;const i=fe(t),o=i.tags??[],c=i.metadata??{},l=i.runName??this.getName(),u=new ni({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Jy({...n}),h=this._streamLog(e,u,i);for await(const m of h){if(s?s=s.concat(m):s=Di.fromRunLogPatch(m),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const T={...s.state},b={run_id:T.id,event:`on_${T.type}_start`,name:l,tags:o,metadata:c,data:{input:e}};d.includeEvent(b,T.type)&&(yield b)}const v=m.ops.filter(T=>T.path.startsWith("/logs/")).map(T=>T.path.split("/")[2]),g=[...new Set(v)];for(const T of g){let b,A={};const x=s.state.logs[T];if(x.end_time===void 0?x.streamed_output.length>0?b="stream":b="start":b="end",b==="start")x.inputs!==void 0&&(A.input=x.inputs);else if(b==="end")x.inputs!==void 0&&(A.input=x.inputs),A.output=x.final_output;else if(b==="stream"){const I=x.streamed_output.length;if(I!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${I} instead. Encountered in: "${x.name}"`);A={chunk:x.streamed_output[0]},x.streamed_output=[]}yield{event:`on_${x.type}_${b}`,name:x.name,run_id:x.id,tags:x.tags,metadata:x.metadata,data:A}}const{state:y}=s;if(y.streamed_output.length>0){const T=y.streamed_output.length;if(T!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${T} instead. Encountered in: "${y.name}"`);const b={chunk:y.streamed_output[0]};y.streamed_output=[];const A={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:c,name:l,data:b};d.includeEvent(A,y.type)&&(yield A)}}const f=s==null?void 0:s.state;if(f!==void 0){const m={event:`on_${f.type}_end`,name:l,run_id:f.id,tags:o,metadata:c,data:{output:f.final_output}};d.includeEvent(m,f.type)&&(yield m)}}static isRunnable(e){return Fi(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new kr({bound:this,config:{},configFactories:[s=>({callbacks:[new Cu({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return c_(this,e)}},kr=class ku extends Ce{constructor(t){super(t);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"bound");w(this,"config");w(this,"kwargs");w(this,"configFactories");this.bound=t.bound,this.kwargs=t.kwargs,this.config=t.config,this.configFactories=t.configFactories}static lc_name(){return"RunnableBinding"}getName(t){return this.bound.getName(t)}async _mergeConfig(...t){const n=Ja(this.config,...t);return Ja(n,...this.configFactories?await Promise.all(this.configFactories.map(async s=>await s(n))):[])}withConfig(t){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...t}})}withRetry(t){return new Bi({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:t==null?void 0:t.stopAfterAttempt,...t})}async invoke(t,n){return this.bound.invoke(t,await this._mergeConfig(n,this.kwargs))}async batch(t,n,s){const a=Array.isArray(n)?await Promise.all(n.map(async i=>this._mergeConfig(fe(i),this.kwargs))):await this._mergeConfig(fe(n),this.kwargs);return this.bound.batch(t,a,s)}_concatOutputChunks(t,n){return this.bound._concatOutputChunks(t,n)}async*_streamIterator(t,n){yield*this.bound._streamIterator(t,await this._mergeConfig(fe(n),this.kwargs))}async stream(t,n){return this.bound.stream(t,await this._mergeConfig(fe(n),this.kwargs))}async*transform(t,n){yield*this.bound.transform(t,await this._mergeConfig(fe(n),this.kwargs))}streamEvents(t,n,s){const a=this,i=async function*(){yield*a.bound.streamEvents(t,{...await a._mergeConfig(fe(n),a.kwargs),version:n.version},s)};return pt.fromAsyncGenerator(i())}static isRunnableBinding(t){return t.bound&&Ce.isRunnable(t.bound)}withListeners({onStart:t,onEnd:n,onError:s}){return new ku({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new Cu({config:a,onStart:t,onEnd:n,onError:s})]})]})}},s_=class $u extends Ce{constructor(t){super(t);w(this,"lc_serializable",!0);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"bound");this.bound=t.bound}static lc_name(){return"RunnableEach"}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async _invoke(t,n,s){return this.bound.batch(t,Ie(n,{callbacks:s==null?void 0:s.getChild()}))}withListeners({onStart:t,onEnd:n,onError:s}){return new $u({bound:this.bound.withListeners({onStart:t,onEnd:n,onError:s})})}},Bi=class extends kr{constructor(e){super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"maxAttemptNumber",3);w(this,"onFailedAttempt",()=>{});this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}static lc_name(){return"RunnableRetry"}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return Ie(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return Un(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const a={};try{await Un(async i=>{const o=e.map((h,f)=>f).filter(h=>a[h.toString()]===void 0||a[h.toString()]instanceof Error),c=o.map(h=>e[h]),l=o.map(h=>this._patchConfigForRetry(i,t==null?void 0:t[h],n==null?void 0:n[h])),u=await super.batch(c,l,{...s,returnExceptions:!0});let d;for(let h=0;h<u.length;h+=1){const f=u[h],m=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=c[h]),a[m.toString()]=f}if(d)throw d;return u},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},cs=class Gr extends Ce{constructor(t){super(t);w(this,"first");w(this,"middle",[]);w(this,"last");w(this,"omitSequenceTags",!1);w(this,"lc_serializable",!0);w(this,"lc_namespace",["langchain_core","runnables"]);this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name,this.omitSequenceTags=t.omitSequenceTags??this.omitSequenceTags}static lc_name(){return"RunnableSequence"}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,n){var l;const s=fe(n),a=await et(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Me(t,"input"),s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;let o=t,c;try{const u=[this.first,...this.middle];for(let d=0;d<u.length;d+=1){const f=u[d].invoke(o,Ie(s,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));o=await tr(f,n==null?void 0:n.signal)}if((l=n==null?void 0:n.signal)!=null&&l.aborted)throw qn(n.signal);c=await this.last.invoke(o,Ie(s,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(Me(c,"output"))),c}async batch(t,n,s){var l;const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(et)),o=await Promise.all(i.map(async(u,d)=>{const h=await(u==null?void 0:u.handleChainStart(this.toJSON(),Me(t[d],"input"),a[d].runId,void 0,void 0,void 0,a[d].runName));return delete a[d].runId,h}));let c=t;try{for(let u=0;u<this.steps.length;u+=1){const h=this.steps[u].batch(c,o.map((f,m)=>{const v=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return Ie(a[m],{callbacks:v})}),s);c=await tr(h,(l=a[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Me(c,"output")))),c}_concatOutputChunks(t,n){return this.last._concatOutputChunks(t,n)}async*_streamIterator(t,n){var h;const s=await et(n),{runId:a,...i}=n??{},o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Me(t,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),c=[this.first,...this.middle,this.last];let l=!0,u;async function*d(){yield t}try{let f=c[0].transform(d(),Ie(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let m=1;m<c.length;m+=1)f=await c[m].transform(f,Ie(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${m+1}`)}));for await(const m of f)if((h=n==null?void 0:n.signal)==null||h.throwIfAborted(),yield m,l)if(u===void 0)u=m;else try{u=this._concatOutputChunks(u,m)}catch{u=void 0,l=!1}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Me(u,"output")))}getGraph(t){const n=new Ui;let s=null;return this.steps.forEach((a,i)=>{const o=a.getGraph(t);i!==0&&o.trimFirstNode(),i!==this.steps.length-1&&o.trimLastNode(),n.extend(o);const c=o.firstNode();if(!c)throw new Error(`Runnable ${a} has no first node`);s&&n.addEdge(s,c),s=o.lastNode()}),n}pipe(t){return Gr.isRunnableSequence(t)?new Gr({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new Gr({first:this.first,middle:[...this.middle,this.last],last:ft(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&Ce.isRunnable(t)}static from([t,...n],s){let a={};return typeof s=="string"?a.name=s:s!==void 0&&(a=s),new Gr({...a,first:ft(t),middle:n.slice(0,-1).map(ft),last:ft(n[n.length-1])})}},jr=class Nu extends Ce{constructor(t){super(t);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"steps");this.steps={};for(const[n,s]of Object.entries(t.steps))this.steps[n]=ft(s)}static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}static from(t){return new Nu({steps:t})}async invoke(t,n){const s=fe(n),a=await et(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:t},s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;const o={};try{const c=Object.entries(this.steps).map(async([l,u])=>{o[l]=await u.invoke(t,Ie(s,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await tr(Promise.all(c),n==null?void 0:n.signal)}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(o)),o}async*_transform(t,n,s){const a={...this.steps},i=Mi(t,Object.keys(a).length),o=new Map(Object.entries(a).map(([c,l],u)=>{const d=l.transform(i[u],Ie(s,{callbacks:n==null?void 0:n.getChild(`map:key:${c}`)}));return[c,d.next().then(h=>({key:c,gen:d,result:h}))]}));for(;o.size;){const c=Promise.race(o.values()),{key:l,result:u,gen:d}=await tr(c,s==null?void 0:s.signal);o.delete(l),u.done||(yield{[l]:u.value},o.set(l,d.next().then(h=>({key:l,gen:d,result:h}))))}}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*s(){yield t}const a=fe(n),i=new mr({generator:this.transform(s(),a),config:a});return await i.setup,pt.fromAsyncGenerator(i)}},a_=class Pu extends Ce{constructor(t){super(t);w(this,"lc_serializable",!1);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"func");if(!Li(t.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=t.func}async invoke(t,n){const[s]=this._getOptionsList(n??{},1),a=await et(s),i=this.func(Ie(s,{callbacks:a}),t);return tr(i,s==null?void 0:s.signal)}async*_streamIterator(t,n){var i,o;const[s]=this._getOptionsList(n??{},1),a=await this.invoke(t,n);if(si(a)){for await(const c of a)(i=s==null?void 0:s.signal)==null||i.throwIfAborted(),yield c;return}if(n_(a)){for(;;){(o=s==null?void 0:s.signal)==null||o.throwIfAborted();const c=a.next();if(c.done)break;yield c.value}return}yield a}static from(t){return new Pu({func:t})}};function i_(r){if(Li(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var rr=class Lu extends Ce{constructor(t){if(Li(t.func))return a_.from(t.func);super(t);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"func");i_(t.func),this.func=t.func}static lc_name(){return"RunnableLambda"}static from(t){return new Lu({func:t})}async _invoke(t,n,s){return new Promise((a,i)=>{const o=Ie(n,{callbacks:s==null?void 0:s.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Oa)-1});Ut.runWithConfig(ur(o),async()=>{var c,l;try{let u=await this.func(t,{...o});if(u&&Ce.isRunnable(u)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(t,{...o,recursionLimit:(o.recursionLimit??Oa)-1})}else if(si(u)){let d;for await(const h of ai(o,u))if((c=n==null?void 0:n.signal)==null||c.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}u=d}else if(Wc(u)){let d;for(const h of Kc(o,u))if((l=n==null?void 0:n.signal)==null||l.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}u=d}a(u)}catch(u){i(u)}})})}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async*_transform(t,n,s){var c,l;let a;for await(const u of t)if(a===void 0)a=u;else try{a=this._concatOutputChunks(a,u)}catch{a=u}const i=Ie(s,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((s==null?void 0:s.recursionLimit)??Oa)-1}),o=await new Promise((u,d)=>{Ut.runWithConfig(ur(i),async()=>{try{const h=await this.func(a,{...i,config:i});u(h)}catch(h){d(h)}})});if(o&&Ce.isRunnable(o)){if((s==null?void 0:s.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await o.stream(a,i);for await(const d of u)yield d}else if(si(o))for await(const u of ai(i,o))(c=s==null?void 0:s.signal)==null||c.throwIfAborted(),yield u;else if(Wc(o))for(const u of Kc(i,o))(l=s==null?void 0:s.signal)==null||l.throwIfAborted(),yield u;else yield o}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*s(){yield t}const a=fe(n),i=new mr({generator:this.transform(s(),a),config:a});return await i.setup,pt.fromAsyncGenerator(i)}},o_=class extends jr{},Mu=class extends Ce{constructor(e){super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"runnable");w(this,"fallbacks");this.runnable=e.runnable,this.fallbacks=e.fallbacks}static lc_name(){return"RunnableWithFallbacks"}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=fe(t),s=await et(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Me(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),c=Ie(i,{callbacks:o==null?void 0:o.getChild()});return await Ut.runWithConfig(c,async()=>{var d;let u;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,c);return await(o==null?void 0:o.handleChainEnd(Me(f,"output"))),f}catch(f){u===void 0&&(u=f)}}throw u===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(u)),u)})}async*_streamIterator(e,t){var d;const n=fe(t),s=await et(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Me(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let c,l;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=Ie(i,{callbacks:o==null?void 0:o.getChild()});try{const m=await h.stream(e,f);l=ai(f,m);break}catch(m){c===void 0&&(c=m)}}if(l===void 0){const h=c??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let u;try{for await(const h of l){yield h;try{u=u===void 0?u:this._concatOutputChunks(u,h)}catch{u=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(Me(u,"output")))}async batch(e,t,n){var c;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(l=>et(l))),i=await Promise.all(a.map(async(l,u)=>{const d=await(l==null?void 0:l.handleChainStart(this.toJSON(),Me(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o;for(const l of this.runnables()){(c=s[0].signal)==null||c.throwIfAborted();try{const u=await l.batch(e,i.map((d,h)=>Ie(s[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,h)=>d==null?void 0:d.handleChainEnd(Me(u[h],"output")))),u}catch(u){o===void 0&&(o=u)}}throw o?(await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function ft(r){if(typeof r=="function")return new rr({func:r});if(Ce.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=ft(n);return new jr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var zi=class extends Ce{constructor(e){e instanceof jr&&(e={mapper:e});super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"mapper");this.mapper=e.mapper}static lc_name(){return"RunnableAssign"}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[a,i]=Mi(e),o=this.mapper.transform(i,Ie(n,{callbacks:t==null?void 0:t.getChild()})),c=o.next();for await(const l of a){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const u=Object.fromEntries(Object.entries(l).filter(([d])=>!s.includes(d)));Object.keys(u).length>0&&(yield u)}yield(await c).value;for await(const l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=fe(t),a=new mr({generator:this.transform(n(),s),config:s});return await a.setup,pt.fromAsyncGenerator(a)}},ju=class extends Ce{constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e});super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"keys");this.keys=e.keys}static lc_name(){return"RunnablePick"}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=fe(t),a=new mr({generator:this.transform(n(),s),config:s});return await a.setup,pt.fromAsyncGenerator(a)}},ii=class extends kr{constructor(e){const t=cs.from([rr.from(async n=>{let s;if(Fl(n))try{s=await di(this.schema,n.args)}catch{throw new jp("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}});w(this,"name");w(this,"description");w(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function c_(r,e){const t=e.name??r.getName(),n=e.description??hi(e.schema);return ll(e.schema)?new ii({name:t,description:n,schema:gi({input:mi()}).transform(s=>s.input),bound:r}):new ii({name:t,description:n,schema:e.schema,bound:r})}const Vn=(r,e)=>{const t=[...new Set(e==null?void 0:e.map(s=>{if(typeof s=="string")return s;const a=new s({});if(!("getType"in a)||typeof a.getType!="function")throw new Error("Invalid type provided.");return a.getType()}))],n=r.getType();return t.some(s=>s===n)};function l_(r,e){return Array.isArray(r)?Yc(r,e):rr.from(t=>Yc(t,r))}function Yc(r,e={}){const{includeNames:t,excludeNames:n,includeTypes:s,excludeTypes:a,includeIds:i,excludeIds:o}=e,c=[];for(const l of r)if(!(n&&l.name&&n.includes(l.name))){{if(a&&Vn(l,a))continue;if(o&&l.id&&o.includes(l.id))continue}s||i||t?(t&&l.name&&t.some(u=>u===l.name)||s&&Vn(l,s)||i&&l.id&&i.some(u=>u===l.id))&&c.push(l):c.push(l)}return c}function u_(r){return Array.isArray(r)?Xc(r):rr.from(Xc)}function Xc(r){if(!r.length)return[];const e=[];for(const t of r){const n=t,s=e.pop();if(!s)e.push(n);else if(n.getType()==="tool"||n.getType()!==s.getType())e.push(s,n);else{const a=Fn(s),i=Fn(n),o=a.concat(i);typeof a.content=="string"&&typeof i.content=="string"&&(o.content=`${a.content}
${i.content}`),e.push(f_(o))}}return e}function d_(r,e){if(Array.isArray(r)){const t=r;if(!e)throw new Error("Options parameter is required when providing messages.");return Qc(t,e)}else{const t=r;return rr.from(n=>Qc(n,t)).withConfig({runName:"trim_messages"})}}async function Qc(r,e){const{maxTokens:t,tokenCounter:n,strategy:s="last",allowPartial:a=!1,endOn:i,startOn:o,includeSystem:c=!1,textSplitter:l}=e;if(o&&s==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(c&&s==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let u;"getNumTokens"in n?u=async h=>(await Promise.all(h.map(m=>n.getNumTokens(m.content)))).reduce((m,v)=>m+v,0):u=async h=>n(h);let d=Fu;if(l&&("splitText"in l?d=l.splitText:d=async h=>l(h)),s==="first")return Du(r,{maxTokens:t,tokenCounter:u,textSplitter:d,partialStrategy:a?"first":void 0,endOn:i});if(s==="last")return h_(r,{maxTokens:t,tokenCounter:u,textSplitter:d,allowPartial:a,includeSystem:c,startOn:o,endOn:i});throw new Error(`Unrecognized strategy: '${s}'. Must be one of 'first' or 'last'.`)}async function Du(r,e){const{maxTokens:t,tokenCounter:n,textSplitter:s,partialStrategy:a,endOn:i}=e;let o=[...r],c=0;for(let l=0;l<o.length;l+=1){const u=l>0?o.slice(0,-l):o;if(await n(u)<=t){c=o.length-l;break}}if(c<o.length&&a){let l=!1;if(Array.isArray(o[c].content)){const u=o[c];if(typeof u.content=="string")throw new Error("Expected content to be an array.");const d=u.content.length,h=a==="last"?[...u.content].reverse():u.content;for(let f=1;f<=d;f+=1){const m=a==="first"?h.slice(0,f):h.slice(-f),v=Object.fromEntries(Object.entries(u).filter(([T])=>T!=="type"&&!T.startsWith("lc_"))),g=qi(u.getType(),{...v,content:m}),y=[...o.slice(0,c),g];if(await n(y)<=t)o=y,c+=1,l=!0;else break}l&&a==="last"&&(u.content=[...h].reverse())}if(!l){const u=o[c];let d;if(Array.isArray(u.content)&&u.content.some(h=>typeof h=="string"||h.type==="text")){const h=u.content.find(f=>f.type==="text"&&f.text);d=h==null?void 0:h.text}else typeof u.content=="string"&&(d=u.content);if(d){const h=await s(d),f=h.length;a==="last"&&h.reverse();for(let m=0;m<f-1;m+=1)if(h.pop(),u.content=h.join(""),await n([...o.slice(0,c),u])<=t){a==="last"&&(u.content=[...h].reverse().join("")),o=[...o.slice(0,c),u],c+=1;break}}}}if(i){const l=Array.isArray(i)?i:[i];for(;c>0&&!Vn(o[c-1],l);)c-=1}return o.slice(0,c)}async function h_(r,e){var u;const{allowPartial:t=!1,includeSystem:n=!1,endOn:s,startOn:a,...i}=e;let o=r.map(d=>{const h=Object.fromEntries(Object.entries(d).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return qi(d.getType(),h,Ei(d))});if(s){const d=Array.isArray(s)?s:[s];for(;o.length>0&&!Vn(o[o.length-1],d);)o=o.slice(0,-1)}const c=n&&((u=o[0])==null?void 0:u.getType())==="system";let l=c?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return l=await Du(l,{...i,partialStrategy:t?"last":void 0,endOn:a}),c?[l[0],...l.slice(1).reverse()]:l.reverse()}const el={human:{message:zt,messageChunk:es},ai:{message:Qt,messageChunk:pr},system:{message:er,messageChunk:Cr},developer:{message:er,messageChunk:Cr},tool:{message:Pr,messageChunk:Kn},function:{message:Xn,messageChunk:Qn},generic:{message:cn,messageChunk:Yn},remove:{message:Dn,messageChunk:Dn}};function qi(r,e,t){var a;let n,s;switch(r){case"human":t?n=new es(e):s=new zt(e);break;case"ai":if(t){let i={...e};"tool_calls"in i&&(i={...i,tool_call_chunks:(a=i.tool_calls)==null?void 0:a.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),n=new pr(i)}else s=new Qt(e);break;case"system":t?n=new Cr(e):s=new er(e);break;case"developer":t?n=new Cr({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):s=new er({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)t?n=new Kn(e):s=new Pr(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(t)n=new Qn(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");s=new Xn(e)}break;case"generic":if("role"in e)t?n=new Yn(e):s=new cn(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${r}`)}if(t&&n)return n;if(s)return s;throw new Error(`Unrecognized message type ${r}`)}function f_(r){const e=r.getType();let t;const n=Object.fromEntries(Object.entries(r).filter(([s])=>!["type","tool_call_chunks"].includes(s)&&!s.startsWith("lc_")));if(e in el&&(t=qi(e,n)),!t)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(el)}`);return t}function Fu(r){const e=r.split(`
`);return Promise.resolve([...e.slice(0,-1).map(t=>`${t}
`),e[e.length-1]])}const p_=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"],m_=["image","video","audio","text-plain","file"],g_=["text","reasoning",...p_,...m_];var y_={};ge(y_,{AIMessage:()=>Qt,AIMessageChunk:()=>pr,BaseMessage:()=>Bt,BaseMessageChunk:()=>fr,ChatMessage:()=>cn,ChatMessageChunk:()=>Yn,FunctionMessage:()=>Xn,FunctionMessageChunk:()=>Qn,HumanMessage:()=>zt,HumanMessageChunk:()=>es,KNOWN_BLOCK_TYPES:()=>g_,RemoveMessage:()=>Dn,SystemMessage:()=>er,SystemMessageChunk:()=>Cr,ToolMessage:()=>Pr,ToolMessageChunk:()=>Kn,_isMessageFieldWithRole:()=>Cl,_mergeDicts:()=>ze,_mergeLists:()=>on,_mergeObj:()=>Ol,_mergeStatus:()=>Al,coerceMessageLikeToMessage:()=>Hr,convertToChunk:()=>Fn,convertToOpenAIImageBlock:()=>El,convertToProviderContentBlock:()=>Jf,defaultTextSplitter:()=>Fu,defaultToolCallParser:()=>Si,filterMessages:()=>l_,getBufferString:()=>Ii,iife:()=>Dp,isAIMessage:()=>xi,isAIMessageChunk:()=>za,isBase64ContentBlock:()=>_i,isBaseMessage:()=>Mt,isBaseMessageChunk:()=>Ei,isChatMessage:()=>Cp,isChatMessageChunk:()=>Rp,isDataContentBlock:()=>Xt,isDirectToolOutput:()=>Pl,isFunctionMessage:()=>kp,isFunctionMessageChunk:()=>$p,isHumanMessage:()=>Np,isHumanMessageChunk:()=>Pp,isIDContentBlock:()=>bl,isMessage:()=>Il,isOpenAIToolCallArray:()=>vp,isPlainTextContentBlock:()=>Vf,isSystemMessage:()=>Lp,isSystemMessageChunk:()=>Mp,isToolMessage:()=>Ll,isToolMessageChunk:()=>Ml,isURLContentBlock:()=>yi,mapChatMessagesToStoredMessages:()=>qp,mapStoredMessageToChatMessage:()=>Ai,mapStoredMessagesToChatMessages:()=>zp,mergeContent:()=>hr,mergeMessageRuns:()=>u_,mergeResponseMetadata:()=>kl,mergeUsageMetadata:()=>Nl,parseBase64DataUrl:()=>Ua,parseMimeType:()=>Zf,trimMessages:()=>d_});var __={};ge(__,{BasePromptValue:()=>ls,ChatPromptValue:()=>Bu,ImagePromptValue:()=>v_,StringPromptValue:()=>Uu});var ls=class extends Or{},Uu=class extends ls{constructor(e){super({value:e});w(this,"lc_namespace",["langchain_core","prompt_values"]);w(this,"lc_serializable",!0);w(this,"value");this.value=e}static lc_name(){return"StringPromptValue"}toString(){return this.value}toChatMessages(){return[new zt(this.value)]}},Bu=class extends ls{constructor(e){Array.isArray(e)&&(e={messages:e});super(e);w(this,"lc_namespace",["langchain_core","prompt_values"]);w(this,"lc_serializable",!0);w(this,"messages");this.messages=e.messages}static lc_name(){return"ChatPromptValue"}toString(){return Ii(this.messages)}toChatMessages(){return this.messages}},v_=class extends ls{constructor(e){"imageUrl"in e||(e={imageUrl:e});super(e);w(this,"lc_namespace",["langchain_core","prompt_values"]);w(this,"lc_serializable",!0);w(this,"imageUrl");w(this,"value");this.imageUrl=e.imageUrl}static lc_name(){return"ImagePromptValue"}toString(){return this.imageUrl.url}toChatMessages(){return[new zt({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},B="0123456789abcdef".split(""),w_=[-2147483648,8388608,32768,128],lt=[24,16,8,0],In=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Fe=[];function mt(r,e){e?(Fe[0]=Fe[16]=Fe[1]=Fe[2]=Fe[3]=Fe[4]=Fe[5]=Fe[6]=Fe[7]=Fe[8]=Fe[9]=Fe[10]=Fe[11]=Fe[12]=Fe[13]=Fe[14]=Fe[15]=0,this.blocks=Fe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=r}mt.prototype.update=function(r){if(!this.finalized){var e,t=typeof r;if(t!=="string"){if(t==="object"){if(r===null)throw new Error(ERROR);if(ARRAY_BUFFER&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!Array.isArray(r)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(r)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,s=0,a,i=r.length,o=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(a=this.start;s<i&&a<64;++s)o[a>>>2]|=r[s]<<lt[a++&3];else for(a=this.start;s<i&&a<64;++s)n=r.charCodeAt(s),n<128?o[a>>>2]|=n<<lt[a++&3]:n<2048?(o[a>>>2]|=(192|n>>>6)<<lt[a++&3],o[a>>>2]|=(128|n&63)<<lt[a++&3]):n<55296||n>=57344?(o[a>>>2]|=(224|n>>>12)<<lt[a++&3],o[a>>>2]|=(128|n>>>6&63)<<lt[a++&3],o[a>>>2]|=(128|n&63)<<lt[a++&3]):(n=65536+((n&1023)<<10|r.charCodeAt(++s)&1023),o[a>>>2]|=(240|n>>>18)<<lt[a++&3],o[a>>>2]|=(128|n>>>12&63)<<lt[a++&3],o[a>>>2]|=(128|n>>>6&63)<<lt[a++&3],o[a>>>2]|=(128|n&63)<<lt[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};mt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>>2]|=w_[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};mt.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=this.blocks,l,u,d,h,f,m,v,g,y,T,b;for(l=16;l<64;++l)f=c[l-15],u=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,f=c[l-2],d=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,c[l]=c[l-16]+u+c[l-7]+d<<0;for(b=e&t,l=0;l<64;l+=4)this.first?(this.is224?(g=300032,f=c[0]-1413257819,o=f-150054599<<0,n=f+24177077<<0):(g=704751109,f=c[0]-210244248,o=f-1521486534<<0,n=f+143694565<<0),this.first=!1):(u=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),g=r&e,h=g^r&t^b,v=s&a^~s&i,f=o+d+v+In[l]+c[l],m=u+h,o=n+f<<0,n=f+m<<0),u=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),y=n&r,h=y^n&e^g,v=i&o^~i&s,f=a+d+v+In[l+1]+c[l+1],m=u+h,i=t+f<<0,t=f+m<<0,u=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),T=t&n,h=T^t&r^y,v=a&i^~a&o,f=s+d+v+In[l+2]+c[l+2],m=u+h,a=e+f<<0,e=f+m<<0,u=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),b=e&t,h=b^e&n^T,v=a&i^~a&o,f=s+d+v+In[l+3]+c[l+3],m=u+h,s=r+f<<0,r=f+m<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0,this.h5=this.h5+a<<0,this.h6=this.h6+i<<0,this.h7=this.h7+o<<0};mt.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=B[r>>>28&15]+B[r>>>24&15]+B[r>>>20&15]+B[r>>>16&15]+B[r>>>12&15]+B[r>>>8&15]+B[r>>>4&15]+B[r&15]+B[e>>>28&15]+B[e>>>24&15]+B[e>>>20&15]+B[e>>>16&15]+B[e>>>12&15]+B[e>>>8&15]+B[e>>>4&15]+B[e&15]+B[t>>>28&15]+B[t>>>24&15]+B[t>>>20&15]+B[t>>>16&15]+B[t>>>12&15]+B[t>>>8&15]+B[t>>>4&15]+B[t&15]+B[n>>>28&15]+B[n>>>24&15]+B[n>>>20&15]+B[n>>>16&15]+B[n>>>12&15]+B[n>>>8&15]+B[n>>>4&15]+B[n&15]+B[s>>>28&15]+B[s>>>24&15]+B[s>>>20&15]+B[s>>>16&15]+B[s>>>12&15]+B[s>>>8&15]+B[s>>>4&15]+B[s&15]+B[a>>>28&15]+B[a>>>24&15]+B[a>>>20&15]+B[a>>>16&15]+B[a>>>12&15]+B[a>>>8&15]+B[a>>>4&15]+B[a&15]+B[i>>>28&15]+B[i>>>24&15]+B[i>>>20&15]+B[i>>>16&15]+B[i>>>12&15]+B[i>>>8&15]+B[i>>>4&15]+B[i&15];return this.is224||(c+=B[o>>>28&15]+B[o>>>24&15]+B[o>>>20&15]+B[o>>>16&15]+B[o>>>12&15]+B[o>>>8&15]+B[o>>>4&15]+B[o&15]),c};mt.prototype.toString=mt.prototype.hex;mt.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=[r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255];return this.is224||c.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),c};mt.prototype.array=mt.prototype.digest;mt.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(this.is224?28:32),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),r};const zu=(...r)=>new mt(!1,!0).update(r.join("")).hex();var b_={};ge(b_,{sha256:()=>zu});var E_={};ge(E_,{BaseCache:()=>Gu,InMemoryCache:()=>Hu,defaultHashKeyEncoder:()=>qu,deserializeStoredGeneration:()=>T_,serializeGeneration:()=>S_});const qu=(...r)=>zu(r.join("_"));function T_(r){return r.message!==void 0?{text:r.text,message:Ai(r.message)}:{text:r.text}}function S_(r){const e={text:r.text};return r.message!==void 0&&(e.message=r.message.toDict()),e}var Gu=class{constructor(){w(this,"keyEncoder",qu)}makeDefaultKeyEncoder(r){this.keyEncoder=r}};const x_=new Map;var Hu=class Vu extends Gu{constructor(t){super();w(this,"cache");this.cache=t??new Map}lookup(t,n){return Promise.resolve(this.cache.get(this.keyEncoder(t,n))??null)}async update(t,n,s){this.cache.set(this.keyEncoder(t,n),s)}static global(){return new Vu(x_)}},Br={},tl;function I_(){if(tl)return Br;tl=1,Br.byteLength=o,Br.toByteArray=l,Br.fromByteArray=h;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=n.length;s<a;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function i(f){var m=f.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=f.indexOf("=");v===-1&&(v=m);var g=v===m?0:4-v%4;return[v,g]}function o(f){var m=i(f),v=m[0],g=m[1];return(v+g)*3/4-g}function c(f,m,v){return(m+v)*3/4-v}function l(f){var m,v=i(f),g=v[0],y=v[1],T=new t(c(f,g,y)),b=0,A=y>0?g-4:g,x;for(x=0;x<A;x+=4)m=e[f.charCodeAt(x)]<<18|e[f.charCodeAt(x+1)]<<12|e[f.charCodeAt(x+2)]<<6|e[f.charCodeAt(x+3)],T[b++]=m>>16&255,T[b++]=m>>8&255,T[b++]=m&255;return y===2&&(m=e[f.charCodeAt(x)]<<2|e[f.charCodeAt(x+1)]>>4,T[b++]=m&255),y===1&&(m=e[f.charCodeAt(x)]<<10|e[f.charCodeAt(x+1)]<<4|e[f.charCodeAt(x+2)]>>2,T[b++]=m>>8&255,T[b++]=m&255),T}function u(f){return r[f>>18&63]+r[f>>12&63]+r[f>>6&63]+r[f&63]}function d(f,m,v){for(var g,y=[],T=m;T<v;T+=3)g=(f[T]<<16&16711680)+(f[T+1]<<8&65280)+(f[T+2]&255),y.push(u(g));return y.join("")}function h(f){for(var m,v=f.length,g=v%3,y=[],T=16383,b=0,A=v-g;b<A;b+=T)y.push(d(f,b,b+T>A?A:b+T));return g===1?(m=f[v-1],y.push(r[m>>2]+r[m<<4&63]+"==")):g===2&&(m=(f[v-2]<<8)+f[v-1],y.push(r[m>>10]+r[m>>4&63]+r[m<<2&63]+"=")),y.join("")}return Br}var A_=I_();const O_=sn(A_);var C_=Object.defineProperty,R_=(r,e,t)=>e in r?C_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,k_=(r,e,t)=>(R_(r,e+"",t),t);function $_(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const a=r.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function N_(r,e){return r.length===1?[e.get(r.join(","))]:$_(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function P_(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var oi=class{constructor(r,e){w(this,"specialTokens");w(this,"inverseSpecialTokens");w(this,"patStr");w(this,"textEncoder",new TextEncoder);w(this,"textDecoder",new TextDecoder("utf-8"));w(this,"rankMap",new Map);w(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,i,...o]=s.split(" "),c=Number.parseInt(i,10);return o.forEach((l,u)=>n[l]=c+u),n},{});for(const[n,s]of Object.entries(t)){const a=O_.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=oi.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!i.has(l)):t);if(o.size>0){const l=oi.specialTokenRegex([...o]),u=r.match(l);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let c=0;for(;;){let l=null,u=c;for(;s.lastIndex=u,l=s.exec(r),!(l==null||i.has(l[0]));)u=l.index+1;const d=(l==null?void 0:l.index)??r.length;for(const f of r.substring(c,d).matchAll(n)){const m=this.textEncoder.encode(f[0]),v=this.rankMap.get(m.join(","));if(v!=null){a.push(v);continue}a.push(...N_(m,this.rankMap))}if(l==null)break;let h=this.specialTokens[l[0]];a.push(h),c=l.index+l[0].length}return a}decode(r){const e=[];let t=0;for(let a=0;a<r.length;++a){const i=r[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},Zu=oi;k_(Zu,"specialTokenRegex",r=>new RegExp(r.map(e=>P_(e)).join("|"),"g"));function L_(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var M_={};ge(M_,{encodingForModel:()=>Gi,getEncoding:()=>Ju});const An={},j_=new os({});async function Ju(r){return r in An||(An[r]=j_.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new Zu(e)).catch(e=>{throw delete An[r],e})),await An[r]}async function Gi(r){return Ju(L_(r))}var D_={};ge(D_,{BaseLangChain:()=>Ku,BaseLanguageModel:()=>Yu,calculateMaxTokens:()=>B_,getEmbeddingContextSize:()=>F_,getModelContextSize:()=>Wu,getModelNameForTiktoken:()=>us,isOpenAITool:()=>U_});const us=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r,F_=r=>{switch(r){case"text-embedding-ada-002":return 8191;default:return 2046}},Wu=r=>{switch(us(r)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}};function U_(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const B_=async({prompt:r,modelName:e})=>{let t;try{t=(await Gi(us(e))).encode(r).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(r.length/4)}return Wu(e)-t},z_=()=>!1;var Ku=class extends Ce{constructor(e){super(e);w(this,"verbose");w(this,"callbacks");w(this,"tags");w(this,"metadata");this.verbose=e.verbose??z_(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}get lc_attributes(){return{callbacks:void 0,verbose:void 0}}},Yu=class extends Ku{constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...a}=n;super({callbacks:e??t,...a});w(this,"caller");w(this,"cache");w(this,"_encoding");typeof s=="object"?this.cache=s:s?this.cache=Hu.global():this.cache=void 0,this.caller=new os(n??{})}get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Gi("modelName"in this?us(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new Uu(e):Array.isArray(e)?new Bu(e.map(Hr)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}},Zn=class extends Ce{constructor(e){super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"func");e&&(this.func=e.func)}static lc_name(){return"RunnablePassthrough"}async invoke(e,t){const n=fe(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=fe(t);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,a)if(s===void 0)s=i;else try{s=dr(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new zi(new jr({steps:e}))}};const q_=r=>r();function Ra(r){const e=r.constructor;return new e({...r,content:r.contentBlocks,response_metadata:{...r.response_metadata,output_version:"v1"}})}var G_={};ge(G_,{BaseChatModel:()=>Xu,SimpleChatModel:()=>H_});function ka(r){const e=[];for(const t of r){let n=t;if(Array.isArray(t.content))for(let s=0;s<t.content.length;s++){const a=t.content[s];(yi(a)||_i(a))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,s),El(a),...t.content.slice(s+1)]}))}e.push(n)}return e}var Xu=class nr extends Yu{constructor(t){super(t);w(this,"lc_namespace",["langchain","chat_models",this._llmType()]);w(this,"disableStreaming",!1);w(this,"outputVersion");this.outputVersion=q_(()=>{const n=t.outputVersion??Wt("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}get callKeys(){return[...super.callKeys,"outputVersion"]}_separateRunnableConfigFromCallOptionsCompat(t){const[n,s]=super._separateRunnableConfigFromCallOptions(t);return s.signal=n.signal,[n,s]}async invoke(t,n){const s=nr._convertInputToPromptValue(t);return(await this.generatePrompt([s],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(t,n,s){throw new Error("Not implemented.")}async*_streamIterator(t,n){var s;if(this._streamResponseChunks===nr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,n);else{const i=nr._convertInputToPromptValue(t).toChatMessages(),[o,c]=this._separateRunnableConfigFromCallOptionsCompat(n),l={...o.metadata,...this.getLsParams(c)},u=await It.configure(o.callbacks,this.callbacks,o.tags,this.tags,l,this.metadata,{verbose:this.verbose}),d={options:c,invocation_params:this==null?void 0:this.invocationParams(c),batch_size:1},h=c.outputVersion??this.outputVersion,f=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[ka(i)],o.runId,void 0,d,void 0,void 0,o.runName));let m,v;try{for await(const g of this._streamResponseChunks(i,c,f==null?void 0:f[0])){if(g.message.id==null){const y=(s=f==null?void 0:f.at(0))==null?void 0:s.runId;y!=null&&g.message._updateId(`run-${y}`)}g.message.response_metadata={...g.generationInfo,...g.message.response_metadata},h==="v1"?yield Ra(g.message):yield g.message,m?m=m.concat(g):m=g,za(g.message)&&g.message.usage_metadata!==void 0&&(v={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}}catch(g){throw await Promise.all((f??[]).map(y=>y==null?void 0:y.handleLLMError(g))),g}await Promise.all((f??[]).map(g=>g==null?void 0:g.handleLLMEnd({generations:[[m]],llmOutput:v})))}}getLsParams(t){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:t.stop,ls_provider:n}}async _generateUncached(t,n,s,a){var f,m;const i=t.map(v=>v.map(Hr));let o;if(a!==void 0&&a.length===i.length)o=a;else{const v={...s.metadata,...this.getLsParams(n)},g=await It.configure(s.callbacks,this.callbacks,s.tags,this.tags,v,this.metadata,{verbose:this.verbose}),y={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};o=await(g==null?void 0:g.handleChatModelStart(this.toJSON(),i.map(ka),s.runId,void 0,y,void 0,void 0,s.runName))}const c=n.outputVersion??this.outputVersion,l=[],u=[];if(!!(o!=null&&o[0].handlers.find(Zl))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==nr.prototype._streamResponseChunks)try{const v=await this._streamResponseChunks(i[0],n,o==null?void 0:o[0]);let g,y;for await(const T of v){if(T.message.id==null){const b=(f=o==null?void 0:o.at(0))==null?void 0:f.runId;b!=null&&T.message._updateId(`run-${b}`)}g===void 0?g=T:g=dr(g,T),za(T.message)&&T.message.usage_metadata!==void 0&&(y={tokenUsage:{promptTokens:T.message.usage_metadata.input_tokens,completionTokens:T.message.usage_metadata.output_tokens,totalTokens:T.message.usage_metadata.total_tokens}})}if(g===void 0)throw new Error("Received empty response from chat model call.");l.push([g]),await(o==null?void 0:o[0].handleLLMEnd({generations:l,llmOutput:y}))}catch(v){throw await(o==null?void 0:o[0].handleLLMError(v)),v}else{const v=await Promise.allSettled(i.map(async(g,y)=>{const T=await this._generate(g,{...n,promptIndex:y},o==null?void 0:o[y]);if(c==="v1")for(const b of T.generations)b.message=Ra(b.message);return T}));await Promise.all(v.map(async(g,y)=>{var T,b,A;if(g.status==="fulfilled"){const x=g.value;for(const I of x.generations){if(I.message.id==null){const P=(T=o==null?void 0:o.at(0))==null?void 0:T.runId;P!=null&&I.message._updateId(`run-${P}`)}I.message.response_metadata={...I.generationInfo,...I.message.response_metadata}}return x.generations.length===1&&(x.generations[0].message.response_metadata={...x.llmOutput,...x.generations[0].message.response_metadata}),l[y]=x.generations,u[y]=x.llmOutput,(b=o==null?void 0:o[y])==null?void 0:b.handleLLMEnd({generations:[x.generations],llmOutput:x.llmOutput})}else return await((A=o==null?void 0:o[y])==null?void 0:A.handleLLMError(g.reason)),Promise.reject(g.reason)}))}const h={generations:l,llmOutput:u.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...u):void 0};return Object.defineProperty(h,Ka,{value:o?{runIds:o==null?void 0:o.map(v=>v.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:t,cache:n,llmStringKey:s,parsedOptions:a,handledOptions:i}){const o=t.map(T=>T.map(Hr)),c={...i.metadata,...this.getLsParams(a)},l=await It.configure(i.callbacks,this.callbacks,i.tags,this.tags,c,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},d=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),o.map(ka),i.runId,void 0,u,void 0,void 0,i.runName)),h=[],m=(await Promise.allSettled(o.map(async(T,b)=>{const A=nr._convertInputToPromptValue(T).toString(),x=await n.lookup(A,s);return x==null&&h.push(b),x}))).map((T,b)=>({result:T,runManager:d==null?void 0:d[b]})).filter(({result:T})=>T.status==="fulfilled"&&T.value!=null||T.status==="rejected"),v=a.outputVersion??this.outputVersion,g=[];await Promise.all(m.map(async({result:T,runManager:b},A)=>{if(T.status==="fulfilled"){const x=T.value;return g[A]=x.map(I=>("message"in I&&Mt(I.message)&&xi(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},v==="v1"&&(I.message=Ra(I.message))),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),x.length&&await(b==null?void 0:b.handleLLMNewToken(x[0].text)),b==null?void 0:b.handleLLMEnd({generations:[x]},void 0,void 0,void 0,{cached:!0})}else return await(b==null?void 0:b.handleLLMError(T.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(T.reason)}));const y={generations:g,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(y,Ka,{value:d?{runIds:d==null?void 0:d.map(T=>T.runId)}:void 0,configurable:!0}),y}async generate(t,n,s){let a;Array.isArray(n)?a={stop:n}:a=n;const i=t.map(v=>v.map(Hr)),[o,c]=this._separateRunnableConfigFromCallOptionsCompat(a);if(o.callbacks=o.callbacks??s,!this.cache)return this._generateUncached(i,c,o);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(c),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:i,cache:l,llmStringKey:u,parsedOptions:c,handledOptions:o});let m={};if(h.length>0){const v=await this._generateUncached(h.map(g=>i[g]),c,o,f!==void 0?h.map(g=>f==null?void 0:f[g]):void 0);await Promise.all(v.generations.map(async(g,y)=>{const T=h[y];d[T]=g;const b=nr._convertInputToPromptValue(i[T]).toString();return l.update(b,u,g)})),m=v.llmOutput??{}}return{generations:d,llmOutput:m}}invocationParams(t){return{}}_modelType(){return"base_chat_model"}async generatePrompt(t,n,s){const a=t.map(i=>i.toChatMessages());return this.generate(a,n,s)}withStructuredOutput(t,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');const s=t,a=n==null?void 0:n.name,i=hi(s)??"A function available to call.",o=n==null?void 0:n.method,c=n==null?void 0:n.includeRaw;if(o==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=a??"extract",u;an(s)?u=[{type:"function",function:{name:l,description:i,parameters:Nr(s)}}]:("name"in s&&(l=s.name),u=[{type:"function",function:{name:l,description:i,parameters:s}}]);const d=this.bindTools(u),h=rr.from(g=>{if(!pr.isInstance(g))throw new Error("Input is not an AIMessageChunk.");if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const y=g.tool_calls.find(T=>T.name===l);if(!y)throw new Error(`No tool call found with name ${l}.`);return y.args});if(!c)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=Zn.assign({parsed:(g,y)=>h.invoke(g.raw,y)}),m=Zn.assign({parsed:()=>null}),v=f.withFallbacks({fallbacks:[m]});return cs.from([{raw:d},v]).withConfig({runName:"StructuredOutputRunnable"})}},H_=class extends Xu{async _generate(r,e,t){const n=await this._call(r,e,t),s=new Qt(n);if(typeof s.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:s.content,message:s}]}}},V_={};ge(V_,{extendInteropZodObject:()=>Yd,getInteropZodDefaultGetter:()=>Qd,getInteropZodObjectShape:()=>$a,getSchemaDescription:()=>hi,interopParse:()=>Jd,interopParseAsync:()=>di,interopSafeParse:()=>Zd,interopSafeParseAsync:()=>cl,interopZodObjectMakeFieldsOptional:()=>rh,interopZodObjectPartial:()=>Xd,interopZodObjectPassthrough:()=>Na,interopZodObjectStrict:()=>kn,interopZodTransformInputSchema:()=>br,isInteropZodLiteral:()=>Vd,isInteropZodObject:()=>Kd,isInteropZodSchema:()=>an,isShapelessZodSchema:()=>Wd,isSimpleStringZodSchema:()=>ll,isZodArrayV4:()=>Jn,isZodLiteralV3:()=>il,isZodLiteralV4:()=>ol,isZodObjectV3:()=>fi,isZodObjectV4:()=>Tt,isZodSchema:()=>Hd,isZodSchemaV3:()=>je,isZodSchemaV4:()=>Re});var Z_=class extends Ce{constructor(e){super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"runnables");this.runnables=e.runnables}static lc_name(){return"RouterRunnable"}async invoke(e,t){const{key:n,input:s}=e,a=this.runnables[n];if(a===void 0)throw new Error(`No runnable associated with key "${n}".`);return a.invoke(s,fe(t))}async batch(e,t,n){var h;const s=e.map(f=>f.key),a=e.map(f=>f.input);if(s.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=s.map(f=>this.runnables[f]),c=this._getOptionsList(t??{},e.length),l=((h=c[0])==null?void 0:h.maxConcurrency)??(n==null?void 0:n.maxConcurrency),u=l&&l>0?l:e.length,d=[];for(let f=0;f<a.length;f+=u){const m=a.slice(f,f+u).map((g,y)=>o[y].invoke(g,c[y])),v=await Promise.all(m);d.push(v)}return d.flat()}async stream(e,t){const{key:n,input:s}=e,a=this.runnables[n];if(a===void 0)throw new Error(`No runnable associated with key "${n}".`);return a.stream(s,t)}},J_=class extends Ce{constructor(e){super(e);w(this,"lc_namespace",["langchain_core","runnables"]);w(this,"lc_serializable",!0);w(this,"default");w(this,"branches");this.branches=e.branches,this.default=e.default}static lc_name(){return"RunnableBranch"}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([a,i])=>[ft(a),ft(i)]),s=ft(e[e.length-1]);return new this({branches:n,default:s})}async _invoke(e,t,n){let s;for(let a=0;a<this.branches.length;a+=1){const[i,o]=this.branches[a];if(await i.invoke(e,Ie(t,{callbacks:n==null?void 0:n.getChild(`condition:${a+1}`)}))){s=await o.invoke(e,Ie(t,{callbacks:n==null?void 0:n.getChild(`branch:${a+1}`)}));break}}return s||(s=await this.default.invoke(e,Ie(t,{callbacks:n==null?void 0:n.getChild("branch:default")}))),s}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const n=await et(t),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),Me(e,"input"),t==null?void 0:t.runId,void 0,void 0,void 0,t==null?void 0:t.runName));let a,i=!0,o;try{for(let c=0;c<this.branches.length;c+=1){const[l,u]=this.branches[c];if(await l.invoke(e,Ie(t,{callbacks:s==null?void 0:s.getChild(`condition:${c+1}`)}))){o=await u.stream(e,Ie(t,{callbacks:s==null?void 0:s.getChild(`branch:${c+1}`)}));for await(const h of o)if(yield h,i)if(a===void 0)a=h;else try{a=dr(a,h)}catch{a=void 0,i=!1}break}}if(o===void 0){o=await this.default.stream(e,Ie(t,{callbacks:s==null?void 0:s.getChild("branch:default")}));for await(const c of o)if(yield c,i)if(a===void 0)a=c;else try{a=dr(a,c)}catch{a=void 0,i=!1}}}catch(c){throw await(s==null?void 0:s.handleChainError(c)),c}await(s==null?void 0:s.handleChainEnd(a??{}))}},W_=class extends kr{constructor(e){let t=rr.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(t=Zn.assign({[n]:t}).withConfig({runName:"insertHistory"}));const s=t.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:s});w(this,"runnable");w(this,"inputMessagesKey");w(this,"outputMessagesKey");w(this,"historyMessagesKey");w(this,"getMessageHistory");this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!Mt(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?t=e[n][0]:t=e[n]}else t=e;if(typeof t=="string")return[new zt(t)];if(Array.isArray(t))return t;if(Mt(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!Mt(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[n]}else t=e;if(typeof t=="string")return[new Qt(t)];if(Array.isArray(t))return t;if(Mt(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){var a;const s=await((a=t==null?void 0:t.configurable)==null?void 0:a.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,t){var c;const n=(c=t.configurable)==null?void 0:c.messageHistory;let s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let a=this._getInputMessages(s);if(this.historyMessagesKey===void 0){const l=await n.getMessages();a=a.slice(l.length)}const i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(i);await n.addMessages([...a,...o])}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const s={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(a)})`)}const{sessionId:n}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(n),t}},K_={};ge(K_,{RouterRunnable:()=>Z_,Runnable:()=>Ce,RunnableAssign:()=>zi,RunnableBinding:()=>kr,RunnableBranch:()=>J_,RunnableEach:()=>s_,RunnableLambda:()=>rr,RunnableMap:()=>jr,RunnableParallel:()=>o_,RunnablePassthrough:()=>Zn,RunnablePick:()=>ju,RunnableRetry:()=>Bi,RunnableSequence:()=>cs,RunnableToolLike:()=>ii,RunnableWithFallbacks:()=>Mu,RunnableWithMessageHistory:()=>W_,_coerceToRunnable:()=>ft,ensureConfig:()=>fe,getCallbackManagerForConfig:()=>et,mergeConfigs:()=>Ja,patchConfig:()=>Ie,pickRunnableConfigKeys:()=>ur});var Qu=class extends Ce{parseResultWithPrompt(r,e,t){return this.parseResult(r,t)}_baseMessageToString(r){return typeof r.content=="string"?r.content:this._baseMessageContentToString(r.content)}_baseMessageContentToString(r){return JSON.stringify(r)}async invoke(r,e){return typeof r=="string"?this._callWithConfig(async(t,n)=>this.parseResult([{text:t}],n==null?void 0:n.callbacks),r,{...e,runType:"parser"}):this._callWithConfig(async(t,n)=>this.parseResult([{message:t,text:this._baseMessageToString(t)}],n==null?void 0:n.callbacks),r,{...e,runType:"parser"})}},ds=class extends Qu{parseResult(r,e){return this.parse(r[0].text,e)}async parseWithPrompt(r,e,t){return this.parse(r,t)}_type(){throw new Error("_type not implemented")}},Dt=class extends Error{constructor(e,t,n,s=!1){super(e);w(this,"llmOutput");w(this,"observation");w(this,"sendToLLM");if(this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Dl(this,"OUTPUT_PARSING_FAILURE")}},hn=class extends ds{async*_transform(r){for await(const e of r)typeof e=="string"?yield this.parseResult([{text:e}]):yield this.parseResult([{message:e,text:this._baseMessageToString(e)}])}async*transform(r,e){yield*this._transformStreamWithConfig(r,this._transform.bind(this),{...e,runType:"parser"})}},hs=class extends hn{constructor(e){super(e);w(this,"diff",!1);this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(Ei(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ya({message:s,text:s.content})}else if(Mt(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ya({message:Fn(s),text:s.content})}else a=new rn({text:s});n===void 0?n=a:n=n.concat(a);const i=await this.parsePartialResult([n]);i!=null&&!ar(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}},Y_=class extends hn{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","bytes"]);w(this,"lc_serializable",!0);w(this,"textEncoder",new TextEncoder)}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},fn=class extends hn{constructor(){super(...arguments);w(this,"re")}async*_transform(e){let t="";for await(const n of e)if(typeof n=="string"?t+=n:t+=n.content,this.re){const s=[...t.matchAll(this.re)];if(s.length>1){let a=0;for(const i of s.slice(0,-1))yield[i[1]],a+=(i.index??0)+i[0].length;t=t.slice(a)}}else{const s=await this.parse(t);if(s.length>1){for(const a of s.slice(0,-1))yield[a];t=s[s.length-1]}}for(const n of await this.parse(t))yield[n]}},X_=class extends fn{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","list"]);w(this,"lc_serializable",!0)}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(t=>t.trim())}catch{throw new Dt(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},Q_=class extends fn{constructor({length:e,separator:t}){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","list"]);w(this,"length");w(this,"separator");this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&t.length!==this.length)throw new Dt(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){throw Object.getPrototypeOf(t)===Dt.prototype?t:new Dt(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},ev=class extends fn{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","list"]);w(this,"lc_serializable",!0);w(this,"re",/\d+\.\s([^\n]+)/g)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},tv=class extends fn{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","list"]);w(this,"lc_serializable",!0);w(this,"re",/^\s*[-*]\s([^\n]+)$/gm)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},rv=class extends hn{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers","string"]);w(this,"lc_serializable",!0)}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,n)=>t+this._messageContentToString(n),"")}},ed=class extends ds{constructor(e){super(e);w(this,"lc_namespace",["langchain","output_parsers","structured"]);this.schema=e}static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=gi(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,mi().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Nr(this.schema))}
\`\`\`
`}async parse(e){var t,n;try{const s=e.trim(),i=(((t=s.match(/^```(?:json)?\s*([\s\S]*?)```/))==null?void 0:t[1])||((n=s.match(/```json\s*([\s\S]*?)```/))==null?void 0:n[1])||s).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,c)=>`"${c.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await di(this.schema,JSON.parse(i))}catch(s){throw new Dt(`Failed to parse. Text: "${e}". Error: ${s}`,e)}}},td=class extends ed{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(r){const e=(r==null?void 0:r.interpolationDepth)??1;if(e<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(Nr(this.schema)).replaceAll("{","{".repeat(e)).replaceAll("}","}".repeat(e))}
\`\`\``}_schemaToInstruction(r,e=2){const t=r;if("type"in t){let n=!1,s;if(Array.isArray(t.type)){const o=t.type.findIndex(c=>c==="null");o!==-1&&(n=!0,t.type.splice(o,1)),s=t.type.join(" | ")}else s=t.type;if(t.type==="object"&&t.properties){const o=t.description?` // ${t.description}`:"";return`{
${Object.entries(t.properties).map(([l,u])=>{var h;const d=(h=t.required)!=null&&h.includes(l)?"":" (optional)";return`${" ".repeat(e)}"${l}": ${this._schemaToInstruction(u,e+2)}${d}`}).join(`
`)}
${" ".repeat(e-2)}}${o}`}if(t.type==="array"&&t.items){const o=t.description?` // ${t.description}`:"";return`array[
${" ".repeat(e)}${this._schemaToInstruction(t.items,e+2)}
${" ".repeat(e-2)}] ${o}`}const a=n?" (nullable)":"",i=t.description?` // ${t.description}`:"";return`${s}${i}${a}`}if("anyOf"in t)return t.anyOf.map(n=>this._schemaToInstruction(n,e)).join(`
${" ".repeat(e-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(r){return new this(r)}static fromNamesAndDescriptions(r){const e=gi(Object.fromEntries(Object.entries(r).map(([t,n])=>[t,mi().describe(n)])));return new this(e)}},nv=class extends ds{constructor({inputSchema:e}){super(...arguments);w(this,"structuredInputParser");this.structuredInputParser=new td(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(n){throw new Dt(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}},sv={};ge(sv,{applyPatch:()=>Rr,compare:()=>ji});var av=class extends hs{constructor(){super(...arguments);w(this,"lc_namespace",["langchain_core","output_parsers"]);w(this,"lc_serializable",!0)}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?ji(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Ba(e[0].text)}async parse(e){return Ba(e,JSON.parse)}getFormatInstructions(){return""}};const iv=function(){const r={};r.parser=function(_,p){return new t(_,p)},r.SAXParser=t,r.SAXStream=l,r.createStream=c,r.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(_,p){if(!(this instanceof t))return new t(_,p);var O=this;s(O),O.q=O.c="",O.bufferCheckPosition=r.MAX_BUFFER_LENGTH,O.opt=p||{},O.opt.lowercase=O.opt.lowercase||O.opt.lowercasetags,O.looseCase=O.opt.lowercase?"toLowerCase":"toUpperCase",O.tags=[],O.closed=O.closedRoot=O.sawRoot=!1,O.tag=O.error=null,O.strict=!!_,O.noscript=!!(_||O.opt.noscript),O.state=E.BEGIN,O.strictEntities=O.opt.strictEntities,O.ENTITIES=O.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),O.attribList=[],O.opt.xmlns&&(O.ns=Object.create(m)),O.trackPosition=O.opt.position!==!1,O.trackPosition&&(O.position=O.line=O.column=0),be(O,"onready")}Object.create||(Object.create=function(_){function p(){}p.prototype=_;var O=new p;return O}),Object.keys||(Object.keys=function(_){var p=[];for(var O in _)_.hasOwnProperty(O)&&p.push(O);return p});function n(_){for(var p=Math.max(r.MAX_BUFFER_LENGTH,10),O=0,S=0,ae=e.length;S<ae;S++){var ye=_[e[S]].length;if(ye>p)switch(e[S]){case"textNode":Ne(_);break;case"cdata":oe(_,"oncdata",_.cdata),_.cdata="";break;case"script":oe(_,"onscript",_.script),_.script="";break;default:N(_,"Max buffer length exceeded: "+e[S])}O=Math.max(O,ye)}var ve=r.MAX_BUFFER_LENGTH-O;_.bufferCheckPosition=ve+_.position}function s(_){for(var p=0,O=e.length;p<O;p++)_[e[p]]=""}function a(_){Ne(_),_.cdata!==""&&(oe(_,"oncdata",_.cdata),_.cdata=""),_.script!==""&&(oe(_,"onscript",_.script),_.script="")}t.prototype={end:function(){$(this)},write:le,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var i=ReadableStream;i||(i=function(){});var o=r.EVENTS.filter(function(_){return _!=="error"&&_!=="end"});function c(_,p){return new l(_,p)}function l(_,p){if(!(this instanceof l))return new l(_,p);i.apply(this),this._parser=new t(_,p),this.writable=!0,this.readable=!0;var O=this;this._parser.onend=function(){O.emit("end")},this._parser.onerror=function(S){O.emit("error",S),O._parser.error=null},this._decoder=null,o.forEach(function(S){Object.defineProperty(O,"on"+S,{get:function(){return O._parser["on"+S]},set:function(ae){if(!ae)return O.removeAllListeners(S),O._parser["on"+S]=ae,ae;O.on(S,ae)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(i.prototype,{constructor:{value:l}}),l.prototype.write=function(_){return this._parser.write(_.toString()),this.emit("data",_),!0},l.prototype.end=function(_){return _&&_.length&&this.write(_),this._parser.end(),!0},l.prototype.on=function(_,p){var O=this;return!O._parser["on"+_]&&o.indexOf(_)!==-1&&(O._parser["on"+_]=function(){var S=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);S.splice(0,0,_),O.emit.apply(O,S)}),i.prototype.on.call(O,_,p)};var u="[CDATA[",d="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",m={xml:h,xmlns:f},v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,T=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function b(_){return _===" "||_===`
`||_==="\r"||_==="	"}function A(_){return _==='"'||_==="'"}function x(_){return _===">"||b(_)}function I(_,p){return _.test(p)}function P(_,p){return!I(_,p)}var E=0;r.STATE={BEGIN:E++,BEGIN_WHITESPACE:E++,TEXT:E++,TEXT_ENTITY:E++,OPEN_WAKA:E++,SGML_DECL:E++,SGML_DECL_QUOTED:E++,DOCTYPE:E++,DOCTYPE_QUOTED:E++,DOCTYPE_DTD:E++,DOCTYPE_DTD_QUOTED:E++,COMMENT_STARTING:E++,COMMENT:E++,COMMENT_ENDING:E++,COMMENT_ENDED:E++,CDATA:E++,CDATA_ENDING:E++,CDATA_ENDING_2:E++,PROC_INST:E++,PROC_INST_BODY:E++,PROC_INST_ENDING:E++,OPEN_TAG:E++,OPEN_TAG_SLASH:E++,ATTRIB:E++,ATTRIB_NAME:E++,ATTRIB_NAME_SAW_WHITE:E++,ATTRIB_VALUE:E++,ATTRIB_VALUE_QUOTED:E++,ATTRIB_VALUE_CLOSED:E++,ATTRIB_VALUE_UNQUOTED:E++,ATTRIB_VALUE_ENTITY_Q:E++,ATTRIB_VALUE_ENTITY_U:E++,CLOSE_TAG:E++,CLOSE_TAG_SAW_WHITE:E++,SCRIPT:E++,SCRIPT_ENDING:E++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(_){var p=r.ENTITIES[_],O=typeof p=="number"?String.fromCharCode(p):p;r.ENTITIES[_]=O});for(var ce in r.STATE)r.STATE[r.STATE[ce]]=ce;E=r.STATE;function be(_,p,O){_[p]&&_[p](O)}function oe(_,p,O){_.textNode&&Ne(_),be(_,p,O)}function Ne(_){_.textNode=it(_.opt,_.textNode),_.textNode&&be(_,"ontext",_.textNode),_.textNode=""}function it(_,p){return _.trim&&(p=p.trim()),_.normalize&&(p=p.replace(/\s+/g," ")),p}function N(_,p){return Ne(_),_.trackPosition&&(p+=`
Line: `+_.line+`
Column: `+_.column+`
Char: `+_.c),p=new Error(p),_.error=p,be(_,"onerror",p),_}function $(_){return _.sawRoot&&!_.closedRoot&&R(_,"Unclosed root tag"),_.state!==E.BEGIN&&_.state!==E.BEGIN_WHITESPACE&&_.state!==E.TEXT&&N(_,"Unexpected end"),Ne(_),_.c="",_.closed=!0,be(_,"onend"),t.call(_,_.strict,_.opt),_}function R(_,p){if(typeof _!="object"||!(_ instanceof t))throw new Error("bad call to strictFail");_.strict&&N(_,p)}function z(_){_.strict||(_.tagName=_.tagName[_.looseCase]());var p=_.tags[_.tags.length-1]||_,O=_.tag={name:_.tagName,attributes:{}};_.opt.xmlns&&(O.ns=p.ns),_.attribList.length=0,oe(_,"onopentagstart",O)}function G(_,p){var O=_.indexOf(":"),S=O<0?["",_]:_.split(":"),ae=S[0],ye=S[1];return p&&_==="xmlns"&&(ae="xmlns",ye=""),{prefix:ae,local:ye}}function U(_){if(_.strict||(_.attribName=_.attribName[_.looseCase]()),_.attribList.indexOf(_.attribName)!==-1||_.tag.attributes.hasOwnProperty(_.attribName)){_.attribName=_.attribValue="";return}if(_.opt.xmlns){var p=G(_.attribName,!0),O=p.prefix,S=p.local;if(O==="xmlns")if(S==="xml"&&_.attribValue!==h)R(_,"xml: prefix must be bound to "+h+`
Actual: `+_.attribValue);else if(S==="xmlns"&&_.attribValue!==f)R(_,"xmlns: prefix must be bound to "+f+`
Actual: `+_.attribValue);else{var ae=_.tag,ye=_.tags[_.tags.length-1]||_;ae.ns===ye.ns&&(ae.ns=Object.create(ye.ns)),ae.ns[S]=_.attribValue}_.attribList.push([_.attribName,_.attribValue])}else _.tag.attributes[_.attribName]=_.attribValue,oe(_,"onattribute",{name:_.attribName,value:_.attribValue});_.attribName=_.attribValue=""}function Z(_,p){if(_.opt.xmlns){var O=_.tag,S=G(_.tagName);O.prefix=S.prefix,O.local=S.local,O.uri=O.ns[S.prefix]||"",O.prefix&&!O.uri&&(R(_,"Unbound namespace prefix: "+JSON.stringify(_.tagName)),O.uri=S.prefix);var ae=_.tags[_.tags.length-1]||_;O.ns&&ae.ns!==O.ns&&Object.keys(O.ns).forEach(function(Nt){oe(_,"onopennamespace",{prefix:Nt,uri:O.ns[Nt]})});for(var ye=0,ve=_.attribList.length;ye<ve;ye++){var Te=_.attribList[ye],Pe=Te[0],Xe=Te[1],Se=G(Pe,!0),Ze=Se.prefix,vt=Se.local,gr=Ze===""?"":O.ns[Ze]||"",M={name:Pe,value:Xe,prefix:Ze,local:vt,uri:gr};Ze&&Ze!=="xmlns"&&!gr&&(R(_,"Unbound namespace prefix: "+JSON.stringify(Ze)),M.uri=Ze),_.tag.attributes[Pe]=M,oe(_,"onattribute",M)}_.attribList.length=0}_.tag.isSelfClosing=!!p,_.sawRoot=!0,_.tags.push(_.tag),oe(_,"onopentag",_.tag),p||(!_.noscript&&_.tagName.toLowerCase()==="script"?_.state=E.SCRIPT:_.state=E.TEXT,_.tag=null,_.tagName=""),_.attribName=_.attribValue="",_.attribList.length=0}function ne(_){if(!_.tagName){R(_,"Weird empty close tag."),_.textNode+="</>",_.state=E.TEXT;return}if(_.script){if(_.tagName!=="script"){_.script+="</"+_.tagName+">",_.tagName="",_.state=E.SCRIPT;return}oe(_,"onscript",_.script),_.script=""}var p=_.tags.length,O=_.tagName;_.strict||(O=O[_.looseCase]());for(var S=O;p--;){var ae=_.tags[p];if(ae.name!==S)R(_,"Unexpected close tag");else break}if(p<0){R(_,"Unmatched closing tag: "+_.tagName),_.textNode+="</"+_.tagName+">",_.state=E.TEXT;return}_.tagName=O;for(var ye=_.tags.length;ye-- >p;){var ve=_.tag=_.tags.pop();_.tagName=_.tag.name,oe(_,"onclosetag",_.tagName);var Te={};for(var Pe in ve.ns)Te[Pe]=ve.ns[Pe];var Xe=_.tags[_.tags.length-1]||_;_.opt.xmlns&&ve.ns!==Xe.ns&&Object.keys(ve.ns).forEach(function(Se){var Ze=ve.ns[Se];oe(_,"onclosenamespace",{prefix:Se,uri:Ze})})}p===0&&(_.closedRoot=!0),_.tagName=_.attribValue=_.attribName="",_.attribList.length=0,_.state=E.TEXT}function ee(_){var p=_.entity,O=p.toLowerCase(),S,ae="";return _.ENTITIES[p]?_.ENTITIES[p]:_.ENTITIES[O]?_.ENTITIES[O]:(p=O,p.charAt(0)==="#"&&(p.charAt(1)==="x"?(p=p.slice(2),S=parseInt(p,16),ae=S.toString(16)):(p=p.slice(1),S=parseInt(p,10),ae=S.toString(10))),p=p.replace(/^0+/,""),isNaN(S)||ae.toLowerCase()!==p?(R(_,"Invalid character entity"),"&"+_.entity+";"):String.fromCodePoint(S))}function ue(_,p){p==="<"?(_.state=E.OPEN_WAKA,_.startTagPosition=_.position):b(p)||(R(_,"Non-whitespace before first tag."),_.textNode=p,_.state=E.TEXT)}function Ee(_,p){var O="";return p<_.length&&(O=_.charAt(p)),O}function le(_){var p=this;if(this.error)throw this.error;if(p.closed)return N(p,"Cannot write after close. Assign an onready handler.");if(_===null)return $(p);typeof _=="object"&&(_=_.toString());for(var O=0,S="";S=Ee(_,O++),p.c=S,!!S;)switch(p.trackPosition&&(p.position++,S===`
`?(p.line++,p.column=0):p.column++),p.state){case E.BEGIN:if(p.state=E.BEGIN_WHITESPACE,S==="\uFEFF")continue;ue(p,S);continue;case E.BEGIN_WHITESPACE:ue(p,S);continue;case E.TEXT:if(p.sawRoot&&!p.closedRoot){for(var ae=O-1;S&&S!=="<"&&S!=="&";)S=Ee(_,O++),S&&p.trackPosition&&(p.position++,S===`
`?(p.line++,p.column=0):p.column++);p.textNode+=_.substring(ae,O-1)}S==="<"&&!(p.sawRoot&&p.closedRoot&&!p.strict)?(p.state=E.OPEN_WAKA,p.startTagPosition=p.position):(!b(S)&&(!p.sawRoot||p.closedRoot)&&R(p,"Text data outside of root node."),S==="&"?p.state=E.TEXT_ENTITY:p.textNode+=S);continue;case E.SCRIPT:S==="<"?p.state=E.SCRIPT_ENDING:p.script+=S;continue;case E.SCRIPT_ENDING:S==="/"?p.state=E.CLOSE_TAG:(p.script+="<"+S,p.state=E.SCRIPT);continue;case E.OPEN_WAKA:if(S==="!")p.state=E.SGML_DECL,p.sgmlDecl="";else if(!b(S))if(I(v,S))p.state=E.OPEN_TAG,p.tagName=S;else if(S==="/")p.state=E.CLOSE_TAG,p.tagName="";else if(S==="?")p.state=E.PROC_INST,p.procInstName=p.procInstBody="";else{if(R(p,"Unencoded <"),p.startTagPosition+1<p.position){var ye=p.position-p.startTagPosition;S=new Array(ye).join(" ")+S}p.textNode+="<"+S,p.state=E.TEXT}continue;case E.SGML_DECL:(p.sgmlDecl+S).toUpperCase()===u?(oe(p,"onopencdata"),p.state=E.CDATA,p.sgmlDecl="",p.cdata=""):p.sgmlDecl+S==="--"?(p.state=E.COMMENT,p.comment="",p.sgmlDecl=""):(p.sgmlDecl+S).toUpperCase()===d?(p.state=E.DOCTYPE,(p.doctype||p.sawRoot)&&R(p,"Inappropriately located doctype declaration"),p.doctype="",p.sgmlDecl=""):S===">"?(oe(p,"onsgmldeclaration",p.sgmlDecl),p.sgmlDecl="",p.state=E.TEXT):(A(S)&&(p.state=E.SGML_DECL_QUOTED),p.sgmlDecl+=S);continue;case E.SGML_DECL_QUOTED:S===p.q&&(p.state=E.SGML_DECL,p.q=""),p.sgmlDecl+=S;continue;case E.DOCTYPE:S===">"?(p.state=E.TEXT,oe(p,"ondoctype",p.doctype),p.doctype=!0):(p.doctype+=S,S==="["?p.state=E.DOCTYPE_DTD:A(S)&&(p.state=E.DOCTYPE_QUOTED,p.q=S));continue;case E.DOCTYPE_QUOTED:p.doctype+=S,S===p.q&&(p.q="",p.state=E.DOCTYPE);continue;case E.DOCTYPE_DTD:p.doctype+=S,S==="]"?p.state=E.DOCTYPE:A(S)&&(p.state=E.DOCTYPE_DTD_QUOTED,p.q=S);continue;case E.DOCTYPE_DTD_QUOTED:p.doctype+=S,S===p.q&&(p.state=E.DOCTYPE_DTD,p.q="");continue;case E.COMMENT:S==="-"?p.state=E.COMMENT_ENDING:p.comment+=S;continue;case E.COMMENT_ENDING:S==="-"?(p.state=E.COMMENT_ENDED,p.comment=it(p.opt,p.comment),p.comment&&oe(p,"oncomment",p.comment),p.comment=""):(p.comment+="-"+S,p.state=E.COMMENT);continue;case E.COMMENT_ENDED:S!==">"?(R(p,"Malformed comment"),p.comment+="--"+S,p.state=E.COMMENT):p.state=E.TEXT;continue;case E.CDATA:S==="]"?p.state=E.CDATA_ENDING:p.cdata+=S;continue;case E.CDATA_ENDING:S==="]"?p.state=E.CDATA_ENDING_2:(p.cdata+="]"+S,p.state=E.CDATA);continue;case E.CDATA_ENDING_2:S===">"?(p.cdata&&oe(p,"oncdata",p.cdata),oe(p,"onclosecdata"),p.cdata="",p.state=E.TEXT):S==="]"?p.cdata+="]":(p.cdata+="]]"+S,p.state=E.CDATA);continue;case E.PROC_INST:S==="?"?p.state=E.PROC_INST_ENDING:b(S)?p.state=E.PROC_INST_BODY:p.procInstName+=S;continue;case E.PROC_INST_BODY:if(!p.procInstBody&&b(S))continue;S==="?"?p.state=E.PROC_INST_ENDING:p.procInstBody+=S;continue;case E.PROC_INST_ENDING:S===">"?(oe(p,"onprocessinginstruction",{name:p.procInstName,body:p.procInstBody}),p.procInstName=p.procInstBody="",p.state=E.TEXT):(p.procInstBody+="?"+S,p.state=E.PROC_INST_BODY);continue;case E.OPEN_TAG:I(g,S)?p.tagName+=S:(z(p),S===">"?Z(p):S==="/"?p.state=E.OPEN_TAG_SLASH:(b(S)||R(p,"Invalid character in tag name"),p.state=E.ATTRIB));continue;case E.OPEN_TAG_SLASH:S===">"?(Z(p,!0),ne(p)):(R(p,"Forward-slash in opening tag not followed by >"),p.state=E.ATTRIB);continue;case E.ATTRIB:if(b(S))continue;S===">"?Z(p):S==="/"?p.state=E.OPEN_TAG_SLASH:I(v,S)?(p.attribName=S,p.attribValue="",p.state=E.ATTRIB_NAME):R(p,"Invalid attribute name");continue;case E.ATTRIB_NAME:S==="="?p.state=E.ATTRIB_VALUE:S===">"?(R(p,"Attribute without value"),p.attribValue=p.attribName,U(p),Z(p)):b(S)?p.state=E.ATTRIB_NAME_SAW_WHITE:I(g,S)?p.attribName+=S:R(p,"Invalid attribute name");continue;case E.ATTRIB_NAME_SAW_WHITE:if(S==="=")p.state=E.ATTRIB_VALUE;else{if(b(S))continue;R(p,"Attribute without value"),p.tag.attributes[p.attribName]="",p.attribValue="",oe(p,"onattribute",{name:p.attribName,value:""}),p.attribName="",S===">"?Z(p):I(v,S)?(p.attribName=S,p.state=E.ATTRIB_NAME):(R(p,"Invalid attribute name"),p.state=E.ATTRIB)}continue;case E.ATTRIB_VALUE:if(b(S))continue;A(S)?(p.q=S,p.state=E.ATTRIB_VALUE_QUOTED):(R(p,"Unquoted attribute value"),p.state=E.ATTRIB_VALUE_UNQUOTED,p.attribValue=S);continue;case E.ATTRIB_VALUE_QUOTED:if(S!==p.q){S==="&"?p.state=E.ATTRIB_VALUE_ENTITY_Q:p.attribValue+=S;continue}U(p),p.q="",p.state=E.ATTRIB_VALUE_CLOSED;continue;case E.ATTRIB_VALUE_CLOSED:b(S)?p.state=E.ATTRIB:S===">"?Z(p):S==="/"?p.state=E.OPEN_TAG_SLASH:I(v,S)?(R(p,"No whitespace between attributes"),p.attribName=S,p.attribValue="",p.state=E.ATTRIB_NAME):R(p,"Invalid attribute name");continue;case E.ATTRIB_VALUE_UNQUOTED:if(!x(S)){S==="&"?p.state=E.ATTRIB_VALUE_ENTITY_U:p.attribValue+=S;continue}U(p),S===">"?Z(p):p.state=E.ATTRIB;continue;case E.CLOSE_TAG:if(p.tagName)S===">"?ne(p):I(g,S)?p.tagName+=S:p.script?(p.script+="</"+p.tagName,p.tagName="",p.state=E.SCRIPT):(b(S)||R(p,"Invalid tagname in closing tag"),p.state=E.CLOSE_TAG_SAW_WHITE);else{if(b(S))continue;P(v,S)?p.script?(p.script+="</"+S,p.state=E.SCRIPT):R(p,"Invalid tagname in closing tag."):p.tagName=S}continue;case E.CLOSE_TAG_SAW_WHITE:if(b(S))continue;S===">"?ne(p):R(p,"Invalid characters in closing tag");continue;case E.TEXT_ENTITY:case E.ATTRIB_VALUE_ENTITY_Q:case E.ATTRIB_VALUE_ENTITY_U:var ve,Te;switch(p.state){case E.TEXT_ENTITY:ve=E.TEXT,Te="textNode";break;case E.ATTRIB_VALUE_ENTITY_Q:ve=E.ATTRIB_VALUE_QUOTED,Te="attribValue";break;case E.ATTRIB_VALUE_ENTITY_U:ve=E.ATTRIB_VALUE_UNQUOTED,Te="attribValue";break}if(S===";")if(p.opt.unparsedEntities){var Pe=ee(p);p.entity="",p.state=ve,p.write(Pe)}else p[Te]+=ee(p),p.entity="",p.state=ve;else I(p.entity.length?T:y,S)?p.entity+=S:(R(p,"Invalid character in entity name"),p[Te]+="&"+p.entity+S,p.entity="",p.state=ve);continue;default:throw new Error(p,"Unknown state: "+p.state)}return p.position>=p.bufferCheckPosition&&n(p),p}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||(function(){var _=String.fromCharCode,p=Math.floor,O=function(){var S=16384,ae=[],ye,ve,Te=-1,Pe=arguments.length;if(!Pe)return"";for(var Xe="";++Te<Pe;){var Se=Number(arguments[Te]);if(!isFinite(Se)||Se<0||Se>1114111||p(Se)!==Se)throw RangeError("Invalid code point: "+Se);Se<=65535?ae.push(Se):(Se-=65536,ye=(Se>>10)+55296,ve=Se%1024+56320,ae.push(ye,ve)),(Te+1===Pe||ae.length>S)&&(Xe+=_.apply(null,ae),ae.length=0)}return Xe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:O,configurable:!0,writable:!0}):String.fromCodePoint=O})(),r},ov=iv(),ci=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var cv=class extends hs{constructor(e){super(e);w(this,"tags");w(this,"lc_namespace",["langchain_core","output_parsers"]);w(this,"lc_serializable",!0);this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,t){if(t)return e?ji(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return li(e[0].text)}async parse(e){return li(e)}getFormatInstructions(){var t;return!!(this.tags&&this.tags.length>0)?ci.replace("{tags}",((t=this.tags)==null?void 0:t.join(", "))??""):ci}};const lv=r=>r.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),rd=r=>{if(Object.keys(r).length===0)return{};const e={};return r.children.length>0?(e[r.name]=r.children.map(rd),e):(e[r.name]=r.text??void 0,e)};function li(r){const e=lv(r),t=ov.parser(!0);let n={};const s=[];t.onopentag=o=>{const c={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};s.length>0?s[s.length-1].children.push(c):n=c,o.isSelfClosing||s.push(c)},t.onclosetag=()=>{if(s.length>0){const o=s.pop();s.length===0&&o&&(n=o)}},t.ontext=o=>{if(s.length>0){const c=s[s.length-1];c.text+=o}},t.onattribute=o=>{if(s.length>0){const c=s[s.length-1];c.attributes[o.name]=o.value}};const a=/```(xml)?(.*)```/s.exec(e),i=a?a[2]:e;return t.write(i).close(),n&&n.name==="?xml"&&(n=n.children[0]),rd(n)}var uv={};ge(uv,{AsymmetricStructuredOutputParser:()=>nv,BaseCumulativeTransformOutputParser:()=>hs,BaseLLMOutputParser:()=>Qu,BaseOutputParser:()=>ds,BaseTransformOutputParser:()=>hn,BytesOutputParser:()=>Y_,CommaSeparatedListOutputParser:()=>X_,CustomListOutputParser:()=>Q_,JsonMarkdownStructuredOutputParser:()=>td,JsonOutputParser:()=>av,ListOutputParser:()=>fn,MarkdownListOutputParser:()=>tv,NumberedListOutputParser:()=>ev,OutputParserException:()=>Dt,StringOutputParser:()=>rv,StructuredOutputParser:()=>ed,XMLOutputParser:()=>cv,XML_FORMAT_INSTRUCTIONS:()=>ci,parseJsonMarkdown:()=>Ba,parsePartialJson:()=>Wn,parseXMLMarkdown:()=>li});function nd(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=Wn(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new Dt([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function dv(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function hv(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}var sd=class extends hs{constructor(e){super(e);w(this,"returnId",!1);w(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);w(this,"lc_serializable",!0);this.returnId=(e==null?void 0:e.returnId)??this.returnId}static lc_name(){return"JsonOutputToolsParser"}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var i;const n=e[0].message;let s;if(xi(n)&&((i=n.tool_calls)!=null&&i.length)?s=n.tool_calls.map(o=>{const{id:c,...l}=o;return this.returnId?{id:c,...l}:l}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(c=>nd(c,{returnId:this.returnId,partial:t}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const c={type:o.name,args:o.args,id:o.id};a.push(c)}return a}},fv=class extends sd{constructor(e){super(e);w(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);w(this,"lc_serializable",!0);w(this,"returnId",!1);w(this,"keyName");w(this,"returnSingle",!1);w(this,"zodSchema");this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}static lc_name(){return"JsonOutputKeyToolsParser"}async _validateResult(e){var n;if(this.zodSchema===void 0)return e;const t=await cl(this.zodSchema,e);if(t.success)return t.data;throw new Dt(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((n=t.error)==null?void 0:n.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}},pv={};ge(pv,{JsonOutputKeyToolsParser:()=>fv,JsonOutputToolsParser:()=>sd,convertLangChainToolCallToOpenAI:()=>dv,makeInvalidToolCall:()=>hv,parseToolCall:()=>nd});function ad(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function id(r){return r!==void 0&&Ce.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function od(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(an(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function cd(r){return od(r)||id(r)||ad(r)}var mv={};ge(mv,{convertToOpenAIFunction:()=>ld,convertToOpenAITool:()=>gv,isLangChainTool:()=>cd,isRunnableToolLike:()=>id,isStructuredTool:()=>ad,isStructuredToolParams:()=>od});function ld(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:Nr(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function gv(r,e){const t=typeof e=="number"?void 0:e;let n;return cd(r)?n={type:"function",function:ld(r)}:n=r,(t==null?void 0:t.strict)!==void 0&&(n.function.strict=t.strict),n}async function yv(r,e,t,n){st(e,"calling-groq"),st(t,""),st(e,"idle")}function rl(r,e){st(e,!Oe(e))}function _v(r,e){var t=document.querySelector("#readability-content");let n=new Blob([t.innerHTML],{type:"text/html"});for(let i of t.children)i.appendChild(document.createTextNode(`
`));let s=new Blob([t.textContent??""],{type:"text/plain"});const a=new window.ClipboardItem({"text/html":n,"text/plain":s});navigator.clipboard.write([a]).then(()=>{st(e,!0),setTimeout(()=>{st(e,!1)},2e3)})}function vv(r,e){var t=document.querySelector("#readability-content");t.hasAttribute("contentEditable")?(t.removeAttribute("contentEditable"),st(e,!1)):(t.setAttribute("contentEditable",!0),st(e,!0))}var wv=(r,e)=>e("highlight"),bv=(r,e)=>e("underline"),Ev=(r,e)=>e("eraser"),Tv=(r,e)=>e()("show"),Sv=(r,e)=>e()("hide"),xv=$r('<div class="absolute top-full left-0 mt-1 px-2 py-1 bg-gray-500 text-white text-xs rounded-md">Copied!</div>'),Iv=$r('<div class="bg-red-500 text-white p-2 rounded-md"> </div>'),Av=$r('<div class="bg-slate-700 text-md text-slate-200 rounded-md h-full h-[300px]"> </div>'),Ov=$r('<div><div class="flex justify-between items-center"><button class="text-slate-400 hover:text-slate-200 focus:outline-hidden"><!></button></div> <div class="space-y-2"><span class="text-xs font-medium">Exract Expert Excerpt</span> <div class="flex flex-row  "><button><!> <span class="ml-1">Highlighter</span></button> <button><!> <span class="ml-1">Underliner</span></button> <button><!> <span class="ml-1">Eraser</span></button></div></div></div> <div class="space-y-4"><div class="flex space-x-2"><div class="flex-1"><span class="text-xs font-medium">Text size</span> <div class="flex bg-slate-700 rounded-md mt-1"></div></div> <div class="flex-1"><span class="text-xs font-medium">Images</span> <div class="flex bg-slate-700 rounded-md mt-1"><button class="flex-1 px-2 py-1 text-xs rounded-l-md hover:bg-slate-600 focus:outline-hidden focus:ring-2 focus:ring-slate-400"><!></button> <button class="flex-1 px-2 py-1 text-xs rounded-r-md hover:bg-slate-600 focus:outline-hidden focus:ring-2 focus:ring-slate-400"><!></button></div></div></div> <div class="space-y-2"><div class="flex"><span class="text-xs font-medium">Words:</span> <div class="flex-1 text-xs bg-slate-700 rounded-md p-2"> </div>  <span class="text-xs font-medium">Copy</span> <div class="relative flex-1 bg-slate-700 rounded-md mt-1"><button class="flex-1 px-2 py-1 text-xs rounded-r-md hover:bg-slate-600 focus:outline-hidden focus:ring-2 focus:ring-slate-400"><!></button> <!></div>  <span class="text-xs font-medium">Edit</span> <div class="relative flex-1 bg-slate-700 rounded-md mt-1"><button><!></button></div></div> <input placeholder="Ask AI any question..." class="w-full bg-slate-700 text-slate-200 border-slate-600 rounded-md p-2"/> <div class="w-full inset-0 bg-linear-to-r from-red-400 via-orange-500 via-pink-300 to-yellow-300  rounded-lg animate-gradient"><button class="w-full bg-slate-700  rounded-lg p-2 m-[5px] hover:bg-slate-600 text-slate-200 px-4 py-2  flex items-center justify-center"><!> </button></div></div> <!> <!></div>',1),Cv=$r('<div class="p-2"><button class="w-8 h-8 bg-slate-700 text-slate-200 rounded-md shadow-md hover:bg-slate-600 focus:outline-hidden focus:ring-2 focus:ring-slate-400 flex items-center justify-center"><!></button></div>'),Rv=$r("<div><!></div>");function kv(r,e){xd(e,!1);const t=Pt();let n=fs(e,"onToggleImages",8),s=fs(e,"onToggleMarkupMode",8),a=fs(e,"article",8,null);const i="Summarize in bullet points and bold topics";let o=Pt(null),c=Pt(""),l=Pt("idle"),u=Pt(""),d=Pt(i),h=Pt(!0),f;function m(I){Oe(o)===I?st(o,null):st(o,I),s()(Oe(o))}let v=Pt(!1),g=Pt(!1);Id(()=>{},()=>{st(t,enumLLMs[f])}),Ad(),Od();var y=Rv();let T;var b=we(y);{var A=I=>{var P=Ov(),E=gt(P),ce=we(E),be=we(ce);be.__click=[rl,h];var oe=we(be);Nd(oe,{size:24});var Ne=De(ce,2),it=De(we(Ne),2),N=we(it);N.__click=[wv,m];var $=we(N);Dd($,{size:16});var R=De(N,2);R.__click=[bv,m];var z=we(R);Bd(z,{size:16});var G=De(R,2);G.__click=[Ev,m];var U=we(G);jd(U,{size:16});var Z=De(E,2),ne=we(Z),ee=De(we(ne),2),ue=De(we(ee),2),Ee=we(ue);Ee.__click=[Tv,n];var le=we(Ee);Fd(le,{size:16});var _=De(Ee,2);_.__click=[Sv,n];var p=we(_);Ld(p,{size:16});var O=De(ne,2),S=we(O),ae=De(we(S),2),ye=we(ae),ve=De(ae,4),Te=we(ve);Te.__click=[_v,v];var Pe=we(Te);Md(Pe,{size:16});var Xe=De(Te,2);{var Se=pe=>{var wt=xv();Be(pe,wt)};pn(Xe,pe=>{Oe(v)&&pe(Se)})}var Ze=De(ve,4),vt=we(Ze);vt.__click=[vv,g];var gr=we(vt);Ud(gr,{size:16});var M=De(S,2),Nt=De(M,2),K=we(Nt);K.__click=[yv,l,u,c];var V=we(K);$d(V,{size:16,class:"mr-2"});var Q=De(V),D=De(O,2);{var L=pe=>{var wt=Iv(),yr=we(wt);mn(()=>gn(yr,Oe(u))),Be(pe,wt)};pn(D,pe=>{Oe(u)&&pe(L)})}var X=De(D,2);{var Y=pe=>{var wt=Av(),yr=we(wt);mn(()=>gn(yr,Oe(c))),Be(pe,wt)};pn(X,pe=>{Oe(c)&&pe(Y)})}mn(pe=>{Dr(N,1,(Oe(o)=="highlight"?"bg-slate-400 ":"")+"px-2 py-1 bg-slate-900 text-xs rounded-md focus:outline-hidden focus:ring-2 focus:ring-slate-400 flex items-center"),Dr(R,1,(Oe(o)=="underline"?"bg-slate-400 ":"")+"px-2 py-1 bg-slate-900 text-xs rounded-md focus:outline-hidden focus:ring-2 focus:ring-slate-400 flex items-center"),Dr(G,1,(Oe(o)=="eraser"?"bg-slate-400 ":"")+"px-2 py-1 bg-slate-900 text-xs rounded-md focus:outline-hidden focus:ring-2 focus:ring-slate-400 flex items-center"),gn(ye,(Rd(a()),Hi(()=>a().word_count))),Dr(vt,1,(Oe(g)?"bg-slate-400 ":"")+"flex-1 px-2 py-1 text-xs rounded-r-md hover:bg-slate-600 focus:outline-hidden focus:ring-2 focus:ring-slate-400"),K.disabled=Oe(l)==="calling-groq",gn(Q,` ${pe??""}`)},[()=>(Oe(l),Oe(t),Hi(()=>Oe(l)==="calling-groq"?"Answering with "+Oe(t).split("-").slice(0,3).join("-"):"AI Generate"))]),kd(M,()=>Oe(d),pe=>st(d,pe)),Be(I,P)},x=I=>{var P=Cv(),E=we(P);E.__click=[rl,h];var ce=we(E);Pd(ce,{size:24}),Be(I,P)};pn(b,I=>{Oe(h)?I(A):I(x,!1)})}mn(I=>T=Dr(y,1,"max-w-[150px] bg-slate-200  h-full overflow-y-auto bg-slate-800 text-slate-200 z-10 transition-all duration-300",null,T,I),[()=>({"w-64":Oe(h),"w-12":!Oe(h)})]),Be(r,y),Cd()}Sd(["click"]);chrome.runtime.onMessage.addListener((r,e,t)=>{console.log("Received message in content script",r),r.action==="activateReadingMode"&&(ud(),t({success:!0}))});async function ud(){var f;if(window.originalHTML){if(document.querySelector("#readability-content")){var r=document.documentElement.innerHTML;r.includes("readability-content")&&(window.readingModeHTML=r),document.documentElement.innerHTML=originalHTML}else r=window.readingModeHTML,document.documentElement.innerHTML=r;return}window.originalHTML=document.documentElement.outerHTML;var e=document.location.href,t=await md(document,{url:e});if(t){let g=function(){window.cssToggleState={stylesheets:[],inlineStyles:new Map,disabled:!1},cssToggleState.disabled?(cssToggleState.stylesheets.forEach(y=>{y.disabled=!1}),cssToggleState.inlineStyles.forEach((y,T)=>{T&&T.setAttribute("style",y)}),cssToggleState.disabled=!1):(cssToggleState.stylesheets=Array.from(document.querySelectorAll('style, link[rel="stylesheet"]')),cssToggleState.stylesheets.forEach(y=>{y.disabled=!0}),cssToggleState.inlineStyles.clear(),document.querySelectorAll("[style]").forEach(y=>{cssToggleState.inlineStyles.set(y,y.getAttribute("style")),y.removeAttribute("style")}),cssToggleState.disabled=!0)};var{title:h,author_short:n,author_cite:s,author:a,date:i,source:o,html:c,cite:l,word_count:u}=t;console.log(c);var d=(i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"")?(f=new Date(i).getFullYear())==null?void 0:f.toString().slice(-2):"";g();var h=document.title;const v=document.createElement("div");v.id="custom-reading-overlay",v.style.position="fixed",v.style.top=0,v.style.left=0,v.style.width="100vw",v.style.height="100vh",v.style.zIndex=999999,v.style.background="rgba(255,255,255,0.98)",v.style.overflow="auto",v.innerHTML=`
  <div class="flex flex-row h-screen overflow-hidden" style="background: linear-gradient(120deg, #f8fafc 0%, #e2e8f0 100%);">
    <div id="reading-mode-controls" class="w-[110px] min-w-[90px] max-w-[140px] overflow-y-auto text-black bg-gradient-to-b from-slate-100 to-slate-200 p-5 shadow-lg border-r border-slate-200">
      <!-- Sidebar content goes here -->
    </div>
    <div id="readability-content" class="flex-1 overflow-y-auto" style="padding: 60px 0; background: transparent;">
      <div class="max-w-3xl mx-auto font-serif text-lg leading-relaxed bg-white/90 rounded-2xl shadow-2xl px-10 py-12 my-10 border border-slate-200"
        style="box-shadow: 0 8px 32px 0 rgba(60,72,88,0.10); margin-left: 15vw; margin-right: 15vw;">
        <div contenteditable class="text-gray-500 mb-4 text-base tracking-wide italic">
          ${n?n+" "+d:""}    
        </div>
        <div class="border-b border-gray-200 text-sm text-gray-500 pb-2 mb-4">
          <p class="mt-2" contenteditable>${t.cite}</p>
        </div>
        <div class="text-2xl font-bold text-slate-700 mb-6 tracking-tight">
          ${t.title}    
        </div>
        <div id="article-text" class="prose prose-lg max-w-none text-slate-800" style="background: none; padding: 0 0 0 0; margin: 0;">
          ${t.html}
        </div>
      </div>
    </div>
  </div>
  <button id="close-reading-overlay" style="
    position: fixed; top: 32px; right: 40px; z-index: 1000000;
    background: #334155; color: #fff; border: none; border-radius: 6px;
    padding: 12px 20px; font-size: 22px; cursor: pointer; box-shadow: 0 2px 8px 0 rgba(30,41,59,0.10);
    transition: background 0.2s;
  " onmouseover="this.style.background='#475569'" onmouseout="this.style.background='#334155'"></button>
`,document.body.appendChild(v),document.getElementById("close-reading-overlay").onclick=()=>{v.remove()},new kv({target:document.getElementById("reading-mode-controls"),props:{onChangeTypography:Nv,onChangeTheme:Pv,onToggleImages:Lv,onToggleMarkupMode:jv,onCollapseControls:Mv,article:t}}),$v(),document.getElementById("readability-content").addEventListener("mouseup",Dv),document.body.setAttribute("style",""),document.documentElement.setAttribute("style",""),console.log("Reading Mode applied successfully")}else console.error("Failed to extract content")}function $v(){const r=document.createElement("style");r.textContent=tailwind.toString()+styles.toString(),document.head.appendChild(r)}function Nv(r){const e=document.getElementById("readability-content");e.style.fontFamily=r==="serif"?"Georgia, serif":"Arial, sans-serif"}function Pv(r){const e=document.getElementById("readability-content");r==="light"?e.style.filter="invert(0)":e.style.filter="invert(1)"}function Lv(r){document.querySelectorAll("#readability-content img").forEach(t=>{t.style.display=r==="hide"?"none":""})}function Mv(){const r=document.getElementById("reading-mode-controls"),e=document.getElementById("hamburger-menu"),t=document.getElementById("readability-content");r.style.display==="none"?(r.style.display="flex",e.style.display="none",t.style.marginTop="5rem"):(r.style.display="none",e.style.display="block",t.style.marginTop="1rem")}let sr=null;function jv(r){const e=document.getElementById("readability-content");sr===r?(e.classList.remove("highlight-cursor","underline-cursor","eraser-cursor"),sr=null):(e.classList.remove("highlight-cursor","underline-cursor","eraser-cursor"),e.classList.add(`${r}-cursor`),sr=r)}function Dv(){if(!sr)return;const r=window.getSelection();if(r.rangeCount===0)return;const e=r.getRangeAt(0);e.toString().trim().length!==0&&(sr==="eraser"?qv(e):sr==="highlight"?Fv(e):sr==="underline"&&Uv(e),r.removeAllRanges())}function Fv(r){dd(r,"highlighted")}function Uv(r){dd(r,"underline-only")}function dd(r,e){const t=document.createNodeIterator(r.commonAncestorContainer,NodeFilter.SHOW_TEXT,a=>r.intersectsNode(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),n=[];let s;for(;s=t.nextNode();)n.push(s);n.forEach(a=>{const i=document.createRange();i.selectNodeContents(a);const o=zv(r,i);o&&Bv(o,e)})}function Bv(r,e){const t=document.createElement("span");t.className=e,r.surroundContents(t)}function zv(r,e){const t=r.compareBoundaryPoints(Range.START_TO_START,e)<0?e.startContainer:r.startContainer,n=r.compareBoundaryPoints(Range.START_TO_START,e)<0?e.startOffset:r.startOffset,s=r.compareBoundaryPoints(Range.END_TO_END,e)>0?e.endContainer:r.endContainer,a=r.compareBoundaryPoints(Range.END_TO_END,e)>0?e.endOffset:r.endOffset,i=document.createRange();return i.setStart(t,n),i.setEnd(s,a),i}function qv(r){const e=document.createNodeIterator(r.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,s=>r.intersectsNode(s)&&(s.classList.contains("highlighted")||s.classList.contains("underline-only")||s.tagName.toLowerCase()==="i"||s.tagName.toLowerCase()==="u")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),t=[];let n;for(;n=e.nextNode();)t.push(n);t.forEach(s=>{const a=s.parentNode;for(;s.firstChild;)a.insertBefore(s.firstChild,s);a.removeChild(s)})}function Gv(r){var a;if(r.keyCode==192&&!r.altKey&&!r.ctrlKey){if(Hv(r.target))return;r.preventDefault(),r.stopPropagation();var e=window==null?void 0:window.getSelection().toString();if(document.location.host.match(/google/gi)&&document.location.href.match(/search/gi)&&((a=document.querySelectorAll("a[href]:has(h3)"))==null?void 0:a.length)>0){var t=qd(document);t.length>0&&(document.location=t[0].url)}else if(e!=null&&e.length){var n=r.shiftKey;zd(e,n)}else ud();var s=document.documentElement.outerHTML;localStorage.setItem("readingModeHTML",s)}}function Hv(r){return r instanceof HTMLImageElement||r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r.textbox||r.textContent&&r.textContent==""||r.ownerDocument&&r.ownerDocument.designMode&&r.ownerDocument.designMode.match(/on/i)}window.addEventListener("keydown",Gv,!1);document.addEventListener("onInvokeChromeAPI",r=>{console.log(JSON.stringify(r.detail)),chrome.runtime.sendMessage(r.detail).then(e=>{console.log(JSON.stringify(e)),document.dispatchEvent(new CustomEvent("onExtractionResult",{detail:e}))})});
